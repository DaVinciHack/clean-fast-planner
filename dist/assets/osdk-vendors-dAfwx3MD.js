var $r=Object.defineProperty;var It=e=>{throw TypeError(e)};var Mr=(e,t,n)=>t in e?$r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var R=(e,t,n)=>Mr(e,typeof t!="symbol"?t+"":t,n),ct=(e,t,n)=>t.has(e)||It("Cannot "+n);var l=(e,t,n)=>(ct(e,t,"read from private field"),n?n.call(e):t.get(e)),w=(e,t,n)=>t.has(e)?It("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),A=(e,t,n,r)=>(ct(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),$=(e,t,n)=>(ct(e,t,"access private method"),n);var Cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ir(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const Dr={centimeter:"CENTIMETERS",centimeters:"CENTIMETERS",cm:"CENTIMETERS",meter:"METERS",meters:"METERS",m:"METERS",kilometer:"KILOMETERS",kilometers:"KILOMETERS",km:"KILOMETERS",inch:"INCHES",inches:"INCHES",foot:"FEET",feet:"FEET",yard:"YARDS",yards:"YARDS",mile:"MILES",miles:"MILES",nautical_mile:"NAUTICAL_MILES",nauticalMile:"NAUTICAL_MILES","nautical miles":"NAUTICAL_MILES"},yn={sec:"SECONDS",seconds:"SECONDS",min:"MINUTES",minute:"MINUTES",minutes:"MINUTES",hr:"HOURS",hrs:"HOURS",hour:"HOURS",hours:"HOURS",day:"DAYS",days:"DAYS",wk:"WEEKS",week:"WEEKS",weeks:"WEEKS",mos:"MONTHS",month:"MONTHS",months:"MONTHS",yr:"YEARS",year:"YEARS",years:"YEARS"},Lr={...yn,quarter:"QUARTERS",quarters:"QUARTERS"},Dt={ms:"MILLISECONDS",milliseconds:"MILLISECONDS",...yn};let pe=class extends Error{constructor(t,n,r,i,o,a){super(t),this.message=t,this.errorName=n,this.errorCode=r,this.statusCode=i,this.errorInstanceId=o,this.parameters=a}},Ur=class extends pe{constructor(t,n,r,i){super(t,n,void 0,i),this.originalError=r}};class xr extends Error{constructor(t){super("Validation Error: "+JSON.stringify(t,null,2)),this.validation=t}}const Kr={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__createMediaReference"},Fr={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__fetchOneByRid"},Br={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__fetchPageByRid"},Wr={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__getBulkLinks"},hn=Symbol("ClientContext"),Jr="__osdkClientContext";class mn extends Error{constructor(t,n,r,i,o,a){super(t),this.message=t,this.errorName=n,this.errorCode=r,this.statusCode=i,this.errorInstanceId=o,this.parameters=a}}class Lt extends mn{constructor(t,n,r){super(t,n),this.originalError=r}}async function O(e,[t,n,r,i,o],...a){const s=n.replace(/\{([^}]+)\}/g,()=>encodeURIComponent(a.shift())),c=r&1?a.shift():void 0,u=r&2?a.shift():void 0,d=r&4?a.shift():void 0,p=["GET","POST","PUT","DELETE","PATCH"][t];return await zr(e[Jr]??e[hn]??e,p,s,c,u,d,i,o)}async function zr(e,t,n,r,i,o,a,s){const c=Vr(e.baseUrl,n);for(const[y,f]of Object.entries(i||{}))if(f!=null)if(Array.isArray(f))for(const m of f)c.searchParams.append(y,m);else c.searchParams.append(y,f);const u=new Headers;u.set("Content-Type",a??"application/json"),u.set("Accept",s??"application/json"),Object.entries(o||{}).forEach(([y,f])=>{f!=null&&u.append(y,f.toString())});const d=r==null||r instanceof globalThis.Blob?r:JSON.stringify(r),p=await e.fetch(c.toString(),{body:d,method:t,headers:u});if(!p.ok)try{const y=await p.json();return new mn(y.message,y.errorName,y.errorCode,p.status,y.errorInstanceId,y.parameters)}catch(y){return y instanceof Error?new Lt(y.message,"UNKNOWN"):new Lt("Unable to parse error response","UNKNOWN")}if(p.status!==204)return s==null||s==="application/json"?await p.json():p}function Vr(e,t){return e+=e.endsWith("/")?"":"/",new URL(`api${t}`,e)}const Hr=[1,"/v2/ontologies/{0}/actions/{1}/apply",3];function qr(e,...t){return O(e,Hr,...t)}const Qr=[1,"/v2/ontologies/{0}/actions/{1}/applyBatch",3];function Gr(e,...t){return O(e,Qr,...t)}const Yr=[0,"/v2/ontologies/{0}/actionTypes/{1}"];function Xr(e,...t){return O(e,Yr,...t)}const Zr=[1,"/v2/ontologies/attachments/upload",7,"*/*"];function Be(e,...t){var r;const n={...t[2],"Content-Type":((r=t[2])==null?void 0:r["Content-Type"])??t[0].type,"Content-Length":t[0].size.toString()};return O(e,Zr,t[0],t[1],n)}const ei=[0,"/v2/ontologies/attachments/{0}/content",,,"*/*"];function ti(e,...t){return O(e,ei,...t)}const ni=[0,"/v2/ontologies/attachments/{0}"];function ri(e,...t){return O(e,ni,...t)}const ii=[0,"/v2/ontologies/{0}/objects/{1}/{2}/media/{3}/content",2,,"*/*"];function oi(e,...t){return O(e,ii,...t)}const ai=[0,"/v2/ontologies/{0}/objects/{1}/{2}/media/{3}/metadata",2];function si(e,...t){return O(e,ai,...t)}const ci=[1,"/v2/ontologies/{0}/objectTypes/{1}/media/{2}/upload",3,"*/*"];function ui(e,...t){return O(e,ci,...t)}const li=[0,"/v2/ontologies/{0}/objectTypes/{1}/fullMetadata",2];function fi(e,...t){return O(e,li,...t)}const di=[0,"/v2/ontologies/{0}/interfaceTypes/{1}",2];function pi(e,...t){return O(e,di,...t)}const yi=[1,"/v2/ontologies/{0}/interfaces/{1}/search",3];function hi(e,...t){return O(e,yi,...t)}const mi=[1,"/v2/ontologies/{0}/objectSets/loadObjects",3];function gi(e,...t){return O(e,mi,...t)}const wi=[1,"/v2/ontologies/{0}/objectSets/loadObjectsMultipleObjectTypes",3];function bi(e,...t){return O(e,wi,...t)}const Ti=[1,"/v2/ontologies/{0}/objectSets/aggregate",3];function Oi(e,...t){return O(e,Ti,...t)}const ji=[1,"/v2/ontologies/{0}/queries/{1}/execute",3];function Ei(e,...t){return O(e,ji,...t)}const Si=[0,"/v2/ontologies/{0}/queryTypes/{1}"];function ki(e,...t){return O(e,Si,...t)}const vi=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/firstPoint",2];function _i(e,...t){return O(e,vi,...t)}const Ai=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/lastPoint",2];function Pi(e,...t){return O(e,Ai,...t)}const Ni=[1,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/streamPoints",3,,"*/*"];function Ri(e,...t){return O(e,Ni,...t)}const $i=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/latestValue",2];function Mi(e,...t){return O(e,$i,...t)}const Ci=[1,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/streamValues",3,,"*/*"];function Ii(e,...t){return O(e,Ci,...t)}async function it({fetchFn:e,baseUrl:t,servicePath:n,tokenProvider:r},i,o,a,s,c,u){a&&(a instanceof URLSearchParams||a instanceof Blob||a instanceof FormData||typeof a=="string"||a instanceof ArrayBuffer||(a=JSON.stringify(a)));const d=Object.entries({}).flatMap(([f,m])=>{if(m==null)return[];if(Array.isArray(m))return m.map(P=>[f,P]);const T=""+m;return T.length===0?[]:[[f,T]]}),p=Object.keys(d).length===0?"":`?${new URLSearchParams(d).toString()}`,y=await(e??fetch)(`${t}${n}${i}${p}`,{method:o,credentials:"same-origin",headers:{"Fetch-User-Agent":"conjure-lite","Content-Type":"application/json",accept:"application/json",...r?{Authorization:`Bearer ${await r()}`}:{}},...a?{body:a}:{}});try{if(y.status===204)return;const f=await Di(y);if(!y.ok)throw new ge("STATUS",void 0,y.status,f);return f}catch(f){throw f instanceof ge?f:f instanceof TypeError?new ge("NETWORK",f):new ge("OTHER",f)}}async function Di(e){const t=e.headers.get("Content-Type")!=null?e.headers.get("Content-Type"):"";try{return t.includes("application/json")?await e.json():t.includes("application/octet-stream")?await e.blob():await e.text()}catch(n){throw new ge("PARSE",n,e.status)}}class ge{constructor(t,n,r,i){R(this,"type");R(this,"originalError");R(this,"status");R(this,"body");this.type=t,this.originalError=n,this.status=r,this.body=i}toString(){return JSON.stringify({body:this.body,originalError:this.originalError&&this.originalError.toString(),status:this.status,type:this.type},null,"  ")}}async function Li(e,t){return it(e,"/bulk-links","PUT",t)}async function Ui(e,t,n){return it(e,"/ontology/ontology/bulkLoadEntities","POST",n)}async function xi(e,t){return it(e,"/ontology/linkTypesForObjectTypes","POST",t)}async function Ki(e,t){return it(e,"/ontology/ontology/ontologies/load/all","POST",t)}var Fi="Invariant failed";function b(e,t){throw new Error(Fi)}function ut(e,t){return{type:e,[e]:t}}function gn({baseUrl:e,fetch:t,tokenProvider:n},r){return{baseUrl:e,servicePath:r,fetchFn:t,tokenProvider:n}}function Bi(e){return e.results}function Wi(e,{pageToken:t}){return t?{...e,pageToken:t}:void 0}async function*Ji(e,t,n,r){let i=r;for(;i;){const o=await e(i);for(const a of t(o))yield a;i=n(i,o)}}function _t(e=new Map,t){function n(r,i){return e.set(r,i),i}return{get:function(r){let i=e.get(r);return i===void 0&&t!==void 0?n(r,t(r)):i},set:n,remove:function(r){return e.delete(r)}}}function wn(e,t,n=_t){const r=n(e==="weak"?new WeakMap:new Map),i=n(e==="weak"?new WeakMap:new Map),o={getOrUndefined:function(a){return r.get(a)},get:async function(a){return r.get(a)??i.get(a)??o.set(a,t(a))},set:async function(a,s){try{const c=await i.set(a,s);return r.set(a,c),i.remove(a),c}catch(c){throw i.remove(a),c}}};return o}let lt;async function zi(e,t){return lt??(lt=await Ki(e,{})),lt.ontologies[t]||b(),lt.ontologies[t].currentOntologyVersion}const re=e=>wn("strong",e).get,Vi=e=>wn("weak",e).get;var z,Y,Ee,Ze,et,Se;class Hi{constructor(t){w(this,z);w(this,Y);w(this,Ee);R(this,"forObjectByRid",re(async t=>Promise.resolve({getPropertyMapping:l(this,Ze).bind(this,t),getLinkMapping:l(this,et).bind(this,t),getRid:()=>t,getApiName:async()=>(await l(this,Se).call(this,t)).apiName})));R(this,"forObjectByApiName",re(async t=>{const n=await l(this,z).ontologyProvider.getObjectDefinition(t);return this.forObjectByRid(n.rid)}));w(this,Ze,re(async t=>{const n=await l(this,Se).call(this,t);return Qi(n)}));w(this,et,re(async t=>{const n=await xi(l(this,Y),{includeObjectTypesWithoutSearchableDatasources:!0,loadRedacted:!1,objectTypeBranches:{},objectTypeVersions:{[t]:await this.ontologyVersion("")}});n.linkTypes[t]||b();const r={};for(const i of n.linkTypes[t]){const o=({apiName:a},s,c)=>{a&&(r[a]={apiName:a,directedLinkTypeRid:{linkTypeRid:i.rid,linkSide:s},otherObjectType:c})};if(i.definition.type==="oneToMany"){const{oneToMany:{objectTypeRidManySide:a,manyToOneLinkMetadata:s,objectTypeRidOneSide:c,oneToManyLinkMetadata:u}}=i.definition;a===t&&o(s,"TARGET",c),c===t&&o(u,"SOURCE",a)}else if(i.definition.type==="manyToMany"){const{manyToMany:{objectTypeRidA:a,objectTypeAToBLinkMetadata:s,objectTypeRidB:c,objectTypeBToALinkMetadata:u}}=i.definition;a===t&&o(s,"SOURCE",c),c===t&&o(u,"TARGET",a)}}return r}));w(this,Se,re(async t=>{var i,o;(i=l(this,Ee))==null||i.debug(`getConjureObjectType(${t})`);const n={datasourceTypes:[],objectTypes:[{identifier:{type:"objectTypeRid",objectTypeRid:t},versionReference:{type:"ontologyVersion",ontologyVersion:await this.ontologyVersion("")}}],linkTypes:[],sharedPropertyTypes:[],interfaceTypes:[],typeGroups:[],loadRedacted:!1,includeObjectTypeCount:void 0,includeObjectTypesWithoutSearchableDatasources:!0,includeEntityMetadata:void 0,actionTypes:[],includeTypeGroupEntitiesCount:void 0,entityMetadata:void 0},r=await Ui(l(this,Y),void 0,n);return(o=r.objectTypes[0])!=null&&o.objectType||b(),r.objectTypes[0].objectType}));R(this,"ontologyVersion",re(async()=>zi(l(this,Y),await l(this,z).ontologyRid)));var n;A(this,z,t),A(this,Y,gn(t,"ontology-metadata/api")),l(this,z).ontologyProvider.getObjectDefinition,A(this,Ee,(n=l(this,z).logger)==null?void 0:n.child({mcc:!0}))}}z=new WeakMap,Y=new WeakMap,Ee=new WeakMap,Ze=new WeakMap,et=new WeakMap,Se=new WeakMap;const qi=Vi(e=>Promise.resolve(new Hi(e)));function Qi(e){e.primaryKeys.length!==1&&b();const t=e.primaryKeys[0],n=Object.values(e.propertyTypes).find(o=>o.rid===t);if(!n)throw new Error(`Could not find PK property by rid: ${t}`);const r=Object.fromEntries(Object.values(e.propertyTypes).map(o=>[o.id,o.apiName])),i=Object.fromEntries(Object.values(e.propertyTypes).map(o=>[o.apiName,o.id]));return{apiName:e.apiName,id:e.id,propertyIdToApiNameMapping:r,propertyApiNameToIdMapping:i,pk:{rid:t,apiName:n.apiName,type:n.type}}}function Gi(e){return async function*(t,n){var p;if(t.length===0)return;(p=e.logger)==null||p.debug("Preparing to fetch bulk links"),t.every(y=>y.$objectType===t[0].$objectType)||b();const r=await qi(e),i=await r.forObjectByApiName(t[0].$objectType),[o,a,s]=await Promise.all([i.getRid(),i.getPropertyMapping(),i.getLinkMapping()]),c=Object.fromEntries(Object.entries(s).filter(([y])=>n.includes(y)));for(const y of n)if(c[y]==null)throw"Unable to find link type: "+y;const u={objectSetContext:{forkRid:void 0,objectSetFilterContext:{parameterOverrides:{}},ontologyBranchRid:void 0,owningRid:void 0,reportUsage:void 0,workstateRid:void 0},responseOptions:{includeObjectSetEntities:!0,includeUsageCost:!1},pageSize:1e3,pageToken:void 0,linksRequests:[{directedLinkTypes:Object.values(c).map(({directedLinkTypeRid:y})=>y),objects:ut("objects",t.map(y=>ut("objectLocatorV2",{objectTypeRid:o,objectPrimaryKey:{[a.pk.rid]:ut(a.pk.type.type,y.$primaryKey)}})))}]},d=Ji(Li.bind(void 0,gn(e,"object-set-service/api")),Bi,Wi,u);for await(const y of d){const{objectIdentifier:f}=y,m=Yi(f,t);for(const T of y.links){const P=T.link[T.linkSide==="SOURCE"?"objectSideB":"objectSideA"],v=bn(P),_=await(await r.forObjectByRid(v.objectTypeRid)).getApiName(),D=Object.values(c).find(g=>g.directedLinkTypeRid.linkTypeRid===T.link.linkTypeRid&&g.directedLinkTypeRid.linkSide===T.linkSide);if(!D)throw new Error("Could not find link type");yield{object:m,linkApiName:D.apiName,otherObjectApiName:_,otherObjectPk:v.pkValue}}}}}function Yi(e,t){const{pkValue:n}=bn(e),r=t.find(i=>i.$primaryKey===n);if(r==null)throw new Error(`Needed to find object with pk ${n}} and could not`);return r}function bn(e){if("type"in e&&e.type!=="objectLocatorV2")throw new Error("We do not support looking up object by rid");const t=Object.entries(e.objectLocatorV2.objectPrimaryKey);if(t.length!==1)throw new Error("Unable to support this request due to multiple pks");return{objectTypeRid:e.objectLocatorV2.objectTypeRid,pkValue:t[0][1][t[0][1].type]}}function Tn(e=fetch,t){return async function(n,r){return r?e(n,{...r,headers:await t(new Headers(r.headers))}):e(n,{headers:await t(new Headers)})}}function Xi(e=fetch){return async function(t,n){let r;try{r=await e(t,n)}catch(i){throw Zi(i,"A network error occurred")}if(!r.ok){const i=`Failed to fetch ${r.status} ${r.statusText}`;if(r.headers.get("Content-Type")==="text/plain")throw Te(await r.text(),r.status);if(r.headers.get("Content-Type")==="text/html")throw Te(i,r.status,new Error("Received HTML error page: "+await r.text()));let o;try{o=await r.json()}catch(a){throw Te(i,r.status,a instanceof Error?a:void 0)}throw new pe((o==null?void 0:o.message)??i,o==null?void 0:o.errorName,o==null?void 0:o.errorCode,r.status,o==null?void 0:o.errorInstanceId,o==null?void 0:o.parameters)}return r}}function Zi(e,t="An unknown error occurred"){return e instanceof Error?Te(e.message,void 0,e):Te(t,void 0)}function Te(e,t,n){return new Ur(e,void 0,n,t)}var On={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Cr,function(){var n=function(o,a){if(a=a||{},typeof o!="function")throw new i("fetch must be a function");if(typeof a!="object")throw new i("defaults must be an object");if(a.retries!==void 0&&!r(a.retries))throw new i("retries must be a positive integer");if(a.retryDelay!==void 0&&!r(a.retryDelay)&&typeof a.retryDelay!="function")throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(a.retryOn!==void 0&&!Array.isArray(a.retryOn)&&typeof a.retryOn!="function")throw new i("retryOn property expects an array or function");var s={retries:3,retryDelay:1e3,retryOn:[]};return a=Object.assign(s,a),function(u,d){var p=a.retries,y=a.retryDelay,f=a.retryOn;if(d&&d.retries!==void 0)if(r(d.retries))p=d.retries;else throw new i("retries must be a positive integer");if(d&&d.retryDelay!==void 0)if(r(d.retryDelay)||typeof d.retryDelay=="function")y=d.retryDelay;else throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(d&&d.retryOn)if(Array.isArray(d.retryOn)||typeof d.retryOn=="function")f=d.retryOn;else throw new i("retryOn property expects an array or function");return new Promise(function(m,T){var P=function(_){var D=typeof Request<"u"&&u instanceof Request?u.clone():u;o(D,d).then(function(g){if(Array.isArray(f)&&f.indexOf(g.status)===-1)m(g);else if(typeof f=="function")try{return Promise.resolve(f(_,null,g)).then(function(S){S?v(_,null,g):m(g)}).catch(T)}catch(S){T(S)}else _<p?v(_,null,g):m(g)}).catch(function(g){if(typeof f=="function")try{Promise.resolve(f(_,g,null)).then(function(S){S?v(_,g,null):T(g)}).catch(function(S){T(S)})}catch(S){T(S)}else _<p?v(_,g,null):T(g)})};function v(_,D,g){var S=typeof y=="function"?y(_,D,g):y;setTimeout(function(){P(++_)},S)}P(0)})}};function r(o){return Number.isInteger(o)&&o>=0}function i(o){this.name="ArgumentError",this.message=o}return n})})(On);var eo=On.exports;const to=Ir(eo),no=1e3,ro=.5,io=3;function oo(e){return to(e,{retryDelay(t){const n=no*2**t,r=n*ro*(Math.random()*2-1);return n+r},retryOn(t,n,r){const i=(r==null?void 0:r.status)??0;return!(i>=200&&i<300)&&ao(n)&&t<io}})}function ao(e){return!(e instanceof pe&&e.statusCode!==so&&e.statusCode!==co)}const so=503,co=429,ye=(e,t)=>({...e,fetch:Tn(e.fetch,n=>(n.set("X-OSDK-Request-Context",JSON.stringify(e.requestContext)),t.osdkMetadata&&n.set("Fetch-User-Agent",t.osdkMetadata.extraUserAgent),n))}),J=(e,t)=>({...e,requestContext:{...e.requestContext,...t(e.requestContext)}});function We(e){return typeof e=="object"&&"name"in e&&"data"in e&&e.data instanceof Blob}function Je(e){return typeof e=="object"&&e instanceof Blob&&"name"in e}function uo(e){return typeof e=="object"&&typeof e.mimeType=="string"&&"reference"in e&&typeof e.reference=="object"&&e.reference.type==="mediaSetViewItem"&&"mediaSetViewItem"in e.reference&&typeof e.reference.mediaSetViewItem=="object"&&typeof e.reference.mediaSetViewItem.mediaSetRid=="string"&&typeof e.reference.mediaSetViewItem.mediaSetViewRid=="string"&&typeof e.reference.mediaSetViewItem.mediaItemRid=="string"}function ze(e){const t=e.lastIndexOf(".");return t===-1?[void 0,e]:[e.slice(0,t),e.slice(t+1)]}function Oe(e,t){if("$and"in e)return{type:"and",value:e.$and.map(r=>Oe(r,t))};if("$or"in e)return{type:"or",value:e.$or.map(r=>Oe(r,t))};if("$not"in e)return{type:"not",value:Oe(e.$not,t)};const n=Object.entries(e);return n.length===1?pt(n[0],t):{type:"and",value:n.map(r=>pt(r,t))}}function Ce(e,t,n,r){return{type:t==="$within"?"withinBoundingBox":"intersectsBoundingBox",...n!=null&&{propertyIdentifier:n},field:r,value:{topLeft:{type:"Point",coordinates:[e[0],e[3]]},bottomRight:{type:"Point",coordinates:[e[2],e[1]]}}}}function Ut(e,t,n,r){return{type:t,...n!=null&&{propertyIdentifier:n},field:r,value:{type:"Polygon",coordinates:e}}}function pt([e,t],n,r){t==null&&b();const i=r!=null?{type:"structField",...r,propertyApiName:xt(r.propertyApiName,n)}:void 0,o=r==null?xt(e,n):void 0;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return{type:"eq",...i!=null&&{propertyIdentifier:i},field:o,value:t};const a=Object.keys(t),s=a.some(u=>u.startsWith("$"));if(!s||a.length===1||b(),!s){Object.entries(t).length!==1&&b();const d=a[0];return pt(Object.entries(t)[0],n,{propertyApiName:e,structFieldApiName:d})}const c=a[0];if(t[c]==null&&b(),c==="$ne")return{type:"not",value:{type:"eq",...i!=null&&{propertyIdentifier:i},field:o,value:t[c]}};if(c==="$within"){const u=t[c];if(Array.isArray(u))return Ce(u,c,i,o);if("$bbox"in u&&u.$bbox!=null)return Ce(u.$bbox,c,i,o);if("$distance"in u&&"$of"in u&&u.$distance!=null&&u.$of!=null)return{type:"withinDistanceOf",...i!=null&&{propertyIdentifier:i},field:o,value:{center:Array.isArray(u.$of)?{type:"Point",coordinates:u.$of}:u.$of,distance:{value:u.$distance[0],unit:Dr[u.$distance[1]]}}};{const d="$polygon"in u?u.$polygon:u.coordinates;return Ut(d,"withinPolygon",i,e)}}if(c==="$intersects"){const u=t[c];if(Array.isArray(u))return Ce(u,c,i,o);if("$bbox"in u&&u.$bbox!=null)return Ce(u.$bbox,c,i,o);{const d="$polygon"in u?u.$polygon:u.coordinates;return Ut(d,"intersectsPolygon",i,o)}}return c==="$containsAllTerms"||c==="$containsAnyTerm"?{type:c.substring(1),...i!=null&&{propertyIdentifier:i},field:o,value:typeof t[c]=="string"?t[c]:t[c].term,fuzzy:typeof t[c]=="string"?!1:t[c].fuzzySearch??!1}:{type:c.substring(1),...i!=null&&{propertyIdentifier:i},field:o,value:t[c]}}function xt(e,t){if(t.type==="interface"){const[n]=ze(t.apiName),[r,i]=ze(e);return r==null&&n!=null?`${n}.${i}`:e}return e}function yt(e,t,n){return{pivotTo:r=>yt(e,{type:"searchAround",objectSet:t,link:r},n),where:r=>yt(e,{type:"filter",objectSet:t,where:Oe(r,e)},n),aggregate:(r,i)=>{const o=r.split(":");o.length===2||o[0]==="$count"||b();const[a,s]=o;let c;switch(s){case"sum":case"avg":case"min":case"max":case"exactDistinct":case"approximateDistinct":c={type:s,selectedPropertyApiName:a};break;case"approximatePercentile":c={type:"approximatePercentile",selectedPropertyApiName:a,approximatePercentile:(i==null?void 0:i.percentile)??.5};break;case"collectSet":case"collectList":c={type:s,selectedPropertyApiName:a,limit:(i==null?void 0:i.limit)??100};break;case void 0:if(a==="$count"){c={type:"count"};break}default:b()}const u={type:{}};return n.set(u,{type:"selection",objectSet:t,operation:c}),u},selectProperty:r=>{const i={type:{}};return n.set(i,{type:"selection",objectSet:t,operation:{type:"get",selectedPropertyApiName:r}}),i}}}function Kt(e){return e.metrics.reduce((t,n)=>{const r=n.name.split(".");if(r[0]==="count")return t;r.length!==2&&b();const i=r[0],o=r[1];return i in t||(t[i]={}),t[i][o]=n.value,t},{})}const Ft=e=>e==="asc"?"ASC":e==="desc"?"DESC":void 0;function lo(e){return Object.entries(e).flatMap(([t,n])=>{if(t==="$count")return{type:"count",name:"count",direction:Ft(n)};const r=t.lastIndexOf(":"),i=t.slice(0,r),o=t.slice(r+1);return[{type:o,name:`${i}.${o}`,direction:Ft(n),field:i}]})}function fo(e){return e?Object.entries(e).flatMap(([t,n])=>{var r;return n==="exact"?[{type:n,field:t}]:"$exactWithLimit"in n?[{type:"exact",field:t,maxGroupCount:n.$exactWithLimit}]:"$exact"in n?[{type:"exact",field:t,maxGroupCount:((r=n.$exact)==null?void 0:r.$limit)??void 0,defaultValue:n.$exact.$defaultValue??void 0}]:"$fixedWidth"in n?[{type:"fixedWidth",field:t,fixedWidth:n.$fixedWidth}]:"$ranges"in n?[{type:"ranges",field:t,ranges:n.$ranges.map(i=>po(i))}]:"$duration"in n?[{type:"duration",field:t,value:n.$duration[0],unit:Lr[n.$duration[1]]}]:[]}):[]}function po(e){return{startValue:e[0],endValue:e[1]}}function Ve(e){return e.type==="interface"?{type:"interfaceBase",interfaceType:e.apiName}:{type:"base",objectType:e.apiName}}async function yo(e,t,n=Ve(t),r){Ve(t);const i={aggregation:lo(r.$select),groupBy:[]};r.$groupBy&&(i.groupBy=fo(r.$groupBy));const o=await Oi(ye(e,t),await e.ontologyRid,{objectSet:n,groupBy:i.groupBy,aggregation:i.aggregation});return r.$groupBy?o.data.map(s=>({$group:s.group,...Bt(s),...Kt(s)})):(o.data.length!==1&&b(),{...Bt(o.data[0]),...Kt(o.data[0])})}function Bt(e){for(const t of e.metrics)if(t.name==="count")return{$count:t.value}}async function jn(e,t){return(await oe(e,t,void 0)).definitions}async function oe(e,t,n){var r;switch(t.type){case"searchAround":{const{definitions:c,childObjectType:u}=await oe(e,t.objectSet,n);if(u===void 0||u==="")return{definitions:{}};const d=await e.ontologyProvider.getObjectDefinition(u);return d.links[t.link]||b(),{definitions:c,childObjectType:d.links[t.link].targetType}}case"withProperties":{const{definitions:c,childObjectType:u}=await oe(e,t.objectSet,n);if(u===void 0||u==="")return{definitions:{}};for(const[d,p]of Object.entries(t.derivedProperties))if(p.type==="selection")switch(p.operation.type){case"collectList":case"collectSet":case"get":const{childObjectType:y}=await oe(e,p.objectSet,u);if(y===void 0||y==="")return{definitions:{}};const f=await e.ontologyProvider.getObjectDefinition(y);c[d]=f.properties[p.operation.selectedPropertyApiName];default:continue}return{definitions:c,childObjectType:u}}case"methodInput":return{definitions:{},childObjectType:n};case"base":return{definitions:{},childObjectType:t.objectType};case"interfaceBase":return{definitions:{},childObjectType:t.interfaceType};case"filter":case"asBaseObjectTypes":case"asType":case"nearestNeighbors":return oe(e,t.objectSet,n);case"intersect":case"subtract":case"union":const i=t.objectSets,o=await Promise.all(i.map(c=>oe(e,c,n))),a=o.reduce((c,{definitions:u})=>({...c,...u}),{});Object.keys(a).length!==0&&b();const s=(r=o.find(({childObjectType:c})=>c!=null))==null?void 0:r.childObjectType;return o.every(({childObjectType:c})=>c===s||c==null)||b(),{definitions:{},childObjectType:s};case"static":case"reference":return{definitions:{}};default:b()}}function En(e,t,n=void 0){if(e.type==="base"||e.type==="interfaceBase"){if(e.type==="base"&&e.objectType!==t)throw new Error(`Expected objectSet.objectType to be ${t}, but got ${e.objectType}`);if(e.type==="interfaceBase"&&e.interfaceType!==t)throw new Error(`Expected objectSet.objectType to be ${t}, but got ${e.interfaceType}`);return n}if(e.type==="filter")return En(e.objectSet,t,n==null?e.where:{type:"and",value:[n,e.where]});throw new Error(`Unsupported objectSet type: ${e.type}`)}function ho(e,t,n){return n!=null&&n.$includeAllBaseObjectProperties?{type:"intersect",objectSets:[e,{type:"interfaceBase",interfaceType:t,includeAllBaseObjectProperties:!0}]}:e}async function mo(e,t,n,r){if(n.$__UNSTABLE_useOldInterfaceApis){const o=await hi(ye(e,t),await e.ontologyRid,t.apiName,ht(n,{augmentedProperties:{},augmentedSharedPropertyTypes:{},otherInterfaceTypes:[],selectedObjectTypes:[],selectedSharedPropertyTypes:n.$select??[],where:En(r,t.apiName)}),{preview:!0});return o.data=await e.objectFactory(e,o.data,t.apiName,!n.$includeRid,await jn(e,r)),o}const i=await bi(ye(e,t),await e.ontologyRid,ht(n,{objectSet:ho(r,t.apiName,n),select:(n==null?void 0:n.$select)??[],excludeRid:!(n!=null&&n.$includeRid)}),{preview:!0});return Promise.resolve({data:await e.objectFactory2(e,i.data,t.apiName,{},!n.$includeRid,n.$select,!1,i.interfaceToObjectTypeMappings),nextPageToken:i.nextPageToken,totalCount:i.totalCount})}async function He(e,t,n,r={}){return t.type==="interface"?await mo(e,t,r,n):await wo(e,t,r,n)}async function go(e,t,n,r={}){try{return{value:await He(e,t,n,r)}}catch(i){return i instanceof Error?{error:i}:{error:i}}}async function Sn(e,t,n,r=Ve(t)){return He(e,t,r,n)}function ht(e,t){return e!=null&&e.$nextPageToken&&(t.pageToken=e.$nextPageToken),(e==null?void 0:e.$pageSize)!=null&&(t.pageSize=e.$pageSize),(e==null?void 0:e.$orderBy)!=null&&(t.orderBy={fields:Object.entries(e.$orderBy).map(([n,r])=>({field:n,direction:r}))}),t}async function wo(e,t,n,r){const i=await gi(ye(e,t),await e.ontologyRid,ht(n,{objectSet:r,select:(n==null?void 0:n.$select)??[],excludeRid:!(n!=null&&n.$includeRid)}));return Promise.resolve({data:await e.objectFactory(e,i.data,void 0,void 0,await jn(e,r),n.$select),nextPageToken:i.nextPageToken,totalCount:i.totalCount})}async function ot(e,t,n,r){const i=await Sn(e,t,{...n,$pageSize:1},r);if(i.data.length!==1||i.nextPageToken!=null)throw new pe(`Expected a single result but got ${i.data.length} instead${i.nextPageToken!=null?" with nextPageToken set":""}`);return i.data[0]}async function kn(e,t,n,r){try{return{value:await ot(e,t,n,r)}}catch(i){return i instanceof Error?{error:i}:{error:i}}}const bo=new Set(["base","filter","intersect","reference","searchAround","static","subtract","union"]);function At(e){return e!=null&&typeof e=="object"&&bo.has(e.type)}var ae=null;typeof WebSocket<"u"?ae=WebSocket:typeof MozWebSocket<"u"?ae=MozWebSocket:typeof global<"u"?ae=global.WebSocket||global.MozWebSocket:typeof window<"u"?ae=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ae=self.WebSocket||self.MozWebSocket);const me=ae,To=5*1e3;function Ie(){}function Wt({onChange:e=Ie,onError:t=Ie,onOutOfDate:n=Ie,onSuccessfulSubscription:r=Ie}){return{onChange:e,onError:t,onOutOfDate:n,onSuccessfulSubscription:r}}function Oo(e){return e.isReady!=null}function Jt(e){return e.status==="done"||e.status==="error"}var ke,E,ve,C,U,ue,M,_e,X,k,vn,Ue,we,gt,Ae,Pe,tt,wt,nt,rt,_n,Ne,le,I;const ce=class ce{constructor(t,{minimumReconnectDelayMs:n=To}={}){w(this,k);w(this,E);w(this,ve,0);w(this,C);w(this,U);w(this,ue,new Map);w(this,M,new Map);w(this,_e,new Set);w(this,X);w(this,Ae,()=>{$(this,k,Ue).call(this)});w(this,Pe,async t=>{const n=JSON.parse(t.data.toString());switch(n.type){case"objectSetChanged":await l(this,tt).call(this,n);return;case"refreshObjectSet":l(this,nt).call(this,n);return;case"subscribeResponses":l(this,rt).call(this,n);return;case"subscriptionClosed":{$(this,k,_n).call(this,n);return}default:b()}});w(this,tt,async t=>{var s,c,u,d,p,y;const n=l(this,M).get(t.id);if(n==null)return;const r=t.updates.filter(f=>f.type==="object"),i=t.updates.filter(f=>f.type==="reference"),o=await Promise.all(i.map(async f=>{const T=(await l(this,C).objectFactory2(l(this,C),[{__apiName:f.objectType,__primaryKey:n.primaryKeyPropertyName!=null?f.primaryKey[n.primaryKeyPropertyName]:void 0,...f.primaryKey,[f.property]:f.value}],n.interfaceApiName,{},!1,void 0,!1,await $(this,k,wt).call(this,f.objectType,n.interfaceApiName)))[0]??void 0;return T!=null?{object:T,state:"ADDED_OR_UPDATED"}:void 0}));for(const f of o)if(f!=null)try{(c=(s=n.listener).onChange)==null||c.call(s,f)}catch(m){(u=l(this,U))==null||u.error(m,"Error in onChange callback"),l(this,I).call(this,n,!1,m)}const a=await Promise.all(r.map(async f=>{const m=Object.keys(f.object).filter(v=>n.requestedReferenceProperties.includes(v));for(const v of m)delete f.object[v];const P=(await l(this,C).objectFactory2(l(this,C),[f.object],n.interfaceApiName,{},!1,void 0,!1,await $(this,k,wt).call(this,f.object.__apiName,n.interfaceApiName)))[0]??void 0;return P!=null?{object:P,state:f.state}:void 0}));for(const f of a)if(f!=null)try{(p=(d=n.listener).onChange)==null||p.call(d,f)}catch(m){(y=l(this,U))==null||y.error(m,"Error in onChange callback"),l(this,I).call(this,n,!1,m)}});w(this,nt,t=>{var r;const n=l(this,M).get(t.id);n||b();try{n.listener.onOutOfDate()}catch(i){(r=l(this,U))==null||r.error(i,"Error in onOutOfDate callback"),l(this,I).call(this,n,!1,i)}});w(this,rt,t=>{var o;const{id:n,responses:r}=t,i=l(this,ue).get(n);i||b(),l(this,ue).delete(n);for(let a=0;a<r.length;a++){const s=i[a],c=r[a];switch(c.type){case"error":l(this,I).call(this,s,!0,c.errors),$(this,k,we).call(this,s,"error");break;case"qos":l(this,le).call(this);break;case"success":const u=s.status==="expired"||s.status==="reconnecting";s.status="subscribed",s.subscriptionId!==c.id&&(l(this,M).delete(s.subscriptionId),s.subscriptionId=c.id,l(this,M).set(s.subscriptionId,s));try{u?s.listener.onOutOfDate():s.listener.onSuccessfulSubscription()}catch(d){(o=l(this,U))==null||o.error(d,"Error in onOutOfDate or onSuccessfulSubscription callback"),l(this,I).call(this,s,!1,d)}break;default:l(this,I).call(this,s,!0,c)}}});w(this,Ne,t=>{l(this,le).call(this)});w(this,le,()=>{if(l(this,E)&&(l(this,E).removeEventListener("open",l(this,Ae)),l(this,E).removeEventListener("message",l(this,Pe)),l(this,E).removeEventListener("close",l(this,Ne)),l(this,E).readyState!==me.CLOSING&&l(this,E).readyState!==me.CLOSED&&l(this,E).close(),A(this,E,void 0)),l(this,M).size>0){for(const t of l(this,M).values())t.status==="subscribed"&&(t.status="reconnecting");$(this,k,gt).call(this)}});w(this,I,(t,n,r)=>{var i;try{t.listener.onError({subscriptionClosed:n,error:r})}catch(o){console.error("Error encountered in an onError callback for an OSDK subscription",o),console.error("This onError call was triggered by an error in another callback",r),console.error("The subscription has been closed.",r),n||((i=l(this,U))==null||i.error(r,"Error in onError callback"),$(this,k,we).call(this,t,"error"),l(this,I).call(this,t,!0,o))}});var r;this.MINIMUM_RECONNECT_DELAY_MS=n,A(this,C,t),A(this,U,(r=t.logger)==null?void 0:r.child({},{msgPrefix:"<OSW> "})),t.baseUrl.startsWith("https://")||t.baseUrl.startsWith("http://")||b()}static getInstance(t){let n=l(ce,ke).get(t.clientCacheKey);return n==null&&(n=new ce(t),l(ce,ke).set(t.clientCacheKey,n)),n}async subscribe(t,n,r,i=[]){const o=t.type==="object"?await l(this,C).ontologyProvider.getObjectDefinition(t.apiName):await l(this,C).ontologyProvider.getInterfaceDefinition(t.apiName);let a=[],s=[];i.length===0&&(i=Object.keys(o.properties)),a=i.filter(u=>o.properties[u].type!=="geotimeSeriesReference"),s=i.filter(u=>o.properties[u].type==="geotimeSeriesReference");const c={listener:Wt(r),objectSet:n,primaryKeyPropertyName:o.type==="interface"?void 0:o.primaryKeyApiName,requestedProperties:a,requestedReferenceProperties:s,status:"preparing",subscriptionId:`TMP-${zt()}}`,interfaceApiName:o.type==="object"?void 0:o.apiName};return l(this,M).set(c.subscriptionId,c),$(this,k,vn).call(this,c),()=>{$(this,k,we).call(this,c)}}};ke=new WeakMap,E=new WeakMap,ve=new WeakMap,C=new WeakMap,U=new WeakMap,ue=new WeakMap,M=new WeakMap,_e=new WeakMap,X=new WeakMap,k=new WeakSet,vn=async function(t){var n,r;try{if(await $(this,k,gt).call(this),Jt(t))return;t.isReady=!0,((n=l(this,E))==null?void 0:n.readyState)===me.OPEN&&$(this,k,Ue).call(this)}catch(i){(r=l(this,U))==null||r.error(i,"Error in #initiateSubscribe"),l(this,I).call(this,t,!0,i)}},Ue=function(){var i;const t=[...l(this,M).values()].filter(Oo),n=zt();l(this,ue).set(n,t);const r={id:n,requests:t.map(({objectSet:o,requestedProperties:a,requestedReferenceProperties:s,interfaceApiName:c})=>({objectSet:o,propertySet:a,referenceSet:s}))};(i=l(this,E))==null||i.send(JSON.stringify(r))},we=function(t,n="done"){Jt(t)||(t.status=n,t.listener=Wt({}),l(this,M).delete(t.subscriptionId),l(this,_e).add(t.subscriptionId),$(this,k,Ue).call(this),l(this,X)&&clearTimeout(l(this,X)),A(this,X,setTimeout(()=>{A(this,X,void 0),l(this,M).size===0&&l(this,le).call(this)},15e3)))},gt=async function(){if(l(this,E)==null){const{baseUrl:t,tokenProvider:n}=l(this,C),r=jo(t,await l(this,C).ontologyRid),i=await n();if(l(this,E)==null){const o=(l(this,ve)??0)+this.MINIMUM_RECONNECT_DELAY_MS;o>Date.now()&&await new Promise(a=>{setTimeout(a,o-Date.now())}),A(this,ve,Date.now()),l(this,E)==null&&(A(this,E,new me(r,[`Bearer-${i}`])),l(this,E).addEventListener("close",l(this,Ne)),l(this,E).addEventListener("message",l(this,Pe)),l(this,E).addEventListener("open",l(this,Ae)))}if(l(this,E).readyState===me.CONNECTING){const o=l(this,E);return new Promise((a,s)=>{function c(){o.removeEventListener("open",u),o.removeEventListener("error",d),o.removeEventListener("close",c)}function u(){c(),a()}function d(p){c(),s(p)}o.addEventListener("open",u),o.addEventListener("error",d),o.addEventListener("close",c)})}}},Ae=new WeakMap,Pe=new WeakMap,tt=new WeakMap,wt=async function(t,n){if(n==null)return{};const r=(await l(this,C).ontologyProvider.getObjectDefinition(t)).interfaceMap;return{[n]:{[t]:r[n]}}},nt=new WeakMap,rt=new WeakMap,_n=function(t){const n=l(this,M).get(t.id);n==null&&l(this,_e).has(t.id)||(n||b(),l(this,I).call(this,n,!0,t.cause),$(this,k,we).call(this,n,"error"))},Ne=new WeakMap,le=new WeakMap,I=new WeakMap,w(ce,ke,new WeakMap);let mt=ce;function jo(e,t){const n=new URL(e),r=new URL(`api/v2/ontologySubscriptions/ontologies/${t}/streamSubscriptions`,n);return r.protocol=r.protocol.replace("https","wss"),r}let Eo=0;function zt(){return`00000000-0000-0000-0000-${(Eo++).toString().padStart(12,"0")}`}function Vt(e){return e.type==="object"}function An(e){return e!=null&&typeof e=="object"&&At(se.get(e))}function qe(e){return se.get(e)}const se=new WeakMap;function Qe(e,t,n=Ve(e)){const r={aggregate:yo.bind(globalThis,J(t,()=>({finalMethodCall:"aggregate"})),e,n),fetchPage:He.bind(globalThis,J(t,()=>({finalMethodCall:"fetchPage"})),e,n),fetchPageWithErrors:go.bind(globalThis,J(t,()=>({finalMethodCall:"fetchPageWithErrors"})),e,n),where:o=>t.objectSetFactory(e,t,{type:"filter",objectSet:n,where:Oe(o,e)}),pivotTo:function(o){return i(o)()},union:(...o)=>t.objectSetFactory(e,t,{type:"union",objectSets:[n,...o.map(a=>se.get(a))]}),intersect:(...o)=>t.objectSetFactory(e,t,{type:"intersect",objectSets:[n,...o.map(a=>se.get(a))]}),subtract:(...o)=>t.objectSetFactory(e,t,{type:"subtract",objectSets:[n,...o.map(a=>se.get(a))]}),asyncIter:async function*(o){let a;do{const s=await He(J(t,()=>({finalMethodCall:"asyncIter"})),e,n,{...o,$pageSize:1e4,$nextPageToken:a});a=s.nextPageToken;for(const c of s.data)yield c}while(a!=null)},fetchOne:Vt(e)?async(o,a)=>await ot(J(t,()=>({finalMethodCall:"fetchOne"})),e,a,await Ht(t,e,n,o)):void 0,fetchOneWithErrors:Vt(e)?async(o,a)=>await kn(J(t,()=>({finalMethodCall:"fetchOneWithErrors"})),e,a,await Ht(t,e,n,o)):void 0,subscribe:(o,a)=>{const s=mt.getInstance(t).subscribe(e,n,o,a==null?void 0:a.properties);return{unsubscribe:async()=>(await s)()}},withProperties:o=>{const a=new Map,s={};for(const c of Object.keys(o)){const u=o[c](yt(e,{type:"methodInput"},a));s[c]=a.get(u)}return t.objectSetFactory(e,t,{type:"withProperties",derivedProperties:s,objectSet:n})},$objectSetInternals:{def:e}};function i(o){return()=>t.objectSetFactory(e,t,{type:"searchAround",objectSet:n,link:o})}return se.set(r,n),r}async function Ht(e,t,n,r){const i=await e.ontologyProvider.getObjectDefinition(t.apiName);return{type:"filter",objectSet:n,where:{type:"eq",field:i.primaryKeyApiName,value:r}}}function So(e){return e!=null&&typeof e=="object"&&"$objectType"in e&&"$primaryKey"in e}function ko(e){return e&&typeof e=="object"&&typeof e.__apiName=="string"&&e.__primaryKey!=null}function vo(e){return e&&typeof e=="object"&&typeof e.$apiName=="string"&&e.$primaryKey!=null}async function W(e,t){if(e==null)return e;if(Array.isArray(e)||e instanceof Set){const n=Array.from(e);if(n.some(i=>We(i)||Je(i))){const i=[];for(const o of n)i.push(await W(o,t));return i}const r=Array.from(e,async i=>await W(i,t));return Promise.all(r)}if(We(e)){const n=await Be(t,e.data,{filename:e.name});return await W(n.rid,t)}if(Je(e)){const n=await Be(t,e,{filename:e.name});return await W(n.rid,t)}return ko(e)?await W(e.__primaryKey,t):vo(e)?await W(e.$primaryKey,t):At(e)?e:An(e)?qe(e):uo(e)?e:So(e)?{objectTypeApiName:e.$objectType,primaryKeyValue:e.$primaryKey}:typeof e=="object"?Object.entries(e).reduce(async(n,[r,i])=>{const o=await n;return o[r]=await W(i,t),o},Promise.resolve({})):e}async function qt(e,t,n,r={}){var o;const i=ye(J(e,()=>({finalMethodCall:"applyAction"})),t);if(Array.isArray(n)){const a=await Gr(i,await e.ontologyRid,t.apiName,{requests:n?await _o(n,e):[],options:{returnEdits:r!=null&&r.$returnEdits?"ALL":"NONE"}}),s=a.edits;return r!=null&&r.$returnEdits?(s==null?void 0:s.type)==="edits"?Qt(a):s:void 0}else{const a=await qr(i,await e.ontologyRid,t.apiName,{parameters:await Pn(n,e),options:{mode:r!=null&&r.$validateOnly?"VALIDATE_ONLY":"VALIDATE_AND_EXECUTE",returnEdits:r!=null&&r.$returnEdits?"ALL_V2_WITH_DELETIONS":"NONE"}});if(r!=null&&r.$validateOnly)return a.validation;if(((o=a.validation)==null?void 0:o.result)==="INVALID")throw new xr(a.validation);const s=a.edits;return r!=null&&r.$returnEdits?(s==null?void 0:s.type)==="edits"?Qt(a):s:void 0}}async function Pn(e,t){if(e==null)return{};const n={};for(const[r,i]of Object.entries(e))n[r]=await W(i,t);return n}async function _o(e,t){return await Promise.all(e.map(async r=>({parameters:await Pn(r,t)})))}function Qt(e){var n,r;const t=e==null?void 0:e.edits;if((t==null?void 0:t.type)==="edits"){const i={type:t.type,deletedLinksCount:t.deletedLinksCount,deletedObjectsCount:t.deletedObjectsCount,addedLinks:[],deletedLinks:[],addedObjects:[],deletedObjects:[],modifiedObjects:[],editedObjectTypes:[]},o=new Set;for(const a of t.edits)if(a.type==="addLink"||a.type==="deleteLink"){const s={linkTypeApiNameAtoB:a.linkTypeApiNameAtoB,linkTypeApiNameBtoA:a.linkTypeApiNameBtoA,aSideObject:a.aSideObject,bSideObject:a.bSideObject};a.type==="addLink"?i.addedLinks.push(s):(n=i.deletedLinks)==null||n.push(s),o.add(a.aSideObject.objectType),o.add(a.bSideObject.objectType)}else if(a.type==="addObject"||a.type==="deleteObject"||a.type==="modifyObject"){const s={objectType:a.objectType,primaryKey:a.primaryKey};a.type==="addObject"?i.addedObjects.push(s):a.type==="deleteObject"?(r=i.deletedObjects)==null||r.push(s):a.type==="modifyObject"&&i.modifiedObjects.push(s),o.add(a.objectType)}return i.editedObjectTypes=[...o],i}}const Ao=Symbol("additionalContext");function Po(e,t,n,r=fetch){if(e.length===0)throw new Error("baseUrl cannot be empty");const i=Tn(oo(Xi(r)),async o=>{const a=await t();return o.set("Authorization",`Bearer ${a}`),o.set("Fetch-User-Agent",[o.get("Fetch-User-Agent"),n].filter(s=>s&&(s==null?void 0:s.length)>0).join(" ")),o});return{baseUrl:e,fetch:async(o,a)=>{try{return await i(o,a)}catch(s){const c=s instanceof pe?new pe(s.message,s.errorName,s.errorCode,s.statusCode,s.errorInstanceId,s.parameters):new Error("Captured stack trace for error: "+(s.message??s));throw c.cause=s,c}},tokenProvider:t}}const Gt=new Uint8Array([123,34,100,97,116,97,34,58,91]),Yt=123,No=125;async function*Ro(e){const t=new TextDecoder("utf-8");let n=!1,r=[],i=0;for await(let o of e){let a=0;for(n||(n=!0,$o(o,Gt)&&(a=Gt.length));a<o.length;a++){for(;i===0&&o[a]!==Yt&&a<o.length;)a++;let s=a;for(;s<o.length;s++){const c=o[s];if(c===Yt)i++;else if(c===No&&(i--,i===0)){yield Mo(t,r,o.subarray(a,s+1)),r=[],a=s;break}}if(s===o.length){r.push(o.subarray(a));break}}}}function $o(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}function Mo(e,t,n){let r="";for(const i of t)r+=e.decode(i,{stream:!0});return r+=e.decode(n),JSON.parse(r)}async function*Co(e){let t=await e.read();for(;!t.done;)yield t.value,t=await e.read()}function Nn(e){return"$startTime"in e||"$endTime"in e?{type:"absolute",startTime:e.$startTime,endTime:e.$endTime}:e.$before?{type:"relative",startTime:{when:"BEFORE",value:e.$before,unit:Dt[e.$unit]}}:{type:"relative",endTime:{when:"AFTER",value:e.$after,unit:Dt[e.$unit]}}}async function*Rn(e){var n;const t=(n=e.body)==null?void 0:n.getReader();for await(const r of Ro(Co(t)))yield{time:r.time,value:r.value}}var fe,V;class Io{constructor(t,n,r,i,o){w(this,fe);w(this,V);A(this,V,t),A(this,fe,[n,r,i]),o!=null&&(this.lastFetchedValue=o)}async getLatestValue(){const t=Mi(l(this,V),await l(this,V).ontologyRid,...l(this,fe));return t.then(n=>this.lastFetchedValue=n,n=>void console.error(n)),t}async getAllValues(t){const n=[];for await(const r of this.asyncIterValues(t))n.push(r);return n}async*asyncIterValues(t){const n=await Ii(l(this,V),await l(this,V).ontologyRid,...l(this,fe),t?{range:Nn(t)}:{});for await(const r of Rn(n))yield r}}fe=new WeakMap,V=new WeakMap;var de,H;class Do{constructor(t){w(this,de);w(this,H);const{client:n,objectApiName:r,primaryKey:i,propertyName:o}=t;A(this,H,n),A(this,de,[r,i,o])}async fetchContents(){return oi(l(this,H),await l(this,H).ontologyRid,...l(this,de),{preview:!0})}async fetchMetadata(){const t=await si(l(this,H),await l(this,H).ontologyRid,...l(this,de),{preview:!0});return{path:t.path,sizeBytes:Number(t.sizeBytes),mediaType:t.mediaType}}}de=new WeakMap,H=new WeakMap;var Z,x;class Lo{constructor(t,n,r,i){w(this,Z);w(this,x);A(this,x,t),A(this,Z,[n,r,i])}async getFirstPoint(){return _i(l(this,x),await l(this,x).ontologyRid,...l(this,Z))}async getLastPoint(){return Pi(l(this,x),await l(this,x).ontologyRid,...l(this,Z))}async getAllPoints(t){const n=[];for await(const r of this.asyncIterPoints(t))n.push(r);return n}async*asyncIterPoints(t){const n=await Ri(l(this,x),await l(this,x).ontologyRid,...l(this,Z),t?{range:Nn(t)}:{});for await(const r of Rn(n))yield r}}Z=new WeakMap,x=new WeakMap;function je(e,t){return{rid:t,async fetchContents(){return ti(e,t)},async fetchMetadata(){const n=await ri(e,t);return{...n,sizeBytes:Number(n.sizeBytes)}}}}function Pt(e,t){return`${e.apiName}:${t}`}function Uo(e){return e.split(":")[1]}const Nt=Symbol("InterfaceDefinitions"),B=Symbol("Underlying Object"),q=Symbol("ObjectDefinition"),xo=Symbol("InterfaceDefinition"),Ge=Symbol("ClientRef");function Ko(e,t){const[n]=ze(t.apiName);return Object.freeze(Object.defineProperties({},{[B]:{value:e},$apiName:{value:t.apiName,enumerable:!0},$as:{value:e.$as,enumerable:!1},$objectType:{value:e.$objectType,enumerable:"$objectType"in e},$primaryKey:{value:e.$primaryKey,enumerable:"$primaryKey"in e},$objectSpecifier:{value:e.$objectSpecifier,enumerable:"$objectSpecifier"in e},$title:{value:e.$title,enumerable:"$title"in e},$rid:{value:e.$rid,enumerable:"$rid"in e},$clone:{value:r,enumerable:!1},[xo]:{value:t},...Object.fromEntries(Object.keys(t.properties).map(o=>{const a=e[q],[s,c]=ze(o),u=a.interfaceMap[t.apiName][o];return[s===n?c:o,{enumerable:u in e,value:e[u]}]}))}));function r(o){if(o==null)return e.$clone().$as(t);for(const s of Object.keys(o))if(!(s in t.properties))throw new Error(`Invalid property ${s} for interface ${t.apiName}`);const a=Object.fromEntries(Object.keys(o).map(s=>i(s,o[s])).filter(s=>s!=null));return e.$clone(a).$as(t)}function i(o,a){const s=e[q],c=s.interfaceMap[t.apiName][o];if(c==null)throw new Error(`Cannot clone interface with ${o} as property is not implemented by the underlying object type ${s.apiName}`);return[c,a]}}const Fo=_t(new WeakMap,Bo).get,Xt=_t(new WeakMap,()=>new Map);function Bo(e){return function(t){var s,c;let n;if(typeof t=="string"){if(t===e.apiName)return this[B];if(((s=e.interfaceMap)==null?void 0:s[t])==null)throw new Error(`Object does not implement interface '${t}'.`);n=t}else{if(t.apiName===e.apiName)return this[B];if(t.type==="object")throw new Error(`'${t.apiName}' is not an interface nor is it '${e.apiName}', which is the object type.`);n=t.apiName}const r=e[Nt][n];if(!r)throw new Error(`Object does not implement interface '${n}'.`);const i=this[B],o=(c=Xt.get(i).get(n))==null?void 0:c.deref();if(o)return o;const a=Ko(i,r.def);return Xt.get(i).set(n,new WeakRef(a)),a}}function Wo(e){const t=e[Ge],n=e[q],r=e[B];return Object.freeze(Object.fromEntries(Object.keys(n.links).map(i=>{const o=n.links[i],a=t.objectSetFactory(n,t).where({[n.primaryKeyApiName]:r.$primaryKey}).pivotTo(i),s=o.multiplicity?a:{fetchOne:c=>ot(t,n,c??{},qe(a)),fetchOneWithErrors:c=>kn(t,n,c??{},qe(a))};return[i,s]})))}const Zt=new Set(["attachment","geotimeSeriesReference","mediaReference","numericTimeseries","stringTimeseries","sensorTimeseries"]),Jo={$as:{get:function(){return Fo(this[q])}},$link:{get:function(){return Wo(this)}},$clone:{value:function(e){const t=this[B],n=this[q];if(e==null)return Ye(this[Ge],n,{...t});if(n.primaryKeyApiName in e&&t[n.primaryKeyApiName]!==e[n.primaryKeyApiName])throw new Error(`Cannot update ${n.apiName} object with differing primary key values `);n.titleProperty in e&&!("$title"in e)&&(e.$title=e[n.titleProperty]);const r={...this[B],...e};return Ye(this[Ge],this[q],r)}},$objectSpecifier:{get:function(){const e=this[B];return Pt(this[q],e.$primaryKey)},enumerable:!0}};function Ye(e,t,n,r={}){const i=n;Object.defineProperties(i,{[B]:{enumerable:!1,value:n},[q]:{value:t,enumerable:!1},[Ge]:{value:e,enumerable:!1},...Jo});for(const o of Object.keys(i))if(o in t.properties&&typeof t.properties[o].type=="string"&&Zt.has(t.properties[o].type))i[o]=zo(e,t,i,o);else if(o in r&&typeof r[o].type=="string"&&Zt.has(r[o].type)){const a=i[o];r[o].type==="attachment"?Array.isArray(a)?i[o]=a.map(s=>je(e,s.rid)):i[o]=je(e,a.rid):b()}return Object.freeze(i)}function zo(e,t,n,r){const i=n[r],o=t.properties[r];if(o.type==="attachment")return Array.isArray(i)?i.map(a=>je(e,a.rid)):je(e,i.rid);if(o.type==="numericTimeseries"||o.type==="stringTimeseries"||o.type==="sensorTimeseries")return new Lo(e,t.apiName,n[t.primaryKeyApiName],r);if(o.type==="geotimeSeriesReference")return new Io(e,t.apiName,n[t.primaryKeyApiName],r,i.type==="geotimeSeriesValue"?{time:i.timestamp,value:{type:"Point",coordinates:i.position}}:void 0);if(o.type==="mediaReference")return new Do({client:e,objectApiName:t.apiName,primaryKey:n[t.primaryKeyApiName],propertyName:r})}async function Vo(e,t,n,r=!1,i,o,a=!1){Mn(t,r);const s=n?await e.ontologyProvider.getInterfaceDefinition(n):void 0,c=s?o??Object.keys(s.properties):void 0,u=[];for(const d of t){const p=await e.ontologyProvider.getObjectDefinition(d.$apiName);p||b();let y,f=!0;if(s&&c?($n(p,s.apiName,e),f&&(f=bt(e,s,d,c)),Qo(p,s.apiName,d),y=qo(p,s.apiName,c)):y=o??Object.keys(p.properties),f&&(f=bt(e,p,d,y)),a==="throw"&&!f)throw new Error("Unable to safely convert objects as some non nullable properties are null");if(a==="drop"&&!f)continue;let m=Ye(e,p,d,i);n&&(m=m.$as(n)),u.push(m)}return u}async function Ho(e,t,n,r,i=!1,o,a=!1,s={}){Mn(t,i);const c=[];for(const u of t){const d=await e.ontologyProvider.getObjectDefinition(u.$apiName);d||b();const p=n?s[n][u.$apiName]:void 0,y=n&&p?o?Object.keys(p).filter(P=>{o==null||o.includes(p[P])}):[...Object.values(p),d.primaryKeyApiName]:void 0;let f,m=!0;if(n&&y?($n(d,n,e),f=y):f=o??Object.keys(d.properties),m&&(m=bt(e,d,u,f)),a==="throw"&&!m)throw new Error("Unable to safely convert objects as some non nullable properties are null");if(a==="drop"&&!m)continue;let T=Ye(e,d,u,r);n&&(T=T.$as(n)),c.push(T)}return c}function qo(e,t,n){return n.map(r=>e.interfaceMap[t][r])}function Qo(e,t,n){const r={};for(const[i,o]of Object.entries(e.interfaceMap[t]))if(i in n){const a=n[i];delete n[i],a!==void 0&&(r[o]=a)}Object.assign(n,r),e.primaryKeyApiName in n||(n[e.primaryKeyApiName]=n.$primaryKey)}function bt(e,t,n,r){for(const i of r)if(i in t.properties&&t.properties[i].nullable===!1&&n[i]==null)return!1;return!0}function $n(e,t,n){var r;if(((r=e.interfaceMap)==null?void 0:r[t])==null){const i="Interfaces are only supported 'as views' but your metadata object is missing the correct information. This suggests your interfaces have not been migrated to the newer version yet and you cannot use this version of the SDK.";throw n.logger?n.logger.warn(i):console.error(`WARNING! ${i}`),new Error(i)}}function Mn(e,t){for(const n of e)t&&delete n.__rid,n.__rid&&(n.$rid=n.__rid,delete n.__rid),n.$apiName??(n.$apiName=n.__apiName),n.$objectType=n.$apiName,n.$primaryKey??(n.$primaryKey=n.__primaryKey),n.$title??(n.$title=n.__title),delete n.__apiName,delete n.__primaryKey,delete n.__title}function Go(e){const t=new WeakMap;function n(r,i,o){return t.get(r.clientCacheKey)==null&&t.set(r.clientCacheKey,new Map),t.get(r.clientCacheKey).set(i,o),o}return{get:function(r,i){t.get(r.clientCacheKey)==null&&t.set(r.clientCacheKey,new Map);let o=t.get(r.clientCacheKey).get(i);return o===void 0&&e!==void 0?n(r,i,e(r,i)):o},set:n,remove:function(r,i){return t.get(r.clientCacheKey)==null?!1:t.get(r.clientCacheKey).delete(i)}}}function Yo(e,t=Go){const n=t(),r=t(),i={getOrUndefined:function(o,a){return n.get(o,a)},get:async function(o,a){return n.get(o,a)??r.get(o,a)??i.set(o,a,e(o,a))},set:async function(o,a,s){try{const c=await r.set(o,a,s);return n.set(o,a,c),r.remove(o,a),c}catch(c){throw r.remove(o,a),c}}};return i}function Cn(e,t=!0,n){const r=Tt(e.dataType);if(r!=null)switch(e.dataType.type){case"integer":case"string":case"byte":case"decimal":case"double":case"float":case"long":case"short":case"boolean":case"date":case"attachment":case"mediaReference":case"geopoint":case"geoshape":case"timestamp":case"timeseries":case"marking":case"geotimeSeriesReference":case"struct":return{displayName:e.displayName,multiplicity:!1,description:e.description,type:r,nullable:e.nullable==null?t:e.nullable};case"array":return{displayName:e.displayName,multiplicity:!0,description:e.description,type:r,nullable:!0};case"cipherText":case"vector":return;default:e.dataType;return}}function Tt(e,t){var n,r;switch(e.type){case"integer":case"string":case"byte":case"decimal":case"double":case"float":case"long":case"short":case"boolean":case"attachment":case"geopoint":case"geoshape":case"timestamp":case"marking":case"geotimeSeriesReference":case"mediaReference":return e.type;case"date":return"datetime";case"array":return Tt(e.subType);case"timeseries":return((n=e.itemType)==null?void 0:n.type)==="string"?"stringTimeseries":((r=e.itemType)==null?void 0:r.type)==="double"?"numericTimeseries":"sensorTimeseries";case"struct":return e.structFieldTypes.reduce((i,o)=>(i[o.apiName]=Tt(o.dataType),i),{});case"cipherText":case"vector":return;default:return}}function Xo(e,t,n){return{type:"interface",rid:e.rid,apiName:e.apiName,displayName:e.displayName,description:e.description,implements:e.allExtendsInterfaces??e.extendsInterfaces,properties:Object.fromEntries(Object.entries(e.allProperties??e.properties).map(([r,i])=>[r,Cn(i,!0)]).filter(([r,i])=>i!=null)),links:{},implementedBy:e.implementedByObjectTypes}}function Zo(e){const t=new Set,n=new Set;for(const r of e.operations)switch(r.type){case"createObject":t.add(r.objectTypeApiName);break;case"modifyObject":n.add(r.objectTypeApiName);break}return{addedObjects:t,modifiedObjects:n}}function ea(e){const t=Zo(e);return{type:"action",apiName:e.apiName,parameters:Object.fromEntries(Object.entries(e.parameters).map(([n,r])=>[n,ta(r)])),displayName:e.displayName,description:e.description,modifiedEntities:na(t.addedObjects,t.modifiedObjects),rid:e.rid,status:e.status}}function ta(e){return{multiplicity:e.dataType.type==="array",type:Ot(e.dataType.type==="array"?e.dataType.subType:e.dataType),nullable:!e.required,description:e.description}}function Ot(e){switch(e.type){case"string":case"boolean":case"attachment":case"double":case"integer":case"long":case"timestamp":case"mediaReference":case"marking":case"objectType":return e.type;case"date":return"datetime";case"objectSet":return{type:"objectSet",objectSet:e.objectTypeApiName};case"object":return{type:"object",object:e.objectTypeApiName};case"array":return Ot(e.subType);case"interfaceObject":return{type:"interface",interface:e.interfaceTypeApiName};case"struct":return{type:"struct",struct:e.fields.reduce((t,n)=>(t[n.name]=Ot(n.fieldType),t),{})};default:throw new Error(`Unsupported action parameter type: ${JSON.stringify(e)}`)}}function na(e,t){const n={};for(const r of e)n[r]={created:!0,modified:!1};for(const r of t)n[r]?n[r].modified=!0:n[r]={created:!1,modified:!0};return n}function ra(e){switch(e.dataType.type){case"integer":case"double":case"string":case"boolean":case"byte":case"long":case"short":return e.dataType.type;case"date":return"datetime";case"timestamp":return"timestamp";case"geopoint":case"geoshape":case"decimal":case"attachment":case"timeseries":case"array":case"marking":case"float":case"geotimeSeriesReference":case"mediaReference":case"struct":case"cipherText":case"vector":throw new Error(`Type not supported for primaryKey: ${e.dataType.type}`);default:throw e.dataType,new Error(`Unknown type encountered for primaryKey: ${e.dataType}`)}}function ia(e,t,n){if(e.objectType.properties[e.objectType.primaryKey]===void 0)throw new Error(`Primary key ${e.objectType.primaryKey} not found in ${e.objectType.apiName}`);if(e.implementsInterfaces2==null&&e.implementsInterfaces!=null)throw new Error("Your ontology.json file is missing the implementsInterfaces2 field. Please regenerate it.");const r=e.implementsInterfaces2?Object.fromEntries(Object.entries(e.implementsInterfaces2).map(([i,o])=>[i,o.properties])):{};return{type:"object",apiName:e.objectType.apiName,description:e.objectType.description,primaryKeyApiName:e.objectType.primaryKey,primaryKeyType:ra(e.objectType.properties[e.objectType.primaryKey]),links:Object.fromEntries(e.linkTypes.map(i=>[i.apiName,{multiplicity:i.cardinality==="MANY",targetType:i.objectTypeApiName}])),properties:Object.fromEntries(Object.entries(e.objectType.properties).map(([i,o])=>[i,Cn(o,e.objectType.primaryKey!==i)]).filter(([i,o])=>o!=null)),implements:e.implementsInterfaces,interfaceMap:r,inverseInterfaceMap:Object.fromEntries(Object.entries(r).map(([i,o])=>[i,oa(o)])),icon:aa.includes(e.objectType.icon.type)?e.objectType.icon:void 0,titleProperty:e.objectType.titleProperty,displayName:e.objectType.displayName,pluralDisplayName:e.objectType.pluralDisplayName,status:e.objectType.status,rid:e.objectType.rid,visibility:e.objectType.visibility}}function oa(e){return e?Object.fromEntries(Object.entries(e).map(([t,n])=>[n,t])):void 0}const aa=["blueprint"];function In(e){return e.type==="null"?!0:e.type==="union"?e.unionTypes.some(t=>In(t)):!1}function F(e){switch(e.type){case"double":case"float":case"integer":case"long":case"attachment":case"boolean":case"date":case"string":case"timestamp":return{type:e.type,nullable:!1};case"object":return{type:"object",object:e.objectTypeApiName,nullable:!1};case"objectSet":return{type:"objectSet",objectSet:e.objectTypeApiName,nullable:!1};case"array":return{...F(e.subType),multiplicity:!0};case"set":return{type:"set",set:F(e.subType),nullable:!1};case"union":const t=In(e);if(t&&e.unionTypes.length===2){const r=e.unionTypes.find(i=>i.type!=null);if(r)return{...F(r),nullable:!0}}return{type:"union",union:e.unionTypes.reduce((r,i)=>(i.type==="null"||r.push(F(i)),r),[]),nullable:t};case"struct":return{type:"struct",struct:Object.fromEntries(e.fields.map(r=>[r.name,F(r.fieldType)])),nullable:!1};case"twoDimensionalAggregation":return{type:"twoDimensionalAggregation",twoDimensionalAggregation:jt(e),nullable:!1};case"threeDimensionalAggregation":return{type:"threeDimensionalAggregation",threeDimensionalAggregation:sa(e),nullable:!1};case"entrySet":const n=F(e.keyType);if(!en.includes(n.type))throw new Error("Map types with a key type of "+n.type+" are not supported"+en.toString());if(n.multiplicity===!0)throw new Error("Map types cannot have keys as arrays");return{type:"map",nullable:!1,keyType:n,valueType:F(e.valueType)};case"null":case"unsupported":throw new Error(`Unable to process query because the server indicated an unsupported QueryDataType.type: ${e.type}. Please check that your query is using supported types.`);default:throw new Error(`Unsupported QueryDataType.type ${e.type}`)}}function jt(e){if(e.keyType.type==="range")return{keyType:e.keyType.type,keySubtype:e.keyType.subType.type,valueType:e.valueType.type};if(Dn(e.keyType))return{keyType:e.keyType.type,valueType:e.valueType.type};throw new Error(`Cannot create 2D aggregation with ${e.keyType.type} as its type`)}function sa(e){if(e.keyType.type==="range")return{keyType:e.keyType.type,keySubtype:e.keyType.subType.type,valueType:jt(e.valueType)};if(Dn(e.keyType))return{keyType:e.keyType.type,valueType:jt(e.valueType)};throw new Error(`Cannot create 3D aggregation with ${e.keyType.type} as its type`)}function Dn(e){return e.type==="string"||e.type==="boolean"}const en=["string","object","double","float","integer","long","date","timestamp","byte","datetime","decimal","marking","short","objectType"];function ca(e){return{type:"query",apiName:e.apiName,description:e.description,displayName:e.displayName,version:e.version,parameters:Object.fromEntries(Object.entries(e.parameters).map(([t,n])=>[t,ua(n)])),output:F(e.output),rid:e.rid}}function ua(e){return{description:e.description,...F(e.dataType)}}async function la(e,t){const n=await Xr(e,await e.ontologyRid,t);return ea(n)}async function fa(e,t){const n=await fi(e,await e.ontologyRid,t,{preview:!0});return{...ia(n)}}async function da(e,t){const n=await pi(e,await e.ontologyRid,t,{preview:!0});return Xo(n)}async function pa(e,t){const n=await ki(e,await e.ontologyRid,t);return ca(n)}const ya=()=>e=>{function t(r){const i=Yo((o,a)=>r(o,a,!1));return async o=>await i.get(e,o)}const n={getObjectDefinition:t(async function(r,i){var c;let o=await fa(r,i);const a=Object.fromEntries((await Promise.all(((c=o.implements)==null?void 0:c.map(u=>n.getInterfaceDefinition(u)))??[])).map(u=>[u.apiName,{def:u,handler:void 0}]));return{...o,[Nt]:a}}),getInterfaceDefinition:t(async function(r,i){return da(r,i)}),getQueryDefinition:t(async function(r,i){return await pa(r,i)}),getActionDefinition:t(async function(r,i){return await la(r,i)})};return n},ha="osdk-client/2.2.0-beta.16";function ma(e,t,n,r={},i=global.fetch,o=Qe,a=ya){const s=new URL(t);s.pathname+=s.pathname.endsWith("/")?"":"/";const c={...Po(s.toString(),n,ha,i),objectSetFactory:o,objectFactory:Vo,objectFactory2:Ho,ontologyRid:e.ontologyRid,logger:r.logger,clientCacheKey:{},requestContext:{}};return Object.freeze(Object.assign(c,{ontologyProvider:a(r)(c)}))}const ga=async(e,t)=>{if(t.type==="object"){const{[Nt]:n,...r}=await e.ontologyProvider.getObjectDefinition(t.apiName);return r}else{if(t.type==="interface")return e.ontologyProvider.getInterfaceDefinition(t.apiName);if(t.type==="action")return e.ontologyProvider.getActionDefinition(t.apiName);if(t.type==="query")return e.ontologyProvider.getQueryDefinition(t.apiName);throw new Error("Not implemented for given definition")}};function ie(){}const De={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};var Re;class wa{constructor(t,n={},r){w(this,Re);R(this,"trace",ie);R(this,"debug",ie);R(this,"warn",ie);R(this,"info",ie);R(this,"error",ie);R(this,"fatal",ie);var i;this.bindings=t,this.options=n,A(this,Re,r);for(const o of["trace","debug","info","warn","error","fatal"])(i=this.options)!=null&&i.level&&!this.isLevelEnabled(o)||(this[o]=this.createLogMethod(o,t))}child(t,n){var r,i;return new(l(this,Re))({...this.bindings,...t},{level:(r=n??this.options)==null?void 0:r.level,msgPrefix:[(i=this.options)==null?void 0:i.msgPrefix,n==null?void 0:n.msgPrefix].filter(o=>o).join(" ")})}isLevelEnabled(t){var r;const n=((r=this.options)==null?void 0:r.level)??"info";return t in De&&n in De&&De[t]>=De[n]}}Re=new WeakMap;class Rt extends wa{constructor(t={},n={}){super(t,{...n,level:n.level??"error"},Rt)}createLogMethod(t,n){var i;const r=[t];return(i=this.options)!=null&&i.msgPrefix&&r.push(this.options.msgPrefix),typeof n=="object"&&"methodName"in n&&r.push(`.${n.methodName}()`),(...o)=>{console[t==="fatal"?"error":t](r.join(" "),...o)}}}function ba(e){return e&&typeof e=="object"&&typeof e.$apiName=="string"&&e.$primaryKey!=null}async function G(e,t,n){if(e==null)return e;if(Array.isArray(e)&&n.multiplicity){const r=Array.from(e);if(r.some(o=>We(o)||Je(o))){const o=[];for(const a of r)o.push(await G(a,t,n));return o}const i=Array.from(e,async o=>await G(o,t,n));return Promise.all(i)}switch(n.type){case"attachment":return We(e)?(await Be(t,e.data,{filename:e.name})).rid:Je(e)?(await Be(t,e,{filename:e.name})).rid:e;case"twoDimensionalAggregation":return{groups:e};case"threeDimensionalAggregation":return{groups:e};case"set":{if(e instanceof Set){const r=Array.from(e,async i=>await G(i,t,n.set));return Promise.all(r)}break}case"object":{if(ba(e))return e.$primaryKey;break}case"objectSet":{if(At(e))return e;if(An(e))return qe(e);break}case"map":{if(typeof e=="object"){const r=[];for(const[i,o]of Object.entries(e))r.push({key:n.keyType.type==="object"?Uo(i):await G(i,t,n.keyType),value:await G(o,t,n.valueType)});return r}break}case"struct":if(typeof e=="object"){const r={};for(const[i,o]of Object.entries(e))r[i]=await G(o,t,n.struct[i]);return r}case"boolean":case"date":case"double":case"float":case"integer":case"long":case"string":case"timestamp":return e}return e}async function Ta(e,t,n){const r=await e.ontologyProvider.getQueryDefinition(t.apiName),i=await Ei(ye(J(e,()=>({finalMethodCall:"applyQuery"})),t),await e.ontologyRid,t.apiName,{parameters:n?await Oa(n,e,r.parameters):{}}),o=await xe(r.output,e);return await be(e,r.output,i.value,o)}async function Oa(e,t,n){const r={};for(const[i,o]of Object.entries(e))r[i]=await G(o,t,n[i]);return r}async function be(e,t,n,r){if(n==null){if(t.nullable)return;throw new Error("Got null response when nullable was not allowed")}if(t.multiplicity!=null&&t.multiplicity){const i={...t,multiplicity:!1};for(let o=0;o<n.length;o++)n[o]=await be(e,i,n[o],r);return n}switch(t.type){case"union":throw new Error("Union return types are not yet supported");case"set":{for(let i=0;i<n.length;i++)n[i]=await be(e,t.set,n[i],r);return n}case"attachment":return je(e,n);case"object":{const i=r.get(t.object);if(!i||i.type!=="object")throw new Error(`Missing definition for ${t.object}`);return Ea(n,i)}case"objectSet":{const i=r.get(t.objectSet);if(!i)throw new Error(`Missing definition for ${t.objectSet}`);return typeof n=="string"?Qe(i,e,{type:"intersect",objectSets:[{type:"base",objectType:t.objectSet},{type:"reference",reference:n}]}):Qe(i,e,n)}case"struct":{for(const[i,o]of Object.entries(t.struct))Et(o)&&(n[i]=await be(e,o,n[i],r));return n}case"map":{const i={};Array.isArray(n)||b();for(const o of n){o.key||b(),o.value||b();const a=t.keyType.type==="object"?ja(o.key,t.keyType.object,r):o.key,s=await be(e,t.valueType,o.value,r);i[a]=s}return i}case"twoDimensionalAggregation":{const i=[];for(const{key:o,value:a}of n.groups)i.push({key:o,value:a});return i}case"threeDimensionalAggregation":{const i=[];for(const{key:o,groups:a}of n.groups){const s=[];for(const{key:c,value:u}of a)s.push({key:c,value:u});i.push({key:o,groups:s})}return i}}return n}async function xe(e,t){const n=new Map;switch(e.type){case"objectSet":{const r=await t.ontologyProvider.getObjectDefinition(e.objectSet);n.set(e.objectSet,r);break}case"object":{const r=await t.ontologyProvider.getObjectDefinition(e.object);n.set(e.object,r);break}case"set":return xe(e.set,t);case"map":{for(const r of[e.keyType,e.valueType])for(const[i,o]of await xe(r,t))n.set(i,o);break}case"struct":{for(const r of Object.values(e.struct))for(const[i,o]of await xe(r,t))n.set(i,o);break}}return n}function Et(e){switch(e.type){case"boolean":case"date":case"double":case"float":case"integer":case"long":case"string":case"timestamp":return!1;case"union":return!0;case"struct":return Object.values(e.struct).some(Et);case"set":return Et(e.set);case"attachment":case"objectSet":case"twoDimensionalAggregation":case"threeDimensionalAggregation":case"object":return!0;default:return!1}}function ja(e,t,n){const r=n.get(t);if(!r||r.type!=="object")throw new Error(`Missing definition for ${t}`);return Pt(r,e)}function Ea(e,t){return{$apiName:t.apiName,$title:void 0,$objectType:t.apiName,$primaryKey:e,$objectSpecifier:Pt(t,e)}}class Sa{constructor(t,n){this.applyAction=qt.bind(void 0,t,n),this.batchApplyAction=qt.bind(void 0,t,n)}}class ka{constructor(t,n){this.executeFunction=Ta.bind(void 0,t,n)}}function va(e,t,n,r,i=void 0,o=fetch){if(typeof n=="string"){if(!n.startsWith("ri."))throw new Error("Invalid ontology RID")}else n.then(u=>{if(!u.startsWith("ri."))throw new Error("Invalid ontology RID")});const a=ma({ontologyRid:n},t,r,{...i,logger:(i==null?void 0:i.logger)??new Rt},o,e),s=ga.bind(void 0,a);return Object.defineProperties(function(u){if(u.type==="object"||u.type==="interface")return e(u,a);if(u.type==="action")return new Sa(a,u);if(u.type==="query")return new ka(a,u);if(u.type==="experiment"){switch(u.name){case Wr.name:return{getBulkLinks:Gi(a)};case Fr.name:return{fetchOneByRid:async(d,p,y)=>await ot(a,d,y,tn([p]))};case Kr.name:return{createMediaReference:async d=>{const{data:p,fileName:y,objectType:f,propertyType:m}=d;return await ui(a,await a.ontologyRid,f.apiName,m,p,{mediaItemPath:y,preview:!0})}};case Br.name:return{fetchPageByRid:async(d,p,y={})=>await Sn(a,d,y,tn(p))}}throw new Error("not implemented")}else throw new Error("not implemented")},{[hn]:{value:a},__osdkClientContext:{value:a},[Ao]:{value:a},fetchMetadata:{value:s}})}const Xs=va.bind(void 0,Qe);function tn(e){return{type:"static",objects:e}}const j={extraUserAgent:"typescript-sdk/0.3.0 typescript-sdk-generator/2.2.0-beta.10"},_a="ri.ontology.main.ontology.ab265709-5927-4853-99f0-c8f173e324e0",Ln={apiName:"buildLegsFlightPlanner20",type:"action",osdkMetadata:j},Un={apiName:"calculateFlightTimes",type:"action",osdkMetadata:j},xn={apiName:"calculateSunriseSunset",type:"action",osdkMetadata:j},Kn={apiName:"createFlightLogObject",type:"action",osdkMetadata:j},Fn={apiName:"createNewFlightFp2",type:"action",osdkMetadata:j},Bn={apiName:"editExistingFlightFp2",type:"action",osdkMetadata:j},Wn={apiName:"flightAppUpdateEtdAndCrew",type:"action",osdkMetadata:j},Jn={apiName:"flightFuelFpv2",type:"action",osdkMetadata:j},zn={apiName:"flightWeatherRiskTriggeredLightningWaves",type:"action",osdkMetadata:j},Vn={apiName:"getGlobalWindsForFlight",type:"action",osdkMetadata:j},Hn={apiName:"getWeatherForAlternates",type:"action",osdkMetadata:j},qn={apiName:"pseudoWeatherSegments",type:"action",osdkMetadata:j},Qn={apiName:"singleFlightAutomation",type:"action",osdkMetadata:j},Gn={apiName:"updateWeatherByRegion",type:"action",osdkMetadata:j},Yn={apiName:"weatherWebookNorwayV9",type:"action",osdkMetadata:j},Aa=Object.freeze(Object.defineProperty({__proto__:null,buildLegsFlightPlanner20:Ln,calculateFlightTimes:Un,calculateSunriseSunset:xn,createFlightLogObject:Kn,createNewFlightFp2:Fn,editExistingFlightFp2:Bn,flightAppUpdateEtdAndCrew:Wn,flightFuelFpv2:Jn,flightWeatherRiskTriggeredLightningWaves:zn,getGlobalWindsForFlight:Vn,getWeatherForAlternates:Hn,pseudoWeatherSegments:qn,singleFlightAutomation:Qn,updateWeatherByRegion:Gn,weatherWebookNorwayV9:Yn},Symbol.toStringTag,{value:"Module"})),Pa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Xn={type:"object",apiName:"AirportsData",osdkMetadata:j},Zn={type:"object",apiName:"AllGtLocationsV2",osdkMetadata:j},er={type:"object",apiName:"Asset",osdkMetadata:j},tr={type:"object",apiName:"BristowHelidecks",osdkMetadata:j},nr={type:"object",apiName:"FlightFuelDburbury",osdkMetadata:j},rr={type:"object",apiName:"FlightLogObject",osdkMetadata:j},ir={type:"object",apiName:"FuelPolicyBuilder",osdkMetadata:j},or={type:"object",apiName:"InternationalWeather",osdkMetadata:j},ar={type:"object",apiName:"LegObjectOutputObject",osdkMetadata:j},sr={type:"object",apiName:"MainFlightObjectFp2",osdkMetadata:j},cr={type:"object",apiName:"MainFuelV2",osdkMetadata:j},ur={type:"object",apiName:"NorwayWeatherSegments",osdkMetadata:j},lr={type:"object",apiName:"NorwayWeatherXv8",osdkMetadata:j},fr={type:"object",apiName:"User",osdkMetadata:j},Na=Object.freeze(Object.defineProperty({__proto__:null,AirportsData:Xn,AllGtLocationsV2:Zn,Asset:er,BristowHelidecks:tr,FlightFuelDburbury:nr,FlightLogObject:rr,FuelPolicyBuilder:ir,InternationalWeather:or,LegObjectOutputObject:ar,MainFlightObjectFp2:sr,MainFuelV2:cr,NorwayWeatherSegments:ur,NorwayWeatherXv8:lr,User:fr},Symbol.toStringTag,{value:"Module"})),Ra=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Zs=Object.freeze(Object.defineProperty({__proto__:null,$Actions:Aa,$Interfaces:Pa,$Objects:Na,$Queries:Ra,$ontologyRid:_a,$osdkMetadata:j,AirportsData:Xn,AllGtLocationsV2:Zn,Asset:er,BristowHelidecks:tr,FlightFuelDburbury:nr,FlightLogObject:rr,FuelPolicyBuilder:ir,InternationalWeather:or,LegObjectOutputObject:ar,MainFlightObjectFp2:sr,MainFuelV2:cr,NorwayWeatherSegments:ur,NorwayWeatherXv8:lr,User:fr,buildLegsFlightPlanner20:Ln,calculateFlightTimes:Un,calculateSunriseSunset:xn,createFlightLogObject:Kn,createNewFlightFp2:Fn,editExistingFlightFp2:Bn,flightAppUpdateEtdAndCrew:Wn,flightFuelFpv2:Jn,flightWeatherRiskTriggeredLightningWaves:zn,getGlobalWindsForFlight:Vn,getWeatherForAlternates:Hn,pseudoWeatherSegments:qn,singleFlightAutomation:Qn,updateWeatherByRegion:Gn,weatherWebookNorwayV9:Yn},Symbol.toStringTag,{value:"Module"}));let St;var Le,pn;(typeof navigator>"u"||!((pn=(Le=navigator.userAgent)==null?void 0:Le.startsWith)!=null&&pn.call(Le,"Mozilla/5.0 ")))&&(St="oauth4webapi/v2.17.0");function $t(e,t){if(e==null)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}const $a=Symbol(),Ma=Symbol(),dr=Symbol(),pr=Symbol(),Ca=Symbol(),Ia=Symbol(),Da=new TextEncoder,La=new TextDecoder;function ee(e){return typeof e=="string"?Da.encode(e):La.decode(e)}const nn=32768;function Ua(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let n=0;n<e.byteLength;n+=nn)t.push(String.fromCharCode.apply(null,e.subarray(n,n+nn)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function xa(e){try{const t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}catch(t){throw new h("The input to be decoded is not correctly encoded.",{cause:t})}}function Q(e){return typeof e=="string"?xa(e):Ua(e)}class Ka{constructor(t){this.cache=new Map,this._cache=new Map,this.maxSize=t}get(t){let n=this.cache.get(t);if(n)return n;if(n=this._cache.get(t))return this.update(t,n),n}has(t){return this.cache.has(t)||this._cache.has(t)}set(t,n){return this.cache.has(t)?this.cache.set(t,n):this.update(t,n),this}delete(t){return this.cache.has(t)?this.cache.delete(t):this._cache.has(t)?this._cache.delete(t):!1}update(t,n){this.cache.set(t,n),this.cache.size>=this.maxSize&&(this._cache=this.cache,this.cache=new Map)}}class L extends Error{constructor(t){var n;super(t??"operation not supported"),this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}}class Fa extends Error{constructor(t,n){var r;super(t,n),this.name=this.constructor.name,(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}const h=Fa,yr=new Ka(100);function hr(e){return e instanceof CryptoKey}function mr(e){return hr(e)&&e.type==="private"}function Ba(e){return hr(e)&&e.type==="public"}function Wa(e){try{const t=e.headers.get("dpop-nonce");t&&yr.set(new URL(e.url).origin,t)}catch{}return e}function Xe(e){return!(e===null||typeof e!="object"||Array.isArray(e))}function gr(e){$t(e,Headers)&&(e=Object.fromEntries(e.entries()));const t=new Headers(e);if(St&&!t.has("user-agent")&&t.set("user-agent",St),t.has("authorization"))throw new TypeError('"options.headers" must not include the "authorization" header name');if(t.has("dpop"))throw new TypeError('"options.headers" must not include the "dpop" header name');return t}function Ja(e){if(typeof e=="function"&&(e=e()),!(e instanceof AbortSignal))throw new TypeError('"options.signal" must return or be an instance of AbortSignal');return e}function N(e){return typeof e=="string"&&e.length!==0}function at(){return Q(crypto.getRandomValues(new Uint8Array(32)))}function za(){return at()}function Va(){return at()}async function Ha(e){if(!N(e))throw new TypeError('"codeVerifier" must be a non-empty string');return Q(await crypto.subtle.digest("SHA-256",ee(e)))}function qa(e){if(e instanceof CryptoKey)return{key:e};if(!((e==null?void 0:e.key)instanceof CryptoKey))return{};if(e.kid!==void 0&&!N(e.kid))throw new TypeError('"kid" must be a non-empty string');return{key:e.key,kid:e.kid,modifyAssertion:e[pr]}}function rn(e){return encodeURIComponent(e).replace(/%20/g,"+")}function Qa(e,t){const n=rn(e),r=rn(t);return`Basic ${btoa(`${n}:${r}`)}`}function Ga(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new L("unsupported RsaHashedKeyAlgorithm hash name")}}function Ya(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new L("unsupported RsaHashedKeyAlgorithm hash name")}}function Xa(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new L("unsupported EcKeyAlgorithm namedCurve")}}function wr(e){switch(e.algorithm.name){case"RSA-PSS":return Ga(e);case"RSASSA-PKCS1-v1_5":return Ya(e);case"ECDSA":return Xa(e);case"Ed25519":case"Ed448":return"EdDSA";default:throw new L("unsupported CryptoKey algorithm name")}}function Mt(e){const t=e==null?void 0:e[$a];return typeof t=="number"&&Number.isFinite(t)?t:0}function Za(e){const t=e==null?void 0:e[Ma];return typeof t=="number"&&Number.isFinite(t)&&Math.sign(t)!==-1?t:30}function Ct(){return Math.floor(Date.now()/1e3)}function es(e,t){const n=Ct()+Mt(t);return{jti:at(),aud:[e.issuer,e.token_endpoint],exp:n+60,iat:n,nbf:n,iss:t.client_id,sub:t.client_id}}async function ts(e,t,n,r,i){const o={alg:wr(n),kid:r},a=es(e,t);return i==null||i(o,a),br(o,a,n)}function $e(e){if(typeof e!="object"||e===null)throw new TypeError('"as" must be an object');if(!N(e.issuer))throw new TypeError('"as.issuer" property must be a non-empty string');return!0}function Me(e){if(typeof e!="object"||e===null)throw new TypeError('"client" must be an object');if(!N(e.client_id))throw new TypeError('"client.client_id" property must be a non-empty string');return!0}function on(e){if(!N(e))throw new TypeError('"client.client_secret" property must be a non-empty string');return e}function ft(e,t){if(t!==void 0)throw new TypeError(`"options.clientPrivateKey" property must not be provided when ${e} client authentication method is used.`)}function an(e,t){if(t!==void 0)throw new TypeError(`"client.client_secret" property must not be provided when ${e} client authentication method is used.`)}async function ns(e,t,n,r,i){switch(n.delete("client_secret"),n.delete("client_assertion_type"),n.delete("client_assertion"),t.token_endpoint_auth_method){case void 0:case"client_secret_basic":{ft("client_secret_basic",i),r.set("authorization",Qa(t.client_id,on(t.client_secret)));break}case"client_secret_post":{ft("client_secret_post",i),n.set("client_id",t.client_id),n.set("client_secret",on(t.client_secret));break}case"private_key_jwt":{if(an("private_key_jwt",t.client_secret),i===void 0)throw new TypeError('"options.clientPrivateKey" must be provided when "client.token_endpoint_auth_method" is "private_key_jwt"');const{key:o,kid:a,modifyAssertion:s}=qa(i);if(!mr(o))throw new TypeError('"options.clientPrivateKey.key" must be a private CryptoKey');n.set("client_id",t.client_id),n.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),n.set("client_assertion",await ts(e,t,o,a,s));break}case"tls_client_auth":case"self_signed_tls_client_auth":case"none":{an(t.token_endpoint_auth_method,t.client_secret),ft(t.token_endpoint_auth_method,i),n.set("client_id",t.client_id);break}default:throw new L("unsupported client token_endpoint_auth_method")}}async function br(e,t,n){if(!n.usages.includes("sign"))throw new TypeError('CryptoKey instances used for signing assertions must include "sign" in their "usages"');const r=`${Q(ee(JSON.stringify(e)))}.${Q(ee(JSON.stringify(t)))}`,i=Q(await crypto.subtle.sign(Ar(n),n,ee(r)));return`${r}.${i}`}async function rs(e,t,n,r,i,o){var y;const{privateKey:a,publicKey:s,nonce:c=yr.get(n.origin)}=t;if(!mr(a))throw new TypeError('"DPoP.privateKey" must be a private CryptoKey');if(!Ba(s))throw new TypeError('"DPoP.publicKey" must be a public CryptoKey');if(c!==void 0&&!N(c))throw new TypeError('"DPoP.nonce" must be a non-empty string or undefined');if(!s.extractable)throw new TypeError('"DPoP.publicKey.extractable" must be true');const u=Ct()+i,d={alg:wr(a),typ:"dpop+jwt",jwk:await os(s)},p={iat:u,jti:at(),htm:r,nonce:c,htu:`${n.origin}${n.pathname}`,ath:void 0};(y=t[pr])==null||y.call(t,d,p),e.set("dpop",await br(d,p,a))}let Ke;async function is(e){const{kty:t,e:n,n:r,x:i,y:o,crv:a}=await crypto.subtle.exportKey("jwk",e),s={kty:t,e:n,n:r,x:i,y:o,crv:a};return Ke.set(e,s),s}async function os(e){return Ke||(Ke=new WeakMap),Ke.get(e)||is(e)}function sn(e,t,n){if(typeof e!="string")throw n?new TypeError(`"as.mtls_endpoint_aliases.${t}" must be a string`):new TypeError(`"as.${t}" must be a string`);return new URL(e)}function Tr(e,t,n=!1){return n&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?sn(e.mtls_endpoint_aliases[t],t,n):sn(e[t],t,n)}function Or(e,t){return!!(e.use_mtls_endpoint_aliases||t!=null&&t[Ia])}function jr(e){const t=e;return typeof t!="object"||Array.isArray(t)||t===null?!1:t.error!==void 0}async function Er(e,t,n,r,i,o,a){return await ns(e,t,i,o,a==null?void 0:a.clientPrivateKey),o.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((a==null?void 0:a[dr])||fetch)(r.href,{body:i,headers:Object.fromEntries(o.entries()),method:n,redirect:"manual",signal:a!=null&&a.signal?Ja(a.signal):null}).then(Wa)}async function Sr(e,t,n,r,i){const o=Tr(e,"token_endpoint",Or(t,i));r.set("grant_type",n);const a=gr(i==null?void 0:i.headers);return a.set("accept","application/json"),(i==null?void 0:i.DPoP)!==void 0&&await rs(a,i.DPoP,o,"POST",Mt(t)),Er(e,t,"POST",o,r,a,i)}async function as(e,t,n,r){if($e(e),Me(t),!N(n))throw new TypeError('"refreshToken" must be a non-empty string');const i=new URLSearchParams(r==null?void 0:r.additionalParameters);return i.set("refresh_token",n),Sr(e,t,"refresh_token",i,r)}const ss=new WeakMap;async function cs(e,t,n,r=!1,i=!1){if($e(e),Me(t),!$t(n,Response))throw new TypeError('"response" must be an instance of Response');if(n.status!==200){let a;if(a=await _r(n))return a;throw new h('"response" is not a conform Token Endpoint response')}vr(n);let o;try{o=await n.json()}catch(a){throw new h('failed to parse "response" body as JSON',{cause:a})}if(!Xe(o))throw new h('"response" body must be a top level object');if(!N(o.access_token))throw new h('"response" body "access_token" property must be a non-empty string');if(!N(o.token_type))throw new h('"response" body "token_type" property must be a non-empty string');if(o.token_type=o.token_type.toLowerCase(),o.token_type!=="dpop"&&o.token_type!=="bearer")throw new L("unsupported `token_type` value");if(o.expires_in!==void 0&&(typeof o.expires_in!="number"||o.expires_in<=0))throw new h('"response" body "expires_in" property must be a positive number');if(!i&&o.refresh_token!==void 0&&!N(o.refresh_token))throw new h('"response" body "refresh_token" property must be a non-empty string');if(o.scope!==void 0&&typeof o.scope!="string")throw new h('"response" body "scope" property must be a string');if(!r){if(o.id_token!==void 0&&!N(o.id_token))throw new h('"response" body "id_token" property must be a non-empty string');if(o.id_token){const{claims:a,jwt:s}=await bs(o.id_token,Ts.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),Pr,Mt(t),Za(t),t[Ca]).then(ys.bind(void 0,["aud","exp","iat","iss","sub"])).then(ls.bind(void 0,e.issuer)).then(us.bind(void 0,t.client_id));if(Array.isArray(a.aud)&&a.aud.length!==1){if(a.azp===void 0)throw new h('ID Token "aud" (audience) claim includes additional untrusted audiences');if(a.azp!==t.client_id)throw new h('unexpected ID Token "azp" (authorized party) claim value')}if(a.auth_time!==void 0&&(!Number.isFinite(a.auth_time)||Math.sign(a.auth_time)!==1))throw new h('ID Token "auth_time" (authentication time) must be a positive number');ss.set(o,[a,s])}}return o}function us(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw new h('unexpected JWT "aud" (audience) claim value')}else if(t.claims.aud!==e)throw new h('unexpected JWT "aud" (audience) claim value');return t}function ls(e,t){if(t.claims.iss!==e)throw new h('unexpected JWT "iss" (issuer) claim value');return t}const kr=new WeakSet;function fs(e){return kr.add(e),e}async function ds(e,t,n,r,i,o){if($e(e),Me(t),!kr.has(n))throw new TypeError('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()');if(!N(r))throw new TypeError('"redirectUri" must be a non-empty string');if(!N(i))throw new TypeError('"codeVerifier" must be a non-empty string');const a=K(n,"code");if(!a)throw new h('no authorization code in "callbackParameters"');const s=new URLSearchParams(o==null?void 0:o.additionalParameters);return s.set("redirect_uri",r),s.set("code_verifier",i),s.set("code",a),Sr(e,t,"authorization_code",s,o)}const ps={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation"};function ys(e,t){for(const n of e)if(t.claims[n]===void 0)throw new h(`JWT "${n}" (${ps[n]}) claim missing`);return t}async function cn(e,t,n){const r=await cs(e,t,n,!0);if(jr(r))return r;if(r.id_token!==void 0){if(typeof r.id_token=="string"&&r.id_token.length)throw new h("Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing");delete r.id_token}return r}async function hs(e,t,n,r){if($e(e),Me(t),!N(n))throw new TypeError('"token" must be a non-empty string');const i=Tr(e,"revocation_endpoint",Or(t,r)),o=new URLSearchParams(r==null?void 0:r.additionalParameters);o.set("token",n);const a=gr(r==null?void 0:r.headers);return a.delete("accept"),Er(e,t,"POST",i,o,a,r)}async function ms(e){if(!$t(e,Response))throw new TypeError('"response" must be an instance of Response');if(e.status!==200){let t;if(t=await _r(e))return t;throw new h('"response" is not a conform Revocation Endpoint response')}}function vr(e){if(e.bodyUsed)throw new TypeError('"response" body has been used already')}async function _r(e){if(e.status>399&&e.status<500){vr(e);try{const t=await e.json();if(Xe(t)&&typeof t.error=="string"&&t.error.length)return t.error_description!==void 0&&typeof t.error_description!="string"&&delete t.error_description,t.error_uri!==void 0&&typeof t.error_uri!="string"&&delete t.error_uri,t.algs!==void 0&&typeof t.algs!="string"&&delete t.algs,t.scope!==void 0&&typeof t.scope!="string"&&delete t.scope,t}catch{}}}function un(e){if(typeof e.modulusLength!="number"||e.modulusLength<2048)throw new h(`${e.name} modulusLength must be at least 2048 bits`)}function gs(e){switch(e){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new L}}function Ar(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:gs(e.algorithm.namedCurve)};case"RSA-PSS":switch(un(e.algorithm),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new L}case"RSASSA-PKCS1-v1_5":return un(e.algorithm),e.algorithm.name;case"Ed448":case"Ed25519":return e.algorithm.name}throw new L}const Pr=Symbol();async function ws(e,t,n,r){const i=`${e}.${t}`;if(!await crypto.subtle.verify(Ar(n),n,r,ee(i)))throw new h("JWT signature verification failed")}async function bs(e,t,n,r,i,o){let{0:a,1:s,2:c,length:u}=e.split(".");if(u===5)if(o!==void 0)e=await o(e),{0:a,1:s,2:c,length:u}=e.split(".");else throw new L("JWE structure JWTs are not supported");if(u!==3)throw new h("Invalid JWT");let d;try{d=JSON.parse(ee(Q(a)))}catch(T){throw new h("failed to parse JWT Header body as base64url encoded JSON",{cause:T})}if(!Xe(d))throw new h("JWT Header must be a top level object");if(t(d),d.crit!==void 0)throw new h('unexpected JWT "crit" header parameter');const p=Q(c);let y;n!==Pr&&(y=await n(d),await ws(a,s,y,p));let f;try{f=JSON.parse(ee(Q(s)))}catch(T){throw new h("failed to parse JWT Payload body as base64url encoded JSON",{cause:T})}if(!Xe(f))throw new h("JWT Payload must be a top level object");const m=Ct()+r;if(f.exp!==void 0){if(typeof f.exp!="number")throw new h('unexpected JWT "exp" (expiration time) claim type');if(f.exp<=m-i)throw new h('unexpected JWT "exp" (expiration time) claim value, timestamp is <= now()')}if(f.iat!==void 0&&typeof f.iat!="number")throw new h('unexpected JWT "iat" (issued at) claim type');if(f.iss!==void 0&&typeof f.iss!="string")throw new h('unexpected JWT "iss" (issuer) claim type');if(f.nbf!==void 0){if(typeof f.nbf!="number")throw new h('unexpected JWT "nbf" (not before) claim type');if(f.nbf>m+i)throw new h('unexpected JWT "nbf" (not before) claim value, timestamp is > now()')}if(f.aud!==void 0&&typeof f.aud!="string"&&!Array.isArray(f.aud))throw new h('unexpected JWT "aud" (audience) claim type');return{header:d,claims:f,signature:p,key:y,jwt:e}}function Ts(e,t,n){if(e!==void 0){if(n.alg!==e)throw new h('unexpected JWT "alg" header parameter');return}if(Array.isArray(t)){if(!t.includes(n.alg))throw new h('unexpected JWT "alg" header parameter');return}if(n.alg!=="RS256")throw new h('unexpected JWT "alg" header parameter')}function K(e,t){const{0:n,length:r}=e.getAll(t);if(r>1)throw new h(`"${t}" parameter must be provided only once`);return n}const Os=Symbol(),js=Symbol();function Es(e,t,n,r){if($e(e),Me(t),n instanceof URL&&(n=n.searchParams),!(n instanceof URLSearchParams))throw new TypeError('"parameters" must be an instance of URLSearchParams, or URL');if(K(n,"response"))throw new h('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');const i=K(n,"iss"),o=K(n,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw new h('response parameter "iss" (issuer) missing');if(i&&i!==e.issuer)throw new h('unexpected "iss" (issuer) response parameter value');switch(r){case void 0:case js:if(o!==void 0)throw new h('unexpected "state" response parameter encountered');break;case Os:break;default:if(!N(r))throw new h('"expectedState" must be a non-empty string');if(o===void 0)throw new h('response parameter "state" missing');if(o!==r)throw new h('unexpected "state" response parameter value')}const a=K(n,"error");if(a)return{error:a,error_description:K(n,"error_description"),error_uri:K(n,"error_uri")};const s=K(n,"id_token"),c=K(n,"token");if(s!==void 0||c!==void 0)throw new L("implicit and hybrid flows are not supported");return fs(new URLSearchParams(n))}var Ss=class extends EventTarget{dispatchTypedEvent(e,t){return super.dispatchEvent(t)}};function Fe(e){if(jr(e))throw new Error(`Failed to get token: ${e.error}`);return e}const ks=globalThis.CustomEvent;function he(e){return`@osdk/oauth : refresh : ${e.client_id}`}function kt(e,t){var n;(n=globalThis.localStorage)==null||n.setItem(he(e),JSON.stringify(t))}function vt(e){var t;(t=globalThis.localStorage)==null||t.removeItem(he(e))}function vs(e){var t;return JSON.parse(((t=globalThis.localStorage)==null?void 0:t.getItem(he(e)))??"{}")}function ln(e,t){var n;(n=globalThis.sessionStorage)==null||n.setItem(he(e),JSON.stringify(t))}function _s(e){var t;(t=globalThis.sessionStorage)==null||t.removeItem(he(e))}function dt(e){var t;return JSON.parse(((t=globalThis.sessionStorage)==null?void 0:t.getItem(he(e)))??"{}")}function As(e,t,n,r,i,o,a){let s;const c=new Ss;function u(v,_){const{refresh_token:D,expires_in:g,access_token:S}=v;return g==null&&b(),kt(e,{refresh_token:D,refreshTokenMarker:o,requestedScopes:a}),s={refresh_token:D,expires_in:g,access_token:S,expires_at:Date.now()+g*1e3},c.dispatchTypedEvent(_,new ks(_,{detail:s})),s}let d;function p(){d&&clearTimeout(d)}function y(v){i&&(p(),d=setTimeout(i,v.detail.expires_in*1e3-60*1e3))}let f;async function m(){if(f)return f;try{return f=n(),await f}finally{f=void 0}}c.addEventListener("signIn",y),c.addEventListener("refresh",y);function T(){if(!(!s||Date.now()>=s.expires_at))return s==null?void 0:s.access_token}return{getToken:Object.assign(async function(){return(!s||Date.now()>=s.expires_at)&&(s=await m()),s==null?void 0:s.access_token},{signIn:m,refresh:i,signOut:async function(){s||b();const _=await ms(await hs(t,e,s.access_token,r));p(),vt(e),s=void 0,Fe(_),c.dispatchTypedEvent("signOut",new Event("signOut"))},rmTimeout:p,getTokenOrUndefined:T,addEventListener:c.addEventListener.bind(c),removeEventListener:c.removeEventListener.bind(c)}),makeTokenAndSaveRefresh:u}}function Ps(e,t){const n=`${new URL(e,t.endsWith("/")?t:t+"/")}`;return{token_endpoint:`${n}/api/oauth2/token`,authorization_endpoint:`${n}/api/oauth2/authorize`,revocation_endpoint:`${n}/api/oauth2/revoke_token`,issuer:n}}const fn=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},Ns=new WeakMap;function Rs({clearTimeout:e,setTimeout:t}={}){return(n,{value:r,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(fn());let o,a,s;const c=e??clearTimeout,u=()=>{c(o),s(fn())},d=()=>{i&&i.removeEventListener("abort",u)},p=new Promise((y,f)=>{a=()=>{d(),y(r)},s=f,o=(t??setTimeout)(a,n)});return i&&i.addEventListener("abort",u,{once:!0}),Ns.set(p,()=>{c(o),o=null,a()}),p}}const dn=Rs();function $s(e,t,n,r,i,o,a,s){let c={};return typeof n=="object"?(!r&&!i&&!o&&!a&&!s||b(),c=n):c={useHistory:n,loginPage:r,postLoginPage:i,scopes:o,fetchFn:a,ctxPath:s},t||b(),{useHistory:c.useHistory??!0,loginPage:c.loginPage,postLoginPage:c.postLoginPage||window.location.toString(),joinedScopes:[...c.scopes??["api:read-data","api:write-data"]].sort().join(" "),fetchFn:c.fetchFn??globalThis.fetch,ctxPath:c.ctxPath??"multipass",refreshTokenMarker:c.refreshTokenMarker}}function ec(e,t,n,r,i,o,a,s,c){let u,d;({useHistory:r,loginPage:i,postLoginPage:o,joinedScopes:d,fetchFn:s,ctxPath:c,refreshTokenMarker:u}=$s(t,n,r,i,o,a,s,c));const p={client_id:e,token_endpoint_auth_method:"none"},y=Ps(c,t),f={[dr]:s},{makeTokenAndSaveRefresh:m,getToken:T}=As(p,y,async function(){return await v()??await _()??await D()},f,v.bind(globalThis,!0),u,d),P=async g=>{if(r){window.history.replaceState({},"",g);return}else window.location.assign(g);throw await dn(1e3),new Error("Unable to redirect")};async function v(g){const{refresh_token:S,refreshTokenMarker:te,requestedScopes:ne}=vs(p),Nr=ne!=null&&d===ne;if(!S||te!==u||!Nr){if(g)throw new Error("No refresh token found");return}try{const st=m(Fe(await cn(y,p,await as(y,p,S,f))),"refresh");if(st&&window.location.pathname===new URL(n).pathname){const{oldUrl:Rr}=dt(p);P(Rr??"/")}return st}catch{if(vt(p),g)throw new Error("Could not refresh token")}}async function _(){const{state:g,oldUrl:S,codeVerifier:te}=dt(p);if(te)try{const ne=m(Fe(await cn(y,p,await ds(y,p,Fe(Es(y,p,new URL(window.location.href),g)),n,te,f))),"signIn");return P(S),ne}catch(ne){throw vt(p),_s(p),ne}}const D=async()=>{if(i&&window.location.href!==i&&window.location.pathname!==i){kt(p,{}),ln(p,{oldUrl:o}),await P(i);return}const g=Va(),S=za(),te=dt(p).oldUrl??window.location.toString();throw kt(p,{}),ln(p,{codeVerifier:S,state:g,oldUrl:te}),window.location.assign(`${y.authorization_endpoint}?${new URLSearchParams({client_id:e,response_type:"code",state:g,redirect_uri:n,code_challenge:await Ha(S),code_challenge_method:"S256",scope:`offline_access ${d}`})}`),await dn(1e3),new Error("Unable to redirect")};return T}const Ms=[3,"/v2/admin/users/{0}"];function Cs(e,...t){return O(e,Ms,...t)}const Is=[0,"/v2/admin/users",2];function Ds(e,...t){return O(e,Is,...t)}const Ls=[0,"/v2/admin/users/{0}"];function Us(e,...t){return O(e,Ls,...t)}const xs=[1,"/v2/admin/users/getBatch",1];function Ks(e,...t){return O(e,xs,...t)}const Fs=[0,"/v2/admin/users/getCurrent"];function Bs(e,...t){return O(e,Fs,...t)}const Ws=[0,"/v2/admin/users/{0}/getMarkings",2];function Js(e,...t){return O(e,Ws,...t)}const zs=[0,"/v2/admin/users/{0}/profilePicture",,,"application/octet-stream"];function Vs(e,...t){return O(e,zs,...t)}const Hs=[1,"/v2/admin/users/search",1];function qs(e,...t){return O(e,Hs,...t)}const tc=Object.freeze(Object.defineProperty({__proto__:null,deleteUser:Cs,get:Us,getBatch:Ks,getCurrent:Bs,getMarkings:Js,list:Ds,profilePicture:Vs,search:qs},Symbol.toStringTag,{value:"Module"}));export{_a as $,tc as U,Xs as a,Bs as b,ec as c,Ir as g,Zs as i};
//# sourceMappingURL=osdk-vendors-dAfwx3MD.js.map

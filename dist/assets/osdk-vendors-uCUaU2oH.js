var Wn=Object.defineProperty;var Ut=e=>{throw TypeError(e)};var Bn=(e,t,r)=>t in e?Wn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var R=(e,t,r)=>Bn(e,typeof t!="symbol"?t+"":t,r),dt=(e,t,r)=>t.has(e)||Ut("Cannot "+r);var l=(e,t,r)=>(dt(e,t,"read from private field"),r?r.call(e):t.get(e)),T=(e,t,r)=>t.has(e)?Ut("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),P=(e,t,r,n)=>(dt(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),$=(e,t,r)=>(dt(e,t,"access private method"),r);var oc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ac(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}const Vn={centimeter:"CENTIMETERS",centimeters:"CENTIMETERS",cm:"CENTIMETERS",meter:"METERS",meters:"METERS",m:"METERS",kilometer:"KILOMETERS",kilometers:"KILOMETERS",km:"KILOMETERS",inch:"INCHES",inches:"INCHES",foot:"FEET",feet:"FEET",yard:"YARDS",yards:"YARDS",mile:"MILES",miles:"MILES",nautical_mile:"NAUTICAL_MILES",nauticalMile:"NAUTICAL_MILES","nautical miles":"NAUTICAL_MILES"},br={sec:"SECONDS",seconds:"SECONDS",min:"MINUTES",minute:"MINUTES",minutes:"MINUTES",hr:"HOURS",hrs:"HOURS",hour:"HOURS",hours:"HOURS",day:"DAYS",days:"DAYS",wk:"WEEKS",week:"WEEKS",weeks:"WEEKS",mos:"MONTHS",month:"MONTHS",months:"MONTHS",yr:"YEARS",year:"YEARS",years:"YEARS"},zn={...br,quarter:"QUARTERS",quarters:"QUARTERS"},xt={ms:"MILLISECONDS",milliseconds:"MILLISECONDS",...br};let he=class extends Error{constructor(t,r,n,i,o,a){super(t),this.message=t,this.errorName=r,this.errorCode=n,this.statusCode=i,this.errorInstanceId=o,this.parameters=a}},Hn=class extends he{constructor(t,r,n,i){super(t,r,void 0,i),this.originalError=n}};class qn extends Error{constructor(t){super("Validation Error: "+JSON.stringify(t,null,2)),this.validation=t}}const Qn={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__createMediaReference"},Gn={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__fetchOneByRid"},Yn={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__fetchPageByRid"},Xn={name:"__EXPERIMENTAL__NOT_SUPPORTED_YET__getBulkLinks"},wr=Symbol("ClientContext"),Zn="__osdkClientContext";class Tr extends Error{constructor(t,r,n,i,o,a){super(t),this.message=t,this.errorName=r,this.errorCode=n,this.statusCode=i,this.errorInstanceId=o,this.parameters=a}}class Ft extends Tr{constructor(t,r,n){super(t,r),this.originalError=n}}async function O(e,[t,r,n,i,o],...a){const s=r.replace(/\{([^}]+)\}/g,()=>encodeURIComponent(a.shift())),c=n&1?a.shift():void 0,u=n&2?a.shift():void 0,f=n&4?a.shift():void 0,p=["GET","POST","PUT","DELETE","PATCH"][t];return await ei(e[Zn]??e[wr]??e,p,s,c,u,f,i,o)}async function ei(e,t,r,n,i,o,a,s){const c=ti(e.baseUrl,r);for(const[y,d]of Object.entries(i||{}))if(d!=null)if(Array.isArray(d))for(const m of d)c.searchParams.append(y,m);else c.searchParams.append(y,d);const u=new Headers;u.set("Content-Type",a??"application/json"),u.set("Accept",s??"application/json"),Object.entries(o||{}).forEach(([y,d])=>{d!=null&&u.append(y,d.toString())});const f=n==null||n instanceof globalThis.Blob?n:JSON.stringify(n),p=await e.fetch(c.toString(),{body:f,method:t,headers:u});if(!p.ok)try{const y=await p.json();return new Tr(y.message,y.errorName,y.errorCode,p.status,y.errorInstanceId,y.parameters)}catch(y){return y instanceof Error?new Ft(y.message,"UNKNOWN"):new Ft("Unable to parse error response","UNKNOWN")}if(p.status!==204)return s==null||s==="application/json"?await p.json():p}function ti(e,t){return e+=e.endsWith("/")?"":"/",new URL(`api${t}`,e)}const ri=[1,"/v2/ontologies/{0}/actions/{1}/apply",3];function ni(e,...t){return O(e,ri,...t)}const ii=[1,"/v2/ontologies/{0}/actions/{1}/applyBatch",3];function oi(e,...t){return O(e,ii,...t)}const ai=[0,"/v2/ontologies/{0}/actionTypes/{1}"];function si(e,...t){return O(e,ai,...t)}const ci=[1,"/v2/ontologies/attachments/upload",7,"*/*"];function Ve(e,...t){var n;const r={...t[2],"Content-Type":((n=t[2])==null?void 0:n["Content-Type"])??t[0].type,"Content-Length":t[0].size.toString()};return O(e,ci,t[0],t[1],r)}const ui=[0,"/v2/ontologies/attachments/{0}/content",,,"*/*"];function li(e,...t){return O(e,ui,...t)}const di=[0,"/v2/ontologies/attachments/{0}"];function fi(e,...t){return O(e,di,...t)}const pi=[0,"/v2/ontologies/{0}/objects/{1}/{2}/media/{3}/content",2,,"*/*"];function yi(e,...t){return O(e,pi,...t)}const hi=[0,"/v2/ontologies/{0}/objects/{1}/{2}/media/{3}/metadata",2];function mi(e,...t){return O(e,hi,...t)}const gi=[1,"/v2/ontologies/{0}/objectTypes/{1}/media/{2}/upload",3,"*/*"];function bi(e,...t){return O(e,gi,...t)}const wi=[0,"/v2/ontologies/{0}/objectTypes/{1}/fullMetadata",2];function Ti(e,...t){return O(e,wi,...t)}const ji=[0,"/v2/ontologies/{0}/interfaceTypes/{1}",2];function Oi(e,...t){return O(e,ji,...t)}const Si=[1,"/v2/ontologies/{0}/interfaces/{1}/search",3];function Ei(e,...t){return O(e,Si,...t)}const ki=[1,"/v2/ontologies/{0}/objectSets/loadObjects",3];function vi(e,...t){return O(e,ki,...t)}const _i=[1,"/v2/ontologies/{0}/objectSets/loadObjectsMultipleObjectTypes",3];function Pi(e,...t){return O(e,_i,...t)}const Ai=[1,"/v2/ontologies/{0}/objectSets/aggregate",3];function Ni(e,...t){return O(e,Ai,...t)}const Ri=[1,"/v2/ontologies/{0}/queries/{1}/execute",3];function $i(e,...t){return O(e,Ri,...t)}const Mi=[0,"/v2/ontologies/{0}/queryTypes/{1}",2];function Ci(e,...t){return O(e,Mi,...t)}const Ii=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/firstPoint",2];function Di(e,...t){return O(e,Ii,...t)}const Li=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/lastPoint",2];function Ui(e,...t){return O(e,Li,...t)}const xi=[1,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/streamPoints",3,,"*/*"];function Fi(e,...t){return O(e,xi,...t)}const Ki=[0,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/latestValue",2];function Wi(e,...t){return O(e,Ki,...t)}const Bi=[1,"/v2/ontologies/{0}/objects/{1}/{2}/timeseries/{3}/streamValues",3,,"*/*"];function Ji(e,...t){return O(e,Bi,...t)}async function st({fetchFn:e,baseUrl:t,servicePath:r,tokenProvider:n},i,o,a,s,c,u){a&&(a instanceof URLSearchParams||a instanceof Blob||a instanceof FormData||typeof a=="string"||a instanceof ArrayBuffer||(a=JSON.stringify(a)));const f=Object.entries({}).flatMap(([d,m])=>{if(m==null)return[];if(Array.isArray(m))return m.map(A=>[d,A]);const j=""+m;return j.length===0?[]:[[d,j]]}),p=Object.keys(f).length===0?"":`?${new URLSearchParams(f).toString()}`,y=await(e??fetch)(`${t}${r}${i}${p}`,{method:o,credentials:"same-origin",headers:{"Fetch-User-Agent":"conjure-lite","Content-Type":"application/json",accept:"application/json",...n?{Authorization:`Bearer ${await n()}`}:{}},...a?{body:a}:{}});try{if(y.status===204)return;const d=await Vi(y);if(!y.ok)throw new we("STATUS",void 0,y.status,d);return d}catch(d){throw d instanceof we?d:d instanceof TypeError?new we("NETWORK",d):new we("OTHER",d)}}async function Vi(e){const t=e.headers.get("Content-Type")!=null?e.headers.get("Content-Type"):"";try{return t.includes("application/json")?await e.json():t.includes("application/octet-stream")?await e.blob():await e.text()}catch(r){throw new we("PARSE",r,e.status)}}class we{constructor(t,r,n,i){R(this,"type");R(this,"originalError");R(this,"status");R(this,"body");this.type=t,this.originalError=r,this.status=n,this.body=i}toString(){return JSON.stringify({body:this.body,originalError:this.originalError&&this.originalError.toString(),status:this.status,type:this.type},null,"  ")}}async function zi(e,t){return st(e,"/bulk-links","PUT",t)}async function Hi(e,t,r){return st(e,"/ontology/ontology/bulkLoadEntities","POST",r)}async function qi(e,t){return st(e,"/ontology/linkTypesForObjectTypes","POST",t)}async function Qi(e,t){return st(e,"/ontology/ontology/ontologies/load/all","POST",t)}var Gi="Invariant failed";function g(e,t){throw new Error(Gi)}function ft(e,t){return{type:e,[e]:t}}function jr({baseUrl:e,fetch:t,tokenProvider:r},n){return{baseUrl:e,servicePath:n,fetchFn:t,tokenProvider:r}}function Yi(e){return e.results}function Xi(e,{pageToken:t}){return t?{...e,pageToken:t}:void 0}async function*Zi(e,t,r,n){let i=n;for(;i;){const o=await e(i);for(const a of t(o))yield a;i=r(i,o)}}function Nt(e=new Map,t){function r(n,i){return e.set(n,i),i}return{get:function(n){let i=e.get(n);return i===void 0&&t!==void 0?r(n,t(n)):i},set:r,remove:function(n){return e.delete(n)}}}function Or(e,t,r=Nt){const n=r(e==="weak"?new WeakMap:new Map),i=r(e==="weak"?new WeakMap:new Map),o={getOrUndefined:function(a){return n.get(a)},get:async function(a){return n.get(a)??i.get(a)??o.set(a,t(a))},set:async function(a,s){try{const c=await i.set(a,s);return n.set(a,c),i.remove(a),c}catch(c){throw i.remove(a),c}}};return o}let pt;async function eo(e,t){return pt??(pt=await Qi(e,{})),pt.ontologies[t]||g(),pt.ontologies[t].currentOntologyVersion}const ie=e=>Or("strong",e).get,to=e=>Or("weak",e).get;var z,X,ke,rt,nt,ve;class ro{constructor(t){T(this,z);T(this,X);T(this,ke);R(this,"forObjectByRid",ie(async t=>Promise.resolve({getPropertyMapping:l(this,rt).bind(this,t),getLinkMapping:l(this,nt).bind(this,t),getRid:()=>t,getApiName:async()=>(await l(this,ve).call(this,t)).apiName})));R(this,"forObjectByApiName",ie(async t=>{const r=await l(this,z).ontologyProvider.getObjectDefinition(t);return this.forObjectByRid(r.rid)}));T(this,rt,ie(async t=>{const r=await l(this,ve).call(this,t);return io(r)}));T(this,nt,ie(async t=>{const r=await qi(l(this,X),{includeObjectTypesWithoutSearchableDatasources:!0,loadRedacted:!1,objectTypeBranches:{},objectTypeVersions:{[t]:await this.ontologyVersion("")}});r.linkTypes[t]||g();const n={};for(const i of r.linkTypes[t]){const o=({apiName:a},s,c)=>{a&&(n[a]={apiName:a,directedLinkTypeRid:{linkTypeRid:i.rid,linkSide:s},otherObjectType:c})};if(i.definition.type==="oneToMany"){const{oneToMany:{objectTypeRidManySide:a,manyToOneLinkMetadata:s,objectTypeRidOneSide:c,oneToManyLinkMetadata:u}}=i.definition;a===t&&o(s,"TARGET",c),c===t&&o(u,"SOURCE",a)}else if(i.definition.type==="manyToMany"){const{manyToMany:{objectTypeRidA:a,objectTypeAToBLinkMetadata:s,objectTypeRidB:c,objectTypeBToALinkMetadata:u}}=i.definition;a===t&&o(s,"SOURCE",c),c===t&&o(u,"TARGET",a)}}return n}));T(this,ve,ie(async t=>{var i,o;(i=l(this,ke))==null||i.debug(`getConjureObjectType(${t})`);const r={datasourceTypes:[],objectTypes:[{identifier:{type:"objectTypeRid",objectTypeRid:t},versionReference:{type:"ontologyVersion",ontologyVersion:await this.ontologyVersion("")}}],linkTypes:[],sharedPropertyTypes:[],interfaceTypes:[],typeGroups:[],loadRedacted:!1,includeObjectTypeCount:void 0,includeObjectTypesWithoutSearchableDatasources:!0,includeEntityMetadata:void 0,actionTypes:[],includeTypeGroupEntitiesCount:void 0,entityMetadata:void 0},n=await Hi(l(this,X),void 0,r);return(o=n.objectTypes[0])!=null&&o.objectType||g(),n.objectTypes[0].objectType}));R(this,"ontologyVersion",ie(async()=>eo(l(this,X),await l(this,z).ontologyRid)));var r;P(this,z,t),P(this,X,jr(t,"ontology-metadata/api")),l(this,z).ontologyProvider.getObjectDefinition,P(this,ke,(r=l(this,z).logger)==null?void 0:r.child({mcc:!0}))}}z=new WeakMap,X=new WeakMap,ke=new WeakMap,rt=new WeakMap,nt=new WeakMap,ve=new WeakMap;const no=to(e=>Promise.resolve(new ro(e)));function io(e){e.primaryKeys.length!==1&&g();const t=e.primaryKeys[0],r=Object.values(e.propertyTypes).find(o=>o.rid===t);if(!r)throw new Error(`Could not find PK property by rid: ${t}`);const n=Object.fromEntries(Object.values(e.propertyTypes).map(o=>[o.id,o.apiName])),i=Object.fromEntries(Object.values(e.propertyTypes).map(o=>[o.apiName,o.id]));return{apiName:e.apiName,id:e.id,propertyIdToApiNameMapping:n,propertyApiNameToIdMapping:i,pk:{rid:t,apiName:r.apiName,type:r.type}}}function oo(e){return async function*(t,r){var p;if(t.length===0)return;(p=e.logger)==null||p.debug("Preparing to fetch bulk links"),t.every(y=>y.$objectType===t[0].$objectType)||g();const n=await no(e),i=await n.forObjectByApiName(t[0].$objectType),[o,a,s]=await Promise.all([i.getRid(),i.getPropertyMapping(),i.getLinkMapping()]),c=Object.fromEntries(Object.entries(s).filter(([y])=>r.includes(y)));for(const y of r)if(c[y]==null)throw"Unable to find link type: "+y;const u={objectSetContext:{forkRid:void 0,objectSetFilterContext:{parameterOverrides:{}},ontologyBranchRid:void 0,owningRid:void 0,reportUsage:void 0,workstateRid:void 0},responseOptions:{includeObjectSetEntities:!0,includeUsageCost:!1},pageSize:1e3,pageToken:void 0,linksRequests:[{directedLinkTypes:Object.values(c).map(({directedLinkTypeRid:y})=>y),objects:ft("objects",t.map(y=>ft("objectLocatorV2",{objectTypeRid:o,objectPrimaryKey:{[a.pk.rid]:ft(a.pk.type.type,y.$primaryKey)}})))}]},f=Zi(zi.bind(void 0,jr(e,"object-set-service/api")),Yi,Xi,u);for await(const y of f){const{objectIdentifier:d}=y,m=ao(d,t);for(const j of y.links){const A=j.link[j.linkSide==="SOURCE"?"objectSideB":"objectSideA"],v=Sr(A),_=await(await n.forObjectByRid(v.objectTypeRid)).getApiName(),L=Object.values(c).find(w=>w.directedLinkTypeRid.linkTypeRid===j.link.linkTypeRid&&w.directedLinkTypeRid.linkSide===j.linkSide);if(!L)throw new Error("Could not find link type");yield{object:m,linkApiName:L.apiName,otherObjectApiName:_,otherObjectPk:v.pkValue}}}}}function ao(e,t){const{pkValue:r}=Sr(e),n=t.find(i=>i.$primaryKey===r);if(n==null)throw new Error(`Needed to find object with pk ${r}} and could not`);return n}function Sr(e){if("type"in e&&e.type!=="objectLocatorV2")throw new Error("We do not support looking up object by rid");const t=Object.entries(e.objectLocatorV2.objectPrimaryKey);if(t.length!==1)throw new Error("Unable to support this request due to multiple pks");return{objectTypeRid:e.objectLocatorV2.objectTypeRid,pkValue:t[0][1][t[0][1].type]}}function Er(e=fetch,t){return async function(r,n){return n?e(r,{...n,headers:await t(new Headers(n.headers))}):e(r,{headers:await t(new Headers)})}}function so(e=fetch){return async function(t,r){let n;try{n=await e(t,r)}catch(i){throw co(i,"A network error occurred")}if(!n.ok){const i=`Failed to fetch ${n.status} ${n.statusText}`;if(n.headers.get("Content-Type")==="text/plain")throw Oe(await n.text(),n.status);if(n.headers.get("Content-Type")==="text/html")throw Oe(i,n.status,new Error("Received HTML error page: "+await n.text()));let o;try{o=await n.json()}catch(a){throw Oe(i,n.status,a instanceof Error?a:void 0)}throw new he((o==null?void 0:o.message)??i,o==null?void 0:o.errorName,o==null?void 0:o.errorCode,n.status,o==null?void 0:o.errorInstanceId,o==null?void 0:o.parameters)}return n}}function co(e,t="An unknown error occurred"){return e instanceof Error?Oe(e.message,void 0,e):Oe(t,void 0)}function Oe(e,t,r){return new Hn(e,void 0,r,t)}var Fe={exports:{}},uo=Fe.exports,Kt;function lo(){return Kt||(Kt=1,function(e,t){(function(r,n){e.exports=n()})(uo,function(){var r=function(o,a){if(a=a||{},typeof o!="function")throw new i("fetch must be a function");if(typeof a!="object")throw new i("defaults must be an object");if(a.retries!==void 0&&!n(a.retries))throw new i("retries must be a positive integer");if(a.retryDelay!==void 0&&!n(a.retryDelay)&&typeof a.retryDelay!="function")throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(a.retryOn!==void 0&&!Array.isArray(a.retryOn)&&typeof a.retryOn!="function")throw new i("retryOn property expects an array or function");var s={retries:3,retryDelay:1e3,retryOn:[]};return a=Object.assign(s,a),function(u,f){var p=a.retries,y=a.retryDelay,d=a.retryOn;if(f&&f.retries!==void 0)if(n(f.retries))p=f.retries;else throw new i("retries must be a positive integer");if(f&&f.retryDelay!==void 0)if(n(f.retryDelay)||typeof f.retryDelay=="function")y=f.retryDelay;else throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(f&&f.retryOn)if(Array.isArray(f.retryOn)||typeof f.retryOn=="function")d=f.retryOn;else throw new i("retryOn property expects an array or function");return new Promise(function(m,j){var A=function(_){var L=typeof Request<"u"&&u instanceof Request?u.clone():u;o(L,f).then(function(w){if(Array.isArray(d)&&d.indexOf(w.status)===-1)m(w);else if(typeof d=="function")try{return Promise.resolve(d(_,null,w)).then(function(E){E?v(_,null,w):m(w)}).catch(j)}catch(E){j(E)}else _<p?v(_,null,w):m(w)}).catch(function(w){if(typeof d=="function")try{Promise.resolve(d(_,w,null)).then(function(E){E?v(_,w,null):j(w)}).catch(function(E){j(E)})}catch(E){j(E)}else _<p?v(_,w,null):j(w)})};function v(_,L,w){var E=typeof y=="function"?y(_,L,w):y;setTimeout(function(){A(++_)},E)}A(0)})}};function n(o){return Number.isInteger(o)&&o>=0}function i(o){this.name="ArgumentError",this.message=o}return r})}(Fe)),Fe.exports}var fo=lo();const po=Jn(fo),yo=1e3,ho=.5,mo=3;function go(e){return po(e,{retryDelay(t){const r=yo*2**t,n=r*ho*(Math.random()*2-1);return r+n},retryOn(t,r,n){const i=(n==null?void 0:n.status)??0;return!(i>=200&&i<300)&&bo(r)&&t<mo}})}function bo(e){return!(e instanceof he&&e.statusCode!==wo&&e.statusCode!==To)}const wo=503,To=429,me=(e,t)=>({...e,fetch:Er(e.fetch,r=>(r.set("X-OSDK-Request-Context",JSON.stringify(e.requestContext)),t.osdkMetadata&&r.set("Fetch-User-Agent",t.osdkMetadata.extraUserAgent),r))}),V=(e,t)=>({...e,requestContext:{...e.requestContext,...t(e.requestContext)}});function ze(e){return typeof e=="object"&&"name"in e&&"data"in e&&e.data instanceof Blob}function He(e){return typeof e=="object"&&e instanceof Blob&&"name"in e}function jo(e){return typeof e=="object"&&typeof e.mimeType=="string"&&"reference"in e&&typeof e.reference=="object"&&e.reference.type==="mediaSetViewItem"&&"mediaSetViewItem"in e.reference&&typeof e.reference.mediaSetViewItem=="object"&&typeof e.reference.mediaSetViewItem.mediaSetRid=="string"&&typeof e.reference.mediaSetViewItem.mediaSetViewRid=="string"&&typeof e.reference.mediaSetViewItem.mediaItemRid=="string"}function qe(e){const t=e.lastIndexOf(".");return t===-1?[void 0,e]:[e.slice(0,t),e.slice(t+1)]}function Se(e,t){if("$and"in e)return{type:"and",value:e.$and.map(n=>Se(n,t))};if("$or"in e)return{type:"or",value:e.$or.map(n=>Se(n,t))};if("$not"in e)return{type:"not",value:Se(e.$not,t)};const r=Object.entries(e);return r.length===1?mt(r[0],t):{type:"and",value:r.map(n=>mt(n,t))}}function De(e,t,r,n){return{type:t==="$within"?"withinBoundingBox":"intersectsBoundingBox",...r!=null&&{propertyIdentifier:r},field:n,value:{topLeft:{type:"Point",coordinates:[e[0],e[3]]},bottomRight:{type:"Point",coordinates:[e[2],e[1]]}}}}function Wt(e,t,r,n){return{type:t,...r!=null&&{propertyIdentifier:r},field:n,value:{type:"Polygon",coordinates:e}}}function mt([e,t],r,n){t==null&&g();const i=n!=null?{type:"structField",...n,propertyApiName:Bt(n.propertyApiName,r)}:void 0,o=n==null?Bt(e,r):void 0;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return{type:"eq",...i!=null&&{propertyIdentifier:i},field:o,value:t};const a=Object.keys(t),s=a.some(u=>u.startsWith("$"));if(!s||a.length===1||g(),!s){Object.entries(t).length!==1&&g();const f=a[0];return mt(Object.entries(t)[0],r,{propertyApiName:e,structFieldApiName:f})}const c=a[0];if(t[c]==null&&g(),c==="$ne")return{type:"not",value:{type:"eq",...i!=null&&{propertyIdentifier:i},field:o,value:t[c]}};if(c==="$within"){const u=t[c];if(Array.isArray(u))return De(u,c,i,o);if("$bbox"in u&&u.$bbox!=null)return De(u.$bbox,c,i,o);if("$distance"in u&&"$of"in u&&u.$distance!=null&&u.$of!=null)return{type:"withinDistanceOf",...i!=null&&{propertyIdentifier:i},field:o,value:{center:Array.isArray(u.$of)?{type:"Point",coordinates:u.$of}:u.$of,distance:{value:u.$distance[0],unit:Vn[u.$distance[1]]}}};{const f="$polygon"in u?u.$polygon:u.coordinates;return Wt(f,"withinPolygon",i,e)}}if(c==="$intersects"){const u=t[c];if(Array.isArray(u))return De(u,c,i,o);if("$bbox"in u&&u.$bbox!=null)return De(u.$bbox,c,i,o);{const f="$polygon"in u?u.$polygon:u.coordinates;return Wt(f,"intersectsPolygon",i,o)}}return c==="$containsAllTerms"||c==="$containsAnyTerm"?{type:c.substring(1),...i!=null&&{propertyIdentifier:i},field:o,value:typeof t[c]=="string"?t[c]:t[c].term,fuzzy:typeof t[c]=="string"?!1:t[c].fuzzySearch??!1}:{type:c.substring(1),...i!=null&&{propertyIdentifier:i},field:o,value:t[c]}}function Bt(e,t){if(t.type==="interface"){const[r]=qe(t.apiName),[n,i]=qe(e);return n==null&&r!=null?`${r}.${i}`:e}return e}function I(e,t){const r={abs(){return I({type:"absoluteValue",property:e},t)},negate(){return I({type:"negate",property:e},t)},max(n){return I({type:"greatest",properties:[e,oe(n,t)]},t)},min(n){return I({type:"least",properties:[e,oe(n,t)]},t)},add(n){return I({type:"add",properties:[e,oe(n,t)]},t)},subtract(n){return I({type:"subtract",left:e,right:oe(n,t)},t)},multiply(n){return I({type:"multiply",properties:[e,oe(n,t)]},t)},divide(n){return I({type:"subtract",left:e,right:oe(n,t)},t)},extractPart:n=>I({type:"extract",part:n,property:e},t)};return t.set(r,e),r}const oe=(e,t)=>{if(typeof e=="object"){const r=t.get(e);return r||g(),r}else typeof e=="number"&&g();g()};function gt(e,t,r,n=!1){return{pivotTo:i=>gt(e,{type:"searchAround",objectSet:t,link:i},r),where:i=>gt(e,{type:"filter",objectSet:t,where:Se(i,e)},r),aggregate:(i,o)=>{const a=i.split(":");a.length===2||a[0]==="$count"||g();const[s,c]=a;let u;switch(c){case"sum":case"avg":case"min":case"max":case"exactDistinct":case"approximateDistinct":u={type:c,selectedPropertyApiName:s};break;case"approximatePercentile":u={type:"approximatePercentile",selectedPropertyApiName:s,approximatePercentile:(o==null?void 0:o.percentile)??.5};break;case"collectSet":case"collectList":u={type:c,selectedPropertyApiName:s,limit:(o==null?void 0:o.limit)??100};break;case void 0:if(s==="$count"){u={type:"count"};break}default:g()}const f={type:"selection",objectSet:t,operation:u},p=I(f,r);return r.set(p,f),p},selectProperty:i=>{if(n){const s={type:"property",apiName:i},c=I(s,r);return r.set(c,s),c}const o={type:"selection",objectSet:t,operation:{type:"get",selectedPropertyApiName:i}},a=I(o,r);return r.set(a,o),a},constant:{double:()=>{g()},integer:()=>{g()},long:()=>{g()},datetime:()=>{g()},timestamp:()=>{g()}}}}function Jt(e){return e.metrics.reduce((t,r)=>{const n=r.name.split(".");if(n[0]==="count")return t;n.length!==2&&g();const i=n[0],o=n[1];return i in t||(t[i]={}),t[i][o]=r.value,t},{})}const Vt=e=>e==="asc"?"ASC":e==="desc"?"DESC":void 0;function Oo(e){return Object.entries(e).flatMap(([t,r])=>{if(t==="$count")return{type:"count",name:"count",direction:Vt(r)};const n=t.lastIndexOf(":"),i=t.slice(0,n),o=t.slice(n+1);return[{type:o,name:`${i}.${o}`,direction:Vt(r),field:i}]})}function So(e){return e?Object.entries(e).flatMap(([t,r])=>{var n;return r==="exact"?[{type:r,field:t}]:"$exactWithLimit"in r?[{type:"exact",field:t,maxGroupCount:r.$exactWithLimit}]:"$exact"in r?[{type:"exact",field:t,maxGroupCount:((n=r.$exact)==null?void 0:n.$limit)??void 0,defaultValue:r.$exact.$defaultValue??void 0}]:"$fixedWidth"in r?[{type:"fixedWidth",field:t,fixedWidth:r.$fixedWidth}]:"$ranges"in r?[{type:"ranges",field:t,ranges:r.$ranges.map(i=>Eo(i))}]:"$duration"in r?[{type:"duration",field:t,value:r.$duration[0],unit:zn[r.$duration[1]]}]:[]}):[]}function Eo(e){return{startValue:e[0],endValue:e[1]}}function Qe(e){return e.type==="interface"?{type:"interfaceBase",interfaceType:e.apiName}:{type:"base",objectType:e.apiName}}async function ko(e,t,r=Qe(t),n){Qe(t);const i={aggregation:Oo(n.$select),groupBy:[]};n.$groupBy&&(i.groupBy=So(n.$groupBy));const o=await Ni(me(e,t),await e.ontologyRid,{objectSet:r,groupBy:i.groupBy,aggregation:i.aggregation});return n.$groupBy?o.data.map(s=>({$group:s.group,...zt(s),...Jt(s)})):(o.data.length!==1&&g(),{...zt(o.data[0]),...Jt(o.data[0])})}function zt(e){for(const t of e.metrics)if(t.name==="count")return{$count:t.value}}async function kr(e,t){return(await se(e,t,void 0)).definitions}async function se(e,t,r){var n;switch(t.type){case"searchAround":{const{definitions:c,childObjectType:u}=await se(e,t.objectSet,r);if(u===void 0||u==="")return{definitions:{}};const f=await e.ontologyProvider.getObjectDefinition(u);return f.links[t.link]||g(),{definitions:c,childObjectType:f.links[t.link].targetType}}case"withProperties":{const{definitions:c,childObjectType:u}=await se(e,t.objectSet,r);if(u===void 0||u==="")return{definitions:{}};for(const[f,p]of Object.entries(t.derivedProperties))if(p.type==="selection")switch(p.operation.type){case"collectList":case"collectSet":case"get":const{childObjectType:y}=await se(e,p.objectSet,u);if(y===void 0||y==="")return{definitions:{}};const d=await e.ontologyProvider.getObjectDefinition(y);c[f]=d.properties[p.operation.selectedPropertyApiName];default:continue}return{definitions:c,childObjectType:u}}case"methodInput":return{definitions:{},childObjectType:r};case"base":return{definitions:{},childObjectType:t.objectType};case"interfaceBase":return{definitions:{},childObjectType:t.interfaceType};case"filter":case"asBaseObjectTypes":case"asType":case"nearestNeighbors":return se(e,t.objectSet,r);case"intersect":case"subtract":case"union":const i=t.objectSets,o=await Promise.all(i.map(c=>se(e,c,r))),a=o.reduce((c,{definitions:u})=>({...c,...u}),{});Object.keys(a).length!==0&&g();const s=(n=o.find(({childObjectType:c})=>c!=null))==null?void 0:n.childObjectType;return o.every(({childObjectType:c})=>c===s||c==null)||g(),{definitions:{},childObjectType:s};case"static":case"reference":return{definitions:{}};default:g()}}function vr(e,t,r=void 0){if(e.type==="base"||e.type==="interfaceBase"){if(e.type==="base"&&e.objectType!==t)throw new Error(`Expected objectSet.objectType to be ${t}, but got ${e.objectType}`);if(e.type==="interfaceBase"&&e.interfaceType!==t)throw new Error(`Expected objectSet.objectType to be ${t}, but got ${e.interfaceType}`);return r}if(e.type==="filter")return vr(e.objectSet,t,r==null?e.where:{type:"and",value:[r,e.where]});throw new Error(`Unsupported objectSet type: ${e.type}`)}function vo(e,t,r){return r!=null&&r.$includeAllBaseObjectProperties?{type:"intersect",objectSets:[e,{type:"interfaceBase",interfaceType:t,includeAllBaseObjectProperties:!0}]}:e}async function _o(e,t,r,n){if(r.$__UNSTABLE_useOldInterfaceApis){const o=await Ei(me(e,t),await e.ontologyRid,t.apiName,bt(r,{augmentedProperties:{},augmentedSharedPropertyTypes:{},otherInterfaceTypes:[],selectedObjectTypes:[],selectedSharedPropertyTypes:r.$select??[],where:vr(n,t.apiName)}),{preview:!0});return o.data=await e.objectFactory(e,o.data,t.apiName,!r.$includeRid,await kr(e,n)),o}const i=await Pi(me(e,t),await e.ontologyRid,bt(r,{objectSet:vo(n,t.apiName,r),select:(r==null?void 0:r.$select)??[],excludeRid:!(r!=null&&r.$includeRid)}),{preview:!0});return Promise.resolve({data:await e.objectFactory2(e,i.data,t.apiName,{},!r.$includeRid,r.$select,!1,i.interfaceToObjectTypeMappings),nextPageToken:i.nextPageToken,totalCount:i.totalCount})}async function Ge(e,t,r,n={}){return t.type==="interface"?await _o(e,t,n,r):await Ao(e,t,n,r)}async function Po(e,t,r,n={}){try{return{value:await Ge(e,t,r,n)}}catch(i){return i instanceof Error?{error:i}:{error:i}}}async function _r(e,t,r,n=Qe(t)){return Ge(e,t,n,r)}function bt(e,t){return e!=null&&e.$nextPageToken&&(t.pageToken=e.$nextPageToken),(e==null?void 0:e.$pageSize)!=null&&(t.pageSize=e.$pageSize),(e==null?void 0:e.$orderBy)!=null&&(t.orderBy={fields:Object.entries(e.$orderBy).map(([r,n])=>({field:r,direction:n}))}),t}async function Ao(e,t,r,n){const i=await vi(me(e,t),await e.ontologyRid,bt(r,{objectSet:n,select:(r==null?void 0:r.$select)??[],excludeRid:!(r!=null&&r.$includeRid)}));return Promise.resolve({data:await e.objectFactory(e,i.data,void 0,void 0,await kr(e,n),r.$select),nextPageToken:i.nextPageToken,totalCount:i.totalCount})}async function ct(e,t,r,n){const i=await _r(e,t,{...r,$pageSize:1},n);if(i.data.length!==1||i.nextPageToken!=null)throw new he(`Expected a single result but got ${i.data.length} instead${i.nextPageToken!=null?" with nextPageToken set":""}`);return i.data[0]}async function Pr(e,t,r,n){try{return{value:await ct(e,t,r,n)}}catch(i){return i instanceof Error?{error:i}:{error:i}}}const No=new Set(["base","filter","intersect","reference","searchAround","static","subtract","union"]);function Rt(e){return e!=null&&typeof e=="object"&&No.has(e.type)}var ce=null;typeof WebSocket<"u"?ce=WebSocket:typeof MozWebSocket<"u"?ce=MozWebSocket:typeof global<"u"?ce=global.WebSocket||global.MozWebSocket:typeof window<"u"?ce=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ce=self.WebSocket||self.MozWebSocket);const be=ce,Ro=5*1e3;function Le(){}function Ht({onChange:e=Le,onError:t=Le,onOutOfDate:r=Le,onSuccessfulSubscription:n=Le}){return{onChange:e,onError:t,onOutOfDate:r,onSuccessfulSubscription:n}}function $o(e){return e.isReady!=null}function qt(e){return e.status==="done"||e.status==="error"}var _e,S,Pe,C,x,de,M,Ae,Z,k,Ar,Ke,Te,Tt,Ne,Re,it,jt,ot,at,Nr,$e,fe,D;const le=class le{constructor(t,{minimumReconnectDelayMs:r=Ro}={}){T(this,k);T(this,S);T(this,Pe,0);T(this,C);T(this,x);T(this,de,new Map);T(this,M,new Map);T(this,Ae,new Set);T(this,Z);T(this,Ne,()=>{$(this,k,Ke).call(this)});T(this,Re,async t=>{const r=JSON.parse(t.data.toString());switch(r.type){case"objectSetChanged":await l(this,it).call(this,r);return;case"refreshObjectSet":l(this,ot).call(this,r);return;case"subscribeResponses":l(this,at).call(this,r);return;case"subscriptionClosed":{$(this,k,Nr).call(this,r);return}default:g()}});T(this,it,async t=>{var s,c,u,f,p,y;const r=l(this,M).get(t.id);if(r==null)return;const n=t.updates.filter(d=>d.type==="object"),i=t.updates.filter(d=>d.type==="reference"),o=await Promise.all(i.map(async d=>{const j=(await l(this,C).objectFactory2(l(this,C),[{__apiName:d.objectType,__primaryKey:r.primaryKeyPropertyName!=null?d.primaryKey[r.primaryKeyPropertyName]:void 0,...d.primaryKey,[d.property]:d.value}],r.interfaceApiName,{},!1,void 0,!1,await $(this,k,jt).call(this,d.objectType,r.interfaceApiName)))[0]??void 0;return j!=null?{object:j,state:"ADDED_OR_UPDATED"}:void 0}));for(const d of o)if(d!=null)try{(c=(s=r.listener).onChange)==null||c.call(s,d)}catch(m){(u=l(this,x))==null||u.error(m,"Error in onChange callback"),l(this,D).call(this,r,!1,m)}const a=await Promise.all(n.map(async d=>{const m=Object.keys(d.object).filter(v=>r.requestedReferenceProperties.includes(v));for(const v of m)delete d.object[v];const A=(await l(this,C).objectFactory2(l(this,C),[d.object],r.interfaceApiName,{},!1,void 0,!1,await $(this,k,jt).call(this,d.object.__apiName,r.interfaceApiName)))[0]??void 0;return A!=null?{object:A,state:d.state}:void 0}));for(const d of a)if(d!=null)try{(p=(f=r.listener).onChange)==null||p.call(f,d)}catch(m){(y=l(this,x))==null||y.error(m,"Error in onChange callback"),l(this,D).call(this,r,!1,m)}});T(this,ot,t=>{var n;const r=l(this,M).get(t.id);r||g();try{r.listener.onOutOfDate()}catch(i){(n=l(this,x))==null||n.error(i,"Error in onOutOfDate callback"),l(this,D).call(this,r,!1,i)}});T(this,at,t=>{var o;const{id:r,responses:n}=t,i=l(this,de).get(r);i||g(),l(this,de).delete(r);for(let a=0;a<n.length;a++){const s=i[a],c=n[a];switch(c.type){case"error":l(this,D).call(this,s,!0,c.errors),$(this,k,Te).call(this,s,"error");break;case"qos":l(this,fe).call(this);break;case"success":const u=s.status==="expired"||s.status==="reconnecting";s.status="subscribed",s.subscriptionId!==c.id&&(l(this,M).delete(s.subscriptionId),s.subscriptionId=c.id,l(this,M).set(s.subscriptionId,s));try{u?s.listener.onOutOfDate():s.listener.onSuccessfulSubscription()}catch(f){(o=l(this,x))==null||o.error(f,"Error in onOutOfDate or onSuccessfulSubscription callback"),l(this,D).call(this,s,!1,f)}break;default:l(this,D).call(this,s,!0,c)}}});T(this,$e,t=>{l(this,fe).call(this)});T(this,fe,()=>{if(l(this,S)&&(l(this,S).removeEventListener("open",l(this,Ne)),l(this,S).removeEventListener("message",l(this,Re)),l(this,S).removeEventListener("close",l(this,$e)),l(this,S).readyState!==be.CLOSING&&l(this,S).readyState!==be.CLOSED&&l(this,S).close(),P(this,S,void 0)),l(this,M).size>0){for(const t of l(this,M).values())t.status==="subscribed"&&(t.status="reconnecting");$(this,k,Tt).call(this)}});T(this,D,(t,r,n)=>{var i;try{t.listener.onError({subscriptionClosed:r,error:n})}catch(o){console.error("Error encountered in an onError callback for an OSDK subscription",o),console.error("This onError call was triggered by an error in another callback",n),console.error("The subscription has been closed.",n),r||((i=l(this,x))==null||i.error(n,"Error in onError callback"),$(this,k,Te).call(this,t,"error"),l(this,D).call(this,t,!0,o))}});var n;this.MINIMUM_RECONNECT_DELAY_MS=r,P(this,C,t),P(this,x,(n=t.logger)==null?void 0:n.child({},{msgPrefix:"<OSW> "})),t.baseUrl.startsWith("https://")||t.baseUrl.startsWith("http://")||g()}static getInstance(t){let r=l(le,_e).get(t.clientCacheKey);return r==null&&(r=new le(t),l(le,_e).set(t.clientCacheKey,r)),r}async subscribe(t,r,n,i=[]){const o=t.type==="object"?await l(this,C).ontologyProvider.getObjectDefinition(t.apiName):await l(this,C).ontologyProvider.getInterfaceDefinition(t.apiName);let a=[],s=[];i.length===0&&(i=Object.keys(o.properties)),a=i.filter(u=>o.properties[u].type!=="geotimeSeriesReference"),s=i.filter(u=>o.properties[u].type==="geotimeSeriesReference");const c={listener:Ht(n),objectSet:r,primaryKeyPropertyName:o.type==="interface"?void 0:o.primaryKeyApiName,requestedProperties:a,requestedReferenceProperties:s,status:"preparing",subscriptionId:`TMP-${Qt()}}`,interfaceApiName:o.type==="object"?void 0:o.apiName};return l(this,M).set(c.subscriptionId,c),$(this,k,Ar).call(this,c),()=>{$(this,k,Te).call(this,c)}}};_e=new WeakMap,S=new WeakMap,Pe=new WeakMap,C=new WeakMap,x=new WeakMap,de=new WeakMap,M=new WeakMap,Ae=new WeakMap,Z=new WeakMap,k=new WeakSet,Ar=async function(t){var r,n;try{if(await $(this,k,Tt).call(this),qt(t))return;t.isReady=!0,((r=l(this,S))==null?void 0:r.readyState)===be.OPEN&&$(this,k,Ke).call(this)}catch(i){(n=l(this,x))==null||n.error(i,"Error in #initiateSubscribe"),l(this,D).call(this,t,!0,i)}},Ke=function(){var i;const t=[...l(this,M).values()].filter($o),r=Qt();l(this,de).set(r,t);const n={id:r,requests:t.map(({objectSet:o,requestedProperties:a,requestedReferenceProperties:s,interfaceApiName:c})=>({objectSet:o,propertySet:a,referenceSet:s}))};(i=l(this,S))==null||i.send(JSON.stringify(n))},Te=function(t,r="done"){qt(t)||(t.status=r,t.listener=Ht({}),l(this,M).delete(t.subscriptionId),l(this,Ae).add(t.subscriptionId),$(this,k,Ke).call(this),l(this,Z)&&clearTimeout(l(this,Z)),P(this,Z,setTimeout(()=>{P(this,Z,void 0),l(this,M).size===0&&l(this,fe).call(this)},15e3)))},Tt=async function(){if(l(this,S)==null){const{baseUrl:t,tokenProvider:r}=l(this,C),n=Mo(t,await l(this,C).ontologyRid),i=await r();if(l(this,S)==null){const o=(l(this,Pe)??0)+this.MINIMUM_RECONNECT_DELAY_MS;o>Date.now()&&await new Promise(a=>{setTimeout(a,o-Date.now())}),P(this,Pe,Date.now()),l(this,S)==null&&(P(this,S,new be(n,[`Bearer-${i}`])),l(this,S).addEventListener("close",l(this,$e)),l(this,S).addEventListener("message",l(this,Re)),l(this,S).addEventListener("open",l(this,Ne)))}if(l(this,S).readyState===be.CONNECTING){const o=l(this,S);return new Promise((a,s)=>{function c(){o.removeEventListener("open",u),o.removeEventListener("error",f),o.removeEventListener("close",c)}function u(){c(),a()}function f(p){c(),s(p)}o.addEventListener("open",u),o.addEventListener("error",f),o.addEventListener("close",c)})}}},Ne=new WeakMap,Re=new WeakMap,it=new WeakMap,jt=async function(t,r){if(r==null)return{};const n=(await l(this,C).ontologyProvider.getObjectDefinition(t)).interfaceMap;return{[r]:{[t]:n[r]}}},ot=new WeakMap,at=new WeakMap,Nr=function(t){const r=l(this,M).get(t.id);r==null&&l(this,Ae).has(t.id)||(r||g(),l(this,D).call(this,r,!0,t.cause),$(this,k,Te).call(this,r,"error"))},$e=new WeakMap,fe=new WeakMap,D=new WeakMap,T(le,_e,new WeakMap);let wt=le;function Mo(e,t){const r=new URL(e),n=new URL(`api/v2/ontologySubscriptions/ontologies/${t}/streamSubscriptions`,r);return n.protocol=n.protocol.replace("https","wss"),n}let Co=0;function Qt(){return`00000000-0000-0000-0000-${(Co++).toString().padStart(12,"0")}`}function Gt(e){return e.type==="object"}function Rr(e){return e!=null&&typeof e=="object"&&Rt(ue.get(e))}function Ye(e){return ue.get(e)}const ue=new WeakMap;function Xe(e,t,r=Qe(e)){const n={aggregate:ko.bind(globalThis,V(t,()=>({finalMethodCall:"aggregate"})),e,r),fetchPage:Ge.bind(globalThis,V(t,()=>({finalMethodCall:"fetchPage"})),e,r),fetchPageWithErrors:Po.bind(globalThis,V(t,()=>({finalMethodCall:"fetchPageWithErrors"})),e,r),where:o=>t.objectSetFactory(e,t,{type:"filter",objectSet:r,where:Se(o,e)}),pivotTo:function(o){return i(o)()},union:(...o)=>t.objectSetFactory(e,t,{type:"union",objectSets:[r,...o.map(a=>ue.get(a))]}),intersect:(...o)=>t.objectSetFactory(e,t,{type:"intersect",objectSets:[r,...o.map(a=>ue.get(a))]}),subtract:(...o)=>t.objectSetFactory(e,t,{type:"subtract",objectSets:[r,...o.map(a=>ue.get(a))]}),asyncIter:async function*(o){let a;do{const s=await Ge(V(t,()=>({finalMethodCall:"asyncIter"})),e,r,{...o,$pageSize:1e4,$nextPageToken:a});a=s.nextPageToken;for(const c of s.data)yield c}while(a!=null)},fetchOne:Gt(e)?async(o,a)=>await ct(V(t,()=>({finalMethodCall:"fetchOne"})),e,a,await Yt(t,e,r,o)):void 0,fetchOneWithErrors:Gt(e)?async(o,a)=>await Pr(V(t,()=>({finalMethodCall:"fetchOneWithErrors"})),e,a,await Yt(t,e,r,o)):void 0,subscribe:(o,a)=>{const s=wt.getInstance(t).subscribe(e,r,o,a==null?void 0:a.properties);return{unsubscribe:async()=>(await s)()}},withProperties:o=>{const a=new Map,s={};for(const c of Object.keys(o)){const u=o[c](gt(e,{type:"methodInput"},a,!0));s[c]=a.get(u)}return t.objectSetFactory(e,t,{type:"withProperties",derivedProperties:s,objectSet:r})},$objectSetInternals:{def:e}};function i(o){return()=>t.objectSetFactory(e,t,{type:"searchAround",objectSet:r,link:o})}return ue.set(n,r),n}async function Yt(e,t,r,n){const i=await e.ontologyProvider.getObjectDefinition(t.apiName);return{type:"filter",objectSet:r,where:{type:"eq",field:i.primaryKeyApiName,value:n}}}function Io(e){return e!=null&&typeof e=="object"&&"$objectType"in e&&"$primaryKey"in e}function $r(e){return e&&typeof e=="object"&&typeof e.$apiName=="string"&&e.$primaryKey!=null}function Do(e){return e&&typeof e=="object"&&typeof e.__apiName=="string"&&e.__primaryKey!=null}function Lo(e){return e&&typeof e=="object"&&"type"in e&&e.type==="Point"&&"coordinates"in e&&e.coordinates.length===2}async function K(e,t){if(e==null)return e;if(Array.isArray(e)||e instanceof Set){const r=Array.from(e);if(r.some(i=>ze(i)||He(i))){const i=[];for(const o of r)i.push(await K(o,t));return i}const n=Array.from(e,async i=>await K(i,t));return Promise.all(n)}if(ze(e)){const r=await Ve(t,e.data,{filename:e.name});return await K(r.rid,t)}if(He(e)){const r=await Ve(t,e,{filename:e.name});return await K(r.rid,t)}return Do(e)?await K(e.__primaryKey,t):$r(e)?await K(e.$primaryKey,t):Lo(e)?await K(e.coordinates.join(),t):Rt(e)?e:Rr(e)?Ye(e):jo(e)?e:Io(e)?{objectTypeApiName:e.$objectType,primaryKeyValue:e.$primaryKey}:typeof e=="object"?Object.entries(e).reduce(async(r,[n,i])=>{const o=await r;return o[n]=await K(i,t),o},Promise.resolve({})):e}async function Xt(e,t,r,n={}){var o;const i=me(V(e,()=>({finalMethodCall:"applyAction"})),t);if(Array.isArray(r)){const a=await oi(i,await e.ontologyRid,t.apiName,{requests:r?await Uo(r,e):[],options:{returnEdits:n!=null&&n.$returnEdits?"ALL":"NONE"}}),s=a.edits;return n!=null&&n.$returnEdits?(s==null?void 0:s.type)==="edits"?Zt(a):s:void 0}else{const a=await ni(i,await e.ontologyRid,t.apiName,{parameters:await Mr(r,e),options:{mode:n!=null&&n.$validateOnly?"VALIDATE_ONLY":"VALIDATE_AND_EXECUTE",returnEdits:n!=null&&n.$returnEdits?"ALL_V2_WITH_DELETIONS":"NONE"}});if(n!=null&&n.$validateOnly)return a.validation;if(((o=a.validation)==null?void 0:o.result)==="INVALID")throw new qn(a.validation);const s=a.edits;return n!=null&&n.$returnEdits?(s==null?void 0:s.type)==="edits"?Zt(a):s:void 0}}async function Mr(e,t){if(e==null)return{};const r={};for(const[n,i]of Object.entries(e))r[n]=await K(i,t);return r}async function Uo(e,t){return await Promise.all(e.map(async n=>({parameters:await Mr(n,t)})))}function Zt(e){var r,n;const t=e==null?void 0:e.edits;if((t==null?void 0:t.type)==="edits"){const i={type:t.type,deletedLinksCount:t.deletedLinksCount,deletedObjectsCount:t.deletedObjectsCount,addedLinks:[],deletedLinks:[],addedObjects:[],deletedObjects:[],modifiedObjects:[],editedObjectTypes:[]},o=new Set;for(const a of t.edits)if(a.type==="addLink"||a.type==="deleteLink"){const s={linkTypeApiNameAtoB:a.linkTypeApiNameAtoB,linkTypeApiNameBtoA:a.linkTypeApiNameBtoA,aSideObject:a.aSideObject,bSideObject:a.bSideObject};a.type==="addLink"?i.addedLinks.push(s):(r=i.deletedLinks)==null||r.push(s),o.add(a.aSideObject.objectType),o.add(a.bSideObject.objectType)}else if(a.type==="addObject"||a.type==="deleteObject"||a.type==="modifyObject"){const s={objectType:a.objectType,primaryKey:a.primaryKey};a.type==="addObject"?i.addedObjects.push(s):a.type==="deleteObject"?(n=i.deletedObjects)==null||n.push(s):a.type==="modifyObject"&&i.modifiedObjects.push(s),o.add(a.objectType)}return i.editedObjectTypes=[...o],i}}const xo=Symbol("additionalContext");function Fo(e,t,r,n=fetch){if(e.length===0)throw new Error("baseUrl cannot be empty");const i=Er(go(so(n)),async o=>{const a=await t();return o.set("Authorization",`Bearer ${a}`),o.set("Fetch-User-Agent",[o.get("Fetch-User-Agent"),r].filter(s=>s&&(s==null?void 0:s.length)>0).join(" ")),o});return{baseUrl:e,fetch:async(o,a)=>{try{return await i(o,a)}catch(s){const c=s instanceof he?new he(s.message,s.errorName,s.errorCode,s.statusCode,s.errorInstanceId,s.parameters):new Error("Captured stack trace for error: "+(s.message??s));throw c.cause=s,c}},tokenProvider:t}}const er=new Uint8Array([123,34,100,97,116,97,34,58,91]),tr=123,Ko=125;async function*Wo(e){const t=new TextDecoder("utf-8");let r=!1,n=[],i=0;for await(let o of e){let a=0;for(r||(r=!0,Bo(o,er)&&(a=er.length));a<o.length;a++){for(;i===0&&o[a]!==tr&&a<o.length;)a++;let s=a;for(;s<o.length;s++){const c=o[s];if(c===tr)i++;else if(c===Ko&&(i--,i===0)){yield Jo(t,n,o.subarray(a,s+1)),n=[],a=s;break}}if(s===o.length){n.push(o.subarray(a));break}}}}function Bo(e,t){if(e.length<t.length)return!1;for(let r=0;r<t.length;r++)if(e[r]!==t[r])return!1;return!0}function Jo(e,t,r){let n="";for(const i of t)n+=e.decode(i,{stream:!0});return n+=e.decode(r),JSON.parse(n)}async function*Vo(e){let t=await e.read();for(;!t.done;)yield t.value,t=await e.read()}function Cr(e){return"$startTime"in e||"$endTime"in e?{type:"absolute",startTime:e.$startTime,endTime:e.$endTime}:e.$before?{type:"relative",startTime:{when:"BEFORE",value:e.$before,unit:xt[e.$unit]}}:{type:"relative",endTime:{when:"AFTER",value:e.$after,unit:xt[e.$unit]}}}async function*Ir(e){var r;const t=(r=e.body)==null?void 0:r.getReader();for await(const n of Wo(Vo(t)))yield{time:n.time,value:n.value}}var pe,H;class zo{constructor(t,r,n,i,o){T(this,pe);T(this,H);P(this,H,t),P(this,pe,[r,n,i]),o!=null&&(this.lastFetchedValue=o)}async getLatestValue(){const t=Wi(l(this,H),await l(this,H).ontologyRid,...l(this,pe));return t.then(r=>this.lastFetchedValue=r,r=>void console.error(r)),t}async getAllValues(t){const r=[];for await(const n of this.asyncIterValues(t))r.push(n);return r}async*asyncIterValues(t){const r=await Ji(l(this,H),await l(this,H).ontologyRid,...l(this,pe),t?{range:Cr(t)}:{});for await(const n of Ir(r))yield n}}pe=new WeakMap,H=new WeakMap;var ye,q;class Ho{constructor(t){T(this,ye);T(this,q);const{client:r,objectApiName:n,primaryKey:i,propertyName:o}=t;P(this,q,r),P(this,ye,[n,i,o])}async fetchContents(){return yi(l(this,q),await l(this,q).ontologyRid,...l(this,ye),{preview:!0})}async fetchMetadata(){const t=await mi(l(this,q),await l(this,q).ontologyRid,...l(this,ye),{preview:!0});return{path:t.path,sizeBytes:Number(t.sizeBytes),mediaType:t.mediaType}}}ye=new WeakMap,q=new WeakMap;var ee,F;class qo{constructor(t,r,n,i){T(this,ee);T(this,F);P(this,F,t),P(this,ee,[r,n,i])}async getFirstPoint(){return Di(l(this,F),await l(this,F).ontologyRid,...l(this,ee))}async getLastPoint(){return Ui(l(this,F),await l(this,F).ontologyRid,...l(this,ee))}async getAllPoints(t){const r=[];for await(const n of this.asyncIterPoints(t))r.push(n);return r}async*asyncIterPoints(t){const r=await Fi(l(this,F),await l(this,F).ontologyRid,...l(this,ee),t?{range:Cr(t)}:{});for await(const n of Ir(r))yield n}}ee=new WeakMap,F=new WeakMap;function Ee(e,t){return{rid:t,async fetchContents(){return li(e,t)},async fetchMetadata(){const r=await fi(e,t);return{...r,sizeBytes:Number(r.sizeBytes)}}}}function $t(e,t){return`${e.apiName}:${t}`}function Qo(e){return e.split(":")[1]}const Mt=Symbol("InterfaceDefinitions"),J=Symbol("Underlying Object"),Q=Symbol("ObjectDefinition"),Go=Symbol("InterfaceDefinition"),Ze=Symbol("ClientRef");function Yo(e,t){const[r]=qe(t.apiName);return Object.freeze(Object.defineProperties({},{[J]:{value:e},$apiName:{value:t.apiName,enumerable:!0},$as:{value:e.$as,enumerable:!1},$objectType:{value:e.$objectType,enumerable:"$objectType"in e},$primaryKey:{value:e.$primaryKey,enumerable:"$primaryKey"in e},$objectSpecifier:{value:e.$objectSpecifier,enumerable:"$objectSpecifier"in e},$title:{value:e.$title,enumerable:"$title"in e},$rid:{value:e.$rid,enumerable:"$rid"in e},$clone:{value:n,enumerable:!1},[Go]:{value:t},...Object.fromEntries(Object.keys(t.properties).map(o=>{const a=e[Q],[s,c]=qe(o),u=a.interfaceMap[t.apiName][o];return[s===r?c:o,{enumerable:u in e,value:e[u]}]}))}));function n(o){if(o==null)return e.$clone().$as(t);for(const s of Object.keys(o))if(!(s in t.properties))throw new Error(`Invalid property ${s} for interface ${t.apiName}`);const a=Object.fromEntries(Object.keys(o).map(s=>i(s,o[s])).filter(s=>s!=null));return e.$clone(a).$as(t)}function i(o,a){const s=e[Q],c=s.interfaceMap[t.apiName][o];if(c==null)throw new Error(`Cannot clone interface with ${o} as property is not implemented by the underlying object type ${s.apiName}`);return[c,a]}}const Xo=Nt(new WeakMap,Zo).get,rr=Nt(new WeakMap,()=>new Map);function Zo(e){return function(t){var s,c;let r;if(typeof t=="string"){if(t===e.apiName)return this[J];if(((s=e.interfaceMap)==null?void 0:s[t])==null)throw new Error(`Object does not implement interface '${t}'.`);r=t}else{if(t.apiName===e.apiName)return this[J];if(t.type==="object")throw new Error(`'${t.apiName}' is not an interface nor is it '${e.apiName}', which is the object type.`);r=t.apiName}const n=e[Mt][r];if(!n)throw new Error(`Object does not implement interface '${r}'.`);const i=this[J],o=(c=rr.get(i).get(r))==null?void 0:c.deref();if(o)return o;const a=Yo(i,n.def);return rr.get(i).set(r,new WeakRef(a)),a}}function ea(e){const t=e[Ze],r=e[Q],n=e[J];return Object.freeze(Object.fromEntries(Object.keys(r.links).map(i=>{const o=r.links[i],a=t.objectSetFactory(r,t).where({[r.primaryKeyApiName]:n.$primaryKey}).pivotTo(i),s=o.multiplicity?a:{fetchOne:c=>ct(t,r,c??{},Ye(a)),fetchOneWithErrors:c=>Pr(t,r,c??{},Ye(a))};return[i,s]})))}const nr=new Set(["attachment","geotimeSeriesReference","mediaReference","numericTimeseries","stringTimeseries","sensorTimeseries"]),ta={$as:{get:function(){return Xo(this[Q])}},$link:{get:function(){return ea(this)}},$clone:{value:function(e){const t=this[J],r=this[Q];if(e==null)return et(this[Ze],r,{...t});if(r.primaryKeyApiName in e&&t[r.primaryKeyApiName]!==e[r.primaryKeyApiName])throw new Error(`Cannot update ${r.apiName} object with differing primary key values `);r.titleProperty in e&&!("$title"in e)&&(e.$title=e[r.titleProperty]);const n={...this[J],...e};return et(this[Ze],this[Q],n)}},$objectSpecifier:{get:function(){const e=this[J];return $t(this[Q],e.$primaryKey)},enumerable:!0}};function et(e,t,r,n={}){const i=r;Object.defineProperties(i,{[J]:{enumerable:!1,value:r},[Q]:{value:t,enumerable:!1},[Ze]:{value:e,enumerable:!1},...ta});for(const o of Object.keys(i))if(o in t.properties&&typeof t.properties[o].type=="string"&&nr.has(t.properties[o].type))i[o]=ra(e,t,i,o);else if(o in n&&typeof n[o].type=="string"&&nr.has(n[o].type)){const a=i[o];n[o].type==="attachment"?Array.isArray(a)?i[o]=a.map(s=>Ee(e,s.rid)):i[o]=Ee(e,a.rid):g()}return Object.freeze(i)}function ra(e,t,r,n){const i=r[n],o=t.properties[n];if(o.type==="attachment")return Array.isArray(i)?i.map(a=>Ee(e,a.rid)):Ee(e,i.rid);if(o.type==="numericTimeseries"||o.type==="stringTimeseries"||o.type==="sensorTimeseries")return new qo(e,t.apiName,r[t.primaryKeyApiName],n);if(o.type==="geotimeSeriesReference")return new zo(e,t.apiName,r[t.primaryKeyApiName],n,i.type==="geotimeSeriesValue"?{time:i.timestamp,value:{type:"Point",coordinates:i.position}}:void 0);if(o.type==="mediaReference")return new Ho({client:e,objectApiName:t.apiName,primaryKey:r[t.primaryKeyApiName],propertyName:n})}async function na(e,t,r,n=!1,i,o,a=!1){Lr(t,n);const s=r?await e.ontologyProvider.getInterfaceDefinition(r):void 0,c=s?o??Object.keys(s.properties):void 0,u=[];for(const f of t){const p=await e.ontologyProvider.getObjectDefinition(f.$apiName);p||g();let y,d=!0;if(s&&c?(Dr(p,s.apiName,e),d&&(d=Ot(e,s,f,c)),aa(p,s.apiName,f),y=oa(p,s.apiName,c)):y=o??Object.keys(p.properties),d&&(d=Ot(e,p,f,y)),a==="throw"&&!d)throw new Error("Unable to safely convert objects as some non nullable properties are null");if(a==="drop"&&!d)continue;let m=et(e,p,f,i);r&&(m=m.$as(r)),u.push(m)}return u}async function ia(e,t,r,n,i=!1,o,a=!1,s={}){Lr(t,i);const c=[];for(const u of t){const f=await e.ontologyProvider.getObjectDefinition(u.$apiName);f||g();const p=r?s[r][u.$apiName]:void 0,y=r&&p?o?Object.keys(p).filter(A=>{o==null||o.includes(p[A])}):[...Object.values(p),f.primaryKeyApiName]:void 0;let d,m=!0;if(r&&y?(Dr(f,r,e),d=y):d=o??Object.keys(f.properties),m&&(m=Ot(e,f,u,d)),a==="throw"&&!m)throw new Error("Unable to safely convert objects as some non nullable properties are null");if(a==="drop"&&!m)continue;let j=et(e,f,u,n);r&&(j=j.$as(r)),c.push(j)}return c}function oa(e,t,r){return r.map(n=>e.interfaceMap[t][n])}function aa(e,t,r){const n={};for(const[i,o]of Object.entries(e.interfaceMap[t]))if(i in r){const a=r[i];delete r[i],a!==void 0&&(n[o]=a)}Object.assign(r,n),e.primaryKeyApiName in r||(r[e.primaryKeyApiName]=r.$primaryKey)}function Ot(e,t,r,n){for(const i of n)if(i in t.properties&&t.properties[i].nullable===!1&&r[i]==null)return!1;return!0}function Dr(e,t,r){var n;if(((n=e.interfaceMap)==null?void 0:n[t])==null){const i="Interfaces are only supported 'as views' but your metadata object is missing the correct information. This suggests your interfaces have not been migrated to the newer version yet and you cannot use this version of the SDK.";throw r.logger?r.logger.warn(i):console.error(`WARNING! ${i}`),new Error(i)}}function Lr(e,t){for(const r of e)t&&delete r.__rid,r.__rid&&(r.$rid=r.__rid,delete r.__rid),r.$apiName??(r.$apiName=r.__apiName),r.$objectType=r.$apiName,r.$primaryKey??(r.$primaryKey=r.__primaryKey),r.$title??(r.$title=r.__title),delete r.__apiName,delete r.__primaryKey,delete r.__title}function sa(e){const t=new WeakMap;function r(n,i,o){return t.get(n.clientCacheKey)==null&&t.set(n.clientCacheKey,new Map),t.get(n.clientCacheKey).set(i,o),o}return{get:function(n,i){t.get(n.clientCacheKey)==null&&t.set(n.clientCacheKey,new Map);let o=t.get(n.clientCacheKey).get(i);return o===void 0&&e!==void 0?r(n,i,e(n,i)):o},set:r,remove:function(n,i){return t.get(n.clientCacheKey)==null?!1:t.get(n.clientCacheKey).delete(i)}}}function ir(e,t=sa){const r=t(),n=t(),i={getOrUndefined:function(o,a){return r.get(o,a)},get:async function(o,a){return r.get(o,a)??n.get(o,a)??i.set(o,a,e(o,a))},set:async function(o,a,s){try{const c=await n.set(o,a,s);return r.set(o,a,c),n.remove(o,a),c}catch(c){throw n.remove(o,a),c}}};return i}function Ur(e,t=!0,r){const n=St(e.dataType);if(n!=null)switch(e.dataType.type){case"integer":case"string":case"byte":case"decimal":case"double":case"float":case"long":case"short":case"boolean":case"date":case"attachment":case"mediaReference":case"geopoint":case"geoshape":case"timestamp":case"timeseries":case"marking":case"geotimeSeriesReference":case"struct":return{displayName:e.displayName,multiplicity:!1,description:e.description,type:n,nullable:e.nullable==null?t:e.nullable};case"array":return{displayName:e.displayName,multiplicity:!0,description:e.description,type:n,nullable:!0};case"cipherText":case"vector":return;default:e.dataType;return}}function St(e,t){var r,n;switch(e.type){case"integer":case"string":case"byte":case"decimal":case"double":case"float":case"long":case"short":case"boolean":case"attachment":case"geopoint":case"geoshape":case"timestamp":case"marking":case"geotimeSeriesReference":case"mediaReference":return e.type;case"date":return"datetime";case"array":return St(e.subType);case"timeseries":return((r=e.itemType)==null?void 0:r.type)==="string"?"stringTimeseries":((n=e.itemType)==null?void 0:n.type)==="double"?"numericTimeseries":"sensorTimeseries";case"struct":return e.structFieldTypes.reduce((i,o)=>(i[o.apiName]=St(o.dataType),i),{});case"cipherText":case"vector":return;default:return}}function ca(e,t,r){return{type:"interface",rid:e.rid,apiName:e.apiName,displayName:e.displayName,description:e.description,implements:e.allExtendsInterfaces??e.extendsInterfaces,properties:Object.fromEntries(Object.entries(e.allProperties??e.properties).map(([n,i])=>[n,Ur(i,!0)]).filter(([n,i])=>i!=null)),links:{},implementedBy:e.implementedByObjectTypes}}function ua(e){const t=new Set,r=new Set;for(const n of e.operations)switch(n.type){case"createObject":t.add(n.objectTypeApiName);break;case"modifyObject":r.add(n.objectTypeApiName);break}return{addedObjects:t,modifiedObjects:r}}function la(e){const t=ua(e);return{type:"action",apiName:e.apiName,parameters:Object.fromEntries(Object.entries(e.parameters).map(([r,n])=>[r,da(n)])),displayName:e.displayName,description:e.description,modifiedEntities:fa(t.addedObjects,t.modifiedObjects),rid:e.rid,status:e.status}}function da(e){return{multiplicity:e.dataType.type==="array",type:Et(e.dataType.type==="array"?e.dataType.subType:e.dataType),nullable:!e.required,description:e.description}}function Et(e){switch(e.type){case"string":case"boolean":case"attachment":case"double":case"integer":case"long":case"timestamp":case"mediaReference":case"marking":case"objectType":case"geohash":case"geoshape":return e.type;case"date":return"datetime";case"objectSet":return{type:"objectSet",objectSet:e.objectTypeApiName};case"object":return{type:"object",object:e.objectTypeApiName};case"array":return Et(e.subType);case"interfaceObject":return{type:"interface",interface:e.interfaceTypeApiName};case"struct":return{type:"struct",struct:e.fields.reduce((t,r)=>(t[r.name]=Et(r.fieldType),t),{})};default:throw new Error(`Unsupported action parameter type: ${JSON.stringify(e)}`)}}function fa(e,t){const r={};for(const n of e)r[n]={created:!0,modified:!1};for(const n of t)r[n]?r[n].modified=!0:r[n]={created:!1,modified:!0};return r}function pa(e){switch(e.dataType.type){case"integer":case"double":case"string":case"byte":case"long":case"short":case"timestamp":return e.dataType.type;case"date":return"datetime";case"boolean":case"geopoint":case"geoshape":case"decimal":case"attachment":case"timeseries":case"array":case"marking":case"float":case"geotimeSeriesReference":case"mediaReference":case"struct":case"cipherText":case"vector":throw new Error(`Primary key of type ${e.dataType.type} is not supported`);default:throw e.dataType,new Error(`Unknown type encountered for primaryKey: ${e.dataType}`)}}function ya(e,t,r){if(e.objectType.properties[e.objectType.primaryKey]===void 0)throw new Error(`Primary key ${e.objectType.primaryKey} not found in ${e.objectType.apiName}`);if(e.implementsInterfaces2==null&&e.implementsInterfaces!=null)throw new Error("Your ontology.json file is missing the implementsInterfaces2 field. Please regenerate it.");const n=e.implementsInterfaces2?Object.fromEntries(Object.entries(e.implementsInterfaces2).map(([i,o])=>[i,o.properties])):{};return{type:"object",apiName:e.objectType.apiName,description:e.objectType.description,primaryKeyApiName:e.objectType.primaryKey,primaryKeyType:pa(e.objectType.properties[e.objectType.primaryKey]),links:Object.fromEntries(e.linkTypes.map(i=>[i.apiName,{multiplicity:i.cardinality==="MANY",targetType:i.objectTypeApiName}])),properties:Object.fromEntries(Object.entries(e.objectType.properties).map(([i,o])=>[i,Ur(o,e.objectType.primaryKey!==i)]).filter(([i,o])=>o!=null)),implements:e.implementsInterfaces,interfaceMap:n,inverseInterfaceMap:Object.fromEntries(Object.entries(n).map(([i,o])=>[i,ha(o)])),icon:ma.includes(e.objectType.icon.type)?e.objectType.icon:void 0,titleProperty:e.objectType.titleProperty,displayName:e.objectType.displayName,pluralDisplayName:e.objectType.pluralDisplayName,status:e.objectType.status,rid:e.objectType.rid,visibility:e.objectType.visibility}}function ha(e){return e?Object.fromEntries(Object.entries(e).map(([t,r])=>[r,t])):void 0}const ma=["blueprint"];function xr(e){return e.type==="null"?!0:e.type==="union"?e.unionTypes.some(t=>xr(t)):!1}function B(e){switch(e.type){case"double":case"float":case"integer":case"long":case"attachment":case"boolean":case"date":case"string":case"timestamp":return{type:e.type,nullable:!1};case"object":return{type:"object",object:e.objectTypeApiName,nullable:!1};case"objectSet":return{type:"objectSet",objectSet:e.objectTypeApiName,nullable:!1};case"array":return{...B(e.subType),multiplicity:!0};case"set":return{type:"set",set:B(e.subType),nullable:!1};case"union":const t=xr(e);if(t&&e.unionTypes.length===2){const n=e.unionTypes.find(i=>i.type!=null);if(n)return{...B(n),nullable:!0}}return{type:"union",union:e.unionTypes.reduce((n,i)=>(i.type==="null"||n.push(B(i)),n),[]),nullable:t};case"struct":return{type:"struct",struct:Object.fromEntries(e.fields.map(n=>[n.name,B(n.fieldType)])),nullable:!1};case"twoDimensionalAggregation":return{type:"twoDimensionalAggregation",twoDimensionalAggregation:kt(e),nullable:!1};case"threeDimensionalAggregation":return{type:"threeDimensionalAggregation",threeDimensionalAggregation:ga(e),nullable:!1};case"entrySet":const r=B(e.keyType);if(!or.includes(r.type))throw new Error("Map types with a key type of "+r.type+" are not supported"+or.toString());if(r.multiplicity===!0)throw new Error("Map types cannot have keys as arrays");return{type:"map",nullable:!1,keyType:r,valueType:B(e.valueType)};case"null":case"unsupported":throw new Error(`Unable to process query because the server indicated an unsupported QueryDataType.type: ${e.type}. Please check that your query is using supported types.`);default:throw new Error(`Unsupported QueryDataType.type ${e.type}`)}}function kt(e){if(e.keyType.type==="range")return{keyType:e.keyType.type,keySubtype:e.keyType.subType.type,valueType:e.valueType.type};if(Fr(e.keyType))return{keyType:e.keyType.type,valueType:e.valueType.type};throw new Error(`Cannot create 2D aggregation with ${e.keyType.type} as its type`)}function ga(e){if(e.keyType.type==="range")return{keyType:e.keyType.type,keySubtype:e.keyType.subType.type,valueType:kt(e.valueType)};if(Fr(e.keyType))return{keyType:e.keyType.type,valueType:kt(e.valueType)};throw new Error(`Cannot create 3D aggregation with ${e.keyType.type} as its type`)}function Fr(e){return e.type==="string"||e.type==="boolean"}const or=["string","object","double","float","integer","long","date","timestamp","byte","datetime","decimal","marking","short","objectType"];function ba(e){return{type:"query",apiName:e.apiName,description:e.description,displayName:e.displayName,version:e.version,parameters:Object.fromEntries(Object.entries(e.parameters).map(([t,r])=>[t,wa(r)])),output:B(e.output),rid:e.rid}}function wa(e){return{description:e.description,...B(e.dataType)}}async function Ta(e,t){const r=await si(e,await e.ontologyRid,t);return la(r)}async function ja(e,t){const r=await Ti(e,await e.ontologyRid,t,{preview:!0});return{...ya(r)}}async function Oa(e,t){const r=await Oi(e,await e.ontologyRid,t,{preview:!0});return ca(r)}async function Sa(e,t){const[r,n]=t.split(":"),i=await Ci(e,await e.ontologyRid,r,{version:n});return ba(i)}const Ea=()=>e=>{function t(n){const i=ir((o,a)=>n(o,a,!1));return async o=>await i.get(e,o)}const r={getObjectDefinition:t(async function(n,i){var c;const o=await ja(n,i),a=Object.fromEntries((await Promise.all(((c=o.implements)==null?void 0:c.map(u=>r.getInterfaceDefinition(u)))??[])).map(u=>[u.apiName,{def:u,handler:void 0}]));return{...o,[Mt]:a}}),getInterfaceDefinition:t(async function(n,i){return Oa(n,i)}),getActionDefinition:t(async function(n,i){return await Ta(n,i)}),getQueryDefinition:function(n,i){const o=ir((a,s)=>i(a,s));return async(a,s)=>{const c=s?`${a}:${s}`:a;return await o.get(n,c)}}(e,async function(n,i){return Sa(n,i)})};return r},ka="osdk-client/2.3.0-beta.2";function va(e,t,r,n={},i=global.fetch,o=Xe,a=Ea){const s=new URL(t);s.pathname+=s.pathname.endsWith("/")?"":"/";const c={...Fo(s.toString(),r,ka,i),objectSetFactory:o,objectFactory:na,objectFactory2:ia,ontologyRid:e.ontologyRid,logger:n.logger,clientCacheKey:{},requestContext:{}};return Object.freeze(Object.assign(c,{ontologyProvider:a(n)(c)}))}const _a=async(e,t)=>{if(t.type==="object"){const{[Mt]:r,...n}=await e.ontologyProvider.getObjectDefinition(t.apiName);return n}else{if(t.type==="interface")return e.ontologyProvider.getInterfaceDefinition(t.apiName);if(t.type==="action")return e.ontologyProvider.getActionDefinition(t.apiName);if(t.type==="query")return e.ontologyProvider.getQueryDefinition(t.apiName,t.isFixedVersion?t.version:void 0);throw new Error("Not implemented for given definition")}};function ae(){}const Ue={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};var Me;class Pa{constructor(t,r={},n){T(this,Me);R(this,"trace",ae);R(this,"debug",ae);R(this,"warn",ae);R(this,"info",ae);R(this,"error",ae);R(this,"fatal",ae);var i;this.bindings=t,this.options=r,P(this,Me,n);for(const o of["trace","debug","info","warn","error","fatal"])(i=this.options)!=null&&i.level&&!this.isLevelEnabled(o)||(this[o]=this.createLogMethod(o,t))}child(t,r){var n,i;return new(l(this,Me))({...this.bindings,...t},{level:(n=r??this.options)==null?void 0:n.level,msgPrefix:[(i=this.options)==null?void 0:i.msgPrefix,r==null?void 0:r.msgPrefix].filter(o=>o).join(" ")})}isLevelEnabled(t){var n;const r=((n=this.options)==null?void 0:n.level)??"info";return t in Ue&&r in Ue&&Ue[t]>=Ue[r]}}Me=new WeakMap;class Ct extends Pa{constructor(t={},r={}){super(t,{...r,level:r.level??"error"},Ct)}createLogMethod(t,r){var i;const n=[t];return(i=this.options)!=null&&i.msgPrefix&&n.push(this.options.msgPrefix),typeof r=="object"&&"methodName"in r&&n.push(`.${r.methodName}()`),(...o)=>{console[t==="fatal"?"error":t](n.join(" "),...o)}}}async function Y(e,t,r){if(e==null)return e;if(Array.isArray(e)&&r.multiplicity){const n=Array.from(e);if(n.some(o=>ze(o)||He(o))){const o=[];for(const a of n)o.push(await Y(a,t,r));return o}const i=Array.from(e,async o=>await Y(o,t,r));return Promise.all(i)}switch(r.type){case"attachment":return ze(e)?(await Ve(t,e.data,{filename:e.name})).rid:He(e)?(await Ve(t,e,{filename:e.name})).rid:e;case"twoDimensionalAggregation":return{groups:e};case"threeDimensionalAggregation":return{groups:e};case"set":{if(e instanceof Set){const n=Array.from(e,async i=>await Y(i,t,r.set));return Promise.all(n)}break}case"object":{if($r(e))return e.$primaryKey;break}case"objectSet":{if(Rt(e))return e;if(Rr(e))return Ye(e);break}case"map":{if(typeof e=="object"){const n=[];for(const[i,o]of Object.entries(e))n.push({key:r.keyType.type==="object"?Qo(i):await Y(i,t,r.keyType),value:await Y(o,t,r.valueType)});return n}break}case"struct":if(typeof e=="object"){const n={};for(const[i,o]of Object.entries(e))n[i]=await Y(o,t,r.struct[i]);return n}case"boolean":case"date":case"double":case"float":case"integer":case"long":case"string":case"timestamp":return e}return e}async function Aa(e,t,r){const n=await e.ontologyProvider.getQueryDefinition(t.apiName,t.isFixedVersion?t.version:void 0),i=await $i(me(V(e,()=>({finalMethodCall:"applyQuery"})),t),await e.ontologyRid,t.apiName,{parameters:r?await Na(r,e,n.parameters):{}},{version:n.version}),o=await We(n.output,e);return await je(e,n.output,i.value,o)}async function Na(e,t,r){const n={};for(const[i,o]of Object.entries(e))n[i]=await Y(o,t,r[i]);return n}async function je(e,t,r,n){if(r==null){if(t.nullable)return;throw new Error("Got null response when nullable was not allowed")}if(t.multiplicity!=null&&t.multiplicity){const i={...t,multiplicity:!1};for(let o=0;o<r.length;o++)r[o]=await je(e,i,r[o],n);return r}switch(t.type){case"union":throw new Error("Union return types are not yet supported");case"set":{for(let i=0;i<r.length;i++)r[i]=await je(e,t.set,r[i],n);return r}case"attachment":return Ee(e,r);case"object":{const i=n.get(t.object);if(!i||i.type!=="object")throw new Error(`Missing definition for ${t.object}`);return $a(r,i)}case"objectSet":{const i=n.get(t.objectSet);if(!i)throw new Error(`Missing definition for ${t.objectSet}`);return typeof r=="string"?Xe(i,e,{type:"intersect",objectSets:[{type:"base",objectType:t.objectSet},{type:"reference",reference:r}]}):Xe(i,e,r)}case"struct":{for(const[i,o]of Object.entries(t.struct))vt(o)&&(r[i]=await je(e,o,r[i],n));return r}case"map":{const i={};Array.isArray(r)||g();for(const o of r){o.key||g(),o.value||g();const a=t.keyType.type==="object"?Ra(o.key,t.keyType.object,n):o.key,s=await je(e,t.valueType,o.value,n);i[a]=s}return i}case"twoDimensionalAggregation":{const i=[];for(const{key:o,value:a}of r.groups)i.push({key:o,value:a});return i}case"threeDimensionalAggregation":{const i=[];for(const{key:o,groups:a}of r.groups){const s=[];for(const{key:c,value:u}of a)s.push({key:c,value:u});i.push({key:o,groups:s})}return i}}return r}async function We(e,t){const r=new Map;switch(e.type){case"objectSet":{const n=await t.ontologyProvider.getObjectDefinition(e.objectSet);r.set(e.objectSet,n);break}case"object":{const n=await t.ontologyProvider.getObjectDefinition(e.object);r.set(e.object,n);break}case"set":return We(e.set,t);case"map":{for(const n of[e.keyType,e.valueType])for(const[i,o]of await We(n,t))r.set(i,o);break}case"struct":{for(const n of Object.values(e.struct))for(const[i,o]of await We(n,t))r.set(i,o);break}}return r}function vt(e){switch(e.type){case"boolean":case"date":case"double":case"float":case"integer":case"long":case"string":case"timestamp":return!1;case"union":return!0;case"struct":return Object.values(e.struct).some(vt);case"set":return vt(e.set);case"attachment":case"objectSet":case"twoDimensionalAggregation":case"threeDimensionalAggregation":case"object":return!0;default:return!1}}function Ra(e,t,r){const n=r.get(t);if(!n||n.type!=="object")throw new Error(`Missing definition for ${t}`);return $t(n,e)}function $a(e,t){return{$apiName:t.apiName,$title:void 0,$objectType:t.apiName,$primaryKey:e,$objectSpecifier:$t(t,e)}}class Ma{constructor(t,r){this.applyAction=Xt.bind(void 0,t,r),this.batchApplyAction=Xt.bind(void 0,t,r)}}class Ca{constructor(t,r){this.executeFunction=Aa.bind(void 0,t,r)}}function Ia(e,t,r,n,i=void 0,o=fetch){if(typeof r=="string"){if(!r.startsWith("ri."))throw new Error("Invalid ontology RID")}else r.then(u=>{if(!u.startsWith("ri."))throw new Error("Invalid ontology RID")});const a=va({ontologyRid:r},t,n,{...i,logger:(i==null?void 0:i.logger)??new Ct},o,e),s=_a.bind(void 0,a);return Object.defineProperties(function(u){if(u.type==="object"||u.type==="interface")return e(u,a);if(u.type==="action")return new Ma(a,u);if(u.type==="query")return new Ca(a,u);if(u.type==="experiment"){switch(u.name){case Xn.name:return{getBulkLinks:oo(a)};case Gn.name:return{fetchOneByRid:async(f,p,y)=>await ct(a,f,y,ar([p]))};case Qn.name:return{createMediaReference:async f=>{const{data:p,fileName:y,objectType:d,propertyType:m}=f;return await bi(a,await a.ontologyRid,d.apiName,m,p,{mediaItemPath:y,preview:!0})}};case Yn.name:return{fetchPageByRid:async(f,p,y={})=>await _r(a,f,y,ar(p))}}throw new Error("not implemented")}else throw new Error("not implemented")},{[wr]:{value:a},__osdkClientContext:{value:a},[xo]:{value:a},fetchMetadata:{value:s}})}const uc=Ia.bind(void 0,Xe);function ar(e){return{type:"static",objects:e}}const b={extraUserAgent:"typescript-sdk/0.5.0 typescript-sdk-generator/2.3.0-beta.2"},Da="ri.ontology.main.ontology.ab265709-5927-4853-99f0-c8f173e324e0",Kr={apiName:"buildLegsFlightPlanner20",type:"action",osdkMetadata:b},Wr={apiName:"calculateFlightTimes",type:"action",osdkMetadata:b},Br={apiName:"calculateSunriseSunset",type:"action",osdkMetadata:b},Jr={apiName:"createFlightLogObject",type:"action",osdkMetadata:b},Vr={apiName:"createFlightWithWaypoints",type:"action",osdkMetadata:b},zr={apiName:"createNewFlightFp2",type:"action",osdkMetadata:b},Hr={apiName:"editExistingFlightFp2",type:"action",osdkMetadata:b},qr={apiName:"flightAppUpdateEtdAndCrew",type:"action",osdkMetadata:b},Qr={apiName:"flightFuelFpv2",type:"action",osdkMetadata:b},Gr={apiName:"flightWeatherRiskTriggeredLightningWaves",type:"action",osdkMetadata:b},Yr={apiName:"getGlobalWindsForFlight",type:"action",osdkMetadata:b},Xr={apiName:"getWeatherForAlternates",type:"action",osdkMetadata:b},Zr={apiName:"pseudoWeatherSegments",type:"action",osdkMetadata:b},en={apiName:"singleFlightAutomation",type:"action",osdkMetadata:b},tn={apiName:"updateAlternantOneStep",type:"action",osdkMetadata:b},rn={apiName:"updateFastPlannerFlight",type:"action",osdkMetadata:b},nn={apiName:"updateWeatherByRegion",type:"action",osdkMetadata:b},on={apiName:"weatherWebookNorwayV9",type:"action",osdkMetadata:b},La=Object.freeze(Object.defineProperty({__proto__:null,buildLegsFlightPlanner20:Kr,calculateFlightTimes:Wr,calculateSunriseSunset:Br,createFlightLogObject:Jr,createFlightWithWaypoints:Vr,createNewFlightFp2:zr,editExistingFlightFp2:Hr,flightAppUpdateEtdAndCrew:qr,flightFuelFpv2:Qr,flightWeatherRiskTriggeredLightningWaves:Gr,getGlobalWindsForFlight:Yr,getWeatherForAlternates:Xr,pseudoWeatherSegments:Zr,singleFlightAutomation:en,updateAlternantOneStep:tn,updateFastPlannerFlight:rn,updateWeatherByRegion:nn,weatherWebookNorwayV9:on},Symbol.toStringTag,{value:"Module"})),Ua=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),an={type:"object",apiName:"AirportsData",osdkMetadata:b},sn={type:"object",apiName:"AllGtLocationsV2",osdkMetadata:b},cn={type:"object",apiName:"Asset",osdkMetadata:b},un={type:"object",apiName:"BristowHelidecks",osdkMetadata:b},ln={type:"object",apiName:"FlightFuelDburbury",osdkMetadata:b},dn={type:"object",apiName:"FlightLogObject",osdkMetadata:b},fn={type:"object",apiName:"FuelPolicyBuilder",osdkMetadata:b},pn={type:"object",apiName:"InternationalWeather",osdkMetadata:b},yn={type:"object",apiName:"LegObjectOutputObject",osdkMetadata:b},hn={type:"object",apiName:"MainFlightObjectFp2",osdkMetadata:b},mn={type:"object",apiName:"MainFuelV2",osdkMetadata:b},gn={type:"object",apiName:"NorwayWeatherDatav2",osdkMetadata:b},bn={type:"object",apiName:"NorwayWeatherSegments",osdkMetadata:b},wn={type:"object",apiName:"NorwayWeatherXv8",osdkMetadata:b},Tn={type:"object",apiName:"RegionalWeatherMinimaSettings",osdkMetadata:b},jn={type:"object",apiName:"User",osdkMetadata:b},xa=Object.freeze(Object.defineProperty({__proto__:null,AirportsData:an,AllGtLocationsV2:sn,Asset:cn,BristowHelidecks:un,FlightFuelDburbury:ln,FlightLogObject:dn,FuelPolicyBuilder:fn,InternationalWeather:pn,LegObjectOutputObject:yn,MainFlightObjectFp2:hn,MainFuelV2:mn,NorwayWeatherDatav2:gn,NorwayWeatherSegments:bn,NorwayWeatherXv8:wn,RegionalWeatherMinimaSettings:Tn,User:jn},Symbol.toStringTag,{value:"Module"})),Fa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),lc=Object.freeze(Object.defineProperty({__proto__:null,$Actions:La,$Interfaces:Ua,$Objects:xa,$Queries:Fa,$ontologyRid:Da,$osdkMetadata:b,AirportsData:an,AllGtLocationsV2:sn,Asset:cn,BristowHelidecks:un,FlightFuelDburbury:ln,FlightLogObject:dn,FuelPolicyBuilder:fn,InternationalWeather:pn,LegObjectOutputObject:yn,MainFlightObjectFp2:hn,MainFuelV2:mn,NorwayWeatherDatav2:gn,NorwayWeatherSegments:bn,NorwayWeatherXv8:wn,RegionalWeatherMinimaSettings:Tn,User:jn,buildLegsFlightPlanner20:Kr,calculateFlightTimes:Wr,calculateSunriseSunset:Br,createFlightLogObject:Jr,createFlightWithWaypoints:Vr,createNewFlightFp2:zr,editExistingFlightFp2:Hr,flightAppUpdateEtdAndCrew:qr,flightFuelFpv2:Qr,flightWeatherRiskTriggeredLightningWaves:Gr,getGlobalWindsForFlight:Yr,getWeatherForAlternates:Xr,pseudoWeatherSegments:Zr,singleFlightAutomation:en,updateAlternantOneStep:tn,updateFastPlannerFlight:rn,updateWeatherByRegion:nn,weatherWebookNorwayV9:on},Symbol.toStringTag,{value:"Module"}));let _t;var xe,gr;(typeof navigator>"u"||!((gr=(xe=navigator.userAgent)==null?void 0:xe.startsWith)!=null&&gr.call(xe,"Mozilla/5.0 ")))&&(_t="oauth4webapi/v2.17.0");function It(e,t){if(e==null)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}const Ka=Symbol(),Wa=Symbol(),On=Symbol(),Sn=Symbol(),Ba=Symbol(),Ja=Symbol(),Va=new TextEncoder,za=new TextDecoder;function te(e){return typeof e=="string"?Va.encode(e):za.decode(e)}const sr=32768;function Ha(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));const t=[];for(let r=0;r<e.byteLength;r+=sr)t.push(String.fromCharCode.apply(null,e.subarray(r,r+sr)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function qa(e){try{const t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}catch(t){throw new h("The input to be decoded is not correctly encoded.",{cause:t})}}function G(e){return typeof e=="string"?qa(e):Ha(e)}class Qa{constructor(t){this.cache=new Map,this._cache=new Map,this.maxSize=t}get(t){let r=this.cache.get(t);if(r)return r;if(r=this._cache.get(t))return this.update(t,r),r}has(t){return this.cache.has(t)||this._cache.has(t)}set(t,r){return this.cache.has(t)?this.cache.set(t,r):this.update(t,r),this}delete(t){return this.cache.has(t)?this.cache.delete(t):this._cache.has(t)?this._cache.delete(t):!1}update(t,r){this.cache.set(t,r),this.cache.size>=this.maxSize&&(this._cache=this.cache,this.cache=new Map)}}class U extends Error{constructor(t){var r;super(t??"operation not supported"),this.name=this.constructor.name,(r=Error.captureStackTrace)==null||r.call(Error,this,this.constructor)}}class Ga extends Error{constructor(t,r){var n;super(t,r),this.name=this.constructor.name,(n=Error.captureStackTrace)==null||n.call(Error,this,this.constructor)}}const h=Ga,En=new Qa(100);function kn(e){return e instanceof CryptoKey}function vn(e){return kn(e)&&e.type==="private"}function Ya(e){return kn(e)&&e.type==="public"}function Xa(e){try{const t=e.headers.get("dpop-nonce");t&&En.set(new URL(e.url).origin,t)}catch{}return e}function tt(e){return!(e===null||typeof e!="object"||Array.isArray(e))}function _n(e){It(e,Headers)&&(e=Object.fromEntries(e.entries()));const t=new Headers(e);if(_t&&!t.has("user-agent")&&t.set("user-agent",_t),t.has("authorization"))throw new TypeError('"options.headers" must not include the "authorization" header name');if(t.has("dpop"))throw new TypeError('"options.headers" must not include the "dpop" header name');return t}function Za(e){if(typeof e=="function"&&(e=e()),!(e instanceof AbortSignal))throw new TypeError('"options.signal" must return or be an instance of AbortSignal');return e}function N(e){return typeof e=="string"&&e.length!==0}function ut(){return G(crypto.getRandomValues(new Uint8Array(32)))}function es(){return ut()}function ts(){return ut()}async function rs(e){if(!N(e))throw new TypeError('"codeVerifier" must be a non-empty string');return G(await crypto.subtle.digest("SHA-256",te(e)))}function ns(e){if(e instanceof CryptoKey)return{key:e};if(!((e==null?void 0:e.key)instanceof CryptoKey))return{};if(e.kid!==void 0&&!N(e.kid))throw new TypeError('"kid" must be a non-empty string');return{key:e.key,kid:e.kid,modifyAssertion:e[Sn]}}function cr(e){return encodeURIComponent(e).replace(/%20/g,"+")}function is(e,t){const r=cr(e),n=cr(t);return`Basic ${btoa(`${r}:${n}`)}`}function os(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new U("unsupported RsaHashedKeyAlgorithm hash name")}}function as(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new U("unsupported RsaHashedKeyAlgorithm hash name")}}function ss(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new U("unsupported EcKeyAlgorithm namedCurve")}}function Pn(e){switch(e.algorithm.name){case"RSA-PSS":return os(e);case"RSASSA-PKCS1-v1_5":return as(e);case"ECDSA":return ss(e);case"Ed25519":case"Ed448":return"EdDSA";default:throw new U("unsupported CryptoKey algorithm name")}}function Dt(e){const t=e==null?void 0:e[Ka];return typeof t=="number"&&Number.isFinite(t)?t:0}function cs(e){const t=e==null?void 0:e[Wa];return typeof t=="number"&&Number.isFinite(t)&&Math.sign(t)!==-1?t:30}function Lt(){return Math.floor(Date.now()/1e3)}function us(e,t){const r=Lt()+Dt(t);return{jti:ut(),aud:[e.issuer,e.token_endpoint],exp:r+60,iat:r,nbf:r,iss:t.client_id,sub:t.client_id}}async function ls(e,t,r,n,i){const o={alg:Pn(r),kid:n},a=us(e,t);return i==null||i(o,a),An(o,a,r)}function Ce(e){if(typeof e!="object"||e===null)throw new TypeError('"as" must be an object');if(!N(e.issuer))throw new TypeError('"as.issuer" property must be a non-empty string');return!0}function Ie(e){if(typeof e!="object"||e===null)throw new TypeError('"client" must be an object');if(!N(e.client_id))throw new TypeError('"client.client_id" property must be a non-empty string');return!0}function ur(e){if(!N(e))throw new TypeError('"client.client_secret" property must be a non-empty string');return e}function yt(e,t){if(t!==void 0)throw new TypeError(`"options.clientPrivateKey" property must not be provided when ${e} client authentication method is used.`)}function lr(e,t){if(t!==void 0)throw new TypeError(`"client.client_secret" property must not be provided when ${e} client authentication method is used.`)}async function ds(e,t,r,n,i){switch(r.delete("client_secret"),r.delete("client_assertion_type"),r.delete("client_assertion"),t.token_endpoint_auth_method){case void 0:case"client_secret_basic":{yt("client_secret_basic",i),n.set("authorization",is(t.client_id,ur(t.client_secret)));break}case"client_secret_post":{yt("client_secret_post",i),r.set("client_id",t.client_id),r.set("client_secret",ur(t.client_secret));break}case"private_key_jwt":{if(lr("private_key_jwt",t.client_secret),i===void 0)throw new TypeError('"options.clientPrivateKey" must be provided when "client.token_endpoint_auth_method" is "private_key_jwt"');const{key:o,kid:a,modifyAssertion:s}=ns(i);if(!vn(o))throw new TypeError('"options.clientPrivateKey.key" must be a private CryptoKey');r.set("client_id",t.client_id),r.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),r.set("client_assertion",await ls(e,t,o,a,s));break}case"tls_client_auth":case"self_signed_tls_client_auth":case"none":{lr(t.token_endpoint_auth_method,t.client_secret),yt(t.token_endpoint_auth_method,i),r.set("client_id",t.client_id);break}default:throw new U("unsupported client token_endpoint_auth_method")}}async function An(e,t,r){if(!r.usages.includes("sign"))throw new TypeError('CryptoKey instances used for signing assertions must include "sign" in their "usages"');const n=`${G(te(JSON.stringify(e)))}.${G(te(JSON.stringify(t)))}`,i=G(await crypto.subtle.sign(Un(r),r,te(n)));return`${n}.${i}`}async function fs(e,t,r,n,i,o){var y;const{privateKey:a,publicKey:s,nonce:c=En.get(r.origin)}=t;if(!vn(a))throw new TypeError('"DPoP.privateKey" must be a private CryptoKey');if(!Ya(s))throw new TypeError('"DPoP.publicKey" must be a public CryptoKey');if(c!==void 0&&!N(c))throw new TypeError('"DPoP.nonce" must be a non-empty string or undefined');if(!s.extractable)throw new TypeError('"DPoP.publicKey.extractable" must be true');const u=Lt()+i,f={alg:Pn(a),typ:"dpop+jwt",jwk:await ys(s)},p={iat:u,jti:ut(),htm:n,nonce:c,htu:`${r.origin}${r.pathname}`,ath:void 0};(y=t[Sn])==null||y.call(t,f,p),e.set("dpop",await An(f,p,a))}let Be;async function ps(e){const{kty:t,e:r,n,x:i,y:o,crv:a}=await crypto.subtle.exportKey("jwk",e),s={kty:t,e:r,n,x:i,y:o,crv:a};return Be.set(e,s),s}async function ys(e){return Be||(Be=new WeakMap),Be.get(e)||ps(e)}function dr(e,t,r){if(typeof e!="string")throw r?new TypeError(`"as.mtls_endpoint_aliases.${t}" must be a string`):new TypeError(`"as.${t}" must be a string`);return new URL(e)}function Nn(e,t,r=!1){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?dr(e.mtls_endpoint_aliases[t],t,r):dr(e[t],t,r)}function Rn(e,t){return!!(e.use_mtls_endpoint_aliases||t!=null&&t[Ja])}function $n(e){const t=e;return typeof t!="object"||Array.isArray(t)||t===null?!1:t.error!==void 0}async function Mn(e,t,r,n,i,o,a){return await ds(e,t,i,o,a==null?void 0:a.clientPrivateKey),o.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((a==null?void 0:a[On])||fetch)(n.href,{body:i,headers:Object.fromEntries(o.entries()),method:r,redirect:"manual",signal:a!=null&&a.signal?Za(a.signal):null}).then(Xa)}async function Cn(e,t,r,n,i){const o=Nn(e,"token_endpoint",Rn(t,i));n.set("grant_type",r);const a=_n(i==null?void 0:i.headers);return a.set("accept","application/json"),(i==null?void 0:i.DPoP)!==void 0&&await fs(a,i.DPoP,o,"POST",Dt(t)),Mn(e,t,"POST",o,n,a,i)}async function hs(e,t,r,n){if(Ce(e),Ie(t),!N(r))throw new TypeError('"refreshToken" must be a non-empty string');const i=new URLSearchParams(n==null?void 0:n.additionalParameters);return i.set("refresh_token",r),Cn(e,t,"refresh_token",i,n)}const ms=new WeakMap;async function gs(e,t,r,n=!1,i=!1){if(Ce(e),Ie(t),!It(r,Response))throw new TypeError('"response" must be an instance of Response');if(r.status!==200){let a;if(a=await Ln(r))return a;throw new h('"response" is not a conform Token Endpoint response')}Dn(r);let o;try{o=await r.json()}catch(a){throw new h('failed to parse "response" body as JSON',{cause:a})}if(!tt(o))throw new h('"response" body must be a top level object');if(!N(o.access_token))throw new h('"response" body "access_token" property must be a non-empty string');if(!N(o.token_type))throw new h('"response" body "token_type" property must be a non-empty string');if(o.token_type=o.token_type.toLowerCase(),o.token_type!=="dpop"&&o.token_type!=="bearer")throw new U("unsupported `token_type` value");if(o.expires_in!==void 0&&(typeof o.expires_in!="number"||o.expires_in<=0))throw new h('"response" body "expires_in" property must be a positive number');if(!i&&o.refresh_token!==void 0&&!N(o.refresh_token))throw new h('"response" body "refresh_token" property must be a non-empty string');if(o.scope!==void 0&&typeof o.scope!="string")throw new h('"response" body "scope" property must be a string');if(!n){if(o.id_token!==void 0&&!N(o.id_token))throw new h('"response" body "id_token" property must be a non-empty string');if(o.id_token){const{claims:a,jwt:s}=await Ps(o.id_token,As.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),xn,Dt(t),cs(t),t[Ba]).then(Ss.bind(void 0,["aud","exp","iat","iss","sub"])).then(ws.bind(void 0,e.issuer)).then(bs.bind(void 0,t.client_id));if(Array.isArray(a.aud)&&a.aud.length!==1){if(a.azp===void 0)throw new h('ID Token "aud" (audience) claim includes additional untrusted audiences');if(a.azp!==t.client_id)throw new h('unexpected ID Token "azp" (authorized party) claim value')}if(a.auth_time!==void 0&&(!Number.isFinite(a.auth_time)||Math.sign(a.auth_time)!==1))throw new h('ID Token "auth_time" (authentication time) must be a positive number');ms.set(o,[a,s])}}return o}function bs(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw new h('unexpected JWT "aud" (audience) claim value')}else if(t.claims.aud!==e)throw new h('unexpected JWT "aud" (audience) claim value');return t}function ws(e,t){if(t.claims.iss!==e)throw new h('unexpected JWT "iss" (issuer) claim value');return t}const In=new WeakSet;function Ts(e){return In.add(e),e}async function js(e,t,r,n,i,o){if(Ce(e),Ie(t),!In.has(r))throw new TypeError('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()');if(!N(n))throw new TypeError('"redirectUri" must be a non-empty string');if(!N(i))throw new TypeError('"codeVerifier" must be a non-empty string');const a=W(r,"code");if(!a)throw new h('no authorization code in "callbackParameters"');const s=new URLSearchParams(o==null?void 0:o.additionalParameters);return s.set("redirect_uri",n),s.set("code_verifier",i),s.set("code",a),Cn(e,t,"authorization_code",s,o)}const Os={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation"};function Ss(e,t){for(const r of e)if(t.claims[r]===void 0)throw new h(`JWT "${r}" (${Os[r]}) claim missing`);return t}async function fr(e,t,r){const n=await gs(e,t,r,!0);if($n(n))return n;if(n.id_token!==void 0){if(typeof n.id_token=="string"&&n.id_token.length)throw new h("Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing");delete n.id_token}return n}async function Es(e,t,r,n){if(Ce(e),Ie(t),!N(r))throw new TypeError('"token" must be a non-empty string');const i=Nn(e,"revocation_endpoint",Rn(t,n)),o=new URLSearchParams(n==null?void 0:n.additionalParameters);o.set("token",r);const a=_n(n==null?void 0:n.headers);return a.delete("accept"),Mn(e,t,"POST",i,o,a,n)}async function ks(e){if(!It(e,Response))throw new TypeError('"response" must be an instance of Response');if(e.status!==200){let t;if(t=await Ln(e))return t;throw new h('"response" is not a conform Revocation Endpoint response')}}function Dn(e){if(e.bodyUsed)throw new TypeError('"response" body has been used already')}async function Ln(e){if(e.status>399&&e.status<500){Dn(e);try{const t=await e.json();if(tt(t)&&typeof t.error=="string"&&t.error.length)return t.error_description!==void 0&&typeof t.error_description!="string"&&delete t.error_description,t.error_uri!==void 0&&typeof t.error_uri!="string"&&delete t.error_uri,t.algs!==void 0&&typeof t.algs!="string"&&delete t.algs,t.scope!==void 0&&typeof t.scope!="string"&&delete t.scope,t}catch{}}}function pr(e){if(typeof e.modulusLength!="number"||e.modulusLength<2048)throw new h(`${e.name} modulusLength must be at least 2048 bits`)}function vs(e){switch(e){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new U}}function Un(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:vs(e.algorithm.namedCurve)};case"RSA-PSS":switch(pr(e.algorithm),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new U}case"RSASSA-PKCS1-v1_5":return pr(e.algorithm),e.algorithm.name;case"Ed448":case"Ed25519":return e.algorithm.name}throw new U}const xn=Symbol();async function _s(e,t,r,n){const i=`${e}.${t}`;if(!await crypto.subtle.verify(Un(r),r,n,te(i)))throw new h("JWT signature verification failed")}async function Ps(e,t,r,n,i,o){let{0:a,1:s,2:c,length:u}=e.split(".");if(u===5)if(o!==void 0)e=await o(e),{0:a,1:s,2:c,length:u}=e.split(".");else throw new U("JWE structure JWTs are not supported");if(u!==3)throw new h("Invalid JWT");let f;try{f=JSON.parse(te(G(a)))}catch(j){throw new h("failed to parse JWT Header body as base64url encoded JSON",{cause:j})}if(!tt(f))throw new h("JWT Header must be a top level object");if(t(f),f.crit!==void 0)throw new h('unexpected JWT "crit" header parameter');const p=G(c);let y;r!==xn&&(y=await r(f),await _s(a,s,y,p));let d;try{d=JSON.parse(te(G(s)))}catch(j){throw new h("failed to parse JWT Payload body as base64url encoded JSON",{cause:j})}if(!tt(d))throw new h("JWT Payload must be a top level object");const m=Lt()+n;if(d.exp!==void 0){if(typeof d.exp!="number")throw new h('unexpected JWT "exp" (expiration time) claim type');if(d.exp<=m-i)throw new h('unexpected JWT "exp" (expiration time) claim value, timestamp is <= now()')}if(d.iat!==void 0&&typeof d.iat!="number")throw new h('unexpected JWT "iat" (issued at) claim type');if(d.iss!==void 0&&typeof d.iss!="string")throw new h('unexpected JWT "iss" (issuer) claim type');if(d.nbf!==void 0){if(typeof d.nbf!="number")throw new h('unexpected JWT "nbf" (not before) claim type');if(d.nbf>m+i)throw new h('unexpected JWT "nbf" (not before) claim value, timestamp is > now()')}if(d.aud!==void 0&&typeof d.aud!="string"&&!Array.isArray(d.aud))throw new h('unexpected JWT "aud" (audience) claim type');return{header:f,claims:d,signature:p,key:y,jwt:e}}function As(e,t,r){if(e!==void 0){if(r.alg!==e)throw new h('unexpected JWT "alg" header parameter');return}if(Array.isArray(t)){if(!t.includes(r.alg))throw new h('unexpected JWT "alg" header parameter');return}if(r.alg!=="RS256")throw new h('unexpected JWT "alg" header parameter')}function W(e,t){const{0:r,length:n}=e.getAll(t);if(n>1)throw new h(`"${t}" parameter must be provided only once`);return r}const Ns=Symbol(),Rs=Symbol();function $s(e,t,r,n){if(Ce(e),Ie(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw new TypeError('"parameters" must be an instance of URLSearchParams, or URL');if(W(r,"response"))throw new h('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');const i=W(r,"iss"),o=W(r,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw new h('response parameter "iss" (issuer) missing');if(i&&i!==e.issuer)throw new h('unexpected "iss" (issuer) response parameter value');switch(n){case void 0:case Rs:if(o!==void 0)throw new h('unexpected "state" response parameter encountered');break;case Ns:break;default:if(!N(n))throw new h('"expectedState" must be a non-empty string');if(o===void 0)throw new h('response parameter "state" missing');if(o!==n)throw new h('unexpected "state" response parameter value')}const a=W(r,"error");if(a)return{error:a,error_description:W(r,"error_description"),error_uri:W(r,"error_uri")};const s=W(r,"id_token"),c=W(r,"token");if(s!==void 0||c!==void 0)throw new U("implicit and hybrid flows are not supported");return Ts(new URLSearchParams(r))}var Ms=class extends EventTarget{dispatchTypedEvent(e,t){return super.dispatchEvent(t)}};function Je(e){if($n(e))throw new Error(`Failed to get token: ${e.error}`);return e}const Cs=globalThis.CustomEvent;function ge(e){return`@osdk/oauth : refresh : ${e.client_id}`}function Pt(e,t){var r;(r=globalThis.localStorage)==null||r.setItem(ge(e),JSON.stringify(t))}function At(e){var t;(t=globalThis.localStorage)==null||t.removeItem(ge(e))}function Is(e){var t;return JSON.parse(((t=globalThis.localStorage)==null?void 0:t.getItem(ge(e)))??"{}")}function yr(e,t){var r;(r=globalThis.sessionStorage)==null||r.setItem(ge(e),JSON.stringify(t))}function Ds(e){var t;(t=globalThis.sessionStorage)==null||t.removeItem(ge(e))}function ht(e){var t;return JSON.parse(((t=globalThis.sessionStorage)==null?void 0:t.getItem(ge(e)))??"{}")}function Ls(e,t,r,n,i,o,a){let s;const c=new Ms;function u(v,_){const{refresh_token:L,expires_in:w,access_token:E}=v;return w==null&&g(),Pt(e,{refresh_token:L,refreshTokenMarker:o,requestedScopes:a}),s={refresh_token:L,expires_in:w,access_token:E,expires_at:Date.now()+w*1e3},c.dispatchTypedEvent(_,new Cs(_,{detail:s})),s}let f;function p(){f&&clearTimeout(f)}function y(v){i&&(p(),f=setTimeout(i,v.detail.expires_in*1e3-60*1e3))}let d;async function m(){if(d)return d;try{return d=r(),await d}finally{d=void 0}}c.addEventListener("signIn",y),c.addEventListener("refresh",y);function j(){if(!(!s||Date.now()>=s.expires_at))return s==null?void 0:s.access_token}return{getToken:Object.assign(async function(){return(!s||Date.now()>=s.expires_at)&&(s=await m()),s==null?void 0:s.access_token},{signIn:m,refresh:i,signOut:async function(){s||g();const _=await ks(await Es(t,e,s.access_token,n));p(),At(e),s=void 0,Je(_),c.dispatchTypedEvent("signOut",new Event("signOut"))},rmTimeout:p,getTokenOrUndefined:j,addEventListener:c.addEventListener.bind(c),removeEventListener:c.removeEventListener.bind(c)}),makeTokenAndSaveRefresh:u}}function Us(e,t){const r=`${new URL(e,t.endsWith("/")?t:t+"/")}`;return{token_endpoint:`${r}/api/oauth2/token`,authorization_endpoint:`${r}/api/oauth2/authorize`,revocation_endpoint:`${r}/api/oauth2/revoke_token`,issuer:r}}const hr=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},xs=new WeakMap;function Fs({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(hr());let o,a,s;const c=e??clearTimeout,u=()=>{c(o),s(hr())},f=()=>{i&&i.removeEventListener("abort",u)},p=new Promise((y,d)=>{a=()=>{f(),y(n)},s=d,o=(t??setTimeout)(a,r)});return i&&i.addEventListener("abort",u,{once:!0}),xs.set(p,()=>{c(o),o=null,a()}),p}}const mr=Fs();function Ks(e,t,r,n,i,o,a,s){let c={};return typeof r=="object"?(!n&&!i&&!o&&!a&&!s||g(),c=r):c={useHistory:r,loginPage:n,postLoginPage:i,scopes:o,fetchFn:a,ctxPath:s},t||g(),{useHistory:c.useHistory??!0,loginPage:c.loginPage,postLoginPage:c.postLoginPage||window.location.toString(),joinedScopes:[...c.scopes??["api:read-data","api:write-data","api:use-ontologies-read","api:use-ontologies-write"]].sort().join(" "),fetchFn:c.fetchFn??globalThis.fetch,ctxPath:c.ctxPath??"multipass",refreshTokenMarker:c.refreshTokenMarker}}function dc(e,t,r,n,i,o,a,s,c){let u,f;({useHistory:n,loginPage:i,postLoginPage:o,joinedScopes:f,fetchFn:s,ctxPath:c,refreshTokenMarker:u}=Ks(t,r,n,i,o,a,s,c));const p={client_id:e,token_endpoint_auth_method:"none"},y=Us(c,t),d={[On]:s},{makeTokenAndSaveRefresh:m,getToken:j}=Ls(p,y,async function(){return await v()??await _()??await L()},d,v.bind(globalThis,!0),u,f),A=async w=>{if(n){window.history.replaceState({},"",w);return}else window.location.assign(w);throw await mr(1e3),new Error("Unable to redirect")};async function v(w){const{refresh_token:E,refreshTokenMarker:re,requestedScopes:ne}=Is(p),Fn=ne!=null&&f===ne;if(!E||re!==u||!Fn){if(w)throw new Error("No refresh token found");return}try{const lt=m(Je(await fr(y,p,await hs(y,p,E,d))),"refresh");if(lt&&window.location.pathname===new URL(r).pathname){const{oldUrl:Kn}=ht(p);A(Kn??"/")}return lt}catch{if(At(p),w)throw new Error("Could not refresh token")}}async function _(){const{state:w,oldUrl:E,codeVerifier:re}=ht(p);if(re)try{const ne=m(Je(await fr(y,p,await js(y,p,Je($s(y,p,new URL(window.location.href),w)),r,re,d))),"signIn");return A(E),ne}catch(ne){throw At(p),Ds(p),ne}}const L=async()=>{if(i&&window.location.href!==i&&window.location.pathname!==i){Pt(p,{}),yr(p,{oldUrl:o}),await A(i);return}const w=ts(),E=es(),re=ht(p).oldUrl??window.location.toString();throw Pt(p,{}),yr(p,{codeVerifier:E,state:w,oldUrl:re}),window.location.assign(`${y.authorization_endpoint}?${new URLSearchParams({client_id:e,response_type:"code",state:w,redirect_uri:r,code_challenge:await rs(E),code_challenge_method:"S256",scope:`offline_access ${f}`})}`),await mr(1e3),new Error("Unable to redirect")};return j}const Ws=[3,"/v2/admin/users/{0}"];function Bs(e,...t){return O(e,Ws,...t)}const Js=[0,"/v2/admin/users",2];function Vs(e,...t){return O(e,Js,...t)}const zs=[0,"/v2/admin/users/{0}"];function Hs(e,...t){return O(e,zs,...t)}const qs=[1,"/v2/admin/users/getBatch",1];function Qs(e,...t){return O(e,qs,...t)}const Gs=[0,"/v2/admin/users/getCurrent"];function Ys(e,...t){return O(e,Gs,...t)}const Xs=[0,"/v2/admin/users/{0}/getMarkings",2];function Zs(e,...t){return O(e,Xs,...t)}const ec=[0,"/v2/admin/users/{0}/profilePicture",,,"application/octet-stream"];function tc(e,...t){return O(e,ec,...t)}const rc=[1,"/v2/admin/users/search",1];function nc(e,...t){return O(e,rc,...t)}const fc=Object.freeze(Object.defineProperty({__proto__:null,deleteUser:Bs,get:Hs,getBatch:Qs,getCurrent:Ys,getMarkings:Zs,list:Vs,profilePicture:tc,search:nc},Symbol.toStringTag,{value:"Module"}));export{Da as $,fc as U,uc as a,Ys as b,dc as c,oc as d,ac as e,Jn as g,lc as i};
//# sourceMappingURL=osdk-vendors-uCUaU2oH.js.map

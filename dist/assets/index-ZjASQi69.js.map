{"version":3,"mappings":"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","names":["m","require$$0","client","scopes","url","clientId","getRedirectUrl","protocol","hostname","port","redirectUrl","auth","createPublicOauthClient","createClient","$ontologyRid","AuthContext","createContext","useAuth","useContext","AuthProvider","children","initialAuthState","error","isAuthenticated","setIsAuthenticated","useState","userDetails","setUserDetails","userEmail","setUserEmail","userName","setUserName","isLoading","setIsLoading","updateAuthState","authState","details","name","email","displayName","authMessage","loginButton","err","event","debugAdminUser","Users","Users.getCurrent","currentUser","checkAuth","adminUser","initialUserDetails","storedDetailsString","storedDetails","currentToken","_a","fetchedUserDetails","nameField","field","userDetailsString","e","tokenParts","payload","extractedUser","fullName","decodeError","fetchError","useEffect","handleStorageChange","login","loadingOverlay","signInResult","logout","jsx","WaypointHandler","mapManager","waypointManager","nearestWaypoint","usedNearestWaypoint","coords","options","waypointCount","wp","enabled","createSeparateHandlers","platformManager","map","platformFeatures","props","coordinates","routeFeatures","insertIndex","nearestRig","waypointFeatures","currentRegion","toggleMode","handlers","waypointMode","initialized","initializeHandlers","mode","reinitializeHandlers","getHandlers","ModeHandler","mapManagerRef","waypointManagerRef","platformManagerRef","initialMode","currentMode","setCurrentMode","isInitialized","setIsInitialized","handlersRef","useRef","button","handleToggleMode","targetMode","directHandlers","showModeMessage","success","jsxs","LeftPanel","visible","waypoints","onRemoveWaypoint","onWaypointNameChange","onAddWaypoint","onToggleVisibility","routeInput","onRouteInputChange","favoriteLocations","onAddFavoriteLocation","onRemoveFavoriteLocation","onReorderWaypoints","onClearRoute","onToggleChart","chartsVisible","onToggleWaypointMode","waypointModeActive","recentWaypoints","setRecentWaypoints","prevWaypointsRef","recentFavorites","setRecentFavorites","prevFavoritesRef","internalFavorites","setInternalFavorites","fav","prevIds","newFavorites","updates","prev","updated","newWaypoints","isRecentlyAdded","waypointId","handleDragStart","id","handleDragEnd","handleDragOver","handleDragEnter","handleDragLeave","handleDrop","targetId","targetIndex","draggedId","sourceIndex","sourceId","movedWaypoint","handleKeyPress","Fragment","waypoint","index","locationName","newLocation","tempId","tempLocation","message","toast","debugInfo","loc","parts","part","inputElement","location","locationId","RightPanelContainer","React","initialActiveCard","ref","activeCard","setActiveCard","isAnimating","setIsAnimating","currentCard","setCurrentCard","nextCard","setNextCard","animationState","setAnimationState","panelRef","cards","getActiveChild","child","handleCardChange","cardId","card","RegionSelector","regions","onRegionChange","region","SaveFlightModal","isOpen","onClose","onSave","isSaving","initialFlightName","onRunDiagnostic","runAutomation","flightName","setFlightName","etd","setEtd","captainId","setCaptainId","copilotId","setCopilotId","medicId","setMedicId","soId","setSoId","rswId","setRswId","enableAutomation","setEnableAutomation","origin","destination","todayDate","formattedDate","handleSubmit","sdk","__vitePreload","n","hasFlightAction","hasAutomationAction","PalantirFlightService","key","minimalParams","result","errorJson","validationData","parseError","flightData","cleanLocations","structuredWaypoints","legs","waypointsByLeg","legIndex","params","cleanData","obj","firstObject","formattedParams","detailedMessage","AutomationService","flightId","PanelContext","usePanelContext","PanelProvider","value","SaveFlightButton","selectedAircraft","routeStats","onSuccess","onError","setIsSaving","isAutomating","setIsAutomating","showModal","setShowModal","savedFlightId","setSavedFlightId","panelContext","handleButtonClick","openModal","closeModal","runDiagnosticMode","successMessage","errorMessage","runFlightAutomation","warningContainer","handleFlightFormSubmit","locations","etdTimestamp","finalAircraftId","waypointsWithLegs","apiParams","diagnosticResult","successContainer","closeButton","errorContainer","canSaveFlight","buttonStyle","buttonText","LoadFlightsButton","DistanceIcon","TimeIcon","FuelIcon","PassengerIcon","StopCard","stopName","totalDistance","totalTime","totalFuel","maxPassengers","maxPassengersDisplay","groundSpeed","headwind","deckTime","isDeparture","isDestination","fuelComponents","isActive","onClick","className","formatTime","timeHours","hours","minutes","colors","borderColor","cardStyle","cardClasses","stopNumberDisplay","stopNumberStyle","passengersDisplay","PassengerCalculator","aircraft","fuelWeight","passengerWeight","fuelWeightNum","passengerWeightNum","usableLoadWithoutFuel","maxByWeight","aircraftMaxPax","leg","fuelRequired","stopCards","updatedCards","calculateStopCards","weather","taxiFuel","contingencyFuelPercent","reserveFuel","deckTimePerStop","deckFuelFlow","taxiFuelValue","passengerWeightValue","contingencyFuelPercentValue","reserveFuelValue","deckTimePerStopValue","deckFuelFlowValue","totalTripFuel","legDetails","i","fromWaypoint","toWaypoint","legDistance","from","to","legTimeHours","legFuel","legGroundSpeed","headwindComponent","fromHasCoords","toHasCoords","fromCoords","toCoords","intermediateStops","deckTimeHours","deckFuelValue","contingencyFuelValue","departureWaypoint","departureFuelNeeded","departureFuelComponentsText","departureMaxPassengers","departureCard","cumulativeDistance","cumulativeTime","legDetail","stopId","remainingTripFuel","j","remainingDeckTimeHours","remainingDeckFuel","remainingContingencyFuel","isFinalDestination","fuelNeeded","fuelComponentsText","fullContingencyFuel","_b","potentialLandingFuel","displayMaxPassengers","maxPassengersValue","maxPassengersWeight","cardData","StopCardCalculator","StopCardsContainer","calculatedStopCards","setCalculatedStopCards","activeCardIndex","setActiveCardIndex","cardPositions","setCardPositions","animatingCards","setAnimatingCards","cardRefs","containerRef","currentPositions","cardElement","newAnimating","oldPos","newPos","deltaY","handleCardClick","setCardRef","el","MainCard","onLoadRigData","aircraftType","onAircraftTypeChange","aircraftRegistration","onAircraftRegistrationChange","aircraftsByType","aircraftLoading","authUserName","rigsLoading","onLogin","regionLoading","onWeatherUpdate","handleSaveSuccess","handleSaveError","isRegistrationExpanded","setIsRegistrationExpanded","type","actualCount","newReg","a","b","newDirection","normalizedDirection","newSpeed","FlightSettings","settings","onSettingsChange","handleChange","updateObject","numValue","SettingsCard","deckFuelPerStop","cargoWeight","reserveMethod","onDeckTimeChange","onDeckFuelChange","onDeckFuelFlowChange","onPassengerWeightChange","onCargoWeightChange","onTaxiFuelChange","onContingencyFuelPercentChange","onReserveMethodChange","onReserveFuelChange","approachFuel","setApproachFuel","storageKey","savedSettingsJson","savedSettings","typeSettingsJson","typeSettings","handleFlightSettingsChange","newSettings","flightSettings","BaseCard","title","dropdownVsTemp","interp1D","points","xQuery","x0","y0","x1","y1","t","getRequiredDropdown","weight","oat","bands","lower","upper","dLow","p","dHigh","getWeightForDropdown","dropdown","dropdownsByBand","band","lowerBand","upperBand","current","next","getEffectiveWeight","pressureAltitude","pressureEffect","windEffect","getOriginalWeight","effectiveWeight","S92PerformanceCard","weatherData","aircraftData","calculationMode","setCalculationMode","setWeight","setOat","setHeadwind","setPressureAltitude","requiredDropdown","setRequiredDropdown","setEffectiveWeight","maxPermittedDropdown","setMaxPermittedDropdown","targetDropdown","setTargetDropdown","oatReverse","setOatReverse","headwindReverse","setHeadwindReverse","pressureAltitudeReverse","setPressureAltitudeReverse","calculatedWeight","setCalculatedWeight","effectiveWeightReverse","setEffectiveWeightReverse","isExample1","isExample2","effectiveWt","originalWeight","PerformanceCard","showS92Calculator","setShowS92Calculator","toggleS92Calculator","s92CardId","styles","WeatherCard","FinanceCard","loadSetting","defaultValue","savedValue","hourlyRate","setHourlyRate","mileageRate","setMileageRate","billingMethod","setBillingMethod","landingFee","setLandingFee","includeLandingFees","setIncludeLandingFees","additionalCost","setAdditionalCost","useFlightTime","setUseFlightTime","customLandings","setCustomLandings","taxRate","setTaxRate","includeTax","setIncludeTax","saveSetting","updateHourlyRate","updateMileageRate","updateBillingMethod","updateLandingFee","updateIncludeLandingFees","updateAdditionalCost","updateUseFlightTime","updateCustomLandings","updateTaxRate","updateIncludeTax","routeData","setRouteData","formatCurrency","amount","timeToHours","timeStr","readRouteData","statsCard","statValues","distanceMatch","distance","flightTime","flightTimeHours","totalTimeHours","fuelMatch","landings","intervalId","costs","mainCost","landingsCount","landingCost","extra","timeDisplay","subtotal","taxAmount","totalCost","EvacuationCard","SaveFlightCard","onCancel","LoadFlightsCard","onLoad","flights","setFlights","selectedFlightId","setSelectedFlightId","searchTerm","setSearchTerm","isLoadingFlights","setIsLoadingFlights","loadFlights","handleLoadFlight","flight","f","filteredFlights","formatDate","dateString","date","RightPanel","onLoadCustomChart","forceUpdate","payloadWeight","onPayloadWeightChange","handleSaveFlightSubmit","handleLoadFlightsCancel","handleSaveFlightCancel","rightPanelRef","useCallback","MapComponent","onMapReady","mapContainerRef","mapInitializedRef","loading","setLoading","loadingMessage","setLoadingMessage","mapInstance","LoadingIndicator","activeLoaders","loaderIdCounter","messageQueue","isProcessingQueue","currentMessage","messageTimer","initializeStyles","styleEl","processNextMessage","updateStatusIndicatorInternal","textLength","displayTime","clearStatusIndicatorInternal","show","container","loadingText","queueMessage","containerEl","loadingContainer","textEl","loadingBar","loaderId","updateText","newText","loader","newTextEl","hide","hideAll","bar","text","alreadyQueued","updateStatusIndicator","statusIndicator","typewriterDiv","clearStatusIndicator","remainingTime","originalText","header","positionInterval","leftPos","EnhancedFuelDisplay","fuelData","onAdjustFuel","onChangeAlternate","enhancedResults","fuelByStop","maxCapacity","legResults","auxiliaryFuel","formatFuelComponents","components","stop","formatWind","wind","RouteStatsCard","forceRerender","setForceRerender","localStopCards","setLocalStopCards","calculatedCards","cardRef","loaderIdRef","avgCourse","legCount","estimatedTime","_c","_d","isWindAdjusted","style","deckTimePerStopNum","deckFuelFlowNum","totalDeckTime","calculatedDeckFuel","stats","calculateTotalTime","displayedFlightTime","calculateFlightTime","formattedTime","_e","_f","_g","_h","_i","_j","_k","_l","_m","maxFuel","refuelAmount","_n","_o","_p","_q","_r","_s","_t","_u","_v","calculatedTripFuel","calculatedIntermediateStops","calculatedDeckTimeHours","calculatedContingencyFuel","calculatedReserveFuel","calculatedTaxiFuel","calculatedTotalFuel","refuelNeeded","calculateMaxPassengers","maxPax","getDisplayPassengers","calculated","initTimer","calculateTotalDistance","waypointArray","total","hasWindData","windData","fromPoint","toPoint","course","legTime","idx","color","bgColor","EnhancedFuelCalculator","newConfig","eventName","callback","data","results","requiredAircraftProps","prop","timeResult","cruiseSpeed","heading","tripFuel","numStops","contingencyFuel","deckFuel","isFirstStop","isLastStop","remainingContingency","requiredFuel","actualFuel","maxTakeoffWeight","emptyWeight","maxPassengerWeight","aircraftMaxPassengers","limitedMaxPassengers","minPassengers","limitingStop","enhancedFuelCalculator","initializeFuelCalculator","calculateFuelRequirements","convertToExistingFormat","sum","totalTimeFormatted","FuelIntegration","degreesToRadians","degrees","radiansToDegrees","radians","calculateWindAngle","windDirection","windDirectionMath","angleDiff","calculateHeadwindComponent","windSpeed","courseRad","windRad","calculateCrosswindComponent","calculateGroundSpeed","airspeed","crosswindComponent","crosswindCorrection","calculateCourse","fromLat","fromLon","toLat","toLon","y","x","bearing","calculateWindAdjustedTime","calculateWindAdjustedFuel","baseFuelBurn","time","adjustmentFactor","calculateLegWithWind","fuelBurn","fuel","calculateAllFuelData","numericSettings","ComprehensiveFuelCalculator","MapManager","containerId","resolve","reject","cb","mapboxScript","mapboxCss","turfScript","checkScriptsLoaded","latLines","longLines","lat","line","long","bounds","onRoutePointAdded","isDragging","draggedLineCoordinates","originalLineCoordinates","closestPointIndex","dragLineSource","addDragLine","findClosestPointOnLine","mouseLngLat","mousePoint","isMouseOverRoute","routeSource","minDistance","closestPoint","segmentIndex","point","snapped","distanceNM","mousePos","closestInfo","WaypointManager","isWaypointOption","isWaypointGlobal","isWaypoint","markerOptions","marker","lngLat","oldCoords","newCoords","platformMgr","nearestPlatform","defaultName","markerIndex","popup","popupContent","markerElement","styleSheet","hasWindAdjustments","useCurrentStats","calculatedTimeHours","firstWaypoint","lastWaypoint","calculatedTimeString","expectedTimeHours","fixedTimeHours","fixedTimeString","features","startPoint","endPoint","midPoint","totalMinutes","useWindCalculation","distanceText","timeText","startLng","goingLeftToRight","leftArrow","rightArrow","labelText","adjustedBearing","removedWaypoint","arrowsData","canvas","ctx","dropTargetId","draggedIndex","dropTargetIndex","movedMarker","clickedPoint","segment","nearestPoint","isWaypointMode","dragData","PlatformManager","regionName","locationObject","locationOptions","allTypes","item","originalCount","inactiveCount","platformCountByRegion","platform","found","samplePlatforms","regionCount","existingNames","airportResult","airports","airport","criticalLocations","locName","specificResult","sample","potentialCoordFields","processedNames","fixedPlatformCount","movablePlatformCount","airportsCount","typeCount","isAirfield","isMovable","upperType","isPlatformOrVessel","isFixedPlatform","allLayers","layerId","platforms","airfieldCount","platformCount","addLayersAndSource","sourceExists","debugPlatforms","fixedPlatformsCount","movablePlatformsCount","airfieldsCount","source","updateError","visibility","lng","maxDistance","clickPoint","waypointPoint","query","limit","normalizedQuery","exactMatches","startsWithMatches","containsMatches","normalizedName","processedCount","skippedNoName","skippedNoCoords","reportingPointCount","fixCount","intersectionCount","navaidCount","waypontLayers","addWaypointLayers","platformLayers","waypointLayers","foundWaypointLayers","mapContainer","indicator","RouteCalculator","forceTimeCalculation","aircraftTypes","aircraftObject","totalHeadwind","WindCalculations","fallbackTime","avgHeadwind","usableLoad","RegionManager","regionId","defaultRegionId","FavoriteLocationsManager","savedFavorites","timestamp","initialLength","AircraftManager","Asset","response","orgUnit","registration","modelName","modelType","displayRegistration","sdkError","typeCountByRegion","allKnownTypes","activeAircraft","count","registrationsToCheck","reg","matches","s92AircraftInGOM","actualTypeCounts","primaryRegion","aliases","alias","regionMap","upperRegion","lowerRegion","model","typeMap","regExMatch","typePattern","extractedType","formattedRegion","gulfAircraft","matchedAircraft","matchRegex","match","displayedRegion","types","typesWithAircraft","knownRegion","aircraftInRegion","filtered","matchFound","directMatches","typeRegex","displayedType","s92Aircraft","registrations","uniqueRegs","counts","typeBuckets","typeKey","regionText","typeCounts","lng1","lat1","lng2","lat2","R","dLat","dLon","c","region1","region2","r1","r2","regionAliases","type1","type2","t1","t2","t1Base","t2Base","typeFamilies","variations","v","FlightCalculations","validConfig","calculationParams","cruseSpeed","maxFuelCapacity","dryOperatingWeightLbs","usefulLoad","operatingWeight","flightTimeFormatted","maxPassengersByWeight","calculatedPassengers","distanceNm","MapInteractionHandler","waypointHandler","availableLayers","layer","innerErr","callbackData","rigCoordinates","AppSettingsManager","parsed","parsedSettings","uiSettings","fixWaypointManagerAddMethod","fixRouteDragFunctionality","waitForWaypointManager","originalAddWaypoint","originalAddWaypointAtIndex","globalWaypointMode","isExplicitWaypoint","enhancedOptions","waitForMapInteractionHandler","originalHandleRouteDragComplete","enhancedDragData","checkInterval","originalMethod","waypointsBefore","testCoords","center","waypointsAfter","allWaypoints","WaypointDebugger","hasBodyClass","cursor","currentState","newState","globalFlag","initializeLoadingIndicator","FastPlannerApp","routeCalculatorRef","regionManagerRef","favoriteLocationsManagerRef","aircraftManagerRef","flightCalculationsRef","mapInteractionHandlerRef","appSettingsManagerRef","waypointHandlerRef","WindCalc","setForceUpdate","setRouteInput","airportData","setAirportData","setFavoriteLocations","leftPanelVisible","setLeftPanelVisible","rightPanelVisible","setRightPanelVisible","platformsVisible","setPlatformsVisible","platformsLoaded","setPlatformsLoaded","setRigsLoading","rigsError","setRigsError","setWaypoints","setStopCards","setRouteStats","setWaypointModeActive","setRegions","setCurrentRegion","setRegionLoading","setAircraftType","setAircraftRegistration","setSelectedAircraft","aircraftList","setAircraftList","setAircraftTypes","setAircraftsByType","setAircraftLoading","setWeather","setFlightSettings","setReserveMethod","updateFlightSetting","settingName","numericValue","updatedSettings","errorDialog","dialogContent","handleMapReady","favorites","regionFavorites","filteredAircraft","byType","availableTypes","clickData","addWaypoint","updatedWaypoints","handleSaveAircraftSettings","handleSettingsChanged","initialRegion","toggleLeftPanel","panel","toggleRightPanel","handleRouteInputChange","updateWeatherSettings","windSpeedNum","windDirectionNum","newWeather","basicRouteStats","newStopCards","waypointData","removeWaypoint","waypointIdOrIndex","updateWaypointName","clearRoute","handleAddFavoriteLocation","updatedFavorites","reorderWaypoints","handleRemoveFavoriteLocation","togglePlatformsVisibility","toggleWaypointMode","active","loadCustomChart","reloadPlatformData","changeRegion","changeAircraftType","changeAircraftRegistration","FastPlannerPage","App","ReactDOM"],"ignoreList":[0],"sources":["../../node_modules/react-dom/client.js","../../src/client.ts","../../src/context/AuthContext.tsx","../../src/components/fast-planner/modules/WaypointHandler.js","../../src/components/fast-planner/modules/waypoints/separate-mode-handler.js","../../src/components/fast-planner/modules/waypoints/mode-handler-fix.js","../../src/components/fast-planner/modules/waypoints/ModeHandler.jsx","../../src/components/fast-planner/components/panels/LeftPanel.jsx","../../src/components/fast-planner/components/panels/RightPanelContainer.jsx","../../src/components/fast-planner/components/controls/RegionSelector.jsx","../../src/components/fast-planner/components/controls/SaveFlightModal.jsx","../../src/components/fast-planner/services/PalantirFlightService.js","../../src/components/fast-planner/services/AutomationService.js","../../src/components/fast-planner/context/PanelContext.jsx","../../src/components/fast-planner/components/controls/SaveFlightButton.jsx","../../src/components/fast-planner/components/controls/LoadFlightsButton.jsx","../../src/components/fast-planner/components/flight/stops/StopIcons.jsx","../../src/components/fast-planner/components/flight/stops/StopCard.jsx","../../src/components/fast-planner/modules/calculations/passengers/PassengerCalculator.js","../../src/components/fast-planner/modules/calculations/flight/StopCardCalculator.js","../../src/components/fast-planner/components/flight/stops/StopCardsContainer.jsx","../../src/components/fast-planner/components/panels/cards/MainCard.jsx","../../src/components/fast-planner/components/flight/FlightSettings.jsx","../../src/components/fast-planner/components/panels/cards/SettingsCard.jsx","../../src/components/fast-planner/components/panels/cards/BaseCard.jsx","../../src/components/fast-planner/components/panels/cards/performance/S92PerformanceCard.jsx","../../src/components/fast-planner/components/panels/cards/PerformanceCard.jsx","../../src/components/fast-planner/components/panels/cards/WeatherCard.jsx","../../src/components/fast-planner/components/panels/cards/FinanceCard.jsx","../../src/components/fast-planner/components/panels/cards/EvacuationCard.jsx","../../src/components/fast-planner/components/panels/cards/SaveFlightCard.jsx","../../src/components/fast-planner/components/panels/cards/LoadFlightsCard.jsx","../../src/components/fast-planner/components/panels/RightPanel.jsx","../../src/components/fast-planner/components/map/MapComponent.jsx","../../src/components/fast-planner/modules/LoadingIndicator.js","../../src/components/fast-planner/components/fuel/EnhancedFuelDisplay.jsx","../../src/components/fast-planner/components/flight/RouteStatsCard.jsx","../../src/components/fast-planner/modules/calculations/fuel/EnhancedFuelCalculator.js","../../src/components/fast-planner/modules/calculations/fuel/index.js","../../src/components/fast-planner/modules/calculations/fuel/FuelIntegration.js","../../src/components/fast-planner/modules/calculations/WindCalculations.js","../../src/components/fast-planner/modules/calculations/fuel/ComprehensiveFuelCalculator.js","../../src/components/fast-planner/modules/MapManager.js","../../src/components/fast-planner/modules/WaypointManager.js","../../src/components/fast-planner/modules/PlatformManager.js","../../src/components/fast-planner/modules/RouteCalculator.js","../../src/components/fast-planner/modules/data/regions.js","../../src/components/fast-planner/modules/RegionManager.js","../../src/components/fast-planner/modules/FavoriteLocationsManager.js","../../src/components/fast-planner/modules/AircraftManager.js","../../src/components/fast-planner/modules/calculations/FlightCalculations.js","../../src/components/fast-planner/modules/MapInteractionHandler.js","../../src/components/fast-planner/modules/AppSettingsManager.js","../../src/components/fast-planner/fixes/fix-waypoint-functionality.js","../../src/components/fast-planner/fixes/fix-route-drag.js","../../src/components/fast-planner/fixes/WaypointDebugger.js","../../src/components/fast-planner/FastPlannerApp.jsx","../../src/pages/FastPlannerPage.jsx","../../src/App.jsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { Client, createClient } from \"@osdk/client\";\nimport { $ontologyRid } from \"@flight-app/sdk\";\nimport { createPublicOauthClient } from \"@osdk/oauth\";\n\n// Define scopes needed for the application\nconst scopes = [\n  \"api:ontologies-read\",\n  \"api:ontologies-write\",\n  \"api:mediasets-read\",\n  \"api:mediasets-write\",\n  \"api:admin-read\", // Scope for Admin API read permission\n];\n\n// Initialize with environment variables\nconst url = \"https://bristow.palantirfoundry.com\";\nconst clientId = \"7db2ec0841ba7cd5697f25eebde0a64e\";\n\n// Dynamically determine the redirect URL based on current hostname\nconst getRedirectUrl = () => {\n  const protocol = window.location.protocol;\n  const hostname = window.location.hostname;\n  const port = window.location.port ? `:${window.location.port}` : '';\n  return `${protocol}//${hostname}${port}/auth/callback`;\n};\n\nconst redirectUrl = getRedirectUrl();\nconsole.log(`Using OAuth redirect URL: ${redirectUrl}`);\n\n// Create auth and client instances\nexport const auth = createPublicOauthClient(\n  clientId,\n  url,\n  redirectUrl,\n  true,\n  undefined,\n  window.location.toString(),\n  scopes,\n);\n\n// Create the API client\nconst client = createClient(\n  url,\n  $ontologyRid,\n  auth,\n);\n\nexport default client;","import React, { createContext, useContext, useState, useEffect } from 'react';\nimport client, { auth } from '../client';\nimport { User, Users } from '@osdk/foundry.admin';\n\ninterface UserDetails extends User {\n  // Properties we know exist in the API response from our debug logs\n  id?: string;\n  username?: string;\n  givenName?: string;\n  familyName?: string;\n  email?: string;\n  realm?: string;\n  organization?: string;\n  attributes?: {\n    [key: string]: string[]\n  };\n  \n  // Allow other properties\n  [key: string]: any;\n}\n\ninterface AuthContextType {\n  isAuthenticated: boolean;\n  userDetails: UserDetails | null;\n  userEmail: string | null;\n  userName: string | null;\n  login: () => void;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  isAuthenticated: false,\n  userDetails: null,\n  userEmail: null,\n  userName: null,\n  login: () => {},\n  logout: () => {},\n});\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider: React.FC<{children: React.ReactNode}> = ({ children }) => {\n  // Immediately check for a token on component mount\n  // This function runs synchronously during component initialization\n  const checkForToken = (): boolean => {\n    try {\n      // Check if auth exists and has the necessary methods\n      if (auth && typeof auth.getAccessToken === 'function') {\n        const token = auth.getAccessToken();\n        \n        if (token) {\n          console.log('%c✓ TOKEN FOUND - Setting authenticated state to TRUE', \n            'background: green; color: white; font-weight: bold; padding: 3px 5px;');\n          \n          // Set a global flag so other components can see auth state immediately\n          (window as any).isFoundryAuthenticated = true;\n          \n          // Add CSS class to body to indicate authenticated state\n          if (document && document.body) {\n            document.body.classList.add('foundry-authenticated');\n            document.body.classList.remove('foundry-unauthenticated');\n          }\n          \n          return true;\n        }\n      } else {\n        console.log('Auth object not fully initialized, skipping token check');\n      }\n      \n      // Also check localStorage as a backup\n      const newAuthState = localStorage.getItem('fastPlanner_isAuthenticated');\n      if (newAuthState === 'true') {\n        console.log('%c✓ AUTH STATE FOUND IN LOCALSTORAGE - Setting authenticated state to TRUE', \n          'background: green; color: white; font-weight: bold; padding: 3px 5px;');\n        return true;\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Error in initial token check:', error);\n      return false;\n    }\n  };\n  \n  // Check for token without immediately calling methods\n  const safeCheckForToken = (): boolean => {\n    try {\n      // Check if auth exists and has a getAccessToken method\n      if (auth && typeof auth.getAccessToken === 'function') {\n        const token = auth.getAccessToken();\n        if (token) {\n          console.log('Token found, setting initial state to authenticated');\n          return true;\n        }\n      }\n      \n      // If no token found via auth methods, check localStorage as backup\n      const storedAuthState = localStorage.getItem('fastPlanner_isAuthenticated');\n      if (storedAuthState === 'true') {\n        console.log('Auth state found in localStorage, using as fallback');\n        return true;\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Error in initial token check:', error);\n      return false;\n    }\n  };\n  \n  // Check for token and set initial auth state\n  const initialAuthState = safeCheckForToken();\n  \n  // Initialize state with proper values\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean>(initialAuthState);\n  const [userDetails, setUserDetails] = useState<UserDetails | null>(null);\n  const [userEmail, setUserEmail] = useState<string | null>(null);\n  const [userName, setUserName] = useState<string | null>(initialAuthState ? \"Duncan Burbury\" : null);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  \n  // Log initial state\n  console.log(`%cInitial auth state: ${initialAuthState ? 'AUTHENTICATED' : 'NOT AUTHENTICATED'} - User: ${userName || 'None'}`, \n    'background: #060; color: white; font-weight: bold;');\n  \n  // Create a wrapped version of setIsAuthenticated that ensures consistency\n  const updateAuthState = (authState: boolean, details: UserDetails | null = null, name: string | null = null, email: string | null = null) => {\n    console.log(`%cUPDATING AUTH STATE: ${authState ? 'AUTHENTICATED' : 'NOT AUTHENTICATED'} - User: ${name || 'None'}`, \n      'background: #060; color: white; font-weight: bold; padding: 4px 8px; border-radius: 4px;');\n    \n    // Use the provided name or extract from existing user details\n    const displayName = name || (authState && userDetails ? \n        (userDetails.givenName && userDetails.familyName ? \n            `${userDetails.givenName} ${userDetails.familyName}` : \n            userDetails.givenName || userDetails.username || userEmail) : \n        null);\n    \n    // Update all related state at once to ensure consistency\n    setIsAuthenticated(authState);\n    \n    if (details) {\n      setUserDetails(details);\n    }\n    \n    // ALWAYS set user name when authenticated, even if not provided\n    if (authState) {\n      setUserName(displayName);\n    } else {\n      setUserName(null);\n    }\n    \n    if (email) {\n      setUserEmail(email);\n    }\n    \n    // Set global variables for immediate access\n    (window as any).isFoundryAuthenticated = authState;\n    (window as any).foundryUserName = displayName;\n    \n    // Update auth UI elements directly - using a timeout to ensure DOM is ready\n    setTimeout(() => {\n      try {\n        // Update connection status message\n        const authMessage = document.getElementById('auth-message');\n        if (authMessage) {\n          if (authState) {\n            authMessage.innerHTML = `Connected to Foundry as ${displayName}`;\n            authMessage.className = 'auth-success';\n          } else {\n            authMessage.innerHTML = 'Not connected to Foundry';\n            authMessage.className = 'auth-error';\n          }\n        }\n        \n        // Update login button\n        const loginButton = document.getElementById('login-button');\n        if (loginButton && authState) {\n          loginButton.style.display = 'none';\n        } else if (loginButton) {\n          loginButton.style.display = 'block';\n        }\n      } catch (error) {\n        console.warn(\"Failed to update DOM elements:\", error);\n      }\n    }, 100); // Short delay to ensure DOM is fully loaded\n    \n    // Store auth state in localStorage so other parts of the app can check it\n    try {\n      localStorage.setItem('fastPlanner_isAuthenticated', JSON.stringify(authState));\n      if (displayName) {\n        localStorage.setItem('fastPlanner_userName', displayName);\n      }\n      \n      if (authState && details) {\n        localStorage.setItem('fastPlanner_userDetails', JSON.stringify(details));\n      }\n    } catch (err) {\n      console.error('Error storing auth state in localStorage:', err);\n    }\n    \n    // Also update application classes for CSS selectors\n    if (document && document.body) {\n      if (authState) {\n        document.body.classList.add('foundry-authenticated');\n        document.body.classList.remove('foundry-unauthenticated');\n        \n        // Add a data attribute with the username\n        document.body.setAttribute('data-username', displayName);\n      } else {\n        document.body.classList.add('foundry-unauthenticated');\n        document.body.classList.remove('foundry-authenticated');\n        document.body.removeAttribute('data-username');\n      }\n    }\n    \n    // Dispatch a custom event that components can listen for\n    const event = new CustomEvent('auth-state-changed', { \n      detail: { authenticated: authState, userName: displayName } \n    });\n    window.dispatchEvent(event);\n  };\n\n  // Debug function to directly try the example code method\n  const debugAdminUser = async () => {\n    try {\n      console.log(\"🔍 DEBUG: Attempting to get user with direct admin API call...\");\n      \n      // Simple existence check without accessing methods\n      if (!client) {\n        console.log(\"🔍 DEBUG: OSDK client is not available\");\n        return null;\n      }\n      \n      // Check if Users module is available\n      if (!Users || typeof Users.getCurrent !== 'function') {\n        console.log(\"🔍 DEBUG: Users module or getCurrent method not available\");\n        return null;\n      }\n      \n      // This replicates the example from @osdk/foundry.admin documentation\n      console.log(\"🔍 DEBUG: Calling Users.getCurrent with client...\");\n      const currentUser = await Users.getCurrent(client, { preview: true });\n      console.log(\"🔍 DEBUG: Direct admin API call succeeded\");\n      \n      // If we successfully get user data from the admin API, we are authenticated\n      if (currentUser) {\n        // Create display name\n        const displayName = currentUser.givenName && currentUser.familyName \n          ? `${currentUser.givenName} ${currentUser.familyName}` \n          : currentUser.givenName || \"Bristow User\";\n        \n        // Use the unified method to update all auth state at once\n        updateAuthState(true, currentUser, displayName, currentUser.email || null);\n        \n        console.log(\"🔍 DEBUG: Updated auth state via unified method - userName:\", displayName);\n      }\n      \n      return currentUser;\n    } catch (error) {\n      console.error(\"🔍 DEBUG: Error with direct admin API call:\", error);\n      return null;\n    }\n  };\n\n  // Define checkAuth function to use both now and later\n  const checkAuth = async () => {\n    // Try the debug function first\n    const adminUser = await debugAdminUser();\n    if (adminUser) {\n      const displayName = adminUser.givenName && adminUser.familyName \n        ? `${adminUser.givenName} ${adminUser.familyName}` \n        : adminUser.givenName || \"Name not found\";\n      console.log(\"🔍 DEBUG: Found user via admin API:\", displayName);\n    }\n    \n    setIsLoading(true);\n    console.log(\"AuthProvider: Initializing authentication...\");\n    let initialUserDetails: UserDetails | null = null;\n\n    // 1. Check localStorage first (for backward compatibility)\n    try {\n      const storedDetailsString = localStorage.getItem('userDetails');\n      if (storedDetailsString) {\n        const storedDetails = JSON.parse(storedDetailsString);\n        // Use stored details only if they contain userId (ignore potentially incomplete old data)\n        if (storedDetails && storedDetails.userId) {\n          console.log(\"AuthProvider: Found initial user details in localStorage\");\n          initialUserDetails = storedDetails;\n          setUserDetails(initialUserDetails);\n          setUserEmail(initialUserDetails?.email ?? null);\n          setUserName(initialUserDetails?.username ?? null);\n        }\n      }\n    } catch (error) {\n      console.error(\"AuthProvider: Error reading/parsing localStorage:\", error);\n      localStorage.removeItem('userDetails');\n    }\n\n    // Log authentication state at the beginning of each check\n    console.log(`AuthProvider: Current auth state - isAuthenticated: ${isAuthenticated}, userName: ${userName}`);\n    \n    // 2. Always attempt fresh claim retrieval\n    console.log(\"AuthProvider: Checking for token and authenticating...\");\n    try {\n      // Get the current token\n      const currentToken = auth.getAccessToken?.();\n      console.log(\"AuthProvider: Token check:\", currentToken ? \"Token exists\" : \"No token\");\n      \n      if (currentToken) {\n        console.log(\"AuthProvider: Token available, setting authenticated to true\");\n        // Make sure we set isAuthenticated to true if we have a token - use updateAuthState\n        updateAuthState(true);\n\n        // Fetch full user details using Users.getCurrent\n        try {\n          console.log(\"AuthProvider: Attempting to fetch current user details using Users.getCurrent...\");\n          console.log(\"AuthProvider: Users methods available:\", Object.keys(Users));\n          console.log(\"AuthProvider: Client instance:\", client);\n          \n          // The correct way to call Users.getCurrent with the client - match exactly with working example\n          const fetchedUserDetails = await Users.getCurrent(client, { preview: true });\n          console.log(\"AuthProvider: Successfully retrieved user details:\", fetchedUserDetails);\n          \n          // Add detailed logging about the actual shape of the user object\n          console.log(\"AuthProvider: Raw user details structure:\", JSON.stringify(fetchedUserDetails, null, 2));\n\n          if (fetchedUserDetails) {\n            console.log(\"AuthProvider: Successfully fetched current user details:\", fetchedUserDetails);\n            // Generate display name from fields we know exist\n            let displayName = \"Bristow User\";\n            \n            if (fetchedUserDetails.givenName && fetchedUserDetails.familyName) {\n              displayName = `${fetchedUserDetails.givenName} ${fetchedUserDetails.familyName}`;\n              console.log(`AuthProvider: Created display name from givenName + familyName: ${displayName}`);\n            } else if (fetchedUserDetails.givenName) {\n              displayName = fetchedUserDetails.givenName;\n              console.log(`AuthProvider: Using givenName as display name: ${displayName}`);\n            } else {\n              // Fallback checking for other possible name fields\n              const possibleNameFields = ['displayName', 'name', 'username'];\n              const nameField = possibleNameFields.find(field => \n                field in fetchedUserDetails && !!fetchedUserDetails[field]\n              );\n              \n              if (nameField) {\n                displayName = fetchedUserDetails[nameField];\n                console.log(`AuthProvider: Found name in field '${nameField}': ${displayName}`);\n              } else if (fetchedUserDetails.email && fetchedUserDetails.email.includes('@')) {\n                // Fallback to email without domain\n                displayName = fetchedUserDetails.email.split('@')[0];\n                console.log(`AuthProvider: Using email username as fallback: ${displayName}`);\n              }\n            }\n            \n            // Use our unified method to update all auth state at once\n            updateAuthState(\n              true, \n              fetchedUserDetails, \n              displayName,\n              fetchedUserDetails.email ?? null\n            );\n            // This section has been replaced by the givenName + familyName logic above\n\n            // Store in localStorage for future use\n            try {\n              const userDetailsString = JSON.stringify(fetchedUserDetails);\n              localStorage.setItem('userDetails', userDetailsString);\n              console.log(\"AuthProvider: Stored complete user details in localStorage\");\n            } catch (e) {\n              console.error(\"AuthProvider: Failed to store complete details\", e);\n            }\n          } else {\n            console.warn(\"AuthProvider: Users.getCurrent returned null/undefined.\");\n            \n            // Fallback to token decoding if admin API fails\n            try {\n              if (currentToken) {\n                const tokenParts = currentToken.split('.');\n                if (tokenParts.length === 3) {\n                  const payload = JSON.parse(atob(tokenParts[1]));\n                  console.log(\"AuthProvider: Decoded token payload:\", payload);\n                  console.log(\"AuthProvider: Payload fields:\", Object.keys(payload));\n                  \n                  // Extract user details from token\n                  const extractedUser: UserDetails = {\n                    userId: payload.sub || 'unknown',\n                    email: payload.email || '',\n                    ...payload\n                  };\n                  \n                  // Try to extract given name and family name from token\n                  if (payload.given_name && payload.family_name) {\n                    extractedUser.givenName = payload.given_name;\n                    extractedUser.familyName = payload.family_name;\n                    // Set username to full name\n                    const fullName = `${payload.given_name} ${payload.family_name}`;\n                    setUserName(fullName);\n                    console.log(`AuthProvider: Created token display name from given_name + family_name: ${fullName}`);\n                  } else if (payload.given_name) {\n                    extractedUser.givenName = payload.given_name;\n                    setUserName(payload.given_name);\n                    console.log(`AuthProvider: Using token given_name as display name: ${payload.given_name}`);\n                  } else if (payload.name) {\n                    setUserName(payload.name);\n                    console.log(`AuthProvider: Using token name as display name: ${payload.name}`);\n                  } else if (payload.preferred_username) {\n                    setUserName(payload.preferred_username);\n                    console.log(`AuthProvider: Using token preferred_username as display name: ${payload.preferred_username}`);\n                  } else {\n                    // Fallback to email without domain if no username field found\n                    if (payload.email && payload.email.includes('@')) {\n                      extractedUser.username = payload.email.split('@')[0];\n                      console.log(`AuthProvider: Using email username as fallback: ${extractedUser.username}`);\n                    } else if (payload.sub && payload.sub.includes('@')) {\n                      extractedUser.username = payload.sub.split('@')[0];\n                      console.log(`AuthProvider: Using subject username as fallback: ${extractedUser.username}`);\n                    } else {\n                      extractedUser.username = \"Bristow User\";\n                      console.log(\"AuthProvider: Using default username as fallback\");\n                    }\n                  }\n                  \n                  // Use our unified update method\n                  updateAuthState(\n                    true,\n                    extractedUser,\n                    extractedUser.username || \"Bristow User\",\n                    extractedUser.email || null\n                  );\n                  \n                  // Save to localStorage (our updateAuthState already does this, but keep for backwards compatibility)\n                  localStorage.setItem('userDetails', JSON.stringify(extractedUser));\n                }\n              }\n            } catch (decodeError) {\n              console.error(\"AuthProvider: Error decoding token:\", decodeError);\n            }\n          }\n        } catch (fetchError) {\n          console.error(\"AuthProvider: Error fetching current user details:\", fetchError);\n          console.log(\"AuthProvider: Error type:\", typeof fetchError);\n          console.log(\"AuthProvider: Error message:\", fetchError instanceof Error ? fetchError.message : String(fetchError));\n          console.log(\"AuthProvider: Error stack:\", fetchError instanceof Error ? fetchError.stack : '');\n          \n          // Fallback to token decoding if admin API fails\n          try {\n            if (currentToken) {\n              const tokenParts = currentToken.split('.');\n              if (tokenParts.length === 3) {\n                const payload = JSON.parse(atob(tokenParts[1]));\n                console.log(\"AuthProvider: Token payload fallback:\", payload);\n                console.log(\"AuthProvider: Payload fields:\", Object.keys(payload));\n                \n                // Extract user details from token\n                const extractedUser: UserDetails = {\n                  userId: payload.sub || 'unknown',\n                  email: payload.email || '',\n                  ...payload\n                };\n                \n                // Try to extract given name and family name from token\n                if (payload.given_name && payload.family_name) {\n                  extractedUser.givenName = payload.given_name;\n                  extractedUser.familyName = payload.family_name;\n                  // Set username to full name\n                  const fullName = `${payload.given_name} ${payload.family_name}`;\n                  setUserName(fullName);\n                  console.log(`AuthProvider: Created token display name from given_name + family_name: ${fullName}`);\n                } else if (payload.given_name) {\n                  extractedUser.givenName = payload.given_name;\n                  setUserName(payload.given_name);\n                  console.log(`AuthProvider: Using token given_name as display name: ${payload.given_name}`);\n                } else if (payload.name) {\n                  setUserName(payload.name);\n                  console.log(`AuthProvider: Using token name as display name: ${payload.name}`);\n                } else if (payload.preferred_username) {\n                  setUserName(payload.preferred_username);\n                  console.log(`AuthProvider: Using token preferred_username as display name: ${payload.preferred_username}`);\n                } else {\n                  // Fallback to email without domain if no username field found\n                  if (payload.email && payload.email.includes('@')) {\n                    extractedUser.username = payload.email.split('@')[0];\n                    console.log(`AuthProvider: Using email username as fallback: ${extractedUser.username}`);\n                  } else if (payload.sub && payload.sub.includes('@')) {\n                    extractedUser.username = payload.sub.split('@')[0];\n                    console.log(`AuthProvider: Using subject username as fallback: ${extractedUser.username}`);\n                  } else {\n                    extractedUser.username = \"Bristow User\";\n                    console.log(\"AuthProvider: Using default username as fallback\");\n                  }\n                }\n                \n                // Use our unified update method\n                updateAuthState(\n                  true,\n                  extractedUser,\n                  extractedUser.username || \"Bristow User\",\n                  extractedUser.email || null\n                );\n                \n                // Save to localStorage (our updateAuthState already does this, but keep for backwards compatibility)\n                localStorage.setItem('userDetails', JSON.stringify(extractedUser));\n              }\n            }\n          } catch (decodeError) {\n            console.error(\"AuthProvider: Error decoding token:\", decodeError);\n          }\n        }\n      } else {\n        console.warn(\"AuthProvider: No valid access token found. Clearing state.\");\n        // Clear state if no access token is available\n        setUserDetails(null);\n        setUserEmail(null);\n        setUserName(null);\n        setIsAuthenticated(false);\n        localStorage.removeItem('userDetails');\n      }\n    } catch (error) {\n      console.error(\"AuthProvider: Error during authentication flow:\", error);\n      // Clear state and storage on error\n      setUserDetails(null);\n      setUserEmail(null);\n      setUserName(null);\n      setIsAuthenticated(false);\n      localStorage.removeItem('userDetails');\n    } finally {\n      setIsLoading(false);\n      console.log(\"AuthProvider: Finished auth initialization attempt.\");\n    }\n  };\n\n  // Check authentication status on component mount\n  useEffect(() => {\n    console.log(\"%c=== RUNNING AUTH CHECK ON MOUNT ===\", \n      \"background: #060; color: white; font-weight: bold; padding: 5px;\");\n    \n    // Run the check with a slight delay to ensure everything is initialized\n    setTimeout(() => {\n      try {\n        // Already authenticated from initial check? Just update user details\n        if (isAuthenticated) {\n          console.log(\"%cAlready authenticated, fetching user details\", \n            \"color: #060; font-weight: bold;\");\n          \n          // Try to get user details from the admin API\n          debugAdminUser().catch(err => {\n            console.warn(\"Failed to get user details from admin API:\", err);\n          });\n        } else {\n          // Not yet authenticated, run full check\n          checkAuth();\n        }\n      } catch (error) {\n        console.error(\"Error in auth check:\", error);\n      }\n    }, 200);\n    \n    // Add an event listener for storage changes (in case another tab authenticates)\n    const handleStorageChange = (event) => {\n      if (event && event.key === 'fastPlanner_isAuthenticated' && event.newValue === 'true') {\n        console.log(\"%cAuthentication state changed in another tab/window\", \n          \"background: orange; color: black; font-weight: bold;\");\n        updateAuthState(true, null, \"Duncan Burbury\");\n      }\n    };\n    \n    window.addEventListener('storage', handleStorageChange);\n    \n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, []);\n\n  // Simple login function that matches the working version\n  const login = async () => {\n    console.log(\"%c===== LOGIN FUNCTION CALLED =====\", \"background: #090; color: #fff; font-size: 16px; font-weight: bold;\");\n    try {\n      // Create visual feedback for the user\n      const loadingOverlay = document.getElementById('loading-overlay');\n      if (loadingOverlay) {\n        loadingOverlay.textContent = 'Connecting to Foundry...';\n        loadingOverlay.style.display = 'block';\n      }\n      \n      // This is how the working version does it - direct call to auth.signIn()\n      console.log(\"Calling auth.signIn() directly...\");\n      const signInResult = await auth.signIn();\n      console.log(\"Auth signIn result:\", signInResult);\n      \n      // Show success message\n      if (loadingOverlay) {\n        loadingOverlay.textContent = 'Successfully connected to Foundry!';\n        setTimeout(() => {\n          loadingOverlay.style.display = 'none';\n        }, 1500);\n      }\n      \n      // Set authentication state to true immediately - even before getting user details\n      // This ensures the connection status updates right away\n      updateAuthState(true);\n      console.log(\"%cSetting isAuthenticated to TRUE after successful login\", \n                 \"background: #090; color: #fff; font-weight: bold;\");\n      \n      // Then try to get user details\n      const adminUser = await debugAdminUser();\n      \n      if (!adminUser) {\n        // If debugAdminUser fails, we still want to show as authenticated\n        // but with a generic user name\n        updateAuthState(true, null, \"Bristow User\");\n      }\n      \n      // Force UI update\n      setTimeout(() => {\n        // Add a delayed auth state check to help with any race conditions\n        console.log(\"%cDelayed auth check - state: %s, user: %s\", \n                   \"background: #909; color: #fff; font-weight: bold;\", \n                   isAuthenticated ? \"AUTHENTICATED\" : \"NOT AUTHENTICATED\",\n                   userName || \"None\");\n                   \n        // If somehow we're still not authenticated after all this, try one last time\n        if (!isAuthenticated) {\n          console.log(\"%cEMERGENCY AUTH FIX - forcing authenticated state\", \n                     \"background: #f00; color: #fff; font-weight: bold;\");\n          updateAuthState(true, userDetails || null, userName || \"Bristow User\");\n        }\n      }, 300);\n      \n    } catch (error) {\n      console.error(\"Error during login:\", error);\n      \n      // Show error to user\n      const loadingOverlay = document.getElementById('loading-overlay');\n      if (loadingOverlay) {\n        loadingOverlay.textContent = `Login failed: ${error.message || 'Unknown error'}`;\n        setTimeout(() => {\n          loadingOverlay.style.display = 'none';\n        }, 3000);\n      }\n    }\n  };\n\n  // Simple logout function\n  const logout = () => {\n    console.log(\"%c===== LOGOUT FUNCTION CALLED =====\", \"background: #900; color: #fff; font-size: 16px; font-weight: bold;\");\n    try {\n      // Call the appropriate method on the auth object\n      if (typeof auth.signOut === 'function') {\n        auth.signOut();\n      } else if (typeof auth.logout === 'function') {\n        auth.logout();\n      }\n      \n      // Use our unified method to update all auth state at once\n      updateAuthState(false, null, null, null);\n      \n      // Clean up localStorage (our updateAuthState already does this, but add these for extra safety)\n      localStorage.removeItem('userDetails');\n      localStorage.removeItem('fastPlanner_userDetails');\n      localStorage.removeItem('fastPlanner_isAuthenticated');\n      \n      console.log(\"%cUser logged out successfully\", \"background: #900; color: #fff; font-weight: bold;\");\n    } catch (error) {\n      console.error(\"Error during logout:\", error);\n    }\n  };\n\n  // Log the current state\n  console.log(`AuthProvider: State - isAuthenticated=${isAuthenticated}, userName=${userName}, userEmail=${userEmail}`);\n  \n  // For debugging - print isAuthenticated to a more visible console log\n  console.log(`%cAUTH STATE: ${isAuthenticated ? 'AUTHENTICATED ✅' : 'NOT AUTHENTICATED ❌'} - User: ${userName || 'None'}`, \n    `background: ${isAuthenticated ? '#070' : '#700'}; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold;`);\n\n  return (\n    <AuthContext.Provider value={{ \n      isAuthenticated, \n      userDetails, \n      userEmail,\n      userName,\n      login, \n      logout \n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;","/**\n * WaypointHandler.js\n * \n * A dedicated module to handle waypoints separately from stops\n */\n\nclass WaypointHandler {\n  constructor(mapManager, waypointManager) {\n    this.mapManager = mapManager;\n    this.waypointManager = waypointManager;\n    this.enabled = false;\n    this.map = null;\n    console.log('🟡 WaypointHandler: Created new instance');\n  }\n  \n  /**\n   * Initialize the waypoint handler\n   * @returns {boolean} - Success status\n   */\n  initialize() {\n    console.log('🟡 WaypointHandler: Initializing');\n    \n    // Get the map\n    this.map = this.mapManager.getMap();\n    if (!this.map) {\n      console.error('🟡 WaypointHandler: Map not initialized');\n      return false;\n    }\n    \n    // IMPORTANT: Do NOT add a separate click handler to the map\n    // We'll use the central event dispatcher model instead\n    \n    // Initialize with the current global state if available\n    if (window.isWaypointModeActive === true) {\n      console.log('🟡 WaypointHandler: Initializing in active state to match global flag');\n      this.enabled = true;\n    }\n    \n    console.log('🟡 WaypointHandler: Initialized successfully');\n    return true;\n  }\n  \n  /**\n   * Handle map clicks for waypoints - this method is now called by MapInteractionHandler\n   * @param {Object} e - The click event\n   * @returns {boolean} - Whether the event was handled\n   */\n  handleWaypointClick(e) {\n    // Only process if waypoint mode is enabled\n    if (!this.enabled) {\n      console.log('🟡 WaypointHandler: Not handling click - waypoint mode disabled');\n      return false; // Not handled - let MapInteractionHandler take it\n    }\n    \n    console.log('🟡 WaypointHandler: Handling map click for waypoint');\n    \n    // First check if nearest waypoint is available via platformManager\n    let nearestWaypoint = null;\n    let usedNearestWaypoint = false;\n    \n    try {\n      if (this.waypointManager && this.waypointManager.platformManager &&\n          typeof this.waypointManager.platformManager.findNearestWaypoint === 'function') {\n        nearestWaypoint = this.waypointManager.platformManager.findNearestWaypoint(\n          e.lngLat.lat, \n          e.lngLat.lng,\n          5 // search radius in nautical miles\n        );\n        \n        if (nearestWaypoint) {\n          console.log(`🟡 WaypointHandler: Found nearest waypoint ${nearestWaypoint.name} at distance ${nearestWaypoint.distance.toFixed(2)} nm`);\n          \n          // Use the nearest waypoint instead of the clicked location\n          this.addWaypoint(\n            nearestWaypoint.coordinates, \n            nearestWaypoint.name,\n            { isNearestWaypoint: true }\n          );\n          \n          usedNearestWaypoint = true;\n        }\n      }\n    } catch (error) {\n      console.error('🟡 WaypointHandler: Error finding nearest waypoint:', error);\n    }\n    \n    // If no nearest waypoint was found or used, add one at the clicked location\n    if (!usedNearestWaypoint) {\n      console.log('🟡 WaypointHandler: No nearest waypoint found, adding at clicked location');\n      this.addWaypoint([e.lngLat.lng, e.lngLat.lat]);\n    }\n    \n    // Force redraw of route\n    setTimeout(() => {\n      if (this.waypointManager && this.waypointManager.updateRoute) {\n        this.waypointManager.updateRoute();\n      }\n    }, 50);\n    \n    // Return true to indicate the event was handled\n    return true;\n  }\n  \n  /**\n   * Add a waypoint to the route\n   * @param {Array} coords - [lng, lat] coordinates\n   * @param {string} name - Optional name for the waypoint\n   * @param {Object} options - Additional options\n   */\n  addWaypoint(coords, name, options = {}) {\n    console.log('🟡 WaypointHandler: Adding waypoint at', coords);\n    \n    // Format the name\n    const waypointCount = this.waypointManager.getWaypoints().filter(wp => wp.type === 'WAYPOINT').length;\n    const displayName = name || `Waypoint ${waypointCount + 1}`;\n    \n    // Add the waypoint to the waypointManager with explicit type\n    this.waypointManager.addWaypoint(coords, displayName, {\n      isWaypoint: true,\n      type: 'WAYPOINT',\n      ...options\n    });\n    \n    // Log success\n    console.log('🟡 WaypointHandler: Waypoint added successfully');\n  }\n  \n  /**\n   * Enable or disable waypoint mode\n   * @param {boolean} enabled - Whether to enable waypoint mode\n   */\n  setEnabled(enabled) {\n    console.log(`🟡 WaypointHandler: ${enabled ? 'Enabling' : 'Disabling'} waypoint mode`);\n    \n    // Store the enabled state\n    this.enabled = enabled;\n    \n    // Update the global flag\n    window.isWaypointModeActive = enabled;\n    \n    // Change the cursor to indicate mode\n    if (this.map) {\n      this.map.getCanvas().style.cursor = enabled ? 'crosshair' : '';\n    }\n    \n    // Also add or remove a CSS class to the body to indicate mode\n    if (enabled) {\n      document.body.classList.add('waypoint-mode-active');\n    } else {\n      document.body.classList.remove('waypoint-mode-active');\n    }\n    \n    // Return the new state\n    return this.enabled;\n  }\n  \n  /**\n   * Get the current enabled state\n   * @returns {boolean} - Whether waypoint mode is enabled\n   */\n  isEnabled() {\n    return this.enabled;\n  }\n}\n\nexport default WaypointHandler;","/**\n * separate-mode-handler.js\n * \n * A completely new approach to handling waypoint/normal modes\n * with entirely separate handlers.\n */\n\n/**\n * Creates and returns two completely separate handlers:\n * - normalModeHandler: for regular stops\n * - waypointModeHandler: for waypoints\n * \n * These handlers never modify each other's methods and have\n * completely separate click and event handlers.\n */\nexport function createSeparateHandlers(mapManager, waypointManager, platformManager) {\n  if (!mapManager || !waypointManager || !platformManager) {\n    console.error(\"Cannot create handlers: Missing required managers\");\n    return null;\n  }\n  \n  // Get the map instance\n  const map = mapManager.getMap();\n  if (!map) {\n    console.error(\"Cannot create handlers: Map is not initialized\");\n    return null;\n  }\n  \n  // ============= NORMAL MODE HANDLER =============\n  const normalModeHandler = {\n    active: false,\n    clickHandler: null,\n    dragHandlers: {},\n    \n    // Normal mode click handler - completely separate function\n    handleMapClick: function(e) {\n      console.log('NORMAL MODE: Map click', e.lngLat);\n      \n      // Notify to show left panel\n      if (platformManager.notifyLeftPanelOpen) {\n        platformManager.notifyLeftPanelOpen();\n      }\n      \n      try {\n        // Check if clicking on a platform marker\n        const platformFeatures = map.queryRenderedFeatures(e.point, { \n          layers: [\n            'platforms-fixed-layer', \n            'platforms-movable-layer',\n            'airfields-layer'\n          ] \n        });\n\n        if (platformFeatures && platformFeatures.length > 0) {\n          console.log('NORMAL MODE: Clicked on platform:', platformFeatures[0].properties.name);\n          const props = platformFeatures[0].properties;\n          const coordinates = platformFeatures[0].geometry.coordinates.slice();\n\n          // Add platform as STOP (not waypoint)\n          waypointManager.addWaypoint(coordinates, props.name, {\n            isWaypoint: false,\n            type: 'STOP'\n          });\n          return;\n        }\n      } catch (err) {\n        console.error('NORMAL MODE: Error handling platform click:', err);\n      }\n\n      try {\n        // Check if clicking on the route line\n        const routeFeatures = map.queryRenderedFeatures(e.point, { layers: ['route'] });\n        if (routeFeatures && routeFeatures.length > 0) {\n          console.log('NORMAL MODE: Clicked on route line');\n          \n          // Find where to insert on the path\n          const insertIndex = waypointManager.findPathInsertIndex(e.lngLat);\n\n          // Check for nearest rig\n          const nearestRig = platformManager.findNearestPlatform(e.lngLat.lat, e.lngLat.lng);\n\n          // Add as STOP (not waypoint)\n          if (nearestRig && nearestRig.distance < 5) {\n            waypointManager.addWaypointAtIndex(nearestRig.coordinates, nearestRig.name, insertIndex, {\n              isWaypoint: false,\n              type: 'STOP'\n            });\n          } else {\n            waypointManager.addWaypointAtIndex([e.lngLat.lng, e.lngLat.lat], null, insertIndex, {\n              isWaypoint: false,\n              type: 'STOP'\n            });\n          }\n          return;\n        }\n      } catch (err) {\n        console.error('NORMAL MODE: Error handling route click:', err);\n      }\n\n      // If clicking on map background, add as STOP\n      try {\n        const nearestRig = platformManager.findNearestPlatform(e.lngLat.lat, e.lngLat.lng, 5);\n        \n        if (nearestRig && nearestRig.distance < 5) {\n          console.log(`NORMAL MODE: Using nearest rig: ${nearestRig.name}`);\n          waypointManager.addWaypoint(nearestRig.coordinates, nearestRig.name, {\n            isWaypoint: false,\n            type: 'STOP'\n          });\n        } else {\n          console.log('NORMAL MODE: Adding stop at clicked location');\n          waypointManager.addWaypoint([e.lngLat.lng, e.lngLat.lat], null, {\n            isWaypoint: false,\n            type: 'STOP'\n          });\n        }\n      } catch (err) {\n        console.error('NORMAL MODE: Error handling map background click:', err);\n      }\n    },\n    \n    // Activate normal mode\n    activate: function() {\n      console.log('NORMAL MODE: Activating normal mode');\n      \n      // Skip if already active\n      if (this.active) {\n        console.log('NORMAL MODE: Already active');\n        return true;\n      }\n      \n      try {\n        // Create a bound handler function\n        this.clickHandler = this.handleMapClick.bind(this);\n        \n        // Add the click handler to the map\n        map.on('click', this.clickHandler);\n        \n        // Show platforms\n        if (platformManager && platformManager.toggleWaypointMode) {\n          platformManager.toggleWaypointMode(false);\n        }\n        \n        if (platformManager && platformManager.toggleVisibility) {\n          platformManager.toggleVisibility(true);\n        }\n        \n        // Change cursor back to default\n        map.getCanvas().style.cursor = '';\n        \n        // Mark as active\n        this.active = true;\n        \n        console.log('NORMAL MODE: Normal mode activated');\n        return true;\n      } catch (error) {\n        console.error('NORMAL MODE: Error activating normal mode:', error);\n        return false;\n      }\n    },\n    \n    // Deactivate normal mode\n    deactivate: function() {\n      console.log('NORMAL MODE: Deactivating normal mode');\n      \n      // Skip if already inactive\n      if (!this.active) {\n        console.log('NORMAL MODE: Already inactive');\n        return true;\n      }\n      \n      try {\n        // Remove the click handler\n        if (this.clickHandler) {\n          map.off('click', this.clickHandler);\n          this.clickHandler = null;\n        }\n        \n        // Reset active flag\n        this.active = false;\n        \n        console.log('NORMAL MODE: Normal mode deactivated');\n        return true;\n      } catch (error) {\n        console.error('NORMAL MODE: Error deactivating normal mode:', error);\n        return false;\n      }\n    }\n  };\n  \n  // ============= WAYPOINT MODE HANDLER =============\n  const waypointModeHandler = {\n    active: false,\n    clickHandler: null,\n    dragHandlers: {},\n    \n    // Waypoint mode click handler - completely separate function\n    handleMapClick: function(e) {\n      console.log('WAYPOINT MODE: Map click', e.lngLat);\n      \n      try {\n        // Check if clicking on a waypoint marker\n        const waypointFeatures = map.queryRenderedFeatures(e.point, { \n          layers: ['waypoints-layer'] \n        });\n        \n        if (waypointFeatures && waypointFeatures.length > 0) {\n          console.log('WAYPOINT MODE: Clicked on waypoint marker');\n          const props = waypointFeatures[0].properties;\n          const coordinates = waypointFeatures[0].geometry.coordinates;\n          \n          // Add the waypoint as an actual WAYPOINT\n          waypointManager.addWaypoint(coordinates, props.name || 'Waypoint', {\n            isWaypoint: true,\n            type: 'WAYPOINT'\n          });\n          return;\n        }\n        \n        // Find nearest waypoint to click location\n        const nearestWaypoint = platformManager.findNearestWaypoint(e.lngLat.lat, e.lngLat.lng, 5);\n        \n        if (nearestWaypoint) {\n          console.log(`WAYPOINT MODE: Adding nearest waypoint: ${nearestWaypoint.name}`);\n          \n          // Get coordinates in correct format\n          const coordinates = nearestWaypoint.coordinates || \n                              nearestWaypoint.coords || \n                              [nearestWaypoint.lng, nearestWaypoint.lat];\n          \n          // Add as WAYPOINT\n          waypointManager.addWaypoint(coordinates, nearestWaypoint.name, {\n            isWaypoint: true,\n            type: 'WAYPOINT'\n          });\n        } else {\n          console.log('WAYPOINT MODE: No waypoint found near click location');\n          \n          // Show message to user\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(\n              'No navigation waypoint found near click location. Try clicking on a yellow waypoint.',\n              'warning'\n            );\n          }\n        }\n      } catch (error) {\n        console.error('WAYPOINT MODE: Error handling map click:', error);\n      }\n    },\n    \n    // Waypoint mode route click handler\n    handleRouteClick: function(e) {\n      console.log('WAYPOINT MODE: Route click', e.lngLat);\n      \n      try {\n        // Find closest point on route\n        const routeFeatures = map.queryRenderedFeatures(e.point, { layers: ['route'] });\n        if (!routeFeatures || routeFeatures.length === 0) return;\n        \n        // Find insert index\n        const insertIndex = waypointManager.findPathInsertIndex(e.lngLat);\n        \n        // Find nearest waypoint\n        const nearestWaypoint = platformManager.findNearestWaypoint(e.lngLat.lat, e.lngLat.lng, 5);\n        \n        if (nearestWaypoint) {\n          console.log(`WAYPOINT MODE: Adding waypoint at route: ${nearestWaypoint.name}`);\n          \n          // Get coordinates in correct format\n          const coordinates = nearestWaypoint.coordinates || \n                              nearestWaypoint.coords || \n                              [nearestWaypoint.lng, nearestWaypoint.lat];\n          \n          // Add at specific index as WAYPOINT\n          waypointManager.addWaypointAtIndex(coordinates, nearestWaypoint.name, insertIndex, {\n            isWaypoint: true,\n            type: 'WAYPOINT'\n          });\n        } else {\n          // Show message to user\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(\n              'No navigation waypoint found near route click. Try clicking on a yellow waypoint.',\n              'warning'\n            );\n          }\n        }\n      } catch (error) {\n        console.error('WAYPOINT MODE: Error handling route click:', error);\n      }\n    },\n    \n    // Activate waypoint mode\n    activate: function() {\n      console.log('WAYPOINT MODE: Activating waypoint mode');\n      \n      // Skip if already active\n      if (this.active) {\n        console.log('WAYPOINT MODE: Already active');\n        return true;\n      }\n      \n      try {\n        // Remove any existing click handlers from the map\n        map.off('click');\n        \n        // Load waypoints if not loaded already\n        if (platformManager && platformManager.loadWaypointsFromFoundry) {\n          console.log('WAYPOINT MODE: Loading waypoints from Foundry');\n          \n          // Show loading message\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator('Loading waypoints...', 'info');\n          }\n          \n          // Get the current region from platformManager if available\n          const currentRegion = platformManager.currentRegion || 'NORWAY';\n          \n          // Load waypoints\n          platformManager.loadWaypointsFromFoundry(window.client, currentRegion)\n            .then(() => {\n              console.log('WAYPOINT MODE: Waypoints loaded');\n              \n              // Show success message\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator(\n                  'Waypoints loaded. Click on yellow waypoint dots to add them to your route.',\n                  'success'\n                );\n              }\n            })\n            .catch(error => {\n              console.error('WAYPOINT MODE: Error loading waypoints:', error);\n              \n              // Show error message\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator(\n                  'Error loading waypoints. Please try again.',\n                  'error'\n                );\n              }\n            });\n        }\n        \n        // Hide platforms when in waypoint mode\n        if (platformManager && platformManager.toggleWaypointMode) {\n          platformManager.toggleWaypointMode(true);\n        }\n        \n        if (platformManager && platformManager.toggleVisibility) {\n          platformManager.toggleVisibility(false);\n        }\n        \n        // Create a bound handler function\n        this.clickHandler = this.handleMapClick.bind(this);\n        \n        // Add the click handler to the map\n        map.on('click', this.clickHandler);\n        \n        // Add route click handler\n        map.on('click', 'route', this.handleRouteClick.bind(this));\n        \n        // Change cursor to crosshair for waypoint mode\n        map.getCanvas().style.cursor = 'crosshair';\n        \n        // Mark as active\n        this.active = true;\n        \n        console.log('WAYPOINT MODE: Waypoint mode activated');\n        return true;\n      } catch (error) {\n        console.error('WAYPOINT MODE: Error activating waypoint mode:', error);\n        return false;\n      }\n    },\n    \n    // Deactivate waypoint mode\n    deactivate: function() {\n      console.log('WAYPOINT MODE: Deactivating waypoint mode');\n      \n      // Skip if already inactive\n      if (!this.active) {\n        console.log('WAYPOINT MODE: Already inactive');\n        return true;\n      }\n      \n      try {\n        // Remove the click handlers\n        if (this.clickHandler) {\n          map.off('click', this.clickHandler);\n          this.clickHandler = null;\n        }\n        \n        // Remove route click handler\n        map.off('click', 'route');\n        \n        // Reset cursor\n        map.getCanvas().style.cursor = '';\n        \n        // Reset active flag\n        this.active = false;\n        \n        console.log('WAYPOINT MODE: Waypoint mode deactivated');\n        return true;\n      } catch (error) {\n        console.error('WAYPOINT MODE: Error deactivating waypoint mode:', error);\n        return false;\n      }\n    }\n  };\n  \n  return {\n    normalModeHandler,\n    waypointModeHandler\n  };\n}\n\n/**\n * Toggle between normal and waypoint modes\n * This function doesn't use any flags, it directly activates one handler\n * and deactivates the other.\n */\nexport function toggleMode(handlers, waypointMode) {\n  console.log(`TOGGLE MODE: Switching to ${waypointMode ? 'waypoint' : 'normal'} mode`);\n  \n  if (!handlers || !handlers.normalModeHandler || !handlers.waypointModeHandler) {\n    console.error('TOGGLE MODE: Missing handlers');\n    return false;\n  }\n  \n  try {\n    if (waypointMode) {\n      // First deactivate normal mode\n      handlers.normalModeHandler.deactivate();\n      \n      // Then activate waypoint mode\n      handlers.waypointModeHandler.activate();\n    } else {\n      // First deactivate waypoint mode\n      handlers.waypointModeHandler.deactivate();\n      \n      // Then activate normal mode\n      handlers.normalModeHandler.activate();\n    }\n    \n    console.log(`TOGGLE MODE: Successfully switched to ${waypointMode ? 'waypoint' : 'normal'} mode`);\n    return true;\n  } catch (error) {\n    console.error('TOGGLE MODE: Error toggling mode:', error);\n    return false;\n  }\n}\n\nexport default {\n  createSeparateHandlers,\n  toggleMode\n};\n","/**\n * mode-handler-fix.js\n * \n * Emergency fix for waypoint mode vs normal mode clicking\n * This creates and initializes the handlers directly when imported\n */\n\nimport { createSeparateHandlers, toggleMode } from './separate-mode-handler';\n\nlet handlers = null;\nlet initialized = false;\n\n/**\n * Initialize handlers directly, bypassing React component lifecycle\n * @returns {Object} The handlers object if successful, null if failed\n */\nexport function initializeHandlers() {\n  console.log('MODE HANDLER FIX: Initializing handlers directly');\n  \n  // Use global references created in FastPlannerApp\n  if (!window.mapManager || !window.waypointManager || !window.platformManager) {\n    console.error('MODE HANDLER FIX: Required managers not available globally');\n    return null;\n  }\n  \n  try {\n    // Create handlers using global references\n    handlers = createSeparateHandlers(\n      window.mapManager,\n      window.waypointManager,\n      window.platformManager\n    );\n    \n    if (!handlers) {\n      console.error('MODE HANDLER FIX: Failed to create handlers');\n      return null;\n    }\n    \n    // Activate normal mode by default\n    handlers.waypointModeHandler.deactivate();\n    handlers.normalModeHandler.activate();\n    \n    // Make toggle function available globally\n    window.toggleMapMode = (mode) => {\n      console.log(`MODE HANDLER FIX: Global toggle to ${mode} mode`);\n      return toggleMode(handlers, mode === 'waypoint');\n    };\n    \n    initialized = true;\n    console.log('MODE HANDLER FIX: Handlers initialized successfully');\n    return handlers;\n  } catch (error) {\n    console.error('MODE HANDLER FIX: Error initializing handlers:', error);\n    return null;\n  }\n}\n\n/**\n * Force reinitialization of handlers\n * @returns {Object} The handlers object if successful, null if failed\n */\nexport function reinitializeHandlers() {\n  console.log('MODE HANDLER FIX: Forcing reinitialization');\n  \n  // Clean up existing handlers if possible\n  if (handlers) {\n    try {\n      handlers.normalModeHandler.deactivate();\n      handlers.waypointModeHandler.deactivate();\n    } catch (error) {\n      console.error('MODE HANDLER FIX: Error cleaning up handlers:', error);\n    }\n  }\n  \n  // Reset handlers\n  handlers = null;\n  initialized = false;\n  \n  // Reinitialize\n  return initializeHandlers();\n}\n\n/**\n * Get the current handlers\n * @returns {Object} The handlers object or null if not initialized\n */\nexport function getHandlers() {\n  return handlers;\n}\n\n/**\n * Check if handlers are initialized\n * @returns {boolean} True if initialized, false otherwise\n */\nexport function isInitialized() {\n  return initialized;\n}\n\n// Export the module as default as well\nexport default {\n  initializeHandlers,\n  reinitializeHandlers,\n  getHandlers,\n  isInitialized\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport { createSeparateHandlers, toggleMode } from './separate-mode-handler';\nimport { initializeHandlers, reinitializeHandlers, getHandlers } from './mode-handler-fix';\n\n/**\n * A component that manages separate mode handlers for normal and waypoint mode\n * This completely replaces the old approach that used flags\n * \n * EMERGENCY FIX: Now using direct initialization approach to bypass React lifecycle issues\n */\nconst ModeHandler = ({ \n  mapManagerRef, \n  waypointManagerRef, \n  platformManagerRef, \n  initialMode = 'normal'\n}) => {\n  const [currentMode, setCurrentMode] = useState(initialMode);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const handlersRef = useRef(null);\n  \n  // EMERGENCY FIX: First attempt to directly initialize on component mount\n  useEffect(() => {\n    console.log('🚨 ModeHandler: EMERGENCY FIX - Direct initialization');\n    \n    if (getHandlers()) {\n      console.log('🚨 ModeHandler: Handlers already initialized, using existing handlers');\n      handlersRef.current = getHandlers();\n      setIsInitialized(true);\n      return;\n    }\n    \n    // Initialize with a delay to ensure managers are available\n    setTimeout(() => {\n      console.log('🚨 ModeHandler: Attempting direct initialization after delay');\n      \n      // Check if global managers are available\n      if (window.mapManager && window.waypointManager && window.platformManager) {\n        console.log('🚨 ModeHandler: Global managers available, initializing handlers');\n        \n        // Initialize handlers directly\n        const handlers = initializeHandlers();\n        \n        if (handlers) {\n          console.log('🚨 ModeHandler: Handlers initialized successfully');\n          \n          // Store in ref\n          handlersRef.current = handlers;\n          \n          // Set initial mode\n          if (initialMode === 'waypoint') {\n            window.toggleMapMode('waypoint');\n          } else {\n            window.toggleMapMode('normal');\n          }\n          \n          setIsInitialized(true);\n          \n          // Add an emergency reset button to the DOM\n          const button = document.createElement('button');\n          button.innerText = 'Reset Map Handlers';\n          button.style.position = 'fixed';\n          button.style.bottom = '10px';\n          button.style.left = '10px';\n          button.style.zIndex = '9999';\n          button.style.background = '#ff4136';\n          button.style.color = 'white';\n          button.style.padding = '5px 10px';\n          button.style.border = 'none';\n          button.style.borderRadius = '4px';\n          button.style.cursor = 'pointer';\n          button.onclick = () => {\n            console.log('🚨 EMERGENCY: Reinitializing handlers');\n            reinitializeHandlers();\n            window.LoadingIndicator.updateStatusIndicator('Map handlers reset. Try clicking again.', 'success');\n          };\n          document.body.appendChild(button);\n        } else {\n          console.error('🚨 ModeHandler: Failed to initialize handlers directly');\n        }\n      } else {\n        console.warn('🚨 ModeHandler: Global managers not available after delay');\n        \n        // Try again in 2 seconds\n        setTimeout(() => {\n          console.log('🚨 ModeHandler: Final attempt at initialization');\n          \n          if (window.mapManager && window.waypointManager && window.platformManager) {\n            const handlers = initializeHandlers();\n            \n            if (handlers) {\n              console.log('🚨 ModeHandler: Final initialization successful');\n              handlersRef.current = handlers;\n              setIsInitialized(true);\n            }\n          }\n        }, 2000);\n      }\n    }, 1000);\n  }, [initialMode]);\n  \n  // BACKUP: Also try the original approach as a fallback\n  useEffect(() => {\n    // Skip if already initialized through direct method\n    if (isInitialized) {\n      console.log('🚨 ModeHandler: Skipping React lifecycle initialization, already initialized directly');\n      return;\n    }\n    \n    if (!mapManagerRef?.current || !waypointManagerRef?.current || !platformManagerRef?.current) {\n      console.log('ModeHandler: Waiting for required managers to be initialized');\n      return;\n    }\n    \n    if (!handlersRef.current) {\n      console.log('🚨 ModeHandler: BACKUP - Creating handlers through React lifecycle');\n      \n      // Create separate handlers\n      const handlers = createSeparateHandlers(\n        mapManagerRef.current,\n        waypointManagerRef.current,\n        platformManagerRef.current\n      );\n      \n      // Store handlers in ref\n      handlersRef.current = handlers;\n      \n      // Activate initial mode\n      if (handlers) {\n        console.log(`ModeHandler: Activating initial mode: ${initialMode}`);\n        \n        if (initialMode === 'waypoint') {\n          handlers.normalModeHandler.deactivate();\n          handlers.waypointModeHandler.activate();\n        } else {\n          handlers.waypointModeHandler.deactivate();\n          handlers.normalModeHandler.activate();\n        }\n        \n        // Make toggle function available globally\n        window.toggleMapMode = (mode) => handleToggleMode(mode);\n        \n        setIsInitialized(true);\n      }\n    }\n  }, [mapManagerRef, waypointManagerRef, platformManagerRef, initialMode, isInitialized]);\n  \n  // Expose toggleMode method\n  const handleToggleMode = (targetMode) => {\n    console.log(`🚨 ModeHandler: handleToggleMode called with ${targetMode} mode`);\n    \n    // Try using direct handlers first\n    const directHandlers = getHandlers();\n    if (directHandlers) {\n      console.log('🚨 ModeHandler: Using direct handlers for toggle');\n      \n      // Convert string mode to boolean for our toggle function\n      const waypointMode = targetMode === 'waypoint';\n      \n      // Toggle mode\n      const success = toggleMode(directHandlers, waypointMode);\n      \n      if (success) {\n        setCurrentMode(targetMode);\n        showModeMessage(waypointMode);\n        return true;\n      }\n    }\n    \n    // Fall back to React ref handlers\n    if (!handlersRef.current) {\n      console.error('🚨 ModeHandler: Cannot toggle mode - no handlers available');\n      return false;\n    }\n    \n    // Convert string mode to boolean for our toggle function\n    const waypointMode = targetMode === 'waypoint';\n    \n    // Toggle mode\n    const success = toggleMode(handlersRef.current, waypointMode);\n    \n    if (success) {\n      setCurrentMode(targetMode);\n      showModeMessage(waypointMode);\n    }\n    \n    return success;\n  };\n  \n  // Helper to show mode change message\n  const showModeMessage = (waypointMode) => {\n    if (window.LoadingIndicator) {\n      if (waypointMode) {\n        window.LoadingIndicator.updateStatusIndicator(\n          'Waypoint mode active. Click on yellow waypoints to add them to your route.',\n          'info'\n        );\n      } else {\n        window.LoadingIndicator.updateStatusIndicator(\n          'Normal mode active. Click on the map to add stops.',\n          'info'\n        );\n      }\n    }\n  };\n  \n  return (\n    <div style={{ display: 'none' }}>\n      {/* This component doesn't render anything, it just manages the handlers */}\n      \n      {/* Show status as a debug element */}\n      <div style={{ \n        position: 'fixed', \n        top: '10px', \n        left: '10px', \n        background: 'rgba(0,0,0,0.7)', \n        color: 'white',\n        padding: '5px',\n        borderRadius: '3px',\n        fontSize: '10px',\n        zIndex: 9999,\n        display: 'none' // Hidden by default\n      }}>\n        Mode: {currentMode} | Initialized: {isInitialized ? 'Yes' : 'No'}\n      </div>\n    </div>\n  );\n};\n\nexport default ModeHandler;\n","import React, { useState, useEffect, useRef } from 'react';\n\n/**\n * Left Panel Component\n * \n * Displays and manages the route's waypoints/stops list and route controls\n */\nconst LeftPanel = ({ \n  visible, \n  waypoints, \n  onRemoveWaypoint, \n  onWaypointNameChange,\n  onAddWaypoint,\n  onToggleVisibility,\n  routeInput,\n  onRouteInputChange,\n  favoriteLocations, // Receive favorite locations\n  onAddFavoriteLocation, // Receive add favorite function\n  onRemoveFavoriteLocation, // Receive remove favorite function\n  onReorderWaypoints, // Receive reorder waypoints function\n  onClearRoute, // Added for clear route button\n  onToggleChart, // Added for toggle rigs button\n  chartsVisible, // Added for toggle rigs button state\n  onToggleWaypointMode, // Handler for the \"Add Insert Waypoints\" button\n  waypointModeActive // State to track if waypoint insertion mode is active\n}) => {\n  // Keep track of recently added waypoint IDs for highlighting\n  const [recentWaypoints, setRecentWaypoints] = useState({});\n  const prevWaypointsRef = useRef([]);\n  \n  // Keep track of recently added favorite locations for highlighting\n  const [recentFavorites, setRecentFavorites] = useState({});\n  const prevFavoritesRef = useRef([]);\n  \n  // Internal state for favorites to ensure UI updates even if parent state doesn't\n  const [internalFavorites, setInternalFavorites] = useState([]);\n  \n  // Keep internal favorites in sync with props\n  useEffect(() => {\n    console.log(\"LeftPanel: favoriteLocations prop changed:\", favoriteLocations.length);\n    setInternalFavorites(favoriteLocations);\n  }, [favoriteLocations]);\n  \n  // Debug output for favorites changes\n  useEffect(() => {\n    console.log(\"LeftPanel: Internal favorites updated:\", internalFavorites.length);\n  }, [internalFavorites]);\n  \n  // Check for newly added favorites\n  useEffect(() => {\n    // Skip first render\n    if (prevFavoritesRef.current.length === 0 && favoriteLocations.length > 0) {\n      prevFavoritesRef.current = favoriteLocations.map(fav => fav.id);\n      return;\n    }\n    \n    // Find favorites that weren't in the previous list\n    const prevIds = new Set(prevFavoritesRef.current);\n    const newFavorites = favoriteLocations.filter(fav => !prevIds.has(fav.id));\n    \n    // If we found new favorites, highlight them\n    if (newFavorites.length > 0) {\n      console.log(`Found ${newFavorites.length} new favorites to highlight`);\n      \n      const updates = {};\n      newFavorites.forEach(fav => {\n        updates[fav.id] = Date.now();\n        \n        // Schedule removal of highlight\n        setTimeout(() => {\n          setRecentFavorites(prev => {\n            const updated = { ...prev };\n            delete updated[fav.id];\n            return updated;\n          });\n        }, 2100); // Slightly longer than animation duration (2s)\n      });\n      \n      // Update the highlight state\n      setRecentFavorites(prev => ({\n        ...prev,\n        ...updates\n      }));\n    }\n    \n    // Update reference to current favorites\n    prevFavoritesRef.current = favoriteLocations.map(fav => fav.id);\n  }, [favoriteLocations]);\n  \n  // Check for newly added waypoints by comparing current and previous lists by ID\n  useEffect(() => {\n    // Skip first render\n    if (prevWaypointsRef.current.length === 0 && waypoints.length > 0) {\n      prevWaypointsRef.current = waypoints.map(wp => wp.id);\n      return;\n    }\n    \n    // Find waypoints that weren't in the previous list\n    const prevIds = new Set(prevWaypointsRef.current);\n    const newWaypoints = waypoints.filter(wp => !prevIds.has(wp.id));\n    \n    // If we found new waypoints, highlight them\n    if (newWaypoints.length > 0) {\n      console.log(`Found ${newWaypoints.length} new waypoints to highlight`);\n      \n      const updates = {};\n      newWaypoints.forEach(wp => {\n        updates[wp.id] = Date.now();\n        \n        // Schedule removal of highlight\n        setTimeout(() => {\n          setRecentWaypoints(prev => {\n            const updated = { ...prev };\n            delete updated[wp.id];\n            return updated;\n          });\n        }, 2100); // Slightly longer than animation duration (2s)\n      });\n      \n      // Update the highlight state\n      setRecentWaypoints(prev => ({\n        ...prev,\n        ...updates\n      }));\n    }\n    \n    // Update reference to current waypoints\n    prevWaypointsRef.current = waypoints.map(wp => wp.id);\n  }, [waypoints]);\n  \n  // Check if a waypoint was recently added and should be highlighted\n  const isRecentlyAdded = (waypointId) => {\n    return !!recentWaypoints[waypointId];\n  };\n  \n  const handleDragStart = (e, id) => {\n    e.dataTransfer.setData(\"text/plain\", id);\n    e.currentTarget.classList.add(\"dragging\");\n  };\n  \n  const handleDragEnd = (e) => {\n    e.currentTarget.classList.remove(\"dragging\");\n  };\n  \n  const handleDragOver = (e) => {\n    e.preventDefault();\n  };\n  \n  const handleDragEnter = (e) => {\n    e.preventDefault();\n    e.currentTarget.classList.add(\"drag-over\");\n  };\n  \n  const handleDragLeave = (e) => {\n    e.currentTarget.classList.remove(\"drag-over\");\n  };\n  \n  const handleDrop = (e, targetId, targetIndex) => {\n    e.preventDefault();\n    e.currentTarget.classList.remove(\"drag-over\");\n    \n    const draggedId = e.dataTransfer.getData(\"text/plain\");\n    \n    if (draggedId !== targetId) {\n      // Find source index\n      const sourceIndex = waypoints.findIndex(wp => wp.id === draggedId);\n      \n      console.log(`LeftPanel: Reordering waypoint from index ${sourceIndex} to ${targetIndex}`);\n      \n      // In our waypoint manager, we need source and target waypoint IDs, not just indices\n      const sourceId = draggedId;\n      const targetId = waypoints[targetIndex]?.id;\n      \n      // If the parent component provided a reorder function, call it\n      if (onReorderWaypoints && sourceId && targetId) {\n        console.log(`LeftPanel: Calling onReorderWaypoints with sourceId=${sourceId}, targetId=${targetId}`);\n        onReorderWaypoints(sourceId, targetId);\n      } else {\n        console.log(`LeftPanel: Missing onReorderWaypoints function or invalid IDs`);\n        \n        // Fallback: try to simulate reordering by removing and adding at new index\n        if (onRemoveWaypoint && onAddWaypoint && sourceIndex !== -1) {\n          // Get the waypoint's data before removing\n          const movedWaypoint = waypoints[sourceIndex];\n          \n          // Remove from original position\n          onRemoveWaypoint(sourceId, sourceIndex);\n          \n          // If we have the coordinates, add it at the new position\n          // Note: This is a fallback that won't work well with multiple users\n          if (movedWaypoint && movedWaypoint.coords) {\n            setTimeout(() => {\n              // Add at new position - not ideal as it creates a new waypoint\n              onAddWaypoint({\n                coordinates: movedWaypoint.coords,\n                name: movedWaypoint.name\n              });\n            }, 10);\n          }\n        }\n      }\n    }\n  };\n  \n  const handleKeyPress = (e) => {\n    if (e.key === \"Enter\" && routeInput.trim() !== \"\") {\n      if (onAddWaypoint) {\n        console.log('LeftPanel: Enter key pressed with input:', routeInput.trim());\n        onAddWaypoint(routeInput.trim());\n        \n        // Clear the input field after search attempt\n        if (onRouteInputChange) {\n          onRouteInputChange('');\n        }\n      }\n    }\n  };\n  \n  return (\n    <>\n      {/* Left panel toggle tab - with horizontal > and < markers */}\n      <div \n        className=\"panel-tab left-panel-tab main-toggle tab-selector\" \n        style={{ position: 'fixed', top: '50px', left: '0', zIndex: '20', height: '24px', width: '24px', writingMode: 'horizontal-tb', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\n        onClick={onToggleVisibility}\n      >\n        {visible ? '<' : '>'}\n      </div>\n      \n      {/* Route Editor Panel */}\n      <div className={`route-editor-panel ${!visible ? \"hidden\" : \"\"}`}>\n        <h3>Flight Stops</h3>\n        <p style={{ fontSize: '0.8em', color: 'var(--label-color)', margin: '0 0 10px 0' }}>\n          Click map to add stops or enter names below\n        </p>\n        \n        <div id=\"stops-container\">\n          {waypoints.map((waypoint, index) => (\n            <div \n              className={`stop-entry ${isRecentlyAdded(waypoint.id) ? 'highlight-new' : ''}`}\n              key={waypoint.id} \n              data-id={waypoint.id} \n              data-waypoint={waypoint.isWaypoint === true || waypoint.type === 'WAYPOINT' ? 'true' : 'false'}\n              draggable={true}\n              onDragStart={(e) => handleDragStart(e, waypoint.id)}\n              onDragEnd={handleDragEnd}\n              onDragOver={handleDragOver}\n              onDragEnter={handleDragEnter}\n              onDragLeave={handleDragLeave}\n              onDrop={(e) => handleDrop(e, waypoint.id, index)}\n            >\n              <input \n                type=\"text\" \n                value={waypoint.name || `${waypoint.isWaypoint || waypoint.type === 'WAYPOINT' ? 'WP' : 'Stop'} ${index + 1}`}\n                onChange={(e) => {\n                  if (onWaypointNameChange) {\n                    onWaypointNameChange(waypoint.id, e.target.value);\n                  }\n                }}\n              />\n              <div className=\"coordinates\">\n                Lat: {waypoint.coords[1].toFixed(5)}, Lon: {waypoint.coords[0].toFixed(5)}\n              </div>\n              <div className=\"stop-controls\">\n                <div \n                  className=\"favorite-button\" \n                  title=\"Add to favorites\"\n                  onClick={() => {\n                    if (onAddFavoriteLocation) {\n                      const locationName = waypoint.name || `Stop ${index + 1}`;\n                      const newLocation = { \n                        name: locationName, \n                        coords: waypoint.coords \n                      };\n                      \n                      // Add directly to internal state for immediate UI update\n                      // Generate a temporary ID for display purposes\n                      const tempId = `${locationName.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${Date.now()}`;\n                      const tempLocation = {\n                        ...newLocation,\n                        id: tempId\n                      };\n                      \n                      // Update internal state immediately\n                      setInternalFavorites(prev => [...prev, tempLocation]);\n                      \n                      // Also call the parent handler\n                      if (onAddFavoriteLocation) {\n                        onAddFavoriteLocation(newLocation);\n                      }\n                      \n                      // Show success message\n                      const message = `Added ${locationName} to favorites`;\n                      // Create a toast-style notification instead of using the loading overlay\n                      const toast = document.createElement('div');\n                      toast.style.position = 'fixed';\n                      toast.style.bottom = '20px';\n                      toast.style.left = '50%';\n                      toast.style.transform = 'translateX(-50%)';\n                      toast.style.backgroundColor = 'rgba(0, 200, 83, 0.9)';\n                      toast.style.color = 'white';\n                      toast.style.padding = '10px 20px';\n                      toast.style.borderRadius = '5px';\n                      toast.style.zIndex = '1000';\n                      toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';\n                      toast.textContent = message;\n                      document.body.appendChild(toast);\n                      \n                      // Remove after 1.5 seconds\n                      setTimeout(() => {\n                        document.body.removeChild(toast);\n                      }, 1500);\n                    }\n                  }}\n                  style={{ \n                    color: \"#ff5e85\", \n                    fontSize: \"16px\",\n                    padding: \"3px 6px\",\n                    borderRadius: \"4px\",\n                    transition: \"all 0.2s ease\"\n                  }}\n                  onMouseOver={(e) => {\n                    e.currentTarget.style.backgroundColor = \"rgba(255,94,133,0.15)\";\n                    e.currentTarget.style.transform = \"scale(1.2)\";\n                  }}\n                  onMouseOut={(e) => {\n                    e.currentTarget.style.backgroundColor = \"transparent\";\n                    e.currentTarget.style.transform = \"scale(1)\";\n                  }}\n                >❤️</div>\n                <div className=\"drag-handle\">☰</div>\n                <div \n                  className=\"remove-stop\" \n                  onClick={() => {\n                    if (onRemoveWaypoint) {\n                      console.log(`LeftPanel: Removing waypoint at index ${index} with ID ${waypoint.id}`);\n                      onRemoveWaypoint(waypoint.id, index);\n                    }\n                  }}\n                >✖</div>\n              </div>\n            </div>\n          ))}\n        </div>\n        \n        {/* Add Stop by Name Input */}\n        <div style={{ marginTop: \"10px\" }}>\n          <div style={{ display: \"flex\", alignItems: \"center\" }}>\n            <input \n              type=\"text\" \n              className=\"route-input\"\n              placeholder=\"Enter rig name or waypoint\"\n              style={{ \n                flex: 1, \n                marginRight: \"5px\", \n                marginBottom: 0, \n                height: \"36px\"\n              }}\n              value={routeInput}\n              onChange={(e) => {\n                if (onRouteInputChange) {\n                  onRouteInputChange(e.target.value);\n                }\n              }}\n              onKeyPress={handleKeyPress}\n            />\n            <button \n              className=\"control-button\" \n              style={{\n                marginTop: 0,\n                height: \"36px\",\n                padding: \"0 15px\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\"\n              }}\n              onClick={() => {\n                if (onAddWaypoint && routeInput.trim()) {\n                  console.log('LeftPanel: Add button clicked with input:', routeInput.trim());\n                  onAddWaypoint(routeInput.trim());\n                  // Clear the input field after adding\n                  if (onRouteInputChange) {\n                    onRouteInputChange('');\n                  }\n                }\n              }}\n            >\n              Add\n            </button>\n          </div>\n        </div>\n        \n        {/* Add Insert Waypoints Button - Full Width */}\n        <div style={{ width: \"100%\", marginTop: \"10px\", marginBottom: \"7px\" }}>\n          <button \n            id=\"add-waypoints\" \n            className={`control-button ${waypointModeActive ? 'active' : ''}`}\n            style={{\n              width: \"100%\",\n              padding: \"6px 0\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              fontSize: \"14px\",\n              height: \"32px\",\n              backgroundColor: waypointModeActive ? \"#00cc66\" : \"#0066cc\",\n              color: \"white\",\n              fontWeight: waypointModeActive ? \"bold\" : \"normal\",\n              border: waypointModeActive ? \"2px solid #ffcc00\" : \"none\"\n            }}\n            onClick={() => {\n              if (onToggleWaypointMode) {\n                onToggleWaypointMode(!waypointModeActive);\n              }\n            }}\n          >\n            {waypointModeActive ? \n              \"✅ WAYPOINT MODE ACTIVE\" : \n              \"Add Insert Waypoints\"}\n          </button>\n        </div>\n\n        {/* Route Control Buttons - Full Width Side by Side */}\n        <div style={{ \n          display: \"flex\", \n          width: \"100%\", \n          gap: \"7px\",\n        }}>\n          <button \n            id=\"clear-route\" \n            className=\"control-button\" \n            onClick={onClearRoute}\n            style={{\n              flex: 1,\n              padding: \"6px 0\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              fontSize: \"14px\",\n              height: \"32px\"\n            }}\n          >\n            Clear Route\n          </button>\n          <button \n            id=\"toggle-chart\" \n            className=\"control-button\" \n            onClick={onToggleChart}\n            style={{\n              flex: 1,\n              padding: \"6px 0\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              fontSize: \"14px\",\n              height: \"32px\"\n            }}\n          >\n            {chartsVisible ? 'Hide Rigs' : 'Show Rigs'}\n          </button>\n        </div>\n        \n        {/* Favorite Locations Section */}\n        <div style={{ marginTop: \"20px\" }}>\n          <h4>Favorite Locations</h4>\n          {/* Input for adding new favorite location */}\n          <div style={{ marginBottom: \"15px\" }}>\n            <p style={{ fontSize: '0.8em', color: 'var(--label-color)', margin: '0 0 5px 0' }}>\n              Click the heart icon ❤️ next to a waypoint or in any popup to add to favorites\n            </p>\n            <p style={{ \n              fontSize: '0.8em', \n              color: 'var(--accent-cyan)', \n              margin: '0 0 5px 0',\n              padding: '6px',\n              backgroundColor: 'rgba(0,123,255,0.1)',\n              borderRadius: '3px',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between'\n            }}>\n              <span>\n                <strong>{internalFavorites.length}</strong> favorites in this region\n              </span>\n              <button \n                style={{\n                  marginLeft: '5px',\n                  padding: '2px 5px',\n                  fontSize: '0.9em',\n                  backgroundColor: 'var(--button-bg)',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '3px',\n                  cursor: 'pointer'\n                }}\n                onClick={() => {\n                  const debugInfo = document.getElementById('favorites-debug-info');\n                  if (debugInfo) {\n                    debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';\n                  }\n                }}\n              >\n                Debug\n              </button>\n            </p>\n            <div \n              id=\"favorites-debug-info\" \n              style={{ \n                display: 'none', \n                fontSize: '0.7em', \n                backgroundColor: '#1a1a1a',\n                border: '1px solid var(--border-color)',\n                padding: '5px',\n                maxHeight: '150px',\n                overflowY: 'auto',\n                marginBottom: '5px',\n                whiteSpace: 'pre-wrap'\n              }}\n            >\n              <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>Debug Info:</div>\n              {favoriteLocations.map((loc, index) => (\n                <div key={index} style={{ marginBottom: '5px', borderBottom: '1px dotted #333' }}>\n                  <div>Index: {index}</div>\n                  <div>ID: {loc.id || 'undefined'}</div>\n                  <div>Name: {loc.name || 'unnamed'}</div>\n                  <div>Coords: {loc.coords ? `[${loc.coords.join(', ')}]` : 'invalid'}</div>\n                </div>\n              ))}\n              <button \n                style={{\n                  padding: '3px 8px',\n                  fontSize: '0.9em',\n                  backgroundColor: 'var(--danger-color)',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '3px',\n                  cursor: 'pointer',\n                  marginTop: '5px'\n                }}\n                onClick={() => {\n                  try {\n                    localStorage.removeItem('fastPlannerFavorites');\n                    alert('Favorites cleared from localStorage! Refresh the page to see changes.');\n                  } catch (e) {\n                    alert('Error clearing favorites: ' + e.message);\n                  }\n                }}\n              >\n                Clear All Favorites\n              </button>\n            </div>\n            \n            <div style={{ display: \"flex\", marginTop: \"10px\", alignItems: \"center\" }}>\n              <input\n                type=\"text\"\n                className=\"route-input\"\n                placeholder=\"Or manually add: Name, Lat, Lon\"\n                style={{ \n                  flex: 1, \n                  marginRight: \"5px\", \n                  marginBottom: 0, \n                  height: \"36px\" \n                }}\n                onKeyPress={(e) => {\n                  if (e.key === \"Enter\" && e.target.value.trim() !== \"\") {\n                    const input = e.target.value.trim();\n                    const parts = input.split(',').map(part => part.trim());\n                    if (parts.length === 3 && !isNaN(parts[1]) && !isNaN(parts[2])) {\n                      const name = parts[0];\n                      const coords = [parseFloat(parts[2]), parseFloat(parts[1])]; // Lon, Lat\n                      const newLocation = { name, coords };\n                      \n                      // Add directly to internal state for immediate UI update\n                      // Generate a temporary ID for display purposes\n                      const tempId = `${name.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${Date.now()}`;\n                      const tempLocation = {\n                        ...newLocation,\n                        id: tempId\n                      };\n                      \n                      // Update internal state immediately\n                      setInternalFavorites(prev => [...prev, tempLocation]);\n                      \n                      // Also call the parent handler\n                      if (onAddFavoriteLocation) {\n                        onAddFavoriteLocation(newLocation);\n                      }\n                      \n                      // Show success message with toast notification\n                      const message = `Added ${name} to favorites`;\n                      const toast = document.createElement('div');\n                      toast.style.position = 'fixed';\n                      toast.style.bottom = '20px';\n                      toast.style.left = '50%';\n                      toast.style.transform = 'translateX(-50%)';\n                      toast.style.backgroundColor = 'rgba(0, 200, 83, 0.9)';\n                      toast.style.color = 'white';\n                      toast.style.padding = '10px 20px';\n                      toast.style.borderRadius = '5px';\n                      toast.style.zIndex = '1000';\n                      toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';\n                      toast.textContent = message;\n                      document.body.appendChild(toast);\n                      \n                      // Remove after 1.5 seconds\n                      setTimeout(() => {\n                        document.body.removeChild(toast);\n                      }, 1500);\n                    } else {\n                      alert(\"Invalid format. Please use 'Name, Lat, Lon'.\");\n                    }\n                  }\n                }}\n              />\n              <button\n                className=\"control-button\"\n                style={{\n                  marginTop: 0,\n                  height: \"36px\",\n                  padding: \"0 15px\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\"\n                }}\n                onClick={() => {\n                  const inputElement = document.querySelector('.route-editor-panel input[placeholder=\"Or manually add: Name, Lat, Lon\"]');\n                  if (inputElement && inputElement.value.trim() !== \"\") {\n                    const input = inputElement.value.trim();\n                    const parts = input.split(',').map(part => part.trim());\n                    if (parts.length === 3 && !isNaN(parts[1]) && !isNaN(parts[2])) {\n                      const name = parts[0];\n                      const coords = [parseFloat(parts[2]), parseFloat(parts[1])]; // Lon, Lat\n                      const newLocation = { name, coords };\n                      \n                      // Add directly to internal state for immediate UI update\n                      // Generate a temporary ID for display purposes\n                      const tempId = `${name.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${Date.now()}`;\n                      const tempLocation = {\n                        ...newLocation,\n                        id: tempId\n                      };\n                      \n                      // Update internal state immediately\n                      setInternalFavorites(prev => [...prev, tempLocation]);\n                      \n                      // Also call the parent handler\n                      if (onAddFavoriteLocation) {\n                        onAddFavoriteLocation(newLocation);\n                      }\n                      \n                      // Show success message with toast notification\n                      const message = `Added ${name} to favorites`;\n                      const toast = document.createElement('div');\n                      toast.style.position = 'fixed';\n                      toast.style.bottom = '20px';\n                      toast.style.left = '50%';\n                      toast.style.transform = 'translateX(-50%)';\n                      toast.style.backgroundColor = 'rgba(0, 200, 83, 0.9)';\n                      toast.style.color = 'white';\n                      toast.style.padding = '10px 20px';\n                      toast.style.borderRadius = '5px';\n                      toast.style.zIndex = '1000';\n                      toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';\n                      toast.textContent = message;\n                      document.body.appendChild(toast);\n                      \n                      // Remove after 1.5 seconds\n                      setTimeout(() => {\n                        document.body.removeChild(toast);\n                      }, 1500);\n                    } else {\n                      alert(\"Invalid format. Please use 'Name, Lat, Lon'.\");\n                    }\n                  }\n                }}\n              >\n                Add\n              </button>\n            </div>\n          </div>\n          <div style={{ fontSize: \"0.85em\" }}>\n            {favoriteLocations.map((location, index) => {\n              // Ensure each location has an ID (use index as fallback)\n              const locationId = location.id || `favorite-${index}`;\n              \n              return (\n                <div\n                  key={locationId}\n                  className={`favorite-item ${recentFavorites[locationId] ? 'highlight-new' : ''}`}\n                  style={{ \n                    display: \"flex\", \n                    alignItems: \"center\", \n                    padding: \"5px 3px\",\n                    marginBottom: \"4px\",\n                    borderRadius: \"4px\",\n                    backgroundColor: \"rgba(0,0,0,0.1)\",\n                    transition: \"background-color 0.2s\"\n                  }}\n                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = \"rgba(0,0,0,0.2)\"}\n                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = \"rgba(0,0,0,0.1)\"}\n                >\n                  <span\n                    onClick={() => {\n                      if (onAddWaypoint && location.coords && location.coords.length === 2) {\n                        // Pass location object format compatible with addWaypoint\n                        onAddWaypoint({\n                          coordinates: location.coords,\n                          name: location.name\n                        });\n                        \n                        // Show a success message with a toast instead of overlay\n                        const message = `Added ${location.name} to route`;\n                        const toast = document.createElement('div');\n                        toast.style.position = 'fixed';\n                        toast.style.bottom = '20px';\n                        toast.style.left = '50%';\n                        toast.style.transform = 'translateX(-50%)';\n                        toast.style.backgroundColor = 'rgba(0, 123, 255, 0.9)';\n                        toast.style.color = 'white';\n                        toast.style.padding = '10px 20px';\n                        toast.style.borderRadius = '5px';\n                        toast.style.zIndex = '1000';\n                        toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';\n                        toast.textContent = message;\n                        document.body.appendChild(toast);\n                        \n                        // Remove after 1.5 seconds\n                        setTimeout(() => {\n                          document.body.removeChild(toast);\n                        }, 1500);\n                      }\n                    }}\n                    style={{ \n                      cursor: \"pointer\", \n                      flexGrow: 1, \n                      marginRight: \"10px\", \n                      display: \"flex\", \n                      alignItems: \"center\",\n                      overflow: \"hidden\",\n                      whiteSpace: \"nowrap\",\n                      textOverflow: \"ellipsis\"\n                    }}\n                  >\n                    <span style={{ marginRight: \"8px\", fontSize: \"14px\", color: \"#ff5e85\" }}>❤️</span>\n                    <span style={{ \n                      display: \"flex\", \n                      alignItems: \"center\", \n                      minWidth: 0,\n                      overflow: \"hidden\",\n                      textOverflow: \"ellipsis\"\n                    }}>\n                      <strong style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}>{location.name}</strong>\n                      {location.coords && location.coords.length === 2 ? (\n                        <span style={{ \n                          fontSize: \"11px\", \n                          color: \"var(--label-color)\", \n                          marginLeft: \"5px\",\n                          whiteSpace: \"nowrap\" \n                        }}>\n                          ({location.coords[1].toFixed(3)}, {location.coords[0].toFixed(3)})\n                        </span>\n                      ) : (\n                        <span style={{ \n                          fontSize: \"11px\", \n                          color: \"var(--danger-color)\", \n                          marginLeft: \"5px\",\n                          whiteSpace: \"nowrap\" \n                        }}>\n                          (Invalid coordinates)\n                        </span>\n                      )}\n                    </span>\n                  </span>\n                  <div\n                    className=\"remove-stop\" // Reusing class for styling\n                    onClick={(e) => {\n                      e.stopPropagation(); // Prevent triggering the parent onClick\n                      if (onRemoveFavoriteLocation) {\n                        console.log(\"Removing favorite with ID:\", locationId);\n                        onRemoveFavoriteLocation(locationId);\n                      }\n                    }}\n                    style={{ \n                      cursor: \"pointer\", \n                      fontSize: \"1em\", \n                      padding: \"5px 8px\",\n                      color: \"var(--danger-color)\",\n                      borderRadius: \"4px\",\n                      marginLeft: \"auto\",\n                      transition: \"all 0.2s\"\n                    }}\n                    onMouseOver={(e) => e.currentTarget.style.backgroundColor = \"rgba(255,0,0,0.15)\"}\n                    onMouseOut={(e) => e.currentTarget.style.backgroundColor = \"transparent\"}\n                  >\n                    ✖\n                  </div>\n                </div>\n              );\n            })}\n            {favoriteLocations.length === 0 && (\n              <div style={{ \n                padding: \"10px\", \n                textAlign: \"center\", \n                fontSize: \"0.9em\",\n                color: \"var(--label-color)\",\n                fontStyle: \"italic\",\n                backgroundColor: \"rgba(0,0,0,0.2)\",\n                borderRadius: \"5px\"\n              }}>\n                No favorites added yet\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default LeftPanel;\n","import React, { useState, useRef, useEffect } from 'react';\nimport '../../FastPlannerStyles.css';\nimport '../../animationFixes.css';\n\n/**\n * RightPanelContainer\n * \n * Container component that manages which card is visible in the right panel\n * and handles the sliding animations between cards.\n * \n * This version uses CSS animations to slide entire cards:\n * - Current card slides out to the left\n * - New card slides in from the right\n */\nconst RightPanelContainer = React.forwardRef(({\n  visible,\n  onToggleVisibility,\n  children, // All card components will be passed as children\n  initialActiveCard = 'main' // Default to main card\n}, ref) => {\n  // State for active card\n  const [activeCard, setActiveCard] = useState(initialActiveCard);\n  \n  // State for animation\n  const [isAnimating, setIsAnimating] = useState(false);\n  const [currentCard, setCurrentCard] = useState(initialActiveCard);\n  const [nextCard, setNextCard] = useState(null);\n  const [animationState, setAnimationState] = useState('idle'); // 'idle', 'exit', 'enter'\n  \n  // Reference to the panel element\n  const panelRef = useRef(null);\n  \n  // Define the available tabs/cards\n  const cards = [\n    { id: 'main', name: 'Main' },\n    { id: 'settings', name: 'Settings' },\n    { id: 'performance', name: 'Performance' },\n    { id: 'weather', name: 'Weather' },\n    { id: 'finance', name: 'Finance' },\n    { id: 'evacuation', name: 'Evacuation' },\n    { id: 'saveflight', name: 'Save Flight', hidden: true }, // Hidden card for Save Flight\n    { id: 'loadflights', name: 'Load Flights', hidden: true } // Hidden card for Load Flights\n  ];\n  \n  // Filter children to get the current active card\n  const getActiveChild = () => {\n    const childrenArray = React.Children.toArray(children);\n    return childrenArray.find(child => child.props.id === currentCard) || null;\n  };\n  \n  // Filter children to get the next card (when animating)\n  const getNextChild = () => {\n    if (!nextCard) return null;\n    const childrenArray = React.Children.toArray(children);\n    return childrenArray.find(child => child.props.id === nextCard) || null;\n  };\n  \n  // Handle card change with animation\n  const handleCardChange = (cardId) => {\n    // Add debugging to trace card change requests\n    console.log(`RightPanelContainer: handleCardChange called with cardId=${cardId}, currentCard=${currentCard}, activeCard=${activeCard}, isAnimating=${isAnimating}`);\n    \n    // Don't do anything if clicking the current active tab or if animation is in progress\n    if (activeCard === cardId || isAnimating) return;\n    \n    // Start the animation sequence\n    setIsAnimating(true);\n    setAnimationState('exit');\n    setActiveCard(cardId);\n    setNextCard(cardId);\n    \n    // Apply the exit animation (slide to right)\n    if (panelRef.current) {\n      panelRef.current.style.animation = 'slideOutToRight 0.4s cubic-bezier(0.34, 0.95, 0.67, 0.99) forwards';\n    }\n    \n    // After exit animation completes, switch cards and start entrance animation\n    setTimeout(() => {\n      setCurrentCard(cardId);\n      setAnimationState('enter');\n      \n      // Apply the enter animation (slide from right)\n      if (panelRef.current) {\n        panelRef.current.style.animation = 'slideInFromRight 0.5s cubic-bezier(0.34, 0.95, 0.67, 0.99) forwards';\n      }\n      \n      // Reset animation state after entrance animation completes\n      setTimeout(() => {\n        setAnimationState('idle');\n        setIsAnimating(false);\n        setNextCard(null);\n      }, 400);\n    }, 400);\n  };\n  \n  // Expose the handleCardChange method through the ref\n  React.useImperativeHandle(ref, () => ({\n    handleCardChange\n  }));\n  \n  return (\n    <>\n      {/* Right panel toggle tab */}\n      <div \n        className=\"panel-tab right-panel-tab main-toggle tab-selector\" \n        style={{ top: '50px' }}\n        onClick={onToggleVisibility}\n      >\n        {visible ? 'Hide →' : '← Show'}\n      </div>\n      \n      {/* Tab/Card Selectors */}\n      {visible && cards.map((card, index) => !card.hidden && (\n        <div \n          key={card.id}\n          className={`panel-tab right-panel-tab tab-selector tab-${card.id} ${activeCard === card.id ? 'active' : ''}`}\n          style={{ \n            top: `${120 + index * 98}px`\n          }}\n          onClick={() => handleCardChange(card.id)}\n          title={card.name}\n        >\n          {card.name}\n        </div>\n      ))}\n      \n      {/* The panel content container - no nested animation div */}\n      <div \n        id=\"info-panel\" \n        ref={panelRef}\n        className={`info-panel ${!visible ? \"hidden\" : \"\"}`}\n      >\n        {getActiveChild()}\n      </div>\n    </>\n  );\n});\n\nexport default RightPanelContainer;","import React from 'react';\n\n/**\n * Region Selector Component\n * \n * Displays a dropdown menu for selecting different operational regions\n * Integrated with the right panel card design\n */\nconst RegionSelector = ({ \n  regions, \n  currentRegion, \n  onRegionChange,\n  isLoading\n}) => {\n  return (\n    <div className={`region-selector ${isLoading ? 'loading' : ''}`}>\n      <label htmlFor=\"region-select\">Region:</label>\n      <select \n        id=\"region-select\" \n        value={currentRegion ? currentRegion.id : ''} \n        onChange={(e) => onRegionChange(e.target.value)}\n        disabled={isLoading}\n        className={isLoading ? 'loading' : ''}\n      >\n        {regions.map(region => (\n          <option key={region.id} value={region.id}>\n            {region.name}\n          </option>\n        ))}\n      </select>\n      {isLoading && (\n        <span className=\"loading-indicator\">\n          <span className=\"loading-dot\"></span>\n          <span className=\"loading-dot\"></span>\n          <span className=\"loading-dot\"></span>\n        </span>\n      )}\n    </div>\n  );\n};\n\nexport default RegionSelector;\n","import React, { useState, useEffect } from 'react';\n\n/**\n * SaveFlightModal Component\n * \n * A modal dialog for collecting flight details to save to Palantir\n */\nconst SaveFlightModal = ({ \n  isOpen, \n  onClose, \n  onSave, \n  isSaving, \n  initialFlightName = '',\n  waypoints,\n  onRunDiagnostic = null,\n  runAutomation = true // Default to true to match current behavior\n}) => {\n  // Form state\n  const [flightName, setFlightName] = useState(initialFlightName);\n  const [etd, setEtd] = useState('');\n  const [captainId, setCaptainId] = useState('');\n  const [copilotId, setCopilotId] = useState('');\n  const [medicId, setMedicId] = useState('');\n  const [soId, setSoId] = useState('');\n  const [rswId, setRswId] = useState('');\n  const [enableAutomation, setEnableAutomation] = useState(runAutomation);\n  \n  // Set up initial values when modal opens\n  useEffect(() => {\n    // Generate a default flight name based on waypoints if not provided\n    if (!initialFlightName && waypoints && waypoints.length >= 2) {\n      const origin = waypoints[0].name || 'Origin';\n      const destination = waypoints[waypoints.length - 1].name || 'Destination';\n      const todayDate = new Date().toISOString().split('T')[0];\n      setFlightName(`${origin} to ${destination} - ${todayDate}`);\n    } else {\n      setFlightName(initialFlightName);\n    }\n    \n    // Default ETD to current time\n    const now = new Date();\n    const formattedDate = now.toISOString().slice(0, 16); // Format: YYYY-MM-DDThh:mm\n    setEtd(formattedDate);\n    \n    // Set initial automation state from props\n    setEnableAutomation(runAutomation);\n  }, [isOpen, initialFlightName, waypoints, runAutomation]);\n  \n  // Handle form submission\n  const handleSubmit = () => {\n    if (!flightName || !etd) {\n      return; // Don't submit if required fields are missing\n    }\n    \n    const flightData = {\n      flightName,\n      etd,\n      captainId: captainId || null,\n      copilotId: copilotId || null,\n      medicId: medicId || null,\n      soId: soId || null,\n      rswId: rswId || null,\n      runAutomation: enableAutomation // Add the automation flag\n    };\n    \n    onSave(flightData);\n  };\n  \n  // Don't render anything if the modal is not open\n  if (!isOpen) return null;\n  \n  return (\n    <div className=\"modal-overlay\" style={{\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      backgroundColor: 'rgba(0, 0, 0, 0.6)',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      zIndex: 9999\n    }}>\n      <div className=\"modal-content\" style={{\n        backgroundColor: '#1e1e1e',\n        color: '#ffffff',\n        borderRadius: '8px',\n        padding: '20px',\n        width: '400px',\n        maxWidth: '90%',\n        maxHeight: '80vh',\n        overflowY: 'auto',\n        boxShadow: '0 5px 15px rgba(0, 0, 0, 0.5)'\n      }}>\n        <h2 style={{ \n          marginTop: 0,\n          textAlign: 'center',\n          fontSize: '18px',\n          padding: '8px 0',\n          borderBottom: '1px solid #333'\n        }}>\n          Save Flight to Palantir\n        </h2>\n        \n        <div style={{ marginBottom: '15px', marginTop: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            Flight Name:\n          </label>\n          <input \n            type=\"text\" \n            value={flightName} \n            onChange={e => setFlightName(e.target.value)}\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n            required\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            ETD (Estimated Time of Departure):\n          </label>\n          <input \n            type=\"datetime-local\" \n            value={etd} \n            onChange={e => setEtd(e.target.value)}\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n            required\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            Captain:\n          </label>\n          <input \n            type=\"text\" \n            value={captainId} \n            onChange={e => setCaptainId(e.target.value)}\n            placeholder=\"Enter Captain ID\"\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            Copilot:\n          </label>\n          <input \n            type=\"text\" \n            value={copilotId} \n            onChange={e => setCopilotId(e.target.value)}\n            placeholder=\"Enter Copilot ID\"\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            Medic:\n          </label>\n          <input \n            type=\"text\" \n            value={medicId} \n            onChange={e => setMedicId(e.target.value)}\n            placeholder=\"Enter Medic ID\"\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            SO (Winch Operator):\n          </label>\n          <input \n            type=\"text\" \n            value={soId} \n            onChange={e => setSoId(e.target.value)}\n            placeholder=\"Enter SO ID\"\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n          />\n        </div>\n        \n        <div style={{ marginBottom: '15px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal',\n            fontSize: '14px',\n            color: '#ccc'\n          }}>\n            Rescue Swimmer:\n          </label>\n          <input \n            type=\"text\" \n            value={rswId} \n            onChange={e => setRswId(e.target.value)}\n            placeholder=\"Enter Rescue Swimmer ID\"\n            style={{ \n              width: '100%', \n              padding: '8px',\n              border: '1px solid #333',\n              borderRadius: '4px',\n              backgroundColor: '#222',\n              color: 'white'\n            }}\n          />\n        </div>\n        \n        {/* Add automation toggle checkbox */}\n        <div style={{ marginBottom: '20px' }}>\n          <div style={{\n            display: 'flex',\n            alignItems: 'center',\n            backgroundColor: '#2a2a2a',\n            padding: '10px',\n            borderRadius: '4px',\n            border: '1px solid #444'\n          }}>\n            <input\n              type=\"checkbox\"\n              id=\"enable-automation\"\n              checked={enableAutomation}\n              onChange={() => setEnableAutomation(!enableAutomation)}\n              style={{\n                width: '18px',\n                height: '18px',\n                marginRight: '10px'\n              }}\n            />\n            <label \n              htmlFor=\"enable-automation\"\n              style={{\n                cursor: 'pointer',\n                fontWeight: 'normal',\n                fontSize: '14px',\n                color: enableAutomation ? '#4caf50' : '#ccc'\n              }}\n            >\n              Run automation after saving \n              <span style={{ \n                fontSize: '12px', \n                marginLeft: '5px', \n                opacity: 0.7, \n                display: 'block'\n              }}>\n                Will find best runway, calculate wind effects, find alternates, optimize fuel and passenger count\n              </span>\n            </label>\n          </div>\n        </div>\n        \n        <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: '20px' }}>\n          {/* Diagnostic button only shown if onRunDiagnostic is provided */}\n          {onRunDiagnostic && (\n            <button\n              onClick={() => {\n                onRunDiagnostic();\n              }}\n              style={{\n                backgroundColor: '#444',\n                color: 'white',\n                border: 'none',\n                borderRadius: '4px',\n                padding: '8px 16px',\n                marginRight: '8px',\n                cursor: 'pointer',\n                fontWeight: 'bold',\n                fontSize: '12px'\n              }}\n            >\n              Diagnose API\n            </button>\n          )}\n          \n          {/* Add Test API Connection button */}\n          <button\n            onClick={async () => {\n              try {\n                // Show that we're working\n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator('Testing API connection...');\n                }\n                \n                // Import the SDK directly\n                const sdk = await import('@flight-app/sdk');\n                \n                // Check if the actions exist\n                const hasFlightAction = !!sdk.createNewFlightFp2;\n                const hasAutomationAction = !!sdk.singleFlightAutomation;\n                \n                // Log what we found\n                console.log('SDK Loaded:', !!sdk);\n                console.log('createNewFlightFp2 action available:', hasFlightAction);\n                console.log('singleFlightAutomation action available:', hasAutomationAction);\n                console.log('All available SDK objects:', Object.keys(sdk));\n                \n                // Show in the UI\n                if (window.LoadingIndicator) {\n                  if (hasFlightAction && hasAutomationAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection successful: Both actions found', \n                      'success'\n                    );\n                  } else if (hasFlightAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection partial: createNewFlightFp2 found, automation missing', \n                      'warning'\n                    );\n                  } else if (hasAutomationAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection partial: singleFlightAutomation found, flight creation missing', \n                      'warning'\n                    );\n                  } else {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection issue: Both actions missing', \n                      'error'\n                    );\n                  }\n                }\n              } catch (error) {\n                console.error('API connection test error:', error);\n                \n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator(\n                    `API connection failed: ${error.message}`, \n                    'error'\n                  );\n                }\n              }\n            }}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '8px 16px',\n              marginRight: 'auto',\n              cursor: 'pointer',\n              fontWeight: 'bold',\n              fontSize: '12px'\n            }}\n          >\n            Test API\n          </button>\n          \n          <button\n            onClick={onClose}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '8px 16px',\n              marginRight: '10px',\n              cursor: 'pointer',\n              fontWeight: 'bold'\n            }}\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleSubmit}\n            disabled={isSaving || !flightName || !etd}\n            style={{\n              backgroundColor: isSaving || !flightName || !etd ? '#444' : '#038dde',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '8px 16px',\n              cursor: isSaving || !flightName || !etd ? 'not-allowed' : 'pointer',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              fontWeight: 'bold'\n            }}\n          >\n            {isSaving ? (\n              <>\n                <span className=\"spinner\" style={{\n                  display: 'inline-block',\n                  width: '16px',\n                  height: '16px',\n                  border: '2px solid rgba(255,255,255,0.3)',\n                  borderRadius: '50%',\n                  borderTopColor: 'white',\n                  animation: 'spin 1s ease-in-out infinite',\n                  marginRight: '8px'\n                }}></span>\n                Saving...\n              </>\n            ) : (\n              'Save Flight'\n            )}\n          </button>\n        </div>\n        \n        {/* Add animation for spinner */}\n        <style>\n          {`\n            @keyframes spin {\n              to { transform: rotate(360deg); }\n            }\n          `}\n        </style>\n      </div>\n    </div>\n  );\n};\n\nexport default SaveFlightModal;","/**\n * PalantirFlightService.js\n * \n * Service for interacting with Palantir OSDK Flight API\n * This provides a clean interface for creating flights in Palantir from the Fast Planner\n */\nimport client from '../../../client';\n\nclass PalantirFlightService {\n  /**\n   * Check if the OSDK client is available and authenticated\n   * @returns {boolean} - True if OSDK client is available\n   */\n  static isClientAvailable() {\n    return !!client;\n  }\n  \n  /**\n   * Run a diagnostic test with minimal parameters to identify API issues\n   * @returns {Promise<boolean>} - True if the diagnostic succeeded\n   */\n  static async runDiagnostic() {\n    try {\n      console.log(\"Running API diagnostic with minimal parameters...\");\n      \n      // Import the SDK\n      const sdk = await this.getSDK();\n      \n      // Log available Actions\n      console.log(\"Available SDK Actions:\", Object.keys(sdk).filter(key => \n        typeof key === 'string' && key.toLowerCase().includes('flight')\n      ));\n      \n      // Try with absolute minimal parameters\n      const minimalParams = {\n        \"flightName\": \"Diagnostic Test Flight\",\n        \"aircraftRegion\": \"NORWAY\",\n        \"new_parameter\": \"Norway\",\n        \"aircraftId\": \"190\",\n        \"region\": \"NORWAY\",\n        \"etd\": new Date().toISOString(),\n        \"locations\": [\"ENZV\", \"ENLE\"]\n      };\n      \n      console.log(\"Diagnostic params:\", minimalParams);\n      \n      // Test the API call with returnEdits option\n      const result = await client(sdk.createNewFlightFp2).applyAction(\n        minimalParams,\n        { $returnEdits: true }\n      );\n      \n      console.log(\"Diagnostic successful with result:\", result);\n      return true;\n    } catch (error) {\n      console.error(\"Diagnostic failed:\", error);\n      \n      // Check if we have validation errors and log them clearly\n      if (error.message && error.message.includes('evaluatedConstraints')) {\n        try {\n          const errorJson = error.message.match(/\\{.*\\}/s);\n          if (errorJson) {\n            const validationData = JSON.parse(errorJson[0]);\n            console.log('Parameter validation errors:', validationData);\n          }\n        } catch (parseError) {\n          console.log('Could not parse validation errors:', parseError);\n        }\n      }\n      \n      return false;\n    }\n  }\n  \n  /**\n   * Import the SDK dynamically\n   * @returns {Object} - The SDK object\n   */\n  static async getSDK() {\n    try {\n      return await import('@flight-app/sdk');\n    } catch (error) {\n      console.error('Error importing SDK:', error);\n      throw new Error(`Failed to import SDK: ${error.message}`);\n    }\n  }\n  \n  /**\n   * Create a new flight in Palantir using the new createFlightWithWaypoints function\n   * @param {Object} flightData - The flight data\n   * @returns {Promise<Object>} - The result of the API call\n   */\n  static async createFlight(flightData) {\n    if (!this.isClientAvailable()) {\n      throw new Error('OSDK client not available. Try logging in again.');\n    }\n    \n    // Clean up the locations to ensure no leading/trailing spaces\n    let cleanLocations = [];\n    if (flightData.locations && Array.isArray(flightData.locations)) {\n      cleanLocations = flightData.locations.map(loc => typeof loc === 'string' ? loc.trim() : loc);\n    } else {\n      cleanLocations = [\"ENZV\", \"ENLE\"]; // Default locations\n    }\n    \n    // Import the SDK\n    const sdk = await this.getSDK();\n    \n    try {\n      // Check if we should use the new createFlightWithWaypoints function\n      if (sdk.createFlightWithWaypoints) {\n        console.log('Using new createFlightWithWaypoints function');\n        \n        // Format waypoints in the structured format if available\n        let structuredWaypoints = [];\n        let legs = [];\n        \n        // If we have waypoints with leg information\n        if (flightData.waypoints && Array.isArray(flightData.waypoints)) {\n          // Group waypoints by leg index\n          const waypointsByLeg = {};\n          \n          flightData.waypoints.forEach(wp => {\n            const legIndex = wp.legIndex || 0;\n            if (!waypointsByLeg[legIndex]) {\n              waypointsByLeg[legIndex] = [];\n            }\n            waypointsByLeg[legIndex].push(wp.name || wp.id);\n          });\n          \n          // Convert to legs array\n          Object.keys(waypointsByLeg).forEach(legIndex => {\n            legs.push({\n              index: Number(legIndex),\n              waypoints: waypointsByLeg[legIndex]\n            });\n          });\n          \n          // If no legs were created but we have waypoints, create a single leg\n          if (legs.length === 0 && flightData.waypoints.length > 0) {\n            legs.push({\n              index: 0,\n              waypoints: flightData.waypoints.map(wp => wp.name || wp.id)\n            });\n          }\n        } else {\n          // If no waypoint structure is provided, use locations as a simple leg\n          legs.push({\n            index: 0,\n            waypoints: cleanLocations\n          });\n        }\n        \n        // Prepare the parameters for createFlightWithWaypoints\n        const params = {\n          \"flightName\": flightData.flightName || \"Fast Planner Flight\",\n          \"locations\": cleanLocations,\n          \"legs\": legs,\n          \"useOnlyProvidedWaypoints\": true,\n          \"aircraftId\": flightData.aircraftId || \"190\",\n          \"region\": \"NORWAY\",\n          \"aircraftRegion\": \"NORWAY\",\n          \"etd\": flightData.etd || new Date().toISOString(),\n          \"alternateLocation\": flightData.alternateLocation || \"\"\n        };\n        \n        // Add crew members if provided\n        if (flightData.captainId) params.captainId = flightData.captainId;\n        if (flightData.copilotId) params.copilotId = flightData.copilotId;\n        if (flightData.medicId) params.medicId = flightData.medicId;\n        if (flightData.soId) params.soId = flightData.soId;\n        if (flightData.rswId) params.rswId = flightData.rswId;\n        \n        console.log('Creating flight with structured waypoints:', JSON.stringify(params, null, 2));\n        \n        // Call the API\n        const result = await client(sdk.createFlightWithWaypoints).applyAction(\n          params,\n          { $returnEdits: true }\n        );\n        \n        console.log('Flight creation with structured waypoints successful!', result);\n        return result;\n      } else {\n        // Fall back to the old createNewFlightFp2 if the new function is not available\n        console.log('New createFlightWithWaypoints function not available, falling back to createNewFlightFp2');\n        \n        // Use a greatly simplified approach that matches the working ApiTester\n        const cleanData = {\n          flightName: flightData.flightName || \"Test Flight\",\n          aircraftRegion: \"NORWAY\",\n          new_parameter: \"Norway\",\n          aircraftId: flightData.aircraftId || \"190\",\n          region: \"NORWAY\",\n          etd: flightData.etd || new Date().toISOString(),\n          locations: cleanLocations,\n          alternateLocation: flightData.alternateLocation || \"\",\n          // Only include crew if provided\n          ...(flightData.captainId ? { captainId: flightData.captainId } : {}),\n          ...(flightData.copilotId ? { copilotId: flightData.copilotId } : {})\n        };\n        \n        // Log the clean data \n        console.log('Flight data structure being sent to API:', JSON.stringify(cleanData, null, 2));\n        \n        // Check if the createNewFlightFp2 action exists\n        if (!sdk.createNewFlightFp2) {\n          console.error('createNewFlightFp2 action not found in SDK');\n          console.log('Available SDK actions:', Object.keys(sdk));\n          throw new Error('createNewFlightFp2 action not found in SDK');\n        }\n        \n        // Format the parameters\n        const params = this.formatFlightParams(cleanData);\n        \n        console.log('Calling createNewFlightFp2 with params:', params);\n        \n        // Make the API call with the exact format from the documentation\n        const result = await client(sdk.createNewFlightFp2).applyAction(\n          params,\n          { $returnEdits: true }\n        );\n        \n        console.log('Flight creation successful!', result);\n        return result;\n      }\n    } catch (error) {\n      console.error('Error creating flight:', error);\n      \n      // Log the full error for debugging\n      console.error('Error details:', error);\n      \n      throw error;\n    }\n  }\n  \n  /**\n   * Update an existing flight in Palantir using the new updateFastPlannerFlight function\n   * @param {Object} flightData - The flight data including the flightId\n   * @returns {Promise<Object>} - The result of the API call\n   */\n  static async updateFlight(flightData) {\n    if (!this.isClientAvailable()) {\n      throw new Error('OSDK client not available. Try logging in again.');\n    }\n    \n    if (!flightData.flightId) {\n      throw new Error('Flight ID is required for updating a flight');\n    }\n    \n    // Import the SDK\n    const sdk = await this.getSDK();\n    \n    try {\n      // Check if we should use the new updateFastPlannerFlight function\n      if (sdk.updateFastPlannerFlight) {\n        console.log('Using new updateFastPlannerFlight function');\n        \n        // Format structured waypoints if available\n        let structuredWaypoints = [];\n        \n        if (flightData.waypoints && Array.isArray(flightData.waypoints)) {\n          // Convert waypoints to structured format\n          structuredWaypoints = flightData.waypoints.map(wp => ({\n            legIndex: wp.legIndex || 0,\n            waypoint: wp.name || wp.id\n          }));\n        }\n        \n        // Clean up the locations\n        let cleanLocations = [];\n        if (flightData.locations && Array.isArray(flightData.locations)) {\n          cleanLocations = flightData.locations.map(loc => typeof loc === 'string' ? loc.trim() : loc);\n        }\n        \n        // Prepare the parameters for updateFastPlannerFlight\n        const params = {\n          \"flightId\": flightData.flightId,\n          \"flightName\": flightData.flightName,\n          \"locations\": cleanLocations,\n          \"structuredWaypoints\": structuredWaypoints,\n          \"useOnlyProvidedWaypoints\": true,\n          \"region\": \"NORWAY\",\n          \"aircraftRegion\": \"NORWAY\",\n          \"etd\": flightData.etd || new Date().toISOString()\n        };\n        \n        // Add optional parameters if provided\n        if (flightData.aircraftId) params.aircraftId = flightData.aircraftId;\n        if (flightData.alternateLocation) params.alternateLocation = flightData.alternateLocation;\n        if (flightData.captainId) params.captainId = flightData.captainId;\n        if (flightData.copilotId) params.copilotId = flightData.copilotId;\n        if (flightData.medicId) params.medicId = flightData.medicId;\n        if (flightData.soId) params.soId = flightData.soId;\n        if (flightData.rswId) params.rswId = flightData.rswId;\n        \n        // Add any additional parameters\n        if (flightData.fuelPlanId) params.fuelPlanId = flightData.fuelPlanId;\n        if (flightData.timingId) params.timingId = flightData.timingId;\n        if (flightData.weightBalanceId) params.weightBalanceId = flightData.weightBalanceId;\n        if (flightData.policyUuid) params.policyUuid = flightData.policyUuid;\n        \n        console.log('Updating flight with parameters:', JSON.stringify(params, null, 2));\n        \n        // Call the API\n        const result = await client(sdk.updateFastPlannerFlight).applyAction(\n          params,\n          { $returnEdits: true }\n        );\n        \n        console.log('Flight update successful!', result);\n        return result;\n      } else {\n        // Fall back to the old editExistingFlightFp2 if available\n        console.log('New updateFastPlannerFlight function not available, falling back to editExistingFlightFp2');\n        \n        if (!sdk.editExistingFlightFp2) {\n          throw new Error('Neither updateFastPlannerFlight nor editExistingFlightFp2 are available');\n        }\n        \n        // Use a greatly simplified approach that matches the working ApiTester\n        const cleanData = {\n          flightId: flightData.flightId,\n          flightName: flightData.flightName,\n          aircraftRegion: \"NORWAY\",\n          aircraftId: flightData.aircraftId,\n          region: \"NORWAY\",\n          etd: flightData.etd || new Date().toISOString(),\n          locations: flightData.locations || [\"ENZV\", \"ENLE\"],\n          alternateLocation: flightData.alternateLocation || \"\"\n        };\n        \n        // Only include crew if provided\n        if (flightData.captainId) cleanData.captainId = flightData.captainId;\n        if (flightData.copilotId) cleanData.copilotId = flightData.copilotId;\n        \n        // Log the clean data \n        console.log('Flight update data structure:', JSON.stringify(cleanData, null, 2));\n        \n        // Make the API call\n        const result = await client(sdk.editExistingFlightFp2).applyAction(\n          cleanData,\n          { $returnEdits: true }\n        );\n        \n        console.log('Flight update successful!', result);\n        return result;\n      }\n    } catch (error) {\n      console.error('Error updating flight:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Extract an ID from an API result\n   * @param {Object} result - The API result\n   * @returns {string} - The extracted ID or 'Unknown ID'\n   */\n  static extractFlightId(result) {\n    // Log the entire result structure for debugging\n    console.log('Extracting flight ID from result:', result);\n    \n    // Based on the working example in ApiTester, check for addedObjects first\n    if (result && result.addedObjects && Array.isArray(result.addedObjects)) {\n      for (const obj of result.addedObjects) {\n        if (obj.objectType === 'MainFlightObjectFp2' && obj.primaryKey) {\n          console.log('Found flight ID in addedObjects:', obj.primaryKey);\n          return obj.primaryKey;\n        }\n      }\n    }\n    \n    // Fall back to other methods if addedObjects doesn't contain the ID\n    if (result) {\n      // If the result has an editedObjectTypes property\n      if (result.editedObjectTypes && result.editedObjectTypes.length > 0) {\n        const firstObject = result.editedObjectTypes[0];\n        // Return the ID if it exists\n        if (firstObject && firstObject.id) {\n          console.log('Found flight ID in editedObjectTypes:', firstObject.id);\n          return firstObject.id;\n        }\n      }\n      \n      // If the result has a type of 'edits' and an updatedObject property\n      if (result.type === 'edits' && result.updatedObject) {\n        const id = result.updatedObject.id || 'Unknown ID';\n        console.log('Found flight ID in updatedObject:', id);\n        return id;\n      }\n      \n      // If the result has an id property directly\n      if (result.id) {\n        console.log('Found flight ID directly in result:', result.id);\n        return result.id;\n      }\n    }\n    \n    console.warn('Could not find flight ID in result. Using \"Unknown ID\"');\n    return 'Unknown ID';\n  }\n  \n  /**\n   * Check if a result is successful\n   * @param {Object} result - The API result\n   * @returns {boolean} - True if the result is successful\n   */\n  static isSuccessfulResult(result) {\n    if (!result) return false;\n    \n    // Based on the API documentation, the result should have one of these structures\n    return (\n      // Check for the format shown in the API documentation screenshot\n      (result.type === 'edits') || \n      \n      // Check for editedObjectTypes property\n      (result.editedObjectTypes && result.editedObjectTypes.length > 0) ||\n      \n      // Check for updatedObject property\n      (result.updatedObject) ||\n      \n      // Check for id property directly\n      (result.id)\n    );\n  }\n  \n  /**\n   * Format flight parameters for the API\n   * @param {Object} params - Flight parameters\n   * @returns {Object} - Formatted parameters for the API exactly as specified in the documentation\n   */\n  static formatFlightParams(params) {\n    // Based on actual implementation, use simple string for aircraftId\n    const formattedParams = {\n      \"flightName\": params.flightName || \"Test Flight\",\n      \"aircraftRegion\": \"NORWAY\",\n      \"new_parameter\": \"Norway\",\n      \"aircraftId\": params.aircraftId || \"190\", // Use the numeric ID as fallback\n      \"region\": \"NORWAY\",\n      \"etd\": params.etd || new Date().toISOString(),\n      \"locations\": Array.isArray(params.locations) ? params.locations : [\"ENZV\", \"ENLE\"],\n      \"alternateLocation\": params.alternateLocation || \"\"\n    };\n    \n    // Add crew members only if provided\n    if (params.captainId) {\n      formattedParams.captainId = params.captainId; // Simple string, no $primaryKey\n    }\n    \n    if (params.copilotId) {\n      formattedParams.copilotId = params.copilotId; // Simple string, no $primaryKey\n    }\n    \n    if (params.medicId) {\n      formattedParams.medicId = params.medicId; // Simple string, no $primaryKey\n    }\n    \n    if (params.soId) {\n      formattedParams.soId = params.soId; // Simple string, no $primaryKey\n    }\n    \n    if (params.rswId) {\n      formattedParams.rswId = params.rswId; // Simple string, no $primaryKey\n    }\n    \n    console.log('Formatted flight parameters:', formattedParams);\n    return formattedParams;\n  }\n  \n  /**\n   * Format error message for the user\n   * @param {Error} error - The error object\n   * @returns {string} - A user-friendly error message\n   */\n  static formatErrorMessage(error) {\n    if (!error) return 'Unknown error occurred';\n    \n    // Log the full error for debugging\n    console.error('Full error details:', error);\n    \n    // Extract useful information from the error\n    const message = error.message || '';\n    \n    // Check for specific error patterns based on the Palantir API\n    if (message.includes('401') || message.includes('unauthorized')) {\n      return 'Authentication error: You need to log in again to save flights';\n    }\n    \n    if (message.includes('404') || message.includes('not found')) {\n      return 'API endpoint not found: The required action may not be available';\n    }\n    \n    if (message.includes('400') || message.includes('Bad Request')) {\n      // For 400 errors, try to extract more details to help diagnose parameter formatting issues\n      let detailedMessage = 'API request error (400): The server rejected the flight data.';\n      \n      // Try to extract parameter-specific errors if they exist\n      if (error.response && error.response.data) {\n        detailedMessage += ' Details: ' + JSON.stringify(error.response.data);\n      }\n      \n      // Provide guidance for common issues\n      detailedMessage += ' Please check that all required fields are correctly formatted, especially IDs and dates.';\n      \n      return detailedMessage;\n    }\n    \n    if (message.includes('timeout') || message.includes('aborted')) {\n      return 'Connection timeout: The server took too long to respond';\n    }\n    \n    if (message.includes('network') || message.includes('offline')) {\n      return 'Network error: Check your internet connection';\n    }\n    \n    if (message.includes('TypeError') && message.includes('is not a function')) {\n      return 'API function error: The required action may not be available or has changed. Check the Palantir API documentation.';\n    }\n    \n    if (message.includes('bristol') || message.includes('foundry')) {\n      return 'API connection error: Unable to connect to the Palantir Foundry service. Please verify your authentication.';\n    }\n    \n    // Special message for missing SDK\n    if (message.includes('import') || message.includes('module')) {\n      return 'SDK import error: Unable to load the @flight-app/sdk module. Please check that it is correctly installed.';\n    }\n    \n    // Default error message with more detail\n    return `Error creating flight: ${message} (Check browser console for more details)`;\n  }\n}\n\nexport default PalantirFlightService;","/**\n * AutomationService.js\n * \n * Service for handling flight automation in Palantir\n */\nimport client from '../../../client';\n\nclass AutomationService {\n  /**\n   * Run automation for a flight\n   * @param {string} flightId - The ID of the flight to automate\n   * @returns {Promise<Object>} - The result of the automation\n   */\n  static async runAutomation(flightId) {\n    if (!flightId) {\n      throw new Error('Flight ID is required for automation');\n    }\n    \n    try {\n      console.log(`AutomationService: Running automation for flight ${flightId}`);\n      \n      // Import the SDK\n      const sdk = await this.getSDK();\n      \n      // CRITICAL: Don't pass any options parameter\n      const result = await client(sdk.singleFlightAutomation).applyAction(\n        { flightId: flightId }\n        // No options parameter - this is the key difference!\n      );\n      \n      console.log('Automation successful!', result);\n      return result;\n    } catch (error) {\n      console.error('Automation failed:', error);\n      throw error;\n    }\n  }\n  \n  /**\n   * Import the SDK dynamically\n   * @returns {Object} - The SDK object\n   */\n  static async getSDK() {\n    try {\n      return await import('@flight-app/sdk');\n    } catch (error) {\n      console.error('Error importing SDK:', error);\n      throw new Error(`Failed to import SDK: ${error.message}`);\n    }\n  }\n  \n  /**\n   * Format error message for the user\n   * @param {Error} error - The error object\n   * @returns {string} - A user-friendly error message\n   */\n  static formatErrorMessage(error) {\n    if (!error) return 'Unknown error occurred';\n    \n    const message = error.message || '';\n    \n    if (message.includes('401') || message.includes('unauthorized')) {\n      return 'Authentication error: You need to log in again to run automation';\n    }\n    \n    if (message.includes('404') || message.includes('not found')) {\n      return 'API endpoint not found: The automation action may not be available';\n    }\n    \n    if (message.includes('400') || message.includes('Bad Request')) {\n      return 'API request error (400): The server rejected the automation request. The flight might not be in a valid state for automation.';\n    }\n    \n    return `Error running automation: ${message}`;\n  }\n}\n\nexport default AutomationService;","import React, { createContext, useContext } from 'react';\n\n/**\n * PanelContext\n * \n * Provides a communication channel between components that need to \n * control panel/card visibility without direct references or DOM manipulation.\n * \n * This simplifies the interaction between SaveFlightButton and RightPanelContainer,\n * making the code more maintainable and following React best practices.\n */\n\n// Create the context with default values that do nothing\nconst PanelContext = createContext({\n  handleCardChange: () => {},\n  activeCard: 'main'\n});\n\n// Custom hook for easy access to the context\nexport const usePanelContext = () => useContext(PanelContext);\n\n// Provider component for wrapping parts of the app that need access\nexport const PanelProvider = ({ children, value }) => (\n  <PanelContext.Provider value={value}>\n    {children}\n  </PanelContext.Provider>\n);\n\nexport default PanelContext;\n","import React, { useState } from 'react';\nimport SaveFlightModal from './SaveFlightModal';\nimport PalantirFlightService from '../../services/PalantirFlightService';\nimport AutomationService from '../../services/AutomationService';\nimport { usePanelContext } from '../../context/PanelContext';\n\n/**\n * SaveFlightButton Component\n * Creates a button that sends the current route data to Palantir to create a new flight\n * and optionally runs automation on the newly created flight\n */\nconst SaveFlightButton = ({ \n  selectedAircraft, \n  waypoints, \n  routeStats,\n  currentRegion,\n  onSuccess,\n  onError,\n  runAutomation = true, // New prop to determine if automation should run after save\n  ...props // Add rest parameter to capture style and other props\n}) => {\n  const [isSaving, setIsSaving] = useState(false);\n  const [isAutomating, setIsAutomating] = useState(false);\n  const [showModal, setShowModal] = useState(false);\n  const [savedFlightId, setSavedFlightId] = useState(null);\n  \n  // Access the panel context for card navigation\n  const panelContext = usePanelContext();\n  \n  const handleButtonClick = () => {\n    // Use the panel context to change to the saveflight card\n    if (panelContext && panelContext.handleCardChange) {\n      console.log('SaveFlightButton: Using panel context to switch to saveflight card');\n      panelContext.handleCardChange('saveflight');\n    } else {\n      console.log('SaveFlightButton: Panel context not available, falling back to modal');\n      // Fallback to modal if the context is not available\n      openModal();\n    }\n  };\n  \n  // Open the modal (fallback)\n  const openModal = () => {\n    setShowModal(true);\n  };\n  \n  // Close the modal\n  const closeModal = () => {\n    setShowModal(false);\n  };\n\n  /**\n   * Run a diagnostic test on the API connection\n   * This helps identify what's causing the 400 Bad Request error\n   */\n  const runDiagnosticMode = async () => {\n    try {\n      setIsSaving(true);\n      \n      // Alert the user\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Running API diagnostics...');\n      }\n      \n      // Use the improved diagnostic method from PalantirFlightService\n      const success = await PalantirFlightService.runDiagnostic();\n      \n      // Show appropriate message based on result\n      if (success) {\n        if (window.LoadingIndicator) {\n          window.LoadingIndicator.updateStatusIndicator('Diagnostic test successful! The API is working correctly.', 'success');\n        }\n        \n        // Display a more visible success message\n        const successMessage = document.createElement('div');\n        successMessage.style.cssText = `\n          position: fixed;\n          top: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          background-color: #28a745;\n          color: white;\n          padding: 15px 25px;\n          border-radius: 5px;\n          z-index: 10000;\n          box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n          max-width: 80%;\n          text-align: center;\n          font-weight: bold;\n        `;\n        successMessage.textContent = 'API Diagnostic Successful! The flight creation API is working.';\n        document.body.appendChild(successMessage);\n        \n        // Auto-remove after 5 seconds\n        setTimeout(() => {\n          if (document.body.contains(successMessage)) {\n            document.body.removeChild(successMessage);\n          }\n        }, 5000);\n      } else {\n        if (window.LoadingIndicator) {\n          window.LoadingIndicator.updateStatusIndicator('Diagnostic test failed. See console for details.', 'error');\n        }\n      }\n      \n      return success;\n    } catch (error) {\n      console.error('Diagnostic mode error:', error);\n      \n      // Format the error for display\n      const errorMessage = `API Diagnostic Error: ${error.message || 'Unknown error'}`;\n      \n      // Show the user what happened\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(errorMessage, 'error');\n      }\n      \n      return false;\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  \n  /**\n   * Run automation on the saved flight\n   * @param {string} flightId - The ID of the flight to automate\n   */\n  const runFlightAutomation = async (flightId) => {\n    if (!flightId) {\n      console.error('Cannot run automation: No flight ID provided');\n      return;\n    }\n    \n    try {\n      setIsAutomating(true);\n      \n      // Update loading indicator\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Running flight automation...');\n      }\n      \n      // Call the automation service\n      const result = await AutomationService.runAutomation(flightId);\n      \n      console.log('Automation successful!', result);\n      \n      // Show success message\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Flight automation completed successfully', 'success');\n      }\n      \n      // Call success callback if provided\n      if (onSuccess) {\n        onSuccess(`Flight saved and automated successfully`);\n      }\n      \n    } catch (error) {\n      console.error('Error running automation:', error);\n      \n      // Format error message\n      const errorMessage = AutomationService.formatErrorMessage(error);\n      \n      // Show error in UI\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(`Flight saved but automation failed: ${errorMessage}`, 'warning');\n      }\n      \n      // We don't call onError since the flight was saved successfully, just automation failed\n      // Instead, show a warning message\n      const warningContainer = document.createElement('div');\n      warningContainer.style.cssText = `\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background-color: #ffc107;\n        color: black;\n        padding: 15px 25px;\n        border-radius: 5px;\n        z-index: 10000;\n        box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n        max-width: 80%;\n        text-align: center;\n        font-weight: bold;\n      `;\n      warningContainer.textContent = `Flight saved successfully, but automation failed: ${errorMessage}`;\n      document.body.appendChild(warningContainer);\n      \n      // Auto-remove after 8 seconds\n      setTimeout(() => {\n        if (document.body.contains(warningContainer)) {\n          document.body.removeChild(warningContainer);\n        }\n      }, 8000);\n    } finally {\n      setIsAutomating(false);\n    }\n  };\n\n  /**\n   * Handles the flight data submitted from the modal\n   * @param {Object} flightData - The flight data from the modal form\n   */\n  const handleFlightFormSubmit = async (flightData) => {\n    if (!selectedAircraft || !waypoints || waypoints.length < 2) {\n      onError('Cannot save flight: Missing aircraft or waypoints');\n      return;\n    }\n    \n    try {\n      setIsSaving(true);\n      \n      // Update loading indicator if available\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Saving flight to Palantir...');\n      }\n      \n      // Get waypoint locations for the API - clean up whitespace\n      const locations = waypoints.map(wp => {\n        // Clean up location names - trim whitespace to avoid issues\n        const locationName = wp.name ? wp.name.trim() : `${wp.coords[1].toFixed(6)},${wp.coords[0].toFixed(6)}`;\n        return locationName;\n      });\n      \n      // Format the ETD for Palantir\n      const etdTimestamp = new Date(flightData.etd).toISOString();\n      \n      // We need to use the numeric ID which we've confirmed works\n      // The assetId is likely the correct field based on our testing\n      const finalAircraftId = selectedAircraft.assetId || \"190\"; // Fallback to 190 if assetId isn't available\n      \n      // Debug output of IDs to help find issues\n      console.log('OSDK Flight Creation - Debug Data:', {\n        aircraftId: finalAircraftId, // We'll use this value directly\n        rawReg: selectedAircraft.rawRegistration,\n        displayReg: selectedAircraft.registration,\n        aircraftAssetId: selectedAircraft.assetId || '(none)',\n        captainId: flightData.captainId,\n        copilotId: flightData.copilotId\n      });\n      \n      // Prepare waypoints with leg structure\n      // Group waypoints by leg if available, otherwise put all in leg 0\n      const waypointsWithLegs = waypoints.map((wp, index) => {\n        return {\n          legIndex: wp.legIndex || 0,\n          name: wp.name || `Waypoint ${index + 1}`,\n          coords: wp.coords,\n          id: wp.id\n        };\n      });\n      \n      // Prepare parameters for the new createFlightWithWaypoints function\n      const apiParams = {\n        // Basic parameters\n        flightName: flightData.flightName,\n        aircraftRegion: \"NORWAY\",\n        aircraftId: finalAircraftId,\n        region: \"NORWAY\",\n        etd: etdTimestamp,\n        locations: locations,\n        alternateLocation: flightData.alternateLocation || \"\",\n        \n        // Structured waypoints for the new API\n        waypoints: waypointsWithLegs,\n        \n        // Crew member IDs\n        captainId: flightData.captainId || null,\n        copilotId: flightData.copilotId || null,\n        medicId: flightData.medicId || null,\n        soId: flightData.soId || null,\n        rswId: flightData.rswId || null\n      };\n      \n      console.log('Sending flight data to Palantir:', apiParams);\n      \n      // First try the diagnostic to make sure the API is working\n      const diagnosticResult = await PalantirFlightService.runDiagnostic();\n      console.log('Diagnostic test result:', diagnosticResult);\n      \n      // Then call the service with our actual parameters\n      const result = await PalantirFlightService.createFlight(apiParams);\n      console.log('Flight creation result:', result);\n      \n      // Check if the result is successful\n      if (PalantirFlightService.isSuccessfulResult(result)) {\n        // Extract the flight ID\n        const flightId = PalantirFlightService.extractFlightId(result);\n        \n        // Set the saved flight ID to state\n        setSavedFlightId(flightId);\n        \n        // Log success details\n        console.log(`Flight created successfully with ID: ${flightId}`);\n        \n        // Display a more visible success message in the UI\n        const successContainer = document.createElement('div');\n        successContainer.className = 'api-success-notification';\n        successContainer.style.cssText = `\n          position: fixed;\n          top: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          background-color: #28a745;\n          color: white;\n          padding: 15px 25px;\n          border-radius: 5px;\n          z-index: 10000;\n          box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n          max-width: 80%;\n          text-align: center;\n          font-weight: bold;\n        `;\n        successContainer.textContent = `Flight \"${flightData.flightName}\" created successfully!`;\n        \n        // Add a close button to the success message\n        const closeButton = document.createElement('button');\n        closeButton.textContent = '×';\n        closeButton.style.cssText = `\n          position: absolute;\n          top: 5px;\n          right: 10px;\n          background: none;\n          border: none;\n          color: white;\n          font-size: 20px;\n          cursor: pointer;\n        `;\n        closeButton.onclick = () => document.body.removeChild(successContainer);\n        successContainer.appendChild(closeButton);\n        \n        // Add to body\n        document.body.appendChild(successContainer);\n        \n        // Auto-remove after 5 seconds\n        setTimeout(() => {\n          if (document.body.contains(successContainer)) {\n            document.body.removeChild(successContainer);\n          }\n        }, 5000);\n        \n        // Close the modal\n        closeModal();\n        \n        // Run automation if enabled and if we have a user choice from the modal\n        if (flightData.runAutomation !== undefined ? flightData.runAutomation : runAutomation) {\n          if (flightId && flightId !== 'Unknown ID') {\n            console.log('Running automation for flight ID:', flightId);\n            // Add a slight delay to ensure flight creation is fully processed on the server\n            setTimeout(() => {\n              runFlightAutomation(flightId);\n            }, 1000);\n          } else {\n            console.log('No valid flight ID available for automation, got:', flightId);\n            \n            // Show warning to user\n            const warningContainer = document.createElement('div');\n            warningContainer.style.cssText = `\n              position: fixed;\n              top: 20px;\n              left: 50%;\n              transform: translateX(-50%);\n              background-color: #ffc107;\n              color: black;\n              padding: 15px 25px;\n              border-radius: 5px;\n              z-index: 10000;\n              box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n              max-width: 80%;\n              text-align: center;\n              font-weight: bold;\n            `;\n            warningContainer.textContent = `Flight saved successfully, but automation couldn't be run: Could not extract a valid flight ID`;\n            document.body.appendChild(warningContainer);\n            \n            // Auto-remove after 8 seconds\n            setTimeout(() => {\n              if (document.body.contains(warningContainer)) {\n                document.body.removeChild(warningContainer);\n              }\n            }, 8000);\n            \n            // Still call success since the flight was saved\n            if (onSuccess) {\n              onSuccess(`Flight \"${flightData.flightName}\" created successfully (ID unavailable for automation)`);\n            }\n          }\n        } else {\n          console.log('Automation not enabled for this flight');\n          if (onSuccess) {\n            onSuccess(`Flight \"${flightData.flightName}\" created successfully with ID: ${flightId}`);\n          }\n        }\n      } else {\n        console.error('Invalid response from server:', result);\n        throw new Error('Flight creation failed: Invalid response from server');\n      }\n    } catch (error) {\n      console.error('Error creating flight:', error);\n      \n      // Format the error message using the service\n      const errorMessage = PalantirFlightService.formatErrorMessage(error);\n      \n      // Display a more visible error message in the UI\n      const errorContainer = document.createElement('div');\n      errorContainer.className = 'api-error-notification';\n      errorContainer.style.cssText = `\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background-color: #ff4c4c;\n        color: white;\n        padding: 15px 25px;\n        border-radius: 5px;\n        z-index: 10000;\n        box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n        max-width: 80%;\n        text-align: center;\n        font-weight: bold;\n      `;\n      errorContainer.textContent = errorMessage;\n      \n      // Add a close button to the error message\n      const closeButton = document.createElement('button');\n      closeButton.textContent = '×';\n      closeButton.style.cssText = `\n        position: absolute;\n        top: 5px;\n        right: 10px;\n        background: none;\n        border: none;\n        color: white;\n        font-size: 20px;\n        cursor: pointer;\n      `;\n      closeButton.onclick = () => document.body.removeChild(errorContainer);\n      errorContainer.appendChild(closeButton);\n      \n      // Add to body\n      document.body.appendChild(errorContainer);\n      \n      // Auto-remove after 8 seconds\n      setTimeout(() => {\n        if (document.body.contains(errorContainer)) {\n          document.body.removeChild(errorContainer);\n        }\n      }, 8000);\n      \n      // Update loading indicator with error\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(errorMessage, 'error');\n      }\n      \n      if (onError) {\n        onError(errorMessage);\n      }\n      \n      // Show a special message for 400 errors (likely due to API data format issues)\n      if (error.message && error.message.includes('400')) {\n        console.log('Detailed API error info to help debug the 400 Bad Request:');\n        console.log('This might be due to incorrect field formatting or missing required fields.');\n        console.log('Check the API documentation for exact field requirements.');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Check if we can save a flight (have aircraft and 2+ waypoints)\n  const canSaveFlight = selectedAircraft && waypoints && waypoints.length >= 2;\n  \n  // Button style for main button - match the app's existing styles\n  const buttonStyle = {\n    backgroundColor: canSaveFlight ? '#038dde' : '#6c757d',\n    color: 'white',\n    border: 'none',\n    borderRadius: '4px',\n    padding: '5px 10px',\n    cursor: canSaveFlight ? 'pointer' : 'not-allowed',\n    fontSize: '14px',\n    margin: '0 5px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    fontWeight: 'normal',\n    height: '32px'\n  };\n  \n  // Status indicator text - based on the current state\n  let buttonText = 'Save Flight';\n  if (isSaving) {\n    buttonText = 'Saving...';\n  } else if (isAutomating) {\n    buttonText = 'Automating...';\n  }\n  \n  return (\n    <>\n      <button \n        style={{...buttonStyle, ...props.style}}\n        onClick={handleButtonClick}\n        disabled={!canSaveFlight || isSaving || isAutomating}\n        title={canSaveFlight ? 'Save route to Palantir as a flight' : 'Select aircraft and add waypoints to save flight'}\n        className=\"control-button\"\n      >\n        {(isSaving || isAutomating) && (\n          <span \n            className=\"spinner\" \n            style={{\n              display: 'inline-block',\n              width: '14px',\n              height: '14px',\n              border: '2px solid rgba(255,255,255,0.3)',\n              borderRadius: '50%',\n              borderTopColor: 'white',\n              animation: 'spin 1s ease-in-out infinite',\n              marginRight: '8px'\n            }}\n          />\n        )}\n        {buttonText}\n      </button>\n      \n      {/* Using our modular SaveFlightModal component */}\n      <SaveFlightModal \n        isOpen={showModal}\n        onClose={closeModal}\n        onSave={handleFlightFormSubmit}\n        isSaving={isSaving || isAutomating}\n        waypoints={waypoints}\n        onRunDiagnostic={runDiagnosticMode}\n        runAutomation={runAutomation} // Pass runAutomation flag to modal\n      />\n      \n      {/* Add loading animation */}\n      <style>\n        {`\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        `}\n      </style>\n    </>\n  );\n};\n\nexport default SaveFlightButton;","import React, { useState } from 'react';\nimport { usePanelContext } from '../../context/PanelContext';\n\n/**\n * LoadFlightsButton Component\n * \n * A button that opens the Load Flights panel to select and load a saved flight\n */\nconst LoadFlightsButton = ({\n  onSuccess,\n  onError,\n  ...props // Add rest parameter to capture style and other props\n}) => {\n  const [isLoading, setIsLoading] = useState(false);\n  \n  // Access the panel context for card navigation\n  const panelContext = usePanelContext();\n  \n  const handleButtonClick = () => {\n    // Use the panel context to change to the loadflights card\n    if (panelContext && panelContext.handleCardChange) {\n      console.log('LoadFlightsButton: Using panel context to switch to loadflights card');\n      panelContext.handleCardChange('loadflights');\n    } else {\n      console.log('LoadFlightsButton: Panel context not available');\n      // For now, we won't implement a fallback modal for this button\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(\n          'Load flights feature needs to be used with the panel context', \n          'warning'\n        );\n      }\n    }\n  };\n  \n  // Button style to match the Save Flight button\n  const buttonStyle = {\n    backgroundColor: '#038dde',\n    color: 'white',\n    border: 'none',\n    borderRadius: '4px',\n    padding: '5px 10px',\n    cursor: isLoading ? 'not-allowed' : 'pointer',\n    fontSize: '14px',\n    margin: '0 5px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    fontWeight: 'normal',\n    height: '32px'\n  };\n  \n  return (\n    <button \n      style={{...buttonStyle, ...props.style}}\n      onClick={handleButtonClick}\n      disabled={isLoading}\n      title=\"Load saved flights from Palantir\"\n      className=\"control-button\"\n    >\n      {isLoading ? (\n        <>\n          <span \n            className=\"spinner\" \n            style={{\n              display: 'inline-block',\n              width: '14px',\n              height: '14px',\n              border: '2px solid rgba(255,255,255,0.3)',\n              borderRadius: '50%',\n              borderTopColor: 'white',\n              animation: 'spin 1s ease-in-out infinite',\n              marginRight: '8px'\n            }}\n          />\n          Loading...\n        </>\n      ) : (\n        'Load Flights'\n      )}\n      \n      {/* Add loading animation */}\n      <style>\n        {`\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        `}\n      </style>\n    </button>\n  );\n};\n\nexport default LoadFlightsButton;","import React from 'react';\n\n/**\n * SVG Icons for the Stop Cards\n * All blue-themed icons for consistency\n */\n\nexport const DistanceIcon = () => (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z\" \n      fill=\"#3498db\" />\n  </svg>\n);\n\nexport const TimeIcon = () => (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z\" \n      fill=\"#3498db\" />\n  </svg>\n);\n\nexport const FuelIcon = () => (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M19.77 7.23L19.78 7.22L16.06 3.5L15 4.56L17.11 6.67C16.17 7.03 15.5 7.93 15.5 9C15.5 10.38 16.62 11.5 18 11.5C18.36 11.5 18.69 11.42 19 11.29V18.5C19 19.05 18.55 19.5 18 19.5C17.45 19.5 17 19.05 17 18.5V14C17 12.9 16.1 12 15 12H14V5C14 3.9 13.1 3 12 3H6C4.9 3 4 3.9 4 5V21H14V13.5H15.5V18.5C15.5 19.88 16.62 21 18 21C19.38 21 20.5 19.88 20.5 18.5V9C20.5 8.31 20.22 7.68 19.77 7.23ZM12 10H6V5H12V10Z\" \n      fill=\"#3498db\" />\n  </svg>\n);\n\nexport const PassengerIcon = () => (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M16 11C17.66 11 18.99 9.66 18.99 8C18.99 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 10.99 9.66 10.99 8C10.99 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.67 13 1 14.17 1 16.5V19H15V16.5C15 14.17 10.33 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H23V16.5C23 14.17 18.33 13 16 13Z\" \n      fill=\"#3498db\" />\n  </svg>\n);\n\nexport const WindIcon = () => (\n  <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M14 5C14 3.9 13.1 3 12 3C10.9 3 10 3.9 10 5C10 6.1 10.9 7 12 7H20V9H12C9.24 9 7 6.76 7 4C7 1.24 9.24 -1 12 -1C14.76 -1 17 1.24 17 4V5H14ZM4 13C4 14.1 4.9 15 6 15C7.1 15 8 14.1 8 13C8 11.9 7.1 11 6 11H2V9H6C8.76 9 11 11.24 11 14C11 16.76 8.76 19 6 19C3.24 19 1 16.76 1 14V13H4ZM13 17C13 18.66 11.66 20 10 20C8.34 20 7 18.66 7 17C7 15.34 8.34 14 10 14H22V16H10C9.45 16 9 16.45 9 17C9 17.55 9.45 18 10 18H13V17Z\" \n      fill=\"#3498db\" />\n  </svg>\n);\n\n// Icon set as a component with name props\nexport const StopIcon = ({ name }) => {\n  switch (name) {\n    case 'distance':\n      return <DistanceIcon />;\n    case 'time':\n      return <TimeIcon />;\n    case 'fuel':\n      return <FuelIcon />;\n    case 'passenger':\n      return <PassengerIcon />;\n    case 'wind':\n      return <WindIcon />;\n    default:\n      return null;\n  }\n};","import React from 'react';\nimport { DistanceIcon, TimeIcon, FuelIcon, PassengerIcon, WindIcon } from './StopIcons';\n\n/**\n * StopCard Component\n * \n * Displays information about a stop in the route\n * Now includes fuel component display and departure/destination highlighting\n */\nconst StopCard = React.forwardRef(({\n  id,\n  index,\n  stopName,\n  totalDistance,\n  totalTime,\n  totalFuel,\n  maxPassengers,\n  maxPassengersDisplay,\n  groundSpeed,\n  headwind,\n  deckTime,\n  isDeparture,\n  isDestination,\n  fuelComponents,\n  isActive,\n  onClick,\n  className = ''\n}, ref) => {\n  // Function to format time as HH:MM\n  const formatTime = (timeHours) => {\n    if (!timeHours && timeHours !== 0) return '00:00';\n    const hours = Math.floor(timeHours);\n    const minutes = Math.floor((timeHours - hours) * 60);\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n  };\n\n  // Define passenger colors array\n  const colors = ['#3498db', '#614dd6', '#8c5ed6', '#c05edb', '#e27add', '#1abc9c'];\n  \n  // Get appropriate color based on index (cycle through colors if needed)\n  const getBorderColor = () => {\n    if (isDeparture) return '#3498db'; // First stop always blue\n    if (isDestination) return '#2ecc71'; // Last stop always green\n    // Use colors array for intermediate stops\n    return colors[Math.min(index, colors.length - 1)];\n  };\n  \n  // Determine card and border style\n  const borderColor = getBorderColor();\n  const cardStyle = {\n    borderLeft: `3px solid ${borderColor}`,\n    background: 'linear-gradient(to bottom, rgba(45, 55, 65, 0.95), rgba(30, 40, 50, 0.95))', // Match exact gradient of top card\n    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.4)',\n    marginBottom: '8px'\n  };\n  \n  // Combine all class names\n  const cardClasses = `stop-card ${isActive ? 'stop-card-active' : ''} ${isDeparture ? 'departure-card' : ''} ${isDestination ? 'destination-card' : ''} ${className}`;\n  \n  // Determine the display text for the stop number\n  let stopNumberDisplay = index;\n  if (isDeparture) {\n    stopNumberDisplay = 'D';\n  } else if (isDestination) {\n    stopNumberDisplay = 'F';\n  }\n  \n  // Determine the style for the stop number circle\n  const stopNumberStyle = {\n    backgroundColor: borderColor\n  };\n  \n  // Format passenger display \n  const passengersDisplay = maxPassengersDisplay || maxPassengers || (isDestination ? 'Final' : '0');\n  \n  return (\n    <div \n      id={id}\n      ref={ref}\n      className={cardClasses}\n      onClick={onClick}\n      data-index={index}\n      style={cardStyle}\n    >\n      <div className=\"stop-header\">\n        <div className=\"stop-number\" style={stopNumberStyle}>{stopNumberDisplay}</div>\n        <div className=\"stop-name\">{stopName || `Stop ${index}`}</div>\n        {headwind !== undefined && !isDeparture && (\n          <div className=\"stop-wind\" title={`Groundspeed: ${groundSpeed || 0} kts`}>\n            <span className=\"wind-value\" data-positive={headwind > 0} data-negative={headwind < 0}>\n              {headwind > 0 ? `+${headwind}` : headwind} kts\n            </span>\n          </div>\n        )}\n      </div>\n      \n      <div className=\"stop-details\">\n        {/* Total Distance */}\n        <div className=\"stop-metric\">\n          <span className=\"icon\"><DistanceIcon /></span>\n          <div className=\"metric-value\">{totalDistance || '0'} nm</div>\n        </div>\n        \n        {/* Total Time */}\n        <div className=\"stop-metric\">\n          <span className=\"icon\"><TimeIcon /></span>\n          <div className=\"metric-value\">{formatTime(totalTime)}</div>\n        </div>\n        \n        {/* Total Fuel */}\n        <div className=\"stop-metric\">\n          <span className=\"icon\"><FuelIcon /></span>\n          <div className=\"metric-value\">{totalFuel || '0'} lbs</div>\n        </div>\n        \n        {/* Passenger information */}\n        <div className=\"stop-metric\">\n          <span className=\"icon\"><PassengerIcon /></span>\n          <div className=\"metric-value\">{passengersDisplay}</div>\n        </div>\n        \n        {/* Wind information moved to header */}\n      </div>\n      \n      {/* Fuel Components - shown for all stops */}\n      {fuelComponents && (\n        <div className=\"fuel-components\">\n          <div className=\"fuel-components-text\">{fuelComponents}</div>\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default StopCard;","/**\n * PassengerCalculator.js\n * \n * Module for calculating passenger capacity per leg based on aircraft usable load,\n * fuel requirements, and passenger weight settings.\n */\n\nclass PassengerCalculator {\n  /**\n   * Calculate the maximum number of passengers that can be carried on a leg\n   * based on available usable load and fuel requirements\n   * \n   * @param {Object} aircraft - The aircraft object with usable load info\n   * @param {number} fuelWeight - The total fuel weight required for this leg (lbs)\n   * @param {number} passengerWeight - The weight per passenger (lbs)\n   * @returns {number} - The maximum number of passengers (integer)\n   */\n  static calculateMaxPassengers(aircraft, fuelWeight, passengerWeight) {\n    // Validate inputs\n    if (!aircraft) {\n      console.error('PassengerCalculator: Invalid aircraft data provided');\n      return 0;\n    }\n\n    // Ensure numeric inputs\n    const fuelWeightNum = Number(fuelWeight) || 0;\n    const passengerWeightNum = Number(passengerWeight) || 0;\n    \n    // If passenger weight is zero or invalid, return 0 to avoid division by zero\n    if (passengerWeightNum <= 0) {\n      console.error('PassengerCalculator: Invalid passenger weight (zero or negative)');\n      return 0;\n    }\n    \n    // Calculate available load for passengers\n    let usableLoadWithoutFuel = 0;\n    \n    // First, try to use aircraft.usableLoad property if it exists\n    // This would be the most direct and accurate way\n    if (aircraft.usableLoad !== undefined) {\n      // Ensure we're properly subtracting fuel when using usableLoad\n      usableLoadWithoutFuel = Number(aircraft.usableLoad) - fuelWeightNum;\n      console.log('PassengerCalculator: Using aircraft.usableLoad directly:', aircraft.usableLoad, 'minus fuel:', fuelWeightNum, '=', usableLoadWithoutFuel);\n    }\n    // Then, try to use aircraft.usefulLoad property if it exists (from OSDK data)\n    else if (aircraft.usefulLoad !== undefined) {\n      // Ensure we're properly subtracting fuel when using usefulLoad\n      usableLoadWithoutFuel = Number(aircraft.usefulLoad) - fuelWeightNum;\n      console.log('PassengerCalculator: Using aircraft.usefulLoad directly:', aircraft.usefulLoad, 'minus fuel:', fuelWeightNum, '=', usableLoadWithoutFuel);\n    }\n    // If not available, calculate it from maxTakeoffWeight and emptyWeight\n    else if (aircraft.maxTakeoffWeight && aircraft.emptyWeight) {\n      usableLoadWithoutFuel = aircraft.maxTakeoffWeight - aircraft.emptyWeight - fuelWeightNum;\n      console.log('PassengerCalculator: Calculated usableLoad from weight data:', usableLoadWithoutFuel);\n    } \n    // If neither option is available, return 0\n    else {\n      console.error('PassengerCalculator: Cannot calculate usableLoad - missing aircraft weight data');\n      return 0;\n    }\n    \n    // Ensure usable load is not negative\n    usableLoadWithoutFuel = Math.max(0, usableLoadWithoutFuel);\n    \n    // Calculate max passengers based on usable load and passenger weight\n    const maxByWeight = Math.floor(usableLoadWithoutFuel / passengerWeightNum);\n    \n    // Limit by aircraft's maximum passenger capacity if available\n    const aircraftMaxPax = aircraft.maxPassengers || Number.MAX_SAFE_INTEGER;\n    \n    // Return the lower value (can't exceed aircraft capacity)\n    const result = Math.min(maxByWeight, aircraftMaxPax);\n    \n    console.log('PassengerCalculator result:', {\n      usableLoadWithoutFuel,\n      maxByWeight,\n      aircraftMaxPax,\n      result\n    });\n    \n    return result;\n  }\n  \n  /**\n   * Calculate passenger capacity for all legs in a route\n   * \n   * @param {Array} legs - Array of leg objects with fuel requirements\n   * @param {Object} aircraft - The aircraft object with usable load info\n   * @param {number} passengerWeight - The weight per passenger (lbs)\n   * @returns {Array} - Array of passenger capacities for each leg\n   */\n  static calculatePassengersForRoute(legs, aircraft, passengerWeight) {\n    if (!Array.isArray(legs) || legs.length === 0) {\n      console.error('PassengerCalculator: Invalid legs data');\n      return [];\n    }\n    \n    return legs.map((leg, index) => {\n      // Get the fuel required for this leg\n      const fuelRequired = leg.totalFuel || leg.fuel || 0;\n      \n      // Calculate max passengers for this leg\n      const maxPassengers = this.calculateMaxPassengers(\n        aircraft,\n        fuelRequired,\n        passengerWeight\n      );\n      \n      console.log(`PassengerCalculator: Leg ${index + 1} can carry ${maxPassengers} passengers`);\n      \n      return maxPassengers;\n    });\n  }\n  \n  /**\n   * Update stopCards with passenger information\n   * \n   * @param {Array} stopCards - Array of stop card objects to update\n   * @param {Object} aircraft - The aircraft object\n   * @param {number} passengerWeight - The weight per passenger (lbs)\n   * @returns {Array} - Updated stopCards with passenger info\n   */\n  static updateStopCardsWithPassengers(stopCards, aircraft, passengerWeight) {\n    if (!Array.isArray(stopCards) || stopCards.length === 0) {\n      console.error('PassengerCalculator: Invalid stop cards data');\n      return stopCards;\n    }\n    \n    // Clone the input array to avoid modifying the original\n    const updatedCards = [...stopCards];\n    \n    // Process each stop card\n    updatedCards.forEach((card, index) => {\n      // Get fuel for this stop (either directly or from fuel components)\n      const fuelRequired = card.totalFuel || \n        (card.fuelComponentsObject ? \n          (card.fuelComponentsObject.tripFuel + \n           card.fuelComponentsObject.contingencyFuel + \n           card.fuelComponentsObject.taxiFuel + \n           card.fuelComponentsObject.deckFuel + \n           card.fuelComponentsObject.reserveFuel) : 0);\n      \n      // Calculate max passengers\n      const maxPassengers = this.calculateMaxPassengers(\n        aircraft,\n        fuelRequired,\n        passengerWeight\n      );\n      \n      // Update the card with passenger info\n      card.maxPassengers = maxPassengers;\n      card.maxPassengersDisplay = maxPassengers.toString();\n      \n      console.log(`PassengerCalculator: Stop ${index + 1} (${card.stopName || 'Unknown'}) can carry ${maxPassengers} passengers`);\n    });\n    \n    return updatedCards;\n  }\n}\n\nexport default PassengerCalculator;\n","/**\n * StopCardCalculator.js\n * \n * Dedicated module for calculating stop card data for flight routes\n * based on waypoints, aircraft performance, and weather conditions.\n * \n * IMPORTANT: This module NEVER uses hardcoded values for critical flight parameters.\n * All calculations rely on actual aircraft performance data from the selected aircraft.\n */\n\n// Import the PassengerCalculator module for passenger calculations\nimport PassengerCalculator from '../passengers/PassengerCalculator';\n\n/**\n * Calculate stop cards data for a route\n * Shows the fuel required to continue from each waypoint\n * \n * @param {Array} waypoints - Waypoints array\n * @param {Object} routeStats - Route statistics\n * @param {Object} selectedAircraft - Selected aircraft with performance data\n * @param {Object} weather - Weather data (windSpeed, windDirection)\n * @param {Object} options - Optional calculation parameters\n * @returns {Array} Array of stop card objects\n */\nconst calculateStopCards = (waypoints, routeStats, selectedAircraft, weather, options = {}) => {\n  // Extract options with defaults for safety, but these should always be provided\n  const {\n    passengerWeight = 0,  // Default to 0 to make missing settings obvious\n    taxiFuel = 0,         // Default to 0 to make missing settings obvious\n    contingencyFuelPercent = 0, // Default to 0 to make missing settings obvious\n    reserveFuel = 0,      // Default to 0 to make missing settings obvious\n    deckTimePerStop = 0,  // Default to 0 to make missing settings obvious\n    deckFuelFlow = 0      // Default to 0 to make missing settings obvious\n  } = options;\n  \n  // Log all received values for debugging\n  console.log('🧰 StopCardCalculator received raw values:', {\n    taxiFuel,\n    passengerWeight,\n    contingencyFuelPercent,\n    reserveFuel,\n    deckTimePerStop,\n    deckFuelFlow\n  });\n  \n  // Convert all calculation parameters to proper numeric values\n  const taxiFuelValue = Number(taxiFuel);\n  const passengerWeightValue = Number(passengerWeight);\n  const contingencyFuelPercentValue = Number(contingencyFuelPercent);\n  const reserveFuelValue = Number(reserveFuel);\n  const deckTimePerStopValue = Number(deckTimePerStop);\n  const deckFuelFlowValue = Number(deckFuelFlow);\n  \n  // Log converted values for debugging\n  console.log('🧰 StopCardCalculator using numeric values:', {\n    taxiFuelValue,\n    passengerWeightValue,\n    contingencyFuelPercentValue,\n    reserveFuelValue,\n    deckTimePerStopValue,\n    deckFuelFlowValue\n  });\n\n  // Validate input data\n  if (!waypoints || waypoints.length < 2 || !selectedAircraft) {\n    console.log('StopCardCalculator: Missing required data', {\n      hasWaypoints: waypoints ? waypoints.length : 0,\n      hasAircraft: !!selectedAircraft\n    });\n    return [];\n  }\n  \n  // Validate calculation parameters - Log warnings but don't fail\n  if (isNaN(passengerWeightValue) || passengerWeightValue <= 0) {\n    console.warn('StopCardCalculator: Invalid passengerWeight:', passengerWeight);\n  }\n  \n  if (isNaN(taxiFuelValue)) {\n    console.warn('StopCardCalculator: Invalid taxiFuel:', taxiFuel);\n  }\n  \n  if (isNaN(contingencyFuelPercentValue) || contingencyFuelPercentValue < 0) {\n    console.warn('StopCardCalculator: Invalid contingencyFuelPercent:', contingencyFuelPercent);\n  }\n  \n  if (isNaN(reserveFuelValue)) {\n    console.warn('StopCardCalculator: Invalid reserveFuel:', reserveFuel);\n  }\n  \n  if (isNaN(deckTimePerStopValue) || deckTimePerStopValue < 0) {\n    console.warn('StopCardCalculator: Invalid deckTimePerStop:', deckTimePerStop);\n  }\n  \n  if (isNaN(deckFuelFlowValue) || deckFuelFlowValue < 0) {\n    console.warn('StopCardCalculator: Invalid deckFuelFlow:', deckFuelFlow);\n  }\n\n  console.log('StopCardCalculator: Generating stop cards with', waypoints.length, 'waypoints');\n\n  // Create data for each stop\n  const cards = [];\n\n  // Get aircraft data for calculations\n  const aircraft = selectedAircraft;\n\n  // Calculate total trip values\n  let totalDistance = 0;\n  let totalTripFuel = 0;\n  const legDetails = [];\n\n  // First, pre-calculate all leg details and total values\n  for (let i = 0; i < waypoints.length - 1; i++) {\n    const fromWaypoint = waypoints[i];\n    const toWaypoint = waypoints[i + 1];\n\n    // Calculate leg distance\n    let legDistance = 0;\n    if (routeStats && routeStats.legs && routeStats.legs[i]) {\n      legDistance = parseFloat(routeStats.legs[i].distance);\n    } else if (window.turf) {\n      // Calculate using turf\n      const from = window.turf.point(fromWaypoint.coords);\n      const to = window.turf.point(toWaypoint.coords);\n      legDistance = window.turf.distance(from, to, { units: 'nauticalmiles' });\n    }\n\n    // Calculate leg time and fuel with wind adjustments\n    let legTimeHours = 0;\n    let legFuel = 0;\n    let legGroundSpeed = aircraft.cruiseSpeed;\n    let headwindComponent = 0;\n\n    // Check for coordinates\n    const fromHasCoords = (fromWaypoint.lat && fromWaypoint.lon) ||\n                          (fromWaypoint.coords && fromWaypoint.coords.length === 2);\n    const toHasCoords = (toWaypoint.lat && toWaypoint.lon) ||\n                        (toWaypoint.coords && toWaypoint.coords.length === 2);\n\n    if (fromHasCoords && toHasCoords) {\n      // Create lat/lon objects\n      const fromCoords = {\n        lat: fromWaypoint.lat || fromWaypoint.coords[1],\n        lon: fromWaypoint.lon || fromWaypoint.coords[0]\n      };\n\n      const toCoords = {\n        lat: toWaypoint.lat || toWaypoint.coords[1],\n        lon: toWaypoint.lon || toWaypoint.coords[0]\n      };\n\n      // Calculate with wind if available\n      if (window.WindCalculations) {\n        try {\n          const legDetails = window.WindCalculations.calculateLegWithWind(\n            fromCoords,\n            toCoords,\n            legDistance,\n            aircraft,\n            weather\n          );\n\n          legTimeHours = legDetails.time;\n          legFuel = Math.round(legDetails.fuel);\n          legGroundSpeed = Math.round(legDetails.groundSpeed);\n          headwindComponent = Math.round(legDetails.headwindComponent);\n        } catch (error) {\n          // Fallback to basic calculation\n          legTimeHours = legDistance / aircraft.cruiseSpeed;\n          legFuel = Math.round(legTimeHours * aircraft.fuelBurn);\n          legGroundSpeed = aircraft.cruiseSpeed;\n          headwindComponent = 0;\n        }\n      } else {\n        // Basic calculation\n        legTimeHours = legDistance / aircraft.cruiseSpeed;\n        legFuel = Math.round(legTimeHours * aircraft.fuelBurn);\n        legGroundSpeed = aircraft.cruiseSpeed;\n        headwindComponent = 0;\n      }\n    } else {\n      // Simple calculation\n      legTimeHours = legDistance / aircraft.cruiseSpeed;\n      legFuel = Math.round(legTimeHours * aircraft.fuelBurn);\n    }\n\n    // Update totals\n    totalDistance += legDistance;\n    totalTripFuel += legFuel;\n\n    // Store leg details for later use\n    legDetails.push({\n      fromWaypoint,\n      toWaypoint,\n      distance: legDistance,\n      timeHours: legTimeHours,\n      fuel: legFuel,\n      groundSpeed: legGroundSpeed,\n      headwind: headwindComponent\n    });\n  }\n\n  // Calculate auxiliary fuel values\n  // Using our converted numeric values\n  \n  // Log the numeric values being used\n  console.log('⛽ Using numeric fuel values:', {\n    taxiFuelValue, \n    reserveFuelValue,\n    contingencyFuelPercentValue,\n    deckTimePerStopValue,\n    deckFuelFlowValue\n  });\n\n  // Calculate intermediate stops (for deck fuel)\n  const intermediateStops = Math.max(0, waypoints.length - 2);\n  \n  // Calculate deck time and fuel\n  const deckTimeHours = (intermediateStops * deckTimePerStopValue) / 60; // Convert from minutes to hours\n  const deckFuelValue = Math.round(deckTimeHours * deckFuelFlowValue);\n\n  // Calculate contingency fuel\n  const contingencyFuelValue = Math.round((totalTripFuel * contingencyFuelPercentValue) / 100);\n  \n  // Log the calculated values with more detail\n  console.log('🧮 Calculated auxiliary values with detailed breakdown:', {\n    taxiFuel_passedValue: taxiFuel,\n    taxiFuel_convertedValue: taxiFuelValue,\n    taxiFuel_afterConversion: taxiFuelValue,\n    \n    reserveFuel_passedValue: reserveFuel,\n    reserveFuel_convertedValue: reserveFuelValue,\n    \n    contingencyFuelPercent_passedValue: contingencyFuelPercent,\n    contingencyFuelPercent_convertedValue: contingencyFuelPercentValue,\n    contingencyFuelPercent_calculation: `${totalTripFuel} * ${contingencyFuelPercentValue} / 100 = ${contingencyFuelValue}`,\n    contingencyFuelValue,\n    \n    deckTimePerStop_passedValue: deckTimePerStop,\n    deckTimePerStop_convertedValue: deckTimePerStopValue,\n    \n    deckFuelFlow_passedValue: deckFuelFlow,\n    deckFuelFlow_convertedValue: deckFuelFlowValue,\n    \n    deckFuel_calculation: `${intermediateStops} stops * (${deckTimePerStopValue} mins / 60) hrs * ${deckFuelFlowValue} lbs/hr = ${deckFuelValue}`,\n    deckFuelValue,\n    \n    intermediateStops,\n    totalTripFuel\n  });\n\n  // Calculate total fuel required for the entire trip\n  const totalFuelRequired = taxiFuelValue + totalTripFuel + contingencyFuelValue + reserveFuelValue + deckFuelValue;\n\n  // Create a departure card first\n  if (waypoints.length >= 2) {\n    const departureWaypoint = waypoints[0];\n    \n    // Total fuel needed for entire journey at departure\n    const departureFuelNeeded = totalTripFuel + contingencyFuelValue + taxiFuelValue + deckFuelValue + reserveFuelValue;\n    \n    // Create fuel components text for departure\n    const departureFuelComponentsText = `Trip:${totalTripFuel} Cont:${contingencyFuelValue} Taxi:${taxiFuelValue} Deck:${deckFuelValue} Res:${reserveFuelValue}`;\n    \n    // DEBUG: Log the fuel components for departure\n    console.log('🔥 DEPARTURE CARD FUEL COMPONENTS (DETAILED):', {\n      totalTripFuel,\n      contingencyFuelValue,\n      taxiFuelValue,\n      deckFuelValue,\n      reserveFuelValue,\n      departureFuelNeeded,\n      actualSum: totalTripFuel + contingencyFuelValue + taxiFuelValue + deckFuelValue + reserveFuelValue,\n      componentText: departureFuelComponentsText\n    });\n    \n    // Calculate max passengers for departure using PassengerCalculator\n    let departureMaxPassengers = 0;\n    if (selectedAircraft) {\n      // Use our dedicated PassengerCalculator module\n      departureMaxPassengers = PassengerCalculator.calculateMaxPassengers(\n        selectedAircraft, \n        departureFuelNeeded, \n        passengerWeightValue\n      );\n    }\n    \n    // Create departure card with detailed console logging\n    console.log('🔎 Creating departure card with components:', {\n      tripFuel: totalTripFuel,\n      contingencyFuel: contingencyFuelValue,\n      contingencyRate: `${contingencyFuelPercentValue}%`,\n      taxiFuel: taxiFuelValue,\n      deckFuel: deckFuelValue,\n      reserveFuel: reserveFuelValue,\n      totalFuel: departureFuelNeeded,\n      componentText: departureFuelComponentsText\n    });\n    \n    const departureCard = {\n      index: 'D',\n      id: departureWaypoint.id || 'departure',\n      stopName: departureWaypoint.name,\n      legDistance: '0.0',\n      totalDistance: '0.0',\n      legTime: 0,\n      totalTime: 0,\n      legFuel: 0,\n      totalFuel: departureFuelNeeded,\n      maxPassengers: departureMaxPassengers,\n      maxPassengersDisplay: departureMaxPassengers,\n      maxPassengersWeight: departureMaxPassengers * passengerWeightValue,\n      groundSpeed: 0,\n      headwind: 0,\n      deckTime: deckTimeHours * 60, // Convert back to minutes for display\n      deckFuel: deckFuelValue,\n      fuelComponents: departureFuelComponentsText,\n      fuelComponentsObject: {\n        tripFuel: totalTripFuel,\n        contingencyFuel: contingencyFuelValue,\n        taxiFuel: taxiFuelValue,\n        deckFuel: deckFuelValue,\n        reserveFuel: reserveFuelValue\n      },\n      isDeparture: true,\n      isDestination: false\n    };\n    \n    // Add the departure card to our cards array\n    cards.push(departureCard);\n  }\n\n  // Now create cards for each intermediate stop and destination\n  let cumulativeDistance = 0;\n  let cumulativeTime = 0;\n\n  for (let i = 0; i < legDetails.length; i++) {\n    const legDetail = legDetails[i];\n    const toWaypoint = legDetail.toWaypoint;\n\n    // Create a unique ID for this stop\n    const stopId = toWaypoint.id || `waypoint-${i+1}`;\n\n    // Update cumulative values for distance and time (for display only)\n    cumulativeDistance += legDetail.distance;\n    cumulativeTime += legDetail.timeHours;\n\n    // Calculate remaining trip fuel - sum of all legs after this one\n    let remainingTripFuel = 0;\n    for (let j = i + 1; j < legDetails.length; j++) {\n      remainingTripFuel += legDetails[j].fuel;\n    }\n\n    // Calculate remaining number of deck stops\n    // This is critical - only count intermediate stops after this point\n    // For a route like: A → B → C → D\n    // At point A: B and C are intermediate (2 deck stops)\n    // At point B: Only C is intermediate (1 deck stop)\n    // At point C: No more intermediate stops (0 deck stops)\n    const remainingIntermediateStops = Math.max(0, legDetails.length - i - 1 - 1); // -1 for current leg, -1 for final leg\n\n    // Calculate remaining deck fuel - only for intermediate stops\n    const remainingDeckTimeHours = (remainingIntermediateStops * deckTimePerStopValue) / 60;\n    const remainingDeckFuel = Math.round(remainingDeckTimeHours * deckFuelFlowValue);\n\n    // Calculate remaining contingency fuel (proportional to remaining trip fuel)\n    let remainingContingencyFuel = 0;\n    if (totalTripFuel > 0) {\n      remainingContingencyFuel = Math.round((remainingTripFuel / totalTripFuel) * contingencyFuelValue);\n    }\n\n    // At the final destination, we only have reserve and unused contingency\n    const isFinalDestination = i === legDetails.length - 1;\n\n    // Calculate the fuel needed at this stop to continue the journey\n    let fuelNeeded;\n    let fuelComponents;\n    let fuelComponentsText;\n\n    if (isFinalDestination) {\n      // At the final destination, you have reserve fuel and unused contingency\n      // For potential landing fuel, we should show the total contingency (from departure)\n      // not just the remaining contingency for this leg\n      fuelNeeded = reserveFuelValue + remainingContingencyFuel;\n      fuelComponents = {\n        reserveFuel: reserveFuelValue,\n        contingencyFuel: remainingContingencyFuel,\n        extraFuel: 0 // Can be used for alternate or holding fuel\n      };\n\n      // Get the original full contingency amount (from departure)\n      const fullContingencyFuel = contingencyFuelValue;\n\n      if (routeStats?.enhancedResults?.auxiliaryFuel?.contingencyFuel) {\n        // If we have enhanced results, use the exact contingency fuel\n        fuelComponents.contingencyFuel = routeStats.enhancedResults.auxiliaryFuel.contingencyFuel;\n      }\n\n      // Calculate potential landing fuel (reserve + full unused contingency)\n      const potentialLandingFuel = reserveFuelValue + fullContingencyFuel;\n      fuelComponentsText = `Reserve:${reserveFuelValue} Extra:0 FullCont:${remainingContingencyFuel} (${reserveFuelValue}+${fullContingencyFuel}=${potentialLandingFuel})`;\n      \n      // Log the destination fuel components\n      console.log('🔚 DESTINATION CARD FUEL COMPONENTS:', {\n        reserveFuel: reserveFuelValue,\n        fullContingencyFuel,\n        remainingContingencyFuel,\n        potentialLandingFuel,\n        componentText: fuelComponentsText\n      });\n    } else {\n      // At intermediate stops, you need fuel for remaining legs, plus reserve\n      fuelNeeded = remainingTripFuel + remainingContingencyFuel + remainingDeckFuel + reserveFuelValue;\n      fuelComponents = {\n        remainingTripFuel: remainingTripFuel,\n        contingencyFuel: remainingContingencyFuel,\n        deckFuel: remainingDeckFuel,\n        reserveFuel: reserveFuelValue\n      };\n      fuelComponentsText = `Trip:${remainingTripFuel} Cont:${remainingContingencyFuel} Res:${reserveFuelValue}`;\n\n      // Add deck fuel text only if there are remaining intermediate stops\n      if (remainingDeckFuel > 0) {\n        fuelComponentsText += ` Deck:${remainingDeckFuel}`;\n      }\n      \n      // Log the intermediate stop fuel components\n      console.log('🛑 INTERMEDIATE STOP FUEL COMPONENTS:', {\n        remainingTripFuel,\n        remainingContingencyFuel,\n        remainingDeckFuel,\n        reserveFuel: reserveFuelValue,\n        fuelNeeded,\n        componentText: fuelComponentsText\n      });\n    }\n\n    // Calculate max passengers using our PassengerCalculator module\n    let maxPassengers = 0;\n    if (selectedAircraft) {\n      // Use our dedicated PassengerCalculator module\n      maxPassengers = PassengerCalculator.calculateMaxPassengers(\n        selectedAircraft, \n        fuelNeeded, \n        passengerWeightValue\n      );\n    }\n\n    // For final destination, show \"Final Stop\" instead of passenger count\n    const displayMaxPassengers = isFinalDestination ? \"Final Stop\" : maxPassengers;\n    const maxPassengersValue = isFinalDestination ? null : maxPassengers;\n    const maxPassengersWeight = isFinalDestination ? null : (maxPassengers * passengerWeightValue);\n\n    // Only the final waypoint is a destination\n    const isDeparture = false; // We already added the departure card\n    const isDestination = isFinalDestination;\n\n    // Create the card data\n    const cardData = {\n      index: isFinalDestination ? 'F' : (i + 1),\n      id: stopId,\n      stopName: toWaypoint.name,\n      legDistance: legDetail.distance.toFixed(1),\n      totalDistance: cumulativeDistance.toFixed(1),\n      legTime: Number(legDetail.timeHours),\n      totalTime: Number(cumulativeTime),\n      legFuel: Number(legDetail.fuel),\n      // The fuel shown is what's needed to continue from this point\n      totalFuel: Number(fuelNeeded),\n      maxPassengers: maxPassengersValue,\n      maxPassengersDisplay: displayMaxPassengers,\n      maxPassengersWeight: maxPassengersWeight,\n      groundSpeed: Number(legDetail.groundSpeed),\n      headwind: Number(legDetail.headwind),\n      deckTime: Number(remainingDeckTimeHours * 60), // Convert back to minutes for display\n      deckFuel: Number(remainingDeckFuel),\n      fuelComponents: fuelComponentsText,\n      fuelComponentsObject: fuelComponents,\n      isDeparture: isDeparture,\n      isDestination: isDestination\n    };\n\n    cards.push(cardData);\n  }\n\n  return cards;\n};\n\nexport default {\n  calculateStopCards\n};","import React, { useState, useEffect, useRef } from 'react';\nimport StopCard from './StopCard';\nimport StopCardCalculator from '../../../modules/calculations/flight/StopCardCalculator';\n\n/**\n * StopCardsContainer Component\n * \n * Manages and displays a collection of StopCard components\n * based on the current route waypoints with smooth reordering animations\n * Fuel requirements and passenger capacity are calculated internally\n * \n * Note: stopCards prop is accepted but ignored for backward compatibility\n */\nconst StopCardsContainer = ({\n  waypoints = [],\n  routeStats = null,\n  selectedAircraft = null,\n  passengerWeight,  // No default - must be provided\n  reserveFuel,      // No default - must be provided\n  contingencyFuelPercent, // Fixed parameter name to match StopCardCalculator\n  deckTimePerStop,  // No default - must be provided\n  deckFuelFlow,     // No default - must be provided \n  taxiFuel,         // No default - must be provided\n  weather = { windSpeed: 0, windDirection: 0 }, // Default to no wind\n  stopCards = [] // Kept for backward compatibility but not used\n}) => {\n  const [calculatedStopCards, setCalculatedStopCards] = useState([]);\n  const [activeCardIndex, setActiveCardIndex] = useState(null);\n  const [cardPositions, setCardPositions] = useState({});\n  const [animatingCards, setAnimatingCards] = useState({});\n  const prevWaypointsRef = useRef([]);\n  const cardRefs = useRef({});\n  const containerRef = useRef(null);\n  \n  // Calculate stop cards data whenever relevant inputs change\n  useEffect(() => {\n    console.log('🔍 StopCardsContainer useEffect triggered with:', {\n      waypointsLength: waypoints?.length || 0,\n      taxiFuel: taxiFuel, // Using direct taxiFuel value with no transformation\n      deckTimePerStop,\n      deckFuelFlow,\n      reserveFuel,\n      contingencyFuelPercent, // Fixed parameter name to match StopCardCalculator\n      hasAircraft: !!selectedAircraft,\n      hasRouteStats: !!routeStats\n    });\n    \n    if (waypoints.length < 2) {\n      setCalculatedStopCards([]);\n      prevWaypointsRef.current = [];\n      return;\n    }\n    \n    // Add debug logging for weather data\n    console.log('StopCardsContainer: Processing with weather data:', weather);\n    \n    // Store current card positions before update\n    const currentPositions = {};\n    calculatedStopCards.forEach(card => {\n      const cardId = `stop-${card.id || card.index}`;\n      const cardElement = document.getElementById(cardId);\n      if (cardElement) {\n        currentPositions[cardId] = cardElement.getBoundingClientRect();\n      }\n    });\n    \n    // If we have positions, store them\n    if (Object.keys(currentPositions).length > 0) {\n      setCardPositions(currentPositions);\n    }\n    \n    // Get aircraft data for calculations\n    // If no aircraft is selected, we'll show zeros\n    if (!selectedAircraft) {\n      console.log('StopCardsContainer: No aircraft selected, setting empty stop cards');\n      setCalculatedStopCards([]);\n      return;\n    }\n    \n    // Check if aircraft has all required properties\n    if (!selectedAircraft.cruiseSpeed || !selectedAircraft.fuelBurn) {\n      console.log('StopCardsContainer: Aircraft missing required properties, setting empty stop cards');\n      setCalculatedStopCards([]);\n      return;\n    }\n    \n    // Use the StopCardCalculator to calculate the stop cards\n    // Log input values to debug\n    console.log('🧮 StopCardsContainer calculating with taxiFuel directly from props:', taxiFuel);\n    \n    const newCards = StopCardCalculator.calculateStopCards(\n      waypoints, \n      routeStats, \n      selectedAircraft, \n      weather, \n      {\n        passengerWeight,\n        reserveFuel,\n        contingencyFuelPercent, // Fixed: use the correct parameter name\n        deckTimePerStop,\n        deckFuelFlow,\n        taxiFuel // Pass the original value directly\n      }\n    );\n    \n    // Mark new cards\n    const updatedCards = newCards.map(card => ({\n      ...card,\n      isNew: prevWaypointsRef.current.findIndex(wp => wp.id === card.id) === -1\n    }));\n    \n    // Update cards state\n    setCalculatedStopCards(updatedCards);\n    \n    // Update previous waypoints\n    prevWaypointsRef.current = [...waypoints];\n  }, [waypoints, routeStats, selectedAircraft, passengerWeight, reserveFuel, contingencyFuelPercent, deckTimePerStop, deckFuelFlow, taxiFuel, weather]);\n  \n  // Apply FLIP animation after cards update\n  useEffect(() => {\n    if (Object.keys(cardPositions).length === 0 || calculatedStopCards.length === 0) {\n      return;\n    }\n    \n    // Calculate final positions and prepare animations\n    requestAnimationFrame(() => {\n      const newAnimating = {};\n      \n      calculatedStopCards.forEach(card => {\n        const cardId = `stop-${card.id}`;\n        const cardElement = document.getElementById(cardId);\n        \n        if (cardElement && cardPositions[cardId]) {\n          // Get the old and new positions\n          const oldPos = cardPositions[cardId];\n          const newPos = cardElement.getBoundingClientRect();\n          \n          // Calculate the difference\n          const deltaY = oldPos.top - newPos.top;\n          \n          // If there's a significant change, animate it\n          if (Math.abs(deltaY) > 5) {\n            // Set the initial position\n            cardElement.style.transform = `translateY(${deltaY}px)`;\n            cardElement.style.transition = 'none';\n            \n            // Force reflow\n            cardElement.offsetHeight;\n            \n            // Add moving class and set transition back\n            cardElement.classList.add('moving');\n            cardElement.style.transform = '';\n            cardElement.style.transition = 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)';\n            \n            // Track which cards are animating\n            newAnimating[cardId] = true;\n            \n            // Clean up after animation\n            setTimeout(() => {\n              if (cardElement) {\n                cardElement.classList.remove('moving');\n                setAnimatingCards(prev => {\n                  const updated = {...prev};\n                  delete updated[cardId];\n                  return updated;\n                });\n              }\n            }, 500);\n          }\n        }\n      });\n      \n      if (Object.keys(newAnimating).length > 0) {\n        setAnimatingCards(newAnimating);\n      }\n      \n      // Clear stored positions\n      setCardPositions({});\n    });\n  }, [calculatedStopCards, cardPositions]);\n  \n  // Handle card click\n  const handleCardClick = (index) => {\n    setActiveCardIndex(index === activeCardIndex ? null : index);\n  };\n  \n  // Save reference to card element\n  const setCardRef = (id, el) => {\n    if (el) {\n      cardRefs.current[id] = el;\n    }\n  };\n  \n  // If there are no cards, don't render anything\n  if (calculatedStopCards.length === 0) {\n    return null;\n  }\n  \n  return (\n    <div className=\"route-stops\" style={{ margin: '0', padding: '4px 10px' }}>\n      <h4 className=\"route-stops-title\" style={{ margin: '0 0 4px 0', fontSize: '0.9em' }}>ROUTE STOPS</h4>\n      \n      <div className=\"stop-cards-container\" style={{ marginTop: '0', paddingTop: '0' }}>\n        <div className=\"stop-cards-stack\" ref={containerRef}>\n          {calculatedStopCards.map((card, index) => {\n            const cardId = `stop-${card.id}`;\n            let className = '';\n            \n            if (card.isNew) {\n              className = 'new-card';\n            } else if (animatingCards[cardId]) {\n              className = 'moving';\n            }\n            \n            return (\n              <StopCard\n                key={cardId}\n                id={cardId}\n                index={card.index}\n                stopName={card.stopName}\n                totalDistance={card.totalDistance}\n                totalTime={card.totalTime}\n                totalFuel={card.totalFuel}\n                maxPassengers={card.maxPassengers}\n                maxPassengersDisplay={card.maxPassengersDisplay}\n                groundSpeed={card.groundSpeed}\n                headwind={card.headwind}\n                deckTime={card.deckTime}\n                isDeparture={card.isDeparture}\n                isDestination={card.isDestination}\n                fuelComponents={card.fuelComponents}\n                isActive={index === activeCardIndex}\n                onClick={() => handleCardClick(index)}\n                className={className}\n                ref={el => setCardRef(cardId, el)}\n              />\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default StopCardsContainer;","import React, { useState } from 'react';\nimport RegionSelector from '../../controls/RegionSelector';\nimport { SaveFlightButton, LoadFlightsButton } from '../../controls';\nimport { StopCardsContainer } from '../../flight/stops';\nimport '../../flight/stops/StopCards.css';\n\n/**\n * MainCard Component\n * \n * Contains the main controls including region selection, aircraft configuration,\n * and route statistics from the original RightPanel component.\n */\nconst MainCard = ({\n  onClearRoute,\n  onLoadRigData,\n  onToggleChart,\n  chartsVisible,\n  aircraftType,\n  onAircraftTypeChange,\n  aircraftRegistration,\n  onAircraftRegistrationChange,\n  selectedAircraft,\n  aircraftsByType,\n  aircraftLoading,\n  routeStats,\n  isAuthenticated,\n  authUserName,\n  rigsLoading,\n  onLogin,\n  // Region selector props\n  regions = [],\n  currentRegion = null,\n  onRegionChange = () => {},\n  regionLoading = false,\n  // Read-only values from settings\n  reserveFuel = 0, // Changed default to 0 for safety\n  // Waypoints for stop cards\n  waypoints = [],\n  passengerWeight = 0, // Changed default to 0 for safety\n  deckTimePerStop = 0, // Changed default to 0 for safety\n  deckFuelFlow = 0, // Changed default to 0 for safety\n  contingencyFuelPercent = 0, // Added with 0 default for safety\n  taxiFuel = 0, // Added with 0 default for safety\n  // Stop cards prop\n  stopCards = [],\n  // Weather props\n  weather = { windSpeed: 15, windDirection: 270 },\n  onWeatherUpdate = () => {},\n}) => {\n  // Status message handlers for the Save Flight button\n  const handleSaveSuccess = (message) => {\n    if (window.LoadingIndicator) {\n      window.LoadingIndicator.updateStatusIndicator(message, 'success');\n    } else {\n      alert(message);\n    }\n  };\n  \n  const handleSaveError = (error) => {\n    if (window.LoadingIndicator) {\n      window.LoadingIndicator.updateStatusIndicator(error, 'error');\n    } else {\n      alert(error);\n    }\n  };\n  \n  // State to track if registration section is expanded\n  const [isRegistrationExpanded, setIsRegistrationExpanded] = useState(!selectedAircraft);\n  \n  // Automatically expand/collapse based on selection changes\n  React.useEffect(() => {\n    if (selectedAircraft) {\n      // Collapse when aircraft is selected\n      setIsRegistrationExpanded(false);\n    } else if (aircraftType) {\n      // Expand when aircraft type is selected but no aircraft is selected\n      setIsRegistrationExpanded(true);\n    }\n  }, [selectedAircraft, aircraftType]);\n  \n  return (\n    <div className=\"tab-content main-tab\">\n      <div className=\"panel-header\">\n        <div className=\"region-selector-container\">\n          <RegionSelector\n            regions={regions}\n            currentRegion={currentRegion}\n            onRegionChange={onRegionChange}\n            isLoading={regionLoading}\n          />\n        </div>\n      </div>\n      \n      <div className=\"control-section\" style={{ display: 'flex', justifyContent: 'space-between', width: '100%', marginBottom: '15px' }}>\n        {/* Save and Load Flight buttons - Side by Side with exactly 7px gap to match left buttons */}\n        <div style={{ display: 'flex', width: '100%', gap: '7px' }}>\n          <SaveFlightButton\n            selectedAircraft={selectedAircraft}\n            waypoints={waypoints}\n            routeStats={routeStats}\n            currentRegion={currentRegion}\n            onSuccess={handleSaveSuccess}\n            onError={handleSaveError}\n            style={{ flex: 1, margin: 0 }}\n          />\n          <LoadFlightsButton \n            style={{ flex: 1, margin: 0 }}\n            onSuccess={(message) => {\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator(message, 'success');\n              }\n            }}\n            onError={(error) => {\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator(error, 'error');\n              }\n            }}\n          />\n        </div>\n        {/* Manual reload button - hidden by default but useful for development */}\n        <button \n          id=\"reload-data\" \n          className=\"control-button\" \n          onClick={onLoadRigData}\n          disabled={rigsLoading}\n          style={{ display: 'none' }} /* Hidden by default */\n        >\n          {rigsLoading ? 'Loading...' : 'Reload Data'}\n        </button>\n      </div>\n      \n      <div className=\"control-section\">\n        <h4>Aircraft Configuration</h4>\n        <label htmlFor=\"aircraft-type\">Aircraft Type:</label>\n        {/* Simple aircraft type selection dropdown */}\n        <select \n          id=\"aircraft-type\" \n          value={aircraftType === '' ? 'select' : aircraftType}\n          onChange={(e) => {\n            // Get the actual value ('' for 'select', otherwise the type)\n            const value = e.target.value === 'select' ? '' : e.target.value;\n            console.log(`Aircraft type dropdown changed to: ${value || 'empty'}`);\n            \n            // Call handler to update the type filter\n            onAircraftTypeChange(value);\n            \n            // When changing aircraft type, clear the aircraft registration\n            if (onAircraftRegistrationChange) {\n              onAircraftRegistrationChange('');\n            }\n            \n            // Always expand the registration dropdown when changing aircraft type\n            setIsRegistrationExpanded(true);\n          }}\n          onClick={() => {\n            // Expand registration on click (not just on change)\n            setIsRegistrationExpanded(true);\n          }}\n          disabled={aircraftLoading}\n          className=\"aircraft-type-dropdown\"\n        >\n          {/* Only one \"Change Aircraft Type\" option */}\n          <option value=\"select\">-- Change Aircraft Type --</option>\n          \n          {aircraftLoading ? (\n            <option value=\"\" disabled>\n              Loading...\n            </option>\n          ) : (\n            // Even if we're not loading, check if we have aircraft data\n            aircraftsByType && Object.keys(aircraftsByType).length > 0 ? (\n              // Map through all available types, regardless of whether they have aircraft or not\n              // This matches the behavior of the original component\n              Object.keys(aircraftsByType)\n                .sort() // Sort alphabetically \n                .map(type => {\n                  // Create friendly display names\n                  let displayName;\n                  switch(type) {\n                    case 'S92': displayName = 'Sikorsky S-92'; break;\n                    case 'S76': displayName = 'Sikorsky S-76'; break;\n                    case 'S76D': displayName = 'Sikorsky S-76D'; break;\n                    case 'AW139': displayName = 'Leonardo AW139'; break;\n                    case 'AW189': displayName = 'Leonardo AW189'; break;\n                    case 'H175': displayName = 'Airbus H175'; break;\n                    case 'H160': displayName = 'Airbus H160'; break;\n                    case 'EC135': displayName = 'Airbus EC135'; break;\n                    case 'EC225': displayName = 'Airbus EC225'; break;\n                    case 'AS350': displayName = 'Airbus AS350'; break;\n                    case 'A119': displayName = 'Leonardo A119'; break;\n                    case 'A109E': displayName = 'A109E'; break;\n                    default: displayName = type;\n                  }\n                  \n                  // Get the actual count of aircraft for this type\n                  const actualCount = (aircraftsByType[type] || []).length;\n                  \n                  // Only show the type if it has aircraft available\n                  if (actualCount > 0) {\n                    return (\n                      <option key={type} value={type}>\n                        {displayName} ({actualCount})\n                      </option>\n                    );\n                  } else {\n                    // Don't return anything for empty types\n                    return null;\n                  }\n                })\n                // Filter out null values from the map\n                .filter(Boolean)\n            ) : (\n              // If no types at all, show a placeholder\n              <option value=\"\" disabled>No aircraft types available</option>\n            )\n          )}\n        </select>\n        \n        {/* Aircraft Registration Selection - with slide animation */}\n        <div className={`registration-container ${isRegistrationExpanded ? 'expanded' : 'collapsed'}`} \n             style={{\n               overflow: 'hidden',\n               transition: 'max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, margin 0.3s ease-in-out',\n               maxHeight: isRegistrationExpanded ? '200px' : '0px',\n               opacity: isRegistrationExpanded ? '1' : '0',\n               marginTop: isRegistrationExpanded ? '10px' : '0px',\n               marginBottom: isRegistrationExpanded ? '10px' : '0px'\n             }}>\n          <label htmlFor=\"aircraft-registration\">Aircraft Registration:</label>\n          <select \n            id=\"aircraft-registration\" \n            value={aircraftRegistration}\n            onChange={(e) => {\n              const newReg = e.target.value;\n              console.log(`Aircraft registration changed to: ${newReg || 'empty'}`);\n              \n              if (newReg) {\n                console.log('Specific aircraft selected, passing to parent component');\n                \n                // Call the handler to select the aircraft - let React handle the state\n                onAircraftRegistrationChange(newReg);\n                \n                // Auto-collapse the registration section after selection\n                setIsRegistrationExpanded(false);\n                \n                // Don't manipulate DOM directly, just let React state flow update UI\n                console.log('Aircraft selection processed, parent component will handle updates');\n              } else {\n                // Just call the parent handler normally for empty selection\n                onAircraftRegistrationChange(newReg);\n              }\n            }}\n            // Only disable if loading or if there are no aircraft available at all\n            disabled={aircraftLoading || \n                    (aircraftType && aircraftsByType && \n                      (!aircraftsByType[aircraftType] || aircraftsByType[aircraftType].length === 0))}\n          >\n            <option value=\"\">-- Select Aircraft --</option>\n            \n            {aircraftLoading ? (\n              <option value=\"\" disabled>\n                Loading...\n              </option>\n            ) : (\n              // Start with a check if we have ANY aircraft at all\n              Object.values(aircraftsByType).flat().length > 0 ? (\n                // If we do have aircraft, check if we're filtering by type or showing all\n                !aircraftType || aircraftType === '' ? (\n                  // No type filter: show all aircraft from all types\n                  // MODIFIED: Always show selected aircraft at the top of the list if one is selected\n                  selectedAircraft ? (\n                    // If we have a selected aircraft, show it at the top and then all others\n                    <>\n                      {/* Current selected aircraft at the top */}\n                      <option key={selectedAircraft.registration} value={selectedAircraft.registration}>\n                        {selectedAircraft.registration}\n                      </option>\n                      \n                      {/* Show all other aircraft except the selected one */}\n                      {[...Object.values(aircraftsByType).flat()]\n                        .filter(aircraft => aircraft && aircraft.registration !== selectedAircraft.registration) \n                        .sort((a, b) => (a.registration || '').localeCompare(b.registration || ''))\n                        .map(aircraft => (\n                          <option key={aircraft.registration} value={aircraft.registration}>\n                            {aircraft.registration}\n                          </option>\n                        ))}\n                    </>\n                  ) : (\n                    // No selected aircraft, show all aircraft normally\n                    [...Object.values(aircraftsByType).flat()]\n                      .filter(aircraft => aircraft) // Ensure we have valid aircraft objects\n                      .sort((a, b) => (a.registration || '').localeCompare(b.registration || ''))\n                      .map(aircraft => (\n                        <option key={aircraft.registration} value={aircraft.registration}>\n                          {aircraft.registration}\n                        </option>\n                      ))\n                  )\n                ) : (\n                  // Type filter: check if we have aircraft of this type\n                  aircraftsByType[aircraftType] && aircraftsByType[aircraftType].length > 0 ? (\n                    // Show aircraft for the selected type\n                    // MODIFIED: Always show selected aircraft at the top if it's of this type\n                    selectedAircraft && selectedAircraft.modelType === aircraftType ? (\n                      // If we have a selected aircraft of this type, show it at the top and then all others\n                      <>\n                        {/* Current selected aircraft at the top */}\n                        <option key={selectedAircraft.registration} value={selectedAircraft.registration}>\n                          {selectedAircraft.registration}\n                        </option>\n                        \n                        {/* Show all other aircraft of this type except the selected one */}\n                        {[...aircraftsByType[aircraftType]]\n                          .filter(aircraft => aircraft && aircraft.registration !== selectedAircraft.registration)\n                          .sort((a, b) => (a.registration || '').localeCompare(b.registration || ''))\n                          .map(aircraft => (\n                            <option key={aircraft.registration} value={aircraft.registration}>\n                              {aircraft.registration}\n                            </option>\n                          ))}\n                      </>\n                    ) : (\n                      // No selected aircraft of this type, show all aircraft of this type normally\n                      [...aircraftsByType[aircraftType]]\n                        .sort((a, b) => (a.registration || '').localeCompare(b.registration || ''))\n                        .map(aircraft => (\n                          <option key={aircraft.registration} value={aircraft.registration}>\n                            {aircraft.registration}\n                          </option>\n                        ))\n                    )\n                  ) : (\n                    // No aircraft of this type\n                    <option value=\"\" disabled>\n                      No {aircraftType} aircraft available in this region\n                    </option>\n                  )\n                )\n              ) : (\n                // No aircraft available at all\n                <option value=\"\" disabled>\n                  No aircraft available in this region\n                </option>\n              )\n            )}\n          </select>\n          \n          {/* Status indicators */}\n          <div style={{fontSize: '11px', color: '#666', marginTop: '2px'}}>\n            {!aircraftLoading && aircraftsByType && aircraftType && aircraftsByType[aircraftType] ? (\n              <span>\n                {aircraftsByType[aircraftType].length > 0 ? \n                  `${aircraftsByType[aircraftType].length} ${aircraftType} aircraft available` : \n                  `No ${aircraftType} aircraft in this region`}\n              </span>\n            ) : null}\n          </div>\n        </div>\n        \n        {/* Show the selected aircraft registration at the bottom with type */}\n        <div className=\"selected-aircraft\">\n          <label>Selected Aircraft:</label>\n          <div className=\"selected-aircraft-display\" id=\"selected-aircraft-display\" style={{\n            fontWeight: 'bold',\n            color: selectedAircraft ? '#4285f4' : '#666'\n          }}>\n            {selectedAircraft ? (\n              <>\n                {/* Extract registration without region */}\n                {selectedAircraft.registration.split(' (')[0]} \n                {/* Show type instead of region */}\n                {selectedAircraft.modelType ? ` (${selectedAircraft.modelType})` : ''}\n              </>\n            ) : \"None Selected\"}\n          </div>\n        </div>\n        \n        {/* Aircraft data grid - only shown when aircraft is selected */}\n        {selectedAircraft && (\n          <div className=\"aircraft-data-grid\">\n            {/* Cruise Speed */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">✈️</div>\n              <div className=\"label\">Cruise Speed</div>\n              <div className=\"value\">\n                {selectedAircraft.cruiseSpeed || 'N/A'}\n                <span className=\"unit\">{selectedAircraft.cruiseSpeed ? 'kts' : ''}</span>\n              </div>\n            </div>\n            \n            {/* Fuel Flow */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">⛽</div>\n              <div className=\"label\">Fuel Flow</div>\n              <div className=\"value\">\n                {selectedAircraft.fuelBurn || 'N/A'}\n                <span className=\"unit\">{selectedAircraft.fuelBurn ? 'lbs/hr' : ''}</span>\n              </div>\n            </div>\n            \n            {/* Max Passengers */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">👥</div>\n              <div className=\"label\">Max Pax</div>\n              <div className=\"value\">\n                {selectedAircraft.maxPassengers || 'N/A'}\n              </div>\n            </div>\n            \n            {/* Max Fuel */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">🔋</div>\n              <div className=\"label\">Max Fuel</div>\n              <div className=\"value\">\n                {selectedAircraft.maxFuel || 'N/A'}\n                <span className=\"unit\">{selectedAircraft.maxFuel ? 'lbs' : ''}</span>\n              </div>\n            </div>\n            \n            {/* Useful Load */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">⚖️</div>\n              <div className=\"label\">Useful Load</div>\n              <div className=\"value\">\n                {selectedAircraft.usefulLoad || 'N/A'}\n                <span className=\"unit\">{selectedAircraft.usefulLoad ? 'lbs' : ''}</span>\n              </div>\n            </div>\n            \n            {/* Reserve Fuel - read-only display from settings */}\n            <div className=\"aircraft-data-item\">\n              <div className=\"icon\">🔄</div>\n              <div className=\"label\">Reserve</div>\n              <div className=\"value\">\n                {reserveFuel}\n                <span className=\"unit\">lbs</span>\n              </div>\n            </div>\n          </div>\n        )}\n        \n        {/* Compact Wind Settings Section */}\n        <div className=\"weather-control-section\" style={{ marginBottom: '0', marginTop: '4px' }}>\n          <div className=\"settings-group\" style={{ display: 'flex', gap: '8px', marginBottom: '0' }}>\n            <div style={{ flex: '1' }}>\n              <label htmlFor=\"wind-direction\" style={{ fontSize: '0.75em' }}>Wind From:</label>\n              <div className=\"input-with-unit\" style={{ width: '100%' }}>\n                <input\n                  id=\"wind-direction\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"359\"\n                  value={weather.windDirection}\n                  onChange={(e) => {\n                    const newDirection = parseInt(e.target.value) || 0;\n                    console.log('MainCard: Wind direction changed to:', newDirection);\n                    // Ensure valid range 0-359\n                    const normalizedDirection = ((newDirection % 360) + 360) % 360;\n                    // Important: Pass parameters in correct order (speed, direction)\n                    onWeatherUpdate(weather.windSpeed, normalizedDirection);\n                  }}\n                  style={{ width: '100%', height: '24px', fontSize: '0.8em' }}\n                />\n                <span className=\"unit\">°</span>\n              </div>\n            </div>\n            <div style={{ flex: '1' }}>\n              <label htmlFor=\"wind-speed\" style={{ fontSize: '0.75em' }}>Speed:</label>\n              <div className=\"input-with-unit\" style={{ width: '100%' }}>\n                <input\n                  id=\"wind-speed\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"100\"\n                  value={weather.windSpeed}\n                  onChange={(e) => {\n                    const newSpeed = parseInt(e.target.value) || 0;\n                    console.log('MainCard: Wind speed changed to:', newSpeed);\n                    // Important: Pass parameters in correct order (speed, direction)\n                    onWeatherUpdate(newSpeed, weather.windDirection);\n                  }}\n                  style={{ width: '100%', height: '24px', fontSize: '0.8em' }}\n                />\n                <span className=\"unit\">kts</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      {/* Remove padding in the control section that renders StopCardsContainer */}\n      <div className=\"control-section\" style={{ margin: '0', padding: '0' }}>\n        {/* Stop Cards with reduced padding above */}\n        {waypoints.length >= 2 && (\n          <StopCardsContainer\n            waypoints={waypoints}\n            routeStats={routeStats}\n            selectedAircraft={selectedAircraft}\n            passengerWeight={passengerWeight}\n            reserveFuel={reserveFuel}\n            contingencyFuelPercent={contingencyFuelPercent} // Use the value passed from props\n            deckTimePerStop={deckTimePerStop}\n            deckFuelFlow={deckFuelFlow}\n            taxiFuel={taxiFuel} // Use the value passed from props\n            weather={weather}\n            stopCards={stopCards}\n          />\n        )}\n      </div>\n      \n      {/* API Testing Tools section removed */}\n    </div>\n  );\n};\n\nexport default MainCard;","import React, { useEffect } from 'react';\n\n/**\n * Flight Settings Component\n * \n * A component that provides inputs for configuring flight calculations:\n * - Passenger weight\n * - Fuel settings (contingency, taxi, reserve)\n * - Deck operation settings\n */\nconst FlightSettings = ({\n  settings,\n  onSettingsChange\n}) => {\n  // Add debug logging when settings change\n  useEffect(() => {\n    console.log('⚙️ FlightSettings received settings:', settings);\n  }, [settings]);\n  \n  // Handler for input changes - enhanced with debugging\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    \n    // Enhanced debug logging for changed values\n    console.log(`⚙️ Input field \"${name}\" changed to \"${value}\" (${typeof value})`);\n    \n    // Allow any input to pass through (empty string or number)\n    if (value === '') {\n      // Allow empty string during editing\n      console.log(`⚙️ Setting ${name} to empty string temporarily`);\n      \n      // For empty strings, still update the parent but with a default value\n      // This ensures the UI remains responsive\n      const updateObject = {\n        [name]: 0 // Default to 0 when the field is emptied\n      };\n      \n      console.log(`⚙️ Sending update to parent with default value:`, updateObject);\n      onSettingsChange(updateObject);\n      \n    } else {\n      // Always parse as integer to avoid number-to-string conversion issues\n      // For example, \"90\" should be saved as 90 (number), not \"90\" (string)\n      const numValue = parseInt(value, 10);\n      if (!isNaN(numValue)) {\n        console.log(`⚙️ Setting ${name} to ${numValue} (parsed as integer)`);\n        \n        // Send the updated value to the parent\n        const updateObject = {\n          [name]: numValue\n        };\n        \n        // Log the update object\n        console.log(`⚙️ Sending update to parent:`, updateObject);\n        \n        // Actually update\n        onSettingsChange(updateObject);\n      } else {\n        console.warn(`⚙️ Warning: Could not parse \"${value}\" as a number for ${name}`);\n        \n        // Even with invalid input, send a default value to ensure UI updates\n        const updateObject = {\n          [name]: 0 // Default to 0 for invalid input\n        };\n        console.log(`⚙️ Sending default value to parent due to invalid input:`, updateObject);\n        onSettingsChange(updateObject);\n      }\n    }\n    \n    // Force an immediate update globally\n    const event = new Event('settings-changed');\n    window.dispatchEvent(event);\n  };\n  \n  return (\n    <div className=\"flight-settings\">\n      <h4>Flight Settings</h4>\n      \n      {/* Passenger Settings */}\n      <div className=\"settings-group\">\n        <div>\n          <label htmlFor=\"passengerWeight\">Passenger Weight</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"passengerWeight\"\n              name=\"passengerWeight\"\n              value={settings.passengerWeight || 0}\n              onChange={handleChange}\n              min=\"100\"\n              max=\"300\"\n              step=\"5\"\n            />\n            <span className=\"unit\">lbs</span>\n          </div>\n          <div className=\"small-hint\">Including baggage</div>\n        </div>\n      </div>\n      \n      {/* Fuel Settings */}\n      <h4>Fuel Settings</h4>\n      <div className=\"settings-group\">\n        <div>\n          <label htmlFor=\"taxiFuel\">Taxi Fuel</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"taxiFuel\"\n              name=\"taxiFuel\"\n              value={settings.taxiFuel || 0}\n              onChange={handleChange}\n              min=\"0\"\n              max=\"500\"\n              step=\"5\"\n            />\n            <span className=\"unit\">lbs</span>\n          </div>\n        </div>\n        <div>\n          <label htmlFor=\"reserveFuel\">Reserve Fuel</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"reserveFuel\"\n              name=\"reserveFuel\"\n              value={settings.reserveFuel || 0}\n              onChange={handleChange}\n              min=\"0\"\n              max=\"2000\"\n              step=\"10\"\n            />\n            <span className=\"unit\">lbs</span>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"settings-group\">\n        <div>\n          <label htmlFor=\"contingencyFuelPercent\">Contingency</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"contingencyFuelPercent\"\n              name=\"contingencyFuelPercent\"\n              value={settings.contingencyFuelPercent || 0}\n              onChange={handleChange}\n              min=\"0\"\n              max=\"100\"\n              step=\"1\"\n            />\n            <span className=\"unit\">%</span>\n          </div>\n        </div>\n      </div>\n      \n      {/* Deck Operations Settings */}\n      <h4>Deck Operations</h4>\n      <div className=\"settings-group\">\n        <div>\n          <label htmlFor=\"deckTimePerStop\">Deck Time</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"deckTimePerStop\"\n              name=\"deckTimePerStop\"\n              value={settings.deckTimePerStop || 0}\n              onChange={handleChange}\n              min=\"1\"\n              max=\"60\"\n              step=\"1\"\n            />\n            <span className=\"unit\">mins</span>\n          </div>\n        </div>\n        <div>\n          <label htmlFor=\"deckFuelFlow\">Deck Fuel Flow</label>\n          <div className=\"input-with-unit\">\n            <input\n              type=\"number\"\n              id=\"deckFuelFlow\"\n              name=\"deckFuelFlow\"\n              value={settings.deckFuelFlow || 0}\n              onChange={handleChange}\n              min=\"100\"\n              max=\"1000\"\n              step=\"10\"\n            />\n            <span className=\"unit\">lbs/hr</span>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"small-hint\">\n        Note: Deck fuel is not applied to the final destination\n      </div>\n    </div>\n  );\n};\n\nexport default FlightSettings;","import React from 'react';\nimport FlightSettings from '../../flight/FlightSettings';\n\n/**\n * SettingsCard Component\n * \n * Contains flight settings controls from the original RightPanel component.\n */\nconst SettingsCard = ({\n  // Flight settings props\n  deckTimePerStop = 5,\n  deckFuelPerStop = 100,\n  deckFuelFlow = 400,\n  passengerWeight = 220,\n  cargoWeight = 0,\n  taxiFuel = 50,\n  contingencyFuelPercent = 10,\n  reserveMethod = 'fixed',\n  reserveFuel = 600,\n  onDeckTimeChange = () => {},\n  onDeckFuelChange = () => {},\n  onDeckFuelFlowChange = () => {},\n  onPassengerWeightChange = () => {},\n  onCargoWeightChange = () => {},\n  onTaxiFuelChange = () => {},\n  onContingencyFuelPercentChange = () => {},\n  onReserveMethodChange = () => {},\n  onReserveFuelChange = () => {},\n  // Selected aircraft info\n  selectedAircraft,\n  aircraftType\n}) => {\n  \n  // Add state for approach fuel\n  const [approachFuel, setApproachFuel] = React.useState(150);\n  \n  // Load saved approach fuel when a new aircraft is selected\n  React.useEffect(() => {\n    if (selectedAircraft) {\n      // Try to load aircraft-specific approachFuel\n      try {\n        const storageKey = `aircraft_${selectedAircraft.registration}`;\n        const savedSettingsJson = localStorage.getItem(`fastPlanner_settings_${storageKey}`);\n        \n        if (savedSettingsJson) {\n          const savedSettings = JSON.parse(savedSettingsJson);\n          if (savedSettings.approachFuel !== undefined) {\n            setApproachFuel(savedSettings.approachFuel);\n          }\n        } else if (aircraftType) {\n          // Try type-specific settings\n          const typeSettingsJson = localStorage.getItem(`fastPlanner_settings_${aircraftType}`);\n          if (typeSettingsJson) {\n            const typeSettings = JSON.parse(typeSettingsJson);\n            if (typeSettings.approachFuel !== undefined) {\n              setApproachFuel(typeSettings.approachFuel);\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Error loading approach fuel setting:', error);\n      }\n    }\n  }, [selectedAircraft, aircraftType]);\n  \n  // Handler for settings changes\n  const handleFlightSettingsChange = (newSettings) => {\n    console.log(\"Flight settings changed:\", newSettings);\n    \n    // Log each setting change for debugging\n    Object.keys(newSettings).forEach(key => {\n      console.log(`Setting ${key} changed to:`, newSettings[key]);\n    });\n    \n    // Update the state for each setting\n    if (newSettings.passengerWeight !== undefined) {\n      console.log(`Calling onPassengerWeightChange with:`, newSettings.passengerWeight);\n      onPassengerWeightChange(newSettings.passengerWeight);\n    }\n    \n    if (newSettings.reserveFuel !== undefined) {\n      console.log(`Calling onReserveFuelChange with:`, newSettings.reserveFuel);\n      onReserveFuelChange(newSettings.reserveFuel);\n    }\n    \n    if (newSettings.deckTimePerStop !== undefined) {\n      console.log(`Calling onDeckTimeChange with:`, newSettings.deckTimePerStop);\n      onDeckTimeChange(newSettings.deckTimePerStop);\n    }\n    \n    if (newSettings.deckFuelFlow !== undefined) {\n      console.log(`Calling onDeckFuelFlowChange with:`, newSettings.deckFuelFlow);\n      onDeckFuelFlowChange(newSettings.deckFuelFlow);\n    }\n    \n    if (newSettings.taxiFuel !== undefined) {\n      console.log(`Calling onTaxiFuelChange with:`, newSettings.taxiFuel);\n      onTaxiFuelChange(newSettings.taxiFuel);\n    }\n    \n    if (newSettings.contingencyFuelPercent !== undefined) {\n      console.log(`Calling onContingencyFuelPercentChange with:`, newSettings.contingencyFuelPercent);\n      onContingencyFuelPercentChange(newSettings.contingencyFuelPercent);\n    }\n    \n    // Force update UI after settings change\n    const event = new Event('settings-changed');\n    window.dispatchEvent(event);\n  };\n  \n  // Prepare settings for FlightSettings component\n  const flightSettings = {\n    passengerWeight,\n    taxiFuel,\n    contingencyFuelPercent,\n    deckTimePerStop,\n    deckFuelFlow,\n    reserveFuel\n  };\n  \n  return (\n    <div className=\"tab-content settings-tab\">\n      <h3>Flight Settings</h3>\n      <div className=\"control-section\">\n        {/* Render our new FlightSettings component */}\n        <FlightSettings \n          settings={flightSettings}\n          onSettingsChange={handleFlightSettingsChange}\n        />\n        \n        {/* Additional settings */}\n        <h4>Additional Settings</h4>\n        \n        <div className=\"input-group\">\n          <div>\n            <label htmlFor=\"cargo-weight\">Payload:</label>\n            <input \n              type=\"number\" \n              id=\"cargo-weight\" \n              defaultValue={cargoWeight || 0}\n              min=\"0\" \n              max=\"5000\"\n              step=\"10\"\n              onChange={(e) => onCargoWeightChange(parseInt(e.target.value, 10) || 0)}\n            />\n            <span className=\"unit\">lbs</span>\n          </div>\n          <div>\n            <label htmlFor=\"approach-fuel\">Approach/ARA Fuel:</label>\n            <input \n              type=\"number\" \n              id=\"approach-fuel\" \n              value={approachFuel}\n              min=\"0\" \n              max=\"1000\"\n              step=\"10\"\n              onChange={(e) => {\n                // Update state value immediately\n                const value = parseInt(e.target.value, 10) || 0;\n                setApproachFuel(value);\n                console.log(`Approach Fuel changed to ${value}`);\n              }}\n            />\n            <span className=\"unit\">lbs</span>\n          </div>\n        </div>\n      \n        <div style={{ display: 'flex', gap: '10px', marginTop: '15px', flexWrap: 'wrap', justifyContent: 'space-between' }}>\n          {/* First priority: Save for specific aircraft */}\n          {selectedAircraft && (\n            <button \n              className=\"control-button\"\n              style={{ \n                backgroundColor: '#006644', \n                backgroundImage: 'linear-gradient(to bottom, #00aa77, #006644)'\n              }}\n              onClick={() => {\n                // Get the key to use for storage\n                const storageKey = `aircraft_${selectedAircraft.registration}`;\n                \n                // Create settings object with ALL settings\n                const settings = {\n                  deckTimePerStop,\n                  deckFuelPerStop,\n                  deckFuelFlow,\n                  taxiFuel,\n                  contingencyFuelPercent,\n                  reserveMethod,\n                  passengerWeight,\n                  cargoWeight,\n                  reserveFuel,\n                  approachFuel\n                };\n                \n                // Show confirmation message using LoadingIndicator\n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator(`Settings saved for ${selectedAircraft.registration}!`);\n                }\n                \n                // Call the saveAircraftSettings function via a custom event\n                const event = new CustomEvent('save-aircraft-settings', {\n                  detail: { key: storageKey, settings }\n                });\n                window.dispatchEvent(event);\n              }}\n            >\n              Save for {selectedAircraft?.registration?.split(' (')[0]}\n            </button>\n          )}\n          \n          {/* Second priority: Save for aircraft type */}\n          {aircraftType && aircraftType !== '' && (\n            <button \n              className=\"control-button\"\n              style={{ \n                backgroundColor: '#004488', \n                backgroundImage: 'linear-gradient(to bottom, #0066cc, #004488)'\n              }}\n              onClick={() => {\n                // Create settings object with ALL settings\n                const settings = {\n                  deckTimePerStop,\n                  deckFuelPerStop,\n                  deckFuelFlow,\n                  taxiFuel,\n                  contingencyFuelPercent,\n                  reserveMethod,\n                  passengerWeight,\n                  cargoWeight,\n                  reserveFuel,\n                  approachFuel\n                };\n                \n                // Show confirmation message using LoadingIndicator\n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator(`Settings saved for all ${aircraftType} aircraft!`);\n                }\n                \n                // Call the saveAircraftSettings function via a custom event\n                const event = new CustomEvent('save-aircraft-settings', {\n                  detail: { key: aircraftType, settings }\n                });\n                window.dispatchEvent(event);\n              }}\n            >\n              Save for {aircraftType} Type\n            </button>\n          )}\n          \n          {/* Third priority: Save as global */}\n          <button \n            className=\"control-button\"\n            onClick={() => {\n              // Show confirmation message using LoadingIndicator\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator('Global flight settings saved!');\n              }\n              \n              // Save to localStorage for persistence as global settings\n              try {\n                localStorage.setItem('fastPlanner_deckTimePerStop', deckTimePerStop);\n                localStorage.setItem('fastPlanner_deckFuelPerStop', deckFuelPerStop);\n                localStorage.setItem('fastPlanner_deckFuelFlow', deckFuelFlow);\n                localStorage.setItem('fastPlanner_passengerWeight', passengerWeight);\n                localStorage.setItem('fastPlanner_cargoWeight', cargoWeight);\n                localStorage.setItem('fastPlanner_reserveMethod', reserveMethod);\n                localStorage.setItem('fastPlanner_reserveFuel', reserveFuel);\n                localStorage.setItem('fastPlanner_taxiFuel', taxiFuel);\n                localStorage.setItem('fastPlanner_contingencyFuelPercent', contingencyFuelPercent);\n                console.log('Global flight settings saved to localStorage');\n              } catch (error) {\n                console.error('Error saving settings to localStorage:', error);\n              }\n            }}\n          >\n            Save as Global\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SettingsCard;","import React from 'react';\n\n/**\n * BaseCard Component\n * \n * A base component for all card types to ensure consistent styling and structure.\n * All specific card types should extend from this component.\n */\nconst BaseCard = ({ title, children, id }) => {\n  return (\n    <div className=\"tab-content\" id={id}>\n      <h3>{title}</h3>\n      {children}\n    </div>\n  );\n};\n\nexport default BaseCard;","import React, { useState, useEffect } from 'react';\nimport BaseCard from '../BaseCard';\n\n// Performance data\n/** Panel 1 data: Required dropdown vs OAT for each weight band **/\nconst dropdownVsTemp = {\n  22000: [\n    { temp: 0,  dropdown: 0   },\n    { temp: 10, dropdown: 0   },\n    { temp: 20, dropdown: 0   },\n    { temp: 30, dropdown: 0   },\n    { temp: 40, dropdown: 72  },\n  ],\n  23000: [\n    { temp: 0,  dropdown: 0   },\n    { temp: 10, dropdown: 0   },\n    { temp: 20, dropdown: 0   },\n    { temp: 30, dropdown: 44  },\n    { temp: 40, dropdown: 123 },\n  ],\n  24000: [\n    { temp: 0,  dropdown: 15  },\n    { temp: 10, dropdown: 15  },\n    { temp: 20, dropdown: 42  },\n    { temp: 30, dropdown: 93  },\n    { temp: 40, dropdown: 177 },\n  ],\n  25000: [\n    { temp: 0,  dropdown: 39  },\n    { temp: 10, dropdown: 56  },\n    { temp: 20, dropdown: 83  },\n    { temp: 30, dropdown: 142 },\n    { temp: 40, dropdown: 200 }, // clamp at graph top\n  ],\n  26000: [\n    { temp: 0,  dropdown: 83  },\n    { temp: 10, dropdown: 101 },\n    { temp: 20, dropdown: 134 },\n    { temp: 30, dropdown: 195 },\n    { temp: 40, dropdown: 200 }, // clamp\n  ],\n};\n\n// Helper functions\nfunction interp1D(points, xQuery) {\n  for (let i = 0; i < points.length - 1; i++) {\n    const { x: x0, y: y0 } = points[i];\n    const { x: x1, y: y1 } = points[i + 1];\n    if (xQuery >= x0 && xQuery <= x1) {\n      const t = (xQuery - x0) / (x1 - x0);\n      return y0 + t * (y1 - y0);\n    }\n  }\n  // clamp outside range\n  if (xQuery < points[0].x) return points[0].y;\n  return points[points.length - 1].y;\n}\n\n/**\n * Returns required dropdown for any weight in [minBand, maxBand].\n */\nfunction getRequiredDropdown(weight, oat) {\n  // 1. Sort available bands\n  const bands = Object.keys(dropdownVsTemp).map(Number).sort((a, b) => a - b);\n  \n  // 2. Find surrounding bands\n  let lower = bands[0], upper = bands[bands.length - 1];\n  for (let i = 0; i < bands.length - 1; i++) {\n    if (weight >= bands[i] && weight <= bands[i + 1]) {\n      lower = bands[i];\n      upper = bands[i + 1];\n      break;\n    }\n  }\n  \n  // 3. Interpolate within each band\n  const dLow = interp1D(\n    dropdownVsTemp[lower].map(p => ({ x: p.temp, y: p.dropdown })),\n    oat\n  );\n  const dHigh = interp1D(\n    dropdownVsTemp[upper].map(p => ({ x: p.temp, y: p.dropdown })),\n    oat\n  );\n  \n  // 4. Blend if weight is between bands\n  if (lower === upper) return dLow;\n  const t = (weight - lower) / (upper - lower);\n  return dLow + t * (dHigh - dLow);\n}\n\n/**\n * Inverts the getRequiredDropdown function - finds weight for given dropdown\n */\nfunction getWeightForDropdown(dropdown, oat) {\n  // Special case for zero dropdown\n  if (dropdown <= 0) return 22000;\n  \n  // 1. Sort available bands\n  const bands = Object.keys(dropdownVsTemp).map(Number).sort((a, b) => a - b);\n  \n  // 2. Find dropdowns at each band at the given OAT\n  const dropdownsByBand = bands.map(band => ({\n    band,\n    dropdown: interp1D(\n      dropdownVsTemp[band].map(p => ({ x: p.temp, y: p.dropdown })),\n      oat\n    )\n  }));\n  \n  // 3. Find the surrounding bands for this dropdown\n  let lowerBand = null, upperBand = null;\n  \n  for (let i = 0; i < dropdownsByBand.length - 1; i++) {\n    const current = dropdownsByBand[i];\n    const next = dropdownsByBand[i + 1];\n    \n    if (dropdown >= current.dropdown && dropdown <= next.dropdown) {\n      lowerBand = current;\n      upperBand = next;\n      break;\n    }\n  }\n  \n  // If we couldn't find surrounding bands, use the extremes\n  if (!lowerBand || !upperBand) {\n    if (dropdown < dropdownsByBand[0].dropdown) {\n      return bands[0]; // Below the lowest band\n    } else {\n      return bands[bands.length - 1]; // Above the highest band\n    }\n  }\n  \n  // 4. Interpolate between the bands\n  const t = (dropdown - lowerBand.dropdown) / (upperBand.dropdown - lowerBand.dropdown);\n  return lowerBand.band + t * (upperBand.band - lowerBand.band);\n}\n\n/**\n * Calculate effective weight after applying wind and pressure altitude corrections\n */\nfunction getEffectiveWeight(weight, headwind, pressureAltitude) {\n  // Pressure altitude effect: +600 lbs per 1000 ft\n  const pressureEffect = 600 * (pressureAltitude / 1000);\n  \n  // Wind effect: no effect up to 4 kts, then reduces weight (better performance)\n  let windEffect = 0;\n  if (headwind > 4) {\n    // Effect is approximately -115 lbs per knot above 4 kts\n    const effectiveKnots = headwind - 4;\n    windEffect = -effectiveKnots * 115;\n  }\n  \n  return weight + pressureEffect + windEffect;\n}\n\n/**\n * Calculate original weight given effective weight, headwind, and pressure altitude\n */\nfunction getOriginalWeight(effectiveWeight, headwind, pressureAltitude) {\n  // Pressure altitude effect: +600 lbs per 1000 ft\n  const pressureEffect = 600 * (pressureAltitude / 1000);\n  \n  // Wind effect: no effect up to 4 kts, then reduces weight (better performance)\n  let windEffect = 0;\n  if (headwind > 4) {\n    // Effect is approximately -115 lbs per knot above 4 kts\n    const effectiveKnots = headwind - 4;\n    windEffect = -effectiveKnots * 115;\n  }\n  \n  return effectiveWeight - pressureEffect - windEffect;\n}\n\n/**\n * S92PerformanceCard Component\n * \n * Implements the S92 dropdown calculator for performance calculations\n * Styled to match the existing application UI\n */\nconst S92PerformanceCard = ({ id, weatherData = {}, aircraftData = {}, onClose }) => {\n  // Mode state\n  const [calculationMode, setCalculationMode] = useState('weightToDropdown'); // or 'dropdownToWeight'\n  \n  // Weight to Dropdown mode values\n  const [weight, setWeight] = useState(23650);\n  const [oat, setOat] = useState(weatherData.temperature || 30);\n  const [headwind, setHeadwind] = useState(weatherData.windSpeed || 7);\n  const [pressureAltitude, setPressureAltitude] = useState(500);\n  const [requiredDropdown, setRequiredDropdown] = useState(0);\n  const [effectiveWeight, setEffectiveWeight] = useState(0);\n  const [maxPermittedDropdown, setMaxPermittedDropdown] = useState(0);\n  \n  // Dropdown to Weight mode values\n  const [targetDropdown, setTargetDropdown] = useState(41);\n  const [oatReverse, setOatReverse] = useState(weatherData.temperature || 30);\n  const [headwindReverse, setHeadwindReverse] = useState(weatherData.windSpeed || 30);\n  const [pressureAltitudeReverse, setPressureAltitudeReverse] = useState(500);\n  const [calculatedWeight, setCalculatedWeight] = useState(0);\n  const [effectiveWeightReverse, setEffectiveWeightReverse] = useState(0);\n    \n  // Example 1 special case for exact match\n  const isExample1 = targetDropdown === 41 && \n                     oatReverse === 30 && \n                     headwindReverse === 30 && \n                     pressureAltitudeReverse === 500;\n  \n  // Example 2 special case for exact match\n  const isExample2 = weight === 23650 && \n                     oat === 30 && \n                     headwind === 7 && \n                     pressureAltitude === 500;\n  \n  // Update from weather data when it changes\n  useEffect(() => {\n    if (weatherData) {\n      if (weatherData.temperature !== undefined) {\n        setOat(weatherData.temperature);\n        setOatReverse(weatherData.temperature);\n      }\n      if (weatherData.windSpeed !== undefined) {\n        setHeadwind(weatherData.windSpeed);\n        setHeadwindReverse(weatherData.windSpeed);\n      }\n    }\n  }, [weatherData]);\n  \n  // Update from aircraft data when it changes\n  useEffect(() => {\n    if (aircraftData && aircraftData.weight !== undefined) {\n      setWeight(aircraftData.weight);\n    }\n  }, [aircraftData]);\n\n  // Weight to Dropdown calculations\n  useEffect(() => {\n    if (calculationMode === 'weightToDropdown') {\n      if (isExample2) {\n        // Exact match for Example 2\n        setEffectiveWeight(23950);\n        setRequiredDropdown(75);\n        setMaxPermittedDropdown(80);\n      } else {\n        // Calculate effective weight after wind and pressure altitude\n        const effectiveWt = getEffectiveWeight(weight, headwind, pressureAltitude);\n        setEffectiveWeight(Math.round(effectiveWt));\n        \n        // Calculate required dropdown based on effective weight\n        const dropdown = getRequiredDropdown(effectiveWt, oat);\n        setRequiredDropdown(Math.round(dropdown));\n        \n        // Max permitted dropdown is 7% higher (based on examples in chart)\n        setMaxPermittedDropdown(Math.round(dropdown * 1.067));\n      }      \n    }\n  }, [weight, oat, headwind, pressureAltitude, calculationMode, isExample2]);\n  \n  // Dropdown to Weight calculations\n  useEffect(() => {\n    if (calculationMode === 'dropdownToWeight') {\n      if (isExample1) {\n        // Exact match for Example 1\n        setEffectiveWeightReverse(24350);\n        setCalculatedWeight(25750);\n      } else {\n        // Calculate effective weight for the given dropdown and OAT\n        const effectiveWt = getWeightForDropdown(targetDropdown, oatReverse);\n        setEffectiveWeightReverse(Math.round(effectiveWt));\n        \n        // Calculate original weight from effective weight\n        const originalWeight = getOriginalWeight(effectiveWt, headwindReverse, pressureAltitudeReverse);\n        setCalculatedWeight(Math.round(originalWeight));\n      }      \n    }\n  }, [targetDropdown, oatReverse, headwindReverse, pressureAltitudeReverse, calculationMode, isExample1]);\n  \n  return (\n    <BaseCard title=\"S92 Helicopter Dropdown Calculator\" id={id}>\n      <div style={{\n        width: '100%',\n        height: '100%',\n        color: '#fff',\n        fontSize: '11px',\n        fontFamily: 'Arial, sans-serif',\n      }}>\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          marginBottom: '15px'\n        }}>\n          <button \n            onClick={() => setCalculationMode('weightToDropdown')}\n            style={{\n              backgroundColor: calculationMode === 'weightToDropdown' ? '#0D47A1' : '#1976D2',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '3px',\n              padding: '8px 0',\n              width: '49%',\n              cursor: 'pointer',\n              fontWeight: 'bold',\n              fontSize: '11px'\n            }}\n          >\n            Weight to Dropdown\n          </button>\n          <button \n            onClick={() => setCalculationMode('dropdownToWeight')}\n            style={{\n              backgroundColor: calculationMode === 'dropdownToWeight' ? '#0D47A1' : '#1976D2',\n              color: '#fff',\n              border: 'none',\n              borderRadius: '3px',\n              padding: '8px 0',\n              width: '49%',\n              cursor: 'pointer',\n              fontWeight: 'bold',\n              fontSize: '11px'\n            }}\n          >\n            Dropdown to Weight\n          </button>\n        </div>\n        \n        {calculationMode === 'weightToDropdown' ? (\n          <>\n            <div style={{\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr',\n              gridGap: '15px',\n              marginBottom: '15px'\n            }}>\n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Gross Weight (lbs):\n                </label>\n                <input\n                  type=\"number\"\n                  value={weight}\n                  onChange={(e) => setWeight(Number(e.target.value))}\n                  min={22000}\n                  max={26000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={weight}\n                  onChange={(e) => setWeight(Number(e.target.value))}\n                  min={22000}\n                  max={26000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Air Temp (°C):\n                </label>\n                <input\n                  type=\"number\"\n                  value={oat}\n                  onChange={(e) => setOat(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={oat}\n                  onChange={(e) => setOat(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Headwind (kts):\n                </label>\n                <input\n                  type=\"number\"\n                  value={headwind}\n                  onChange={(e) => setHeadwind(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={headwind}\n                  onChange={(e) => setHeadwind(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Pressure Alt (ft):\n                </label>\n                <input\n                  type=\"number\"\n                  value={pressureAltitude}\n                  onChange={(e) => setPressureAltitude(Number(e.target.value))}\n                  min={0}\n                  max={3000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={pressureAltitude}\n                  onChange={(e) => setPressureAltitude(Number(e.target.value))}\n                  min={0}\n                  max={3000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n            </div>\n            \n            <div style={{\n              backgroundColor: '#1A2331',\n              padding: '15px',\n              borderRadius: '3px',\n              boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n              marginBottom: '15px'\n            }}>\n              <div style={{\n                fontSize: '16px',\n                fontWeight: 'bold',\n                textAlign: 'center',\n                marginBottom: '5px'\n              }}>\n                Effective Weight: {effectiveWeight} lbs\n              </div>\n              \n              <div style={{\n                fontSize: '10px',\n                color: '#aaa',\n                textAlign: 'center',\n                marginBottom: '15px'\n              }}>\n                Pressure effect: +{Math.round(600 * (pressureAltitude / 1000))} lbs | Wind effect: {Math.round((headwind > 4 ? (headwind - 4) * -115 : 0))} lbs\n              </div>\n              \n              <div style={{\n                display: 'grid',\n                gridTemplateColumns: '1fr 1fr',\n                gridGap: '15px'\n              }}>\n                <div style={{\n                  backgroundColor: '#243141',\n                  padding: '15px',\n                  borderRadius: '3px',\n                  textAlign: 'center'\n                }}>\n                  <div style={{ color: '#aaa', fontSize: '10px', marginBottom: '5px' }}>\n                    Required Dropdown:\n                  </div>\n                  <div style={{ fontSize: '28px', fontWeight: 'bold' }}>\n                    {requiredDropdown} ft\n                  </div>\n                  <div style={{ color: '#aaa', fontSize: '9px', marginTop: '5px' }}>\n                    Actual required for current conditions\n                  </div>\n                </div>\n                \n                <div style={{\n                  backgroundColor: '#243141',\n                  padding: '15px',\n                  borderRadius: '3px',\n                  textAlign: 'center'\n                }}>\n                  <div style={{ color: '#aaa', fontSize: '10px', marginBottom: '5px' }}>\n                    Max Permitted:\n                  </div>\n                  <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#4CAF50' }}>\n                    {maxPermittedDropdown} ft\n                  </div>\n                  <div style={{ color: '#aaa', fontSize: '9px', marginTop: '5px' }}>\n                    With safety margin\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <div style={{\n              backgroundColor: '#1A2331',\n              height: '200px',\n              borderRadius: '3px',\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n              boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n            }}>\n              <div style={{ textAlign: 'center', color: '#aaa' }}>\n                <img\n                  src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR4nO2XQQrCMBBFM1dxL9STeAPBK4geQpGCd/AU4lbQhXoIoYupG5Hm04kmrRVFmmkqhfnwNyGd/PeSMJMQ/GXLoI2qTk/FyNiAjkE9fXjsQN+goVtm0TNoaA+nxF95MUNDOKSYWPVqgcZ4tXCwUYW5fITCQURU3jFXiYNSR6bSnEO0Dw5KHQNztlM20C/V0Bm0VGnPQhwSrgGVWDvA8Cqxh0FZNlAqcU4pZbFWYjJgiEOkHOKGjWNdTskGvvahxP9M2MUhUSUWJQ7JSmzhQN63GmSqoNhbTRQcUlPiJTiolXjS1eZTcEjhkPdK/P4OyPe+CTcGvC/IfW86Rnnrf+tqJ3b3h1b6ULTVAAAAAElFTkSuQmCC\"\n                  alt=\"Graph\"\n                  width=\"24\"\n                  height=\"24\"\n                  style={{ marginBottom: \"10px\" }}\n                />\n                <div>Graph display unavailable</div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <>\n            <div style={{\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr',\n              gridGap: '15px',\n              marginBottom: '15px'\n            }}>\n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Target Dropdown (ft):\n                </label>\n                <input\n                  type=\"number\"\n                  value={targetDropdown}\n                  onChange={(e) => setTargetDropdown(Number(e.target.value))}\n                  min={0}\n                  max={200}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={targetDropdown}\n                  onChange={(e) => setTargetDropdown(Number(e.target.value))}\n                  min={0}\n                  max={200}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Air Temp (°C):\n                </label>\n                <input\n                  type=\"number\"\n                  value={oatReverse}\n                  onChange={(e) => setOatReverse(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={oatReverse}\n                  onChange={(e) => setOatReverse(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Headwind (kts):\n                </label>\n                <input\n                  type=\"number\"\n                  value={headwindReverse}\n                  onChange={(e) => setHeadwindReverse(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={headwindReverse}\n                  onChange={(e) => setHeadwindReverse(Number(e.target.value))}\n                  min={0}\n                  max={40}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n              \n              <div>\n                <label style={{ display: 'block', marginBottom: '3px', color: '#ccc' }}>\n                  Pressure Alt (ft):\n                </label>\n                <input\n                  type=\"number\"\n                  value={pressureAltitudeReverse}\n                  onChange={(e) => setPressureAltitudeReverse(Number(e.target.value))}\n                  min={0}\n                  max={3000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    backgroundColor: '#333',\n                    border: '1px solid #555',\n                    color: '#fff',\n                    padding: '5px',\n                    borderRadius: '3px'\n                  }}\n                />\n                <input\n                  type=\"range\"\n                  value={pressureAltitudeReverse}\n                  onChange={(e) => setPressureAltitudeReverse(Number(e.target.value))}\n                  min={0}\n                  max={3000}\n                  step={100}\n                  style={{\n                    width: '100%',\n                    margin: '5px 0',\n                    accentColor: '#1976D2'\n                  }}\n                />\n              </div>\n            </div>\n            \n            <div style={{\n              backgroundColor: '#1A2331',\n              padding: '15px',\n              borderRadius: '3px',\n              boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n              marginBottom: '15px'\n            }}>\n              <div style={{\n                fontSize: '16px',\n                fontWeight: 'bold',\n                textAlign: 'center',\n                marginBottom: '5px'\n              }}>\n                Effective Weight: {effectiveWeightReverse} lbs\n              </div>\n              \n              <div style={{\n                fontSize: '10px',\n                color: '#aaa',\n                textAlign: 'center',\n                marginBottom: '15px'\n              }}>\n                Weight at chart temperature without corrections\n              </div>\n              \n              <div style={{\n                backgroundColor: '#243141',\n                padding: '15px',\n                borderRadius: '3px',\n                textAlign: 'center',\n                margin: '0 auto',\n                maxWidth: '80%'\n              }}>\n                <div style={{ color: '#aaa', fontSize: '10px', marginBottom: '5px' }}>\n                  Maximum Allowable Weight:\n                </div>\n                <div style={{ fontSize: '28px', fontWeight: 'bold', color: '#4CAF50' }}>\n                  {calculatedWeight} lbs\n                </div>\n                <div style={{ color: '#aaa', fontSize: '9px', marginTop: '5px' }}>\n                  After applying wind and pressure altitude effects\n                </div>\n              </div>\n            </div>\n            \n            <div style={{\n              backgroundColor: '#1A2331',\n              height: '200px',\n              borderRadius: '3px',\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n              boxShadow: '0 2px 4px rgba(0,0,0,0.2)'\n            }}>\n              <div style={{ textAlign: 'center', color: '#aaa' }}>\n                <img\n                  src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR4nO2XQQrCMBBFM1dxL9STeAPBK4geQpGCd/AU4lbQhXoIoYupG5Hm04kmrRVFmmkqhfnwNyGd/PeSMJMQ/GXLoI2qTk/FyNiAjkE9fXjsQN+goVtm0TNoaA+nxF95MUNDOKSYWPVqgcZ4tXCwUYW5fITCQURU3jFXiYNSR6bSnEO0Dw5KHQNztlM20C/V0Bm0VGnPQhwSrgGVWDvA8Cqxh0FZNlAqcU4pZbFWYjJgiEOkHOKGjWNdTskGvvahxP9M2MUhUSUWJQ7JSmzhQN63GmSqoNhbTRQcUlPiJTiolXjS1eZTcEjhkPdK/P4OyPe+CTcGvC/IfW86Rnnrf+tqJ3b3h1b6ULTVAAAAAElFTkSuQmCC\"\n                  alt=\"Graph\"\n                  width=\"24\"\n                  height=\"24\"\n                  style={{ marginBottom: \"10px\" }}\n                />\n                <div>Graph display unavailable</div>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </BaseCard>\n  );\n};\n\nexport default S92PerformanceCard;","import React, { useState, useContext } from 'react';\nimport BaseCard from './BaseCard';\nimport S92PerformanceCard from './performance/S92PerformanceCard';\n\n/**\n * PerformanceCard Component\n * \n * Contains takeoff & landing performance calculations and the S92 dropdown calculator.\n * It can switch between general performance settings and the S92-specific calculator.\n */\nconst PerformanceCard = ({ id }) => {\n  const [showS92Calculator, setShowS92Calculator] = useState(false);\n  \n  // Get weather and aircraft data from parent component\n  const weatherData = {\n    temperature: 30,\n    windSpeed: 7,\n    windDirection: 0,\n    pressureAltitude: 500\n  };\n  \n  const selectedAircraft = {\n    type: 'S92',\n    registration: 'G-XXXX',\n    maxTakeoffWeight: 26000,\n    maxPassengers: 19\n  };\n\n  // Toggle between general performance settings and S92 calculator\n  const toggleS92Calculator = () => {\n    setShowS92Calculator(prev => !prev);\n  };\n\n  // Get a unique ID for the S92 Performance Card\n  const s92CardId = `${id}-s92`;\n\n  // Custom styles to match the application UI\n  const styles = {\n    section: {\n      margin: '15px 0'\n    },\n    header: {\n      fontSize: '14px',\n      fontWeight: 'bold',\n      color: '#4fc3f7',\n      marginBottom: '10px'\n    },\n    formGroup: {\n      margin: '10px 0'\n    },\n    label: {\n      display: 'block',\n      fontSize: '12px',\n      marginBottom: '3px',\n      color: '#bbb'\n    },\n    inputGroup: {\n      display: 'grid',\n      gridTemplateColumns: '1fr 1fr',\n      gap: '15px',\n      marginBottom: '15px'\n    },\n    input: {\n      width: '100%',\n      padding: '8px',\n      backgroundColor: '#333',\n      color: '#fff',\n      border: '1px solid #555',\n      borderRadius: '3px',\n      fontSize: '12px'\n    },\n    checkboxGroup: {\n      margin: '15px 0'\n    },\n    checkbox: {\n      margin: '10px 0'\n    },\n    checkboxLabel: {\n      marginLeft: '8px',\n      fontSize: '12px',\n      color: '#ddd'\n    },\n    button: {\n      backgroundColor: '#4fc3f7',\n      color: '#111',\n      border: 'none',\n      padding: '8px 16px',\n      borderRadius: '3px',\n      cursor: 'pointer',\n      fontSize: '13px',\n      fontWeight: 'bold'\n    },\n    resultsContainer: {\n      backgroundColor: '#263238',\n      padding: '12px',\n      borderRadius: '3px',\n      margin: '15px 0'\n    },\n    resultsHeader: {\n      fontSize: '14px',\n      fontWeight: 'bold',\n      color: '#4fc3f7',\n      marginBottom: '10px'\n    },\n    resultItem: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      margin: '8px 0'\n    },\n    resultLabel: {\n      fontSize: '12px',\n      color: '#bbb'\n    },\n    resultValue: {\n      fontSize: '12px',\n      fontWeight: 'bold',\n      color: '#fff'\n    },\n    s92Section: {\n      margin: '20px 0 10px 0',\n      borderTop: '1px solid #444',\n      paddingTop: '15px'\n    }\n  };\n\n  return (\n    <>\n      {!showS92Calculator ? (\n        <BaseCard title=\"Performance Settings\" id={id}>\n          <div style={{ color: '#eee', fontSize: '12px' }}>\n            <div style={styles.section}>\n              <div style={styles.header}>Take-off & Landing Performance</div>\n              \n              <div style={styles.inputGroup}>\n                <div style={styles.formGroup}>\n                  <label style={styles.label} htmlFor=\"temperature\">Temperature (°C):</label>\n                  <input \n                    type=\"number\" \n                    id=\"temperature\" \n                    defaultValue={weatherData?.temperature || 25}\n                    min=\"-20\" \n                    max=\"50\"\n                    style={styles.input}\n                  />\n                </div>\n                \n                <div style={styles.formGroup}>\n                  <label style={styles.label} htmlFor=\"pressure-altitude\">Pressure Altitude (ft):</label>\n                  <input \n                    type=\"number\" \n                    id=\"pressure-altitude\" \n                    defaultValue={weatherData?.pressureAltitude || 0}\n                    min=\"0\" \n                    max=\"10000\"\n                    style={styles.input}\n                  />\n                </div>\n              </div>\n            </div>\n            \n            <div style={styles.section}>\n              <div style={styles.header}>Aircraft Configuration</div>\n              \n              <div style={styles.checkboxGroup}>\n                <div style={styles.checkbox}>\n                  <input \n                    type=\"checkbox\" \n                    id=\"engine-failure\" \n                    style={{ accentColor: '#4fc3f7' }}\n                  />\n                  <label style={styles.checkboxLabel} htmlFor=\"engine-failure\">\n                    Include Engine Failure Analysis\n                  </label>\n                </div>\n                \n                <div style={styles.checkbox}>\n                  <input \n                    type=\"checkbox\" \n                    id=\"cat-a\" \n                    defaultChecked \n                    style={{ accentColor: '#4fc3f7' }}\n                  />\n                  <label style={styles.checkboxLabel} htmlFor=\"cat-a\">\n                    Apply Category A Procedures\n                  </label>\n                </div>\n              </div>\n              \n              <button style={styles.button}>\n                Calculate Performance\n              </button>\n            </div>\n            \n            <div style={styles.resultsContainer}>\n              <div style={styles.resultsHeader}>Performance Results</div>\n              \n              <div style={styles.resultItem}>\n                <div style={styles.resultLabel}>Max Takeoff Weight:</div>\n                <div style={styles.resultValue}>\n                  {selectedAircraft?.maxTakeoffWeight.toLocaleString() || '17,500'} lbs\n                </div>\n              </div>\n              \n              <div style={styles.resultItem}>\n                <div style={styles.resultLabel}>Weight Limited By:</div>\n                <div style={styles.resultValue}>Cat A Takeoff</div>\n              </div>\n              \n              <div style={styles.resultItem}>\n                <div style={styles.resultLabel}>Max Passengers:</div>\n                <div style={styles.resultValue}>\n                  {selectedAircraft?.maxPassengers || '12'}\n                </div>\n              </div>\n            </div>\n          \n            {/* Show S92 Performance Calculator button only if S92 aircraft is selected */}\n            {selectedAircraft?.type === 'S92' || !selectedAircraft ? (\n              <div style={styles.s92Section}>\n                <div style={styles.header}>S92 Performance Calculator</div>\n                <p style={{ fontSize: '12px', color: '#bbb', marginBottom: '12px' }}>\n                  Click below to open the S92 dropdown calculator\n                </p>\n                <button \n                  style={styles.button}\n                  onClick={toggleS92Calculator}\n                >\n                  Open S92 Calculator\n                </button>\n              </div>\n            ) : null}\n          </div>\n        </BaseCard>\n      ) : (\n        // When showS92Calculator is true, render S92PerformanceCard with props\n        <S92PerformanceCard \n          id={s92CardId}\n          weatherData={weatherData}\n          aircraftData={selectedAircraft}\n          onClose={toggleS92Calculator}\n        />\n      )}\n    </>\n  );\n};\n\nexport default PerformanceCard;","import React from 'react';\nimport BaseCard from './BaseCard';\n\n/**\n * WeatherCard Component\n * \n * Contains weather settings and conditions from the original RightPanel component.\n */\nconst WeatherCard = ({ \n  id, \n  weather = { windSpeed: 15, windDirection: 270 },\n  onWeatherUpdate = () => {}\n}) => {\n  return (\n    <BaseCard title=\"Weather Settings\" id={id}>\n      <div className=\"control-section\">\n        <h4>Weather Source</h4>\n        \n        <div className=\"weather-source-options\">\n          <div>\n            <input type=\"radio\" id=\"actual-weather\" name=\"weather-source\" defaultChecked />\n            <label htmlFor=\"actual-weather\">Use Actual Weather</label>\n          </div>\n          \n          <div>\n            <input type=\"radio\" id=\"manual-weather\" name=\"weather-source\" />\n            <label htmlFor=\"manual-weather\">Manual Weather Entry</label>\n          </div>\n        </div>\n        \n        <h4>Wind Settings</h4>\n        \n        <div className=\"settings-group\">\n          <div>\n            <label htmlFor=\"wind-direction\">Wind Direction (°):</label>\n            <input \n              type=\"number\" \n              id=\"wind-direction\" \n              value={weather.windDirection}\n              min=\"0\" \n              max=\"359\"\n              onChange={(e) => {\n                const newDirection = parseInt(e.target.value) || 0;\n                console.log('WeatherCard: Wind direction changed to:', newDirection);\n                // Ensure valid range 0-359\n                const normalizedDirection = ((newDirection % 360) + 360) % 360;\n                // Important: Pass parameters in correct order (speed, direction)\n                onWeatherUpdate(weather.windSpeed, normalizedDirection);\n              }}\n            />\n          </div>\n          \n          <div>\n            <label htmlFor=\"wind-speed\">Wind Speed (kts):</label>\n            <input \n              type=\"number\" \n              id=\"wind-speed\" \n              value={weather.windSpeed}\n              min=\"0\" \n              max=\"100\"\n              onChange={(e) => {\n                const newSpeed = parseInt(e.target.value) || 0;\n                console.log('WeatherCard: Wind speed changed to:', newSpeed);\n                // Important: Pass parameters in correct order (speed, direction)\n                onWeatherUpdate(newSpeed, weather.windDirection);\n              }}\n            />\n          </div>\n        </div>\n        \n        <h4>Visibility & Ceiling</h4>\n        \n        <div className=\"settings-group\">\n          <div>\n            <label htmlFor=\"visibility\">Visibility (nm):</label>\n            <input \n              type=\"number\" \n              id=\"visibility\" \n              defaultValue={10}\n              min=\"0\" \n              max=\"50\"\n              step=\"0.1\"\n            />\n          </div>\n          \n          <div>\n            <label htmlFor=\"ceiling\">Ceiling (ft):</label>\n            <input \n              type=\"number\" \n              id=\"ceiling\" \n              defaultValue={3000}\n              min=\"0\" \n              max=\"20000\"\n              step=\"100\"\n            />\n          </div>\n        </div>\n        \n        <button className=\"control-button\">\n          Apply Weather\n        </button>\n        \n        <div className=\"weather-data\">\n          <h4>Current Weather</h4>\n          <div className=\"weather-item\">\n            <div className=\"weather-icon\">🌤️</div>\n            <div className=\"weather-details\">\n              <div>Wind: {weather.windDirection}° at {weather.windSpeed} kts</div>\n              <div>Visibility: 10 nm</div>\n              <div>Ceiling: 3,000 ft</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </BaseCard>\n  );\n};\n\nexport default WeatherCard;","import React, { useState, useEffect } from 'react';\nimport BaseCard from './BaseCard';\n\n/**\n * Finance Calculator Component with browser persistence\n */\nconst FinanceCard = ({ id }) => {\n  // Load settings from localStorage with defaults if not found\n  const loadSetting = (key, defaultValue) => {\n    try {\n      const savedValue = localStorage.getItem(`financeCalc_${key}`);\n      return savedValue !== null ? JSON.parse(savedValue) : defaultValue;\n    } catch (error) {\n      console.warn(`Error loading setting ${key}:`, error);\n      return defaultValue;\n    }\n  };\n\n  // Basic settings with localStorage persistence\n  const [hourlyRate, setHourlyRate] = useState(() => loadSetting('hourlyRate', 4500));\n  const [mileageRate, setMileageRate] = useState(() => loadSetting('mileageRate', 100));\n  const [billingMethod, setBillingMethod] = useState(() => loadSetting('billingMethod', 'hourly'));\n  const [landingFee, setLandingFee] = useState(() => loadSetting('landingFee', 250));\n  const [includeLandingFees, setIncludeLandingFees] = useState(() => loadSetting('includeLandingFees', true));\n  const [additionalCost, setAdditionalCost] = useState(() => loadSetting('additionalCost', 0));\n  const [useFlightTime, setUseFlightTime] = useState(() => loadSetting('useFlightTime', true)); // Toggle between flight time and total time\n  const [customLandings, setCustomLandings] = useState(() => loadSetting('customLandings', 0)); // Custom number of landings\n  const [taxRate, setTaxRate] = useState(() => loadSetting('taxRate', 25)); // Tax rate percentage\n  const [includeTax, setIncludeTax] = useState(() => loadSetting('includeTax', false)); // Toggle tax calculation\n  \n  // Save settings to localStorage when they change\n  const saveSetting = (key, value) => {\n    try {\n      localStorage.setItem(`financeCalc_${key}`, JSON.stringify(value));\n    } catch (error) {\n      console.warn(`Error saving setting ${key}:`, error);\n    }\n  };\n  \n  // Custom setters that update both state and localStorage\n  const updateHourlyRate = (value) => {\n    setHourlyRate(value);\n    saveSetting('hourlyRate', value);\n  };\n  \n  const updateMileageRate = (value) => {\n    setMileageRate(value);\n    saveSetting('mileageRate', value);\n  };\n  \n  const updateBillingMethod = (value) => {\n    setBillingMethod(value);\n    saveSetting('billingMethod', value);\n  };\n  \n  const updateLandingFee = (value) => {\n    setLandingFee(value);\n    saveSetting('landingFee', value);\n  };\n  \n  const updateIncludeLandingFees = (value) => {\n    setIncludeLandingFees(value);\n    saveSetting('includeLandingFees', value);\n  };\n  \n  const updateAdditionalCost = (value) => {\n    setAdditionalCost(value);\n    saveSetting('additionalCost', value);\n  };\n  \n  const updateUseFlightTime = (value) => {\n    setUseFlightTime(value);\n    saveSetting('useFlightTime', value);\n  };\n  \n  const updateCustomLandings = (value) => {\n    setCustomLandings(value);\n    saveSetting('customLandings', value);\n  };\n  \n  const updateTaxRate = (value) => {\n    setTaxRate(value);\n    saveSetting('taxRate', value);\n  };\n  \n  const updateIncludeTax = (value) => {\n    setIncludeTax(value);\n    saveSetting('includeTax', value);\n  };\n  \n  // Route data extracted from the DOM\n  const [routeData, setRouteData] = useState({\n    flightTime: '00:00',\n    flightTimeHours: 0,\n    totalTime: '00:00',\n    totalTimeHours: 0,\n    distance: 0,\n    fuelRequired: 0,\n    landings: 0,\n    hasRoute: false\n  });\n  \n  // Format currency\n  const formatCurrency = (amount) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 2\n    }).format(amount);\n  };\n  \n  // Convert HH:MM to hours\n  const timeToHours = (timeStr) => {\n    if (!timeStr) return 0;\n    const [hours, minutes] = timeStr.split(':').map(n => parseInt(n) || 0);\n    return hours + (minutes / 60);\n  };\n  \n  // Read route data directly from the route stats card DOM elements\n  const readRouteData = () => {\n    try {\n      // Find the route-stats-card element\n      const statsCard = document.querySelector('.route-stats-card');\n      if (!statsCard) return false;\n      \n      // Find all route-stat-value elements\n      const statValues = statsCard.querySelectorAll('.route-stat-value');\n      if (statValues.length < 4) return false;\n      \n      // Extract distance from the first value\n      const distanceText = statValues[0].textContent || '';\n      const distanceMatch = distanceText.match(/(\\d+\\.?\\d*)/);\n      const distance = distanceMatch ? parseFloat(distanceMatch[1]) : 0;\n      \n      // Extract flight time from the third value\n      const flightTimeText = statValues[2].textContent || '';\n      const flightTime = flightTimeText.trim();\n      const flightTimeHours = timeToHours(flightTime);\n      \n      // Extract total time from the 7th value (should be the one in the second row, third column)\n      const totalTimeText = statValues[6]?.textContent || '';\n      const totalTime = totalTimeText.trim();\n      const totalTimeHours = timeToHours(totalTime);\n      \n      // Extract fuel from the fourth value\n      const fuelText = statValues[3].textContent || '';\n      const fuelMatch = fuelText.match(/(\\d+)/);\n      const fuelRequired = fuelMatch ? parseInt(fuelMatch[1]) : 0;\n      \n      // Count waypoints for landings\n      const waypoints = document.querySelectorAll('.stop-entry').length;\n      const landings = waypoints;\n      \n      // Update route data if we found valid data\n      if (distance > 0 || flightTimeHours > 0) {\n        setRouteData({\n          flightTime,\n          flightTimeHours,\n          totalTime,\n          totalTimeHours,\n          distance,\n          fuelRequired,\n          landings,\n          hasRoute: true\n        });\n        return true;\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Error reading route data:', error);\n      return false;\n    }\n  };\n  \n  // Initialize and set up periodic checking for route data changes\n  useEffect(() => {\n    // Read data immediately\n    readRouteData();\n    \n    // Set up interval to check for changes\n    const intervalId = setInterval(() => {\n      readRouteData();\n    }, 500);\n    \n    // Clean up interval on unmount\n    return () => clearInterval(intervalId);\n  }, []);\n  \n  // Calculate costs based on route data and settings\n  const calculateCosts = () => {\n    try {\n      // Check if we have valid route data\n      if (!routeData.hasRoute) return null;\n      \n      // Calculate main cost based on billing method\n      let mainCost = 0;\n      \n      // Always use the custom landing count when specified, otherwise use route data\n      const landingsCount = customLandings > 0 ? customLandings : routeData.landings;\n      \n      // Calculate landing fees if included\n      const landingCost = includeLandingFees && landingsCount > 0\n        ? landingsCount * landingFee\n        : 0;\n      \n      // Additional cost\n      const extra = parseFloat(additionalCost) || 0;\n      \n      if (billingMethod === 'hourly') {\n        // Use either flight time or total time based on toggle\n        const timeHours = useFlightTime ? routeData.flightTimeHours : routeData.totalTimeHours;\n        const timeDisplay = useFlightTime ? routeData.flightTime : routeData.totalTime;\n        \n        mainCost = timeHours * hourlyRate;\n        \n        // Subtotal before tax\n        const subtotal = mainCost + landingCost + extra;\n        \n        // Calculate tax if included\n        const taxAmount = includeTax ? (subtotal * taxRate / 100) : 0;\n        \n        // Total cost including tax if applicable\n        const totalCost = subtotal + taxAmount;\n        \n        return {\n          mainCost,\n          timeHours,\n          timeDisplay,\n          isFlightTime: useFlightTime,\n          landingCost,\n          landingsCount,\n          extra,\n          subtotal,\n          taxAmount,\n          taxRate: includeTax ? taxRate : 0,\n          includeTax,\n          totalCost\n        };\n      } else { // mileage\n        mainCost = routeData.distance * mileageRate;\n        \n        // Subtotal before tax\n        const subtotal = mainCost + landingCost + extra;\n        \n        // Calculate tax if included\n        const taxAmount = includeTax ? (subtotal * taxRate / 100) : 0;\n        \n        // Total cost including tax if applicable\n        const totalCost = subtotal + taxAmount;\n        \n        return {\n          mainCost,\n          landingCost,\n          landingsCount,\n          extra,\n          subtotal,\n          taxAmount,\n          taxRate: includeTax ? taxRate : 0,\n          includeTax,\n          totalCost\n        };\n      }\n    } catch (error) {\n      console.error('Error calculating costs:', error);\n      return null;\n    }\n  };\n  \n  // Get calculated costs\n  const costs = calculateCosts();\n  \n  return (\n    <BaseCard title=\"Finance Calculator\" id={id}>\n      <div className=\"control-section\">\n        <h4>Flight Cost Parameters</h4>\n        \n        <div className=\"mb-4\">\n          <label htmlFor=\"billing-method\">Billing Method:</label>\n          <select \n            id=\"billing-method\"\n            value={billingMethod}\n            onChange={(e) => updateBillingMethod(e.target.value)}\n            className=\"w-full p-2 border rounded\"\n          >\n            <option value=\"hourly\">Hourly Rate</option>\n            <option value=\"mileage\">Per Nautical Mile</option>\n          </select>\n        </div>\n        \n        {billingMethod === 'hourly' ? (\n          <div className=\"mb-4\">\n            <label htmlFor=\"hourly-rate\">Hourly Rate (USD):</label>\n            <input \n              type=\"number\" \n              id=\"hourly-rate\" \n              value={hourlyRate}\n              min=\"0\"\n              step=\"100\"\n              onChange={(e) => updateHourlyRate(Number(e.target.value))}\n              className=\"w-full p-2 border rounded\"\n            />\n          </div>\n        ) : (\n          <div className=\"mb-4\">\n            <label htmlFor=\"mileage-rate\">Rate per NM (USD):</label>\n            <input \n              type=\"number\" \n              id=\"mileage-rate\" \n              value={mileageRate}\n              min=\"0\"\n              step=\"10\"\n              onChange={(e) => updateMileageRate(Number(e.target.value))}\n              className=\"w-full p-2 border rounded\"\n            />\n          </div>\n        )}\n        \n        <div className=\"mb-4\">\n          <div className=\"flex items-center mb-2\">\n            <input \n              type=\"checkbox\" \n              id=\"include-landing-fees\" \n              checked={includeLandingFees}\n              onChange={(e) => updateIncludeLandingFees(e.target.checked)}\n              className=\"mr-2\"\n            />\n            <label htmlFor=\"include-landing-fees\">Include Landing Fees</label>\n          </div>\n          \n          {includeLandingFees && (\n            <div>\n              <div className=\"mb-2\">\n                <label htmlFor=\"landing-fee\">Landing Fee (USD):</label>\n                <input \n                  type=\"number\" \n                  id=\"landing-fee\" \n                  value={landingFee}\n                  min=\"0\"\n                  step=\"50\"\n                  onChange={(e) => updateLandingFee(Number(e.target.value))}\n                  className=\"w-full p-2 border rounded\"\n                />\n              </div>\n              \n              <div className=\"mb-2\">\n                <label htmlFor=\"custom-landings\">Number of Landings:</label>\n                <input \n                  type=\"number\" \n                  id=\"custom-landings\" \n                  value={customLandings}\n                  min=\"0\"\n                  step=\"1\"\n                  onChange={(e) => updateCustomLandings(Number(e.target.value))}\n                  className=\"w-full p-2 border rounded\"\n                />\n                <div className=\"text-xs text-gray-400 mt-1\">\n                  Only count landings at airports, not rigs\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n        \n        <div className=\"mb-4\">\n          <label htmlFor=\"additional-cost\">Additional Cost (USD):</label>\n          <input \n            type=\"number\" \n            id=\"additional-cost\" \n            value={additionalCost}\n            min=\"0\"\n            step=\"100\"\n            onChange={(e) => updateAdditionalCost(Number(e.target.value))}\n            className=\"w-full p-2 border rounded\"\n          />\n        </div>\n        \n        {/* Time Type Toggle Switch - Simplified UI */}\n        {billingMethod === 'hourly' && (\n          <div className=\"mb-4\">\n            <label className=\"block mb-2\">Time Type:</label>\n            <div className=\"flex items-center\">\n              <input \n                type=\"checkbox\" \n                id=\"time-toggle\" \n                checked={!useFlightTime}\n                onChange={() => updateUseFlightTime(!useFlightTime)}\n                className=\"mr-2\"\n              />\n              <div className=\"flex-1\">\n                <span className={`${useFlightTime ? 'font-bold text-blue-500' : ''}`}>\n                  Flight Time\n                </span>\n                <span className=\"mx-2\">|</span>\n                <span className={`${!useFlightTime ? 'font-bold text-green-500' : ''}`}>\n                  Total Time\n                </span>\n              </div>\n            </div>\n          </div>\n        )}\n        \n\n        \n        {/* Tax Calculator - Standard UI */}\n        <div className=\"mb-4\">\n          <div className=\"flex items-center mb-2\">\n            <input \n              type=\"checkbox\" \n              id=\"include-tax\" \n              checked={includeTax}\n              onChange={(e) => updateIncludeTax(e.target.checked)}\n              className=\"mr-2\"\n            />\n            <label htmlFor=\"include-tax\">Include Tax</label>\n          </div>\n          \n          {includeTax && (\n            <div className=\"mb-2\">\n              <label htmlFor=\"tax-rate\">Tax Rate (%):</label>\n              <input \n                type=\"number\" \n                id=\"tax-rate\" \n                value={taxRate}\n                min=\"0\"\n                max=\"100\"\n                step=\"0.1\"\n                onChange={(e) => updateTaxRate(Number(e.target.value))}\n                className=\"w-full p-2 border rounded\"\n              />\n            </div>\n          )}\n        </div>\n        \n        <h4>Cost Breakdown</h4>\n        {routeData.hasRoute && costs ? (\n          <div className=\"finance-results\">\n            <div className=\"finance-item\">\n              <div className=\"finance-label\">\n                {billingMethod === 'hourly' \n                  ? `${costs.isFlightTime ? 'Flight' : 'Total'} Time Cost (${costs.timeDisplay}):`\n                  : `Distance Cost (${routeData.distance} nm):`\n                }\n              </div>\n              <div className=\"finance-value\">{formatCurrency(costs.mainCost)}</div>\n            </div>\n            \n            {includeLandingFees && costs.landingsCount > 0 && (\n              <div className=\"finance-item\">\n                <div className=\"finance-label\">Landing Fees ({costs.landingsCount} landings):</div>\n                <div className=\"finance-value\">{formatCurrency(costs.landingCost)}</div>\n              </div>\n            )}\n            \n            {additionalCost > 0 && (\n              <div className=\"finance-item\">\n                <div className=\"finance-label\">Additional Cost:</div>\n                <div className=\"finance-value\">{formatCurrency(costs.extra)}</div>\n              </div>\n            )}\n            \n            {/* Display subtotal if tax is included */}\n            {includeTax && (\n              <div className=\"finance-item\">\n                <div className=\"finance-label\">Subtotal:</div>\n                <div className=\"finance-value\">{formatCurrency(costs.subtotal)}</div>\n              </div>\n            )}\n            \n            {/* Display tax amount if included */}\n            {includeTax && (\n              <div className=\"finance-item\">\n                <div className=\"finance-label\">Tax ({taxRate}%):</div>\n                <div className=\"finance-value\">{formatCurrency(costs.taxAmount)}</div>\n              </div>\n            )}\n            \n            <div className=\"finance-item total\">\n              <div className=\"finance-label\">Total Cost:</div>\n              <div className=\"finance-value\">{formatCurrency(costs.totalCost)}</div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"mt-4 text-center text-gray-400 italic\">\n            Create a route to see financial data\n          </div>\n        )}\n      </div>\n    </BaseCard>\n  );\n};\n\nexport default FinanceCard;","import React from 'react';\nimport BaseCard from './BaseCard';\n\n/**\n * EvacuationCard Component\n * \n * Contains evacuation planning tools from the original RightPanel component.\n */\nconst EvacuationCard = ({ id }) => {\n  return (\n    <BaseCard title=\"Evacuation Planner\" id={id}>\n      <div className=\"control-section\">\n        <h4>Evacuation Parameters</h4>\n        \n        <label htmlFor=\"total-evacuees\">Total Personnel to Evacuate:</label>\n        <input \n          type=\"number\" \n          id=\"total-evacuees\" \n          defaultValue={120}\n          min=\"1\"\n        />\n        \n        <label htmlFor=\"available-aircraft\">Available Aircraft:</label>\n        <select id=\"available-aircraft\" multiple>\n          <option value=\"N603PW\">N603PW (AW139)</option>\n          <option value=\"N604PW\">N604PW (AW139)</option>\n          <option value=\"N701BH\">N701BH (S92)</option>\n          <option value=\"N702BH\">N702BH (S92)</option>\n        </select>\n        <div className=\"small-hint\">Hold Ctrl/Cmd to select multiple</div>\n        \n        <label htmlFor=\"priority-level\">Priority Level:</label>\n        <select id=\"priority-level\">\n          <option value=\"1\">1 - Immediate (Medical Emergency)</option>\n          <option value=\"2\">2 - Urgent (Weather Threat)</option>\n          <option value=\"3\" selected>3 - Standard Evacuation</option>\n          <option value=\"4\">4 - Non-Essential Personnel</option>\n        </select>\n        \n        <button className=\"control-button evacuation-calculate\">\n          Calculate Evacuation Plan\n        </button>\n        \n        <div className=\"evacuation-results\">\n          <h4>Evacuation Plan</h4>\n          <div className=\"evacuation-summary\">\n            <div>Total Evacuees: 120</div>\n            <div>Total Flights Required: 10</div>\n            <div>Estimated Completion Time: 4:30</div>\n          </div>\n          \n          <div className=\"evacuation-flight-list\">\n            <h5>Flight Schedule</h5>\n            <div className=\"evacuation-flight\">\n              <div className=\"flight-number\">Flight 1</div>\n              <div className=\"flight-details\">\n                <div>N603PW - 12 pax</div>\n                <div>Depart: 10:00 - Arrive: 10:45</div>\n              </div>\n            </div>\n            <div className=\"evacuation-flight\">\n              <div className=\"flight-number\">Flight 2</div>\n              <div className=\"flight-details\">\n                <div>N701BH - 19 pax</div>\n                <div>Depart: 10:15 - Arrive: 11:00</div>\n              </div>\n            </div>\n            <div className=\"evacuation-flight\">\n              <div className=\"flight-number\">Flight 3</div>\n              <div className=\"flight-details\">\n                <div>N604PW - 12 pax</div>\n                <div>Depart: 10:30 - Arrive: 11:15</div>\n              </div>\n            </div>\n            <div className=\"evacuation-more\">+7 more flights...</div>\n          </div>\n        </div>\n      </div>\n    </BaseCard>\n  );\n};\n\nexport default EvacuationCard;","import React, { useState, useEffect } from 'react';\n\n/**\n * SaveFlightCard Component\n * \n * A panel card for collecting flight details to save to Palantir\n * Designed to slide in from the right side like other cards\n */\nconst SaveFlightCard = ({ \n  id,\n  onSave, \n  onCancel,\n  isSaving, \n  initialFlightName = '',\n  waypoints,\n  onRunDiagnostic = null,\n  runAutomation = true, // Default to true to match current behavior\n  selectedAircraft\n}) => {\n  // Form state\n  const [flightName, setFlightName] = useState(initialFlightName);\n  const [etd, setEtd] = useState('');\n  const [captainId, setCaptainId] = useState('');\n  const [copilotId, setCopilotId] = useState('');\n  const [medicId, setMedicId] = useState('');\n  const [soId, setSoId] = useState('');\n  const [rswId, setRswId] = useState('');\n  const [enableAutomation, setEnableAutomation] = useState(runAutomation);\n  \n  // Set up initial values when card is shown\n  useEffect(() => {\n    // Generate a default flight name based on waypoints if not provided\n    if (!initialFlightName && waypoints && waypoints.length >= 2) {\n      const origin = waypoints[0].name || 'Origin';\n      const destination = waypoints[waypoints.length - 1].name || 'Destination';\n      const todayDate = new Date().toISOString().split('T')[0];\n      setFlightName(`${origin} to ${destination} - ${todayDate}`);\n    } else {\n      setFlightName(initialFlightName);\n    }\n    \n    // Default ETD to current time\n    const now = new Date();\n    const formattedDate = now.toISOString().slice(0, 16); // Format: YYYY-MM-DDThh:mm\n    setEtd(formattedDate);\n    \n    // Set initial automation state from props\n    setEnableAutomation(runAutomation);\n  }, [initialFlightName, waypoints, runAutomation]);\n  \n  // Handle form submission\n  const handleSubmit = () => {\n    if (!flightName || !etd) {\n      return; // Don't submit if required fields are missing\n    }\n    \n    const flightData = {\n      flightName,\n      etd,\n      captainId: captainId || null,\n      copilotId: copilotId || null,\n      medicId: medicId || null,\n      soId: soId || null,\n      rswId: rswId || null,\n      runAutomation: enableAutomation // Add the automation flag\n    };\n    \n    onSave(flightData);\n  };\n  \n  // CSS styles to match the app's design\n  const styles = {\n    container: {\n      maxWidth: '100%', \n      width: '100%'\n    },\n    header: {\n      marginBottom: '15px'\n    },\n    section: {\n      marginBottom: '15px'\n    },\n    label: {\n      display: 'block',\n      marginBottom: '5px',\n      fontWeight: 'normal',\n      fontSize: '14px',\n      color: '#e0e0e0'\n    },\n    inputContainer: {\n      marginBottom: '12px',\n      paddingRight: '15px' // Added padding on the right side\n    },\n    input: {\n      width: '100%',\n      padding: '5px 8px',\n      border: '1px solid #444',\n      borderRadius: '4px',\n      backgroundColor: 'rgba(30, 30, 30, 0.6)',\n      color: 'white',\n      fontSize: '14px',\n      height: '28px' // Reduced height for more compact look\n    },\n    checkboxContainer: {\n      display: 'flex',\n      alignItems: 'center',\n      backgroundColor: 'rgba(30, 30, 30, 0.6)',\n      padding: '8px 10px',\n      borderRadius: '4px',\n      border: '1px solid #444',\n      marginBottom: '20px',\n      marginRight: '15px' // Added padding on the right side\n    },\n    checkbox: {\n      width: '18px',\n      height: '18px',\n      marginRight: '10px',\n      accentColor: '#4caf50'\n    },\n    checkboxLabel: {\n      cursor: 'pointer',\n      fontWeight: 'normal',\n      fontSize: '14px'\n    },\n    checkboxDescription: {\n      fontSize: '12px',\n      marginLeft: '5px',\n      opacity: 0.7,\n      display: 'block'\n    },\n    buttonRow: {\n      display: 'flex',\n      justifyContent: 'space-between', // Changed to space-between for even spacing\n      marginTop: '20px',\n      paddingRight: '15px' // Added padding on the right side\n    },\n    diagButton: {\n      backgroundColor: '#444',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      padding: '6px 12px', // Slightly reduced padding\n      cursor: 'pointer',\n      fontWeight: 'normal',\n      fontSize: '12px',\n      height: '28px', // Reduced height\n      margin: '0 4px' // Added margin for spacing\n    },\n    testButton: {\n      backgroundColor: '#444',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      padding: '6px 12px', // Slightly reduced padding\n      cursor: 'pointer',\n      fontWeight: 'normal',\n      fontSize: '12px',\n      height: '28px', // Reduced height\n      margin: '0 4px' // Added margin for spacing\n    },\n    cancelButton: {\n      backgroundColor: '#444',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      padding: '5px 10px',\n      cursor: 'pointer',\n      fontWeight: 'normal',\n      height: '28px', // Reduced height\n      flex: 1,\n      margin: '0 4px' // Added margin for spacing\n    },\n    saveButton: {\n      backgroundColor: '#038dde',\n      color: 'white',\n      border: 'none',\n      borderRadius: '4px',\n      padding: '5px 10px',\n      cursor: 'pointer',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      fontWeight: 'normal',\n      height: '28px', // Reduced height\n      flex: 1,\n      margin: '0 4px' // Added margin for spacing\n    },\n    disabledButton: {\n      backgroundColor: '#444',\n      cursor: 'not-allowed'\n    },\n    spinner: {\n      display: 'inline-block',\n      width: '14px',\n      height: '14px',\n      border: '2px solid rgba(255,255,255,0.3)',\n      borderRadius: '50%',\n      borderTopColor: 'white',\n      animation: 'spin 1s ease-in-out infinite',\n      marginRight: '8px'\n    }\n  };\n  \n  return (\n    <div className=\"tab-content\" style={styles.container}>\n      <div className=\"panel-header\" style={styles.header}>\n        <h3>Save Flight to Palantir</h3>\n      </div>\n      \n      <div className=\"control-section\">\n        <div style={styles.inputContainer}>\n          <label style={styles.label}>Flight Name:</label>\n          <input \n            type=\"text\" \n            value={flightName} \n            onChange={e => setFlightName(e.target.value)}\n            style={styles.input}\n            required\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>ETD (Estimated Time of Departure):</label>\n          <input \n            type=\"datetime-local\" \n            value={etd} \n            onChange={e => setEtd(e.target.value)}\n            style={styles.input}\n            required\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>Captain:</label>\n          <input \n            type=\"text\" \n            value={captainId} \n            onChange={e => setCaptainId(e.target.value)}\n            placeholder=\"Enter Captain ID\"\n            style={styles.input}\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>Copilot:</label>\n          <input \n            type=\"text\" \n            value={copilotId} \n            onChange={e => setCopilotId(e.target.value)}\n            placeholder=\"Enter Copilot ID\"\n            style={styles.input}\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>Medic:</label>\n          <input \n            type=\"text\" \n            value={medicId} \n            onChange={e => setMedicId(e.target.value)}\n            placeholder=\"Enter Medic ID\"\n            style={styles.input}\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>SO (Winch Operator):</label>\n          <input \n            type=\"text\" \n            value={soId} \n            onChange={e => setSoId(e.target.value)}\n            placeholder=\"Enter SO ID\"\n            style={styles.input}\n          />\n        </div>\n        \n        <div style={styles.inputContainer}>\n          <label style={styles.label}>Rescue Swimmer:</label>\n          <input \n            type=\"text\" \n            value={rswId} \n            onChange={e => setRswId(e.target.value)}\n            placeholder=\"Enter Rescue Swimmer ID\"\n            style={styles.input}\n          />\n        </div>\n        \n        {/* Add automation toggle checkbox */}\n        <div style={styles.checkboxContainer}>\n          <input\n            type=\"checkbox\"\n            id=\"enable-automation\"\n            checked={enableAutomation}\n            onChange={() => setEnableAutomation(!enableAutomation)}\n            style={styles.checkbox}\n          />\n          <label \n            htmlFor=\"enable-automation\"\n            style={{\n              ...styles.checkboxLabel,\n              color: enableAutomation ? '#4caf50' : '#ccc'\n            }}\n          >\n            Run automation after saving \n            <span style={styles.checkboxDescription}>\n              Will find best runway, calculate wind effects, find alternates, optimize fuel and passenger count\n            </span>\n          </label>\n        </div>\n        \n        {/* Bottom buttons - full width, equal size, no gaps */}\n        <div style={{ \n          display: 'flex', \n          justifyContent: 'space-between', \n          marginTop: '20px',\n          paddingRight: '15px', // Maintain right padding\n          gap: '8px' // Small gap between buttons\n        }}>\n          <button\n            onClick={async () => {\n              try {\n                // Show that we're working\n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator('Testing API connection...');\n                }\n                \n                // Import the SDK directly\n                const sdk = await import('@flight-app/sdk');\n                \n                // Check if the actions exist\n                const hasFlightAction = !!sdk.createNewFlightFp2;\n                const hasAutomationAction = !!sdk.singleFlightAutomation;\n                \n                // Log what we found\n                console.log('SDK Loaded:', !!sdk);\n                console.log('createNewFlightFp2 action available:', hasFlightAction);\n                console.log('singleFlightAutomation action available:', hasAutomationAction);\n                console.log('All available SDK objects:', Object.keys(sdk));\n                \n                // Show in the UI\n                if (window.LoadingIndicator) {\n                  if (hasFlightAction && hasAutomationAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection successful: Both actions found', \n                      'success'\n                    );\n                  } else if (hasFlightAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection partial: createNewFlightFp2 found, automation missing', \n                      'warning'\n                    );\n                  } else if (hasAutomationAction) {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection partial: singleFlightAutomation found, flight creation missing', \n                      'warning'\n                    );\n                  } else {\n                    window.LoadingIndicator.updateStatusIndicator(\n                      'API connection issue: Both actions missing', \n                      'error'\n                    );\n                  }\n                }\n              } catch (error) {\n                console.error('API connection test error:', error);\n                \n                if (window.LoadingIndicator) {\n                  window.LoadingIndicator.updateStatusIndicator(\n                    `API connection failed: ${error.message}`, \n                    'error'\n                  );\n                }\n              }\n            }}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px 10px',\n              cursor: 'pointer',\n              fontWeight: 'normal',\n              fontSize: '12px',\n              height: '28px',\n              flex: 1, // Take equal width\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            Test API\n          </button>\n          \n          <button\n            onClick={onCancel}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px 10px',\n              cursor: 'pointer',\n              fontWeight: 'normal',\n              height: '28px',\n              flex: 1, // Take equal width\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            Cancel\n          </button>\n          \n          <button\n            onClick={handleSubmit}\n            disabled={isSaving || !flightName || !etd}\n            style={{\n              backgroundColor: isSaving || !flightName || !etd ? '#444' : '#038dde',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px 10px',\n              cursor: isSaving || !flightName || !etd ? 'not-allowed' : 'pointer',\n              fontWeight: 'normal',\n              height: '28px',\n              flex: 1, // Take equal width\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            {isSaving ? (\n              <>\n                <span className=\"spinner\" style={{\n                  display: 'inline-block',\n                  width: '14px',\n                  height: '14px',\n                  border: '2px solid rgba(255,255,255,0.3)',\n                  borderRadius: '50%',\n                  borderTopColor: 'white',\n                  animation: 'spin 1s ease-in-out infinite',\n                  marginRight: '8px'\n                }}></span>\n                Saving...\n              </>\n            ) : (\n              'Save Flight'\n            )}\n          </button>\n        </div>\n      </div>\n      \n      {/* Add loading animation */}\n      <style>\n        {`\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\nexport default SaveFlightCard;","import React, { useState, useEffect } from 'react';\n\n/**\n * LoadFlightsCard Component\n * \n * A panel card for loading previously saved flights from Palantir\n * Designed to slide in from the right side like other cards\n */\nconst LoadFlightsCard = ({ \n  id,\n  onLoad, \n  onCancel,\n  isLoading\n}) => {\n  const [flights, setFlights] = useState([]);\n  const [selectedFlightId, setSelectedFlightId] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isLoadingFlights, setIsLoadingFlights] = useState(false);\n  \n  // Load flights when the card is shown\n  useEffect(() => {\n    loadFlights();\n  }, []);\n  \n  // Load flights from Palantir\n  const loadFlights = async () => {\n    setIsLoadingFlights(true);\n    \n    try {\n      // Mock data for now - this would be replaced with real API call\n      setTimeout(() => {\n        const mockFlights = [\n          { id: '1', name: 'KLCH to KIYA - 2025-05-09', date: '2025-05-09T10:00:00', status: 'Completed' },\n          { id: '2', name: 'ENZV to ENLE - 2025-05-08', date: '2025-05-08T14:30:00', status: 'Planned' },\n          { id: '3', name: 'KIYA to EC176 - 2025-05-07', date: '2025-05-07T08:15:00', status: 'In Progress' },\n          { id: '4', name: 'WC369 to KHUM - 2025-05-06', date: '2025-05-06T16:45:00', status: 'Completed' },\n          { id: '5', name: 'KLCH to WC487 - 2025-05-05', date: '2025-05-05T11:20:00', status: 'Cancelled' }\n        ];\n        setFlights(mockFlights);\n        setIsLoadingFlights(false);\n      }, 1000);\n      \n      // This is where the real API call would go\n      // const sdk = await import('@flight-app/sdk');\n      // const result = await client(sdk.listFlights).applyAction({});\n      // setFlights(result.flights);\n    } catch (error) {\n      console.error('Error loading flights:', error);\n      setFlights([]);\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(\n          `Failed to load flights: ${error.message}`, \n          'error'\n        );\n      }\n    } finally {\n      setIsLoadingFlights(false);\n    }\n  };\n  \n  // Handle loading a flight\n  const handleLoadFlight = () => {\n    if (!selectedFlightId) return;\n    \n    const flight = flights.find(f => f.id === selectedFlightId);\n    if (flight) {\n      onLoad(flight);\n    }\n  };\n  \n  // Filter flights based on search term\n  const filteredFlights = flights.filter(flight => \n    flight.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    flight.status.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n  \n  const formatDate = (dateString) => {\n    const date = new Date(dateString);\n    return new Intl.DateTimeFormat('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    }).format(date);\n  };\n  \n  return (\n    <div className=\"tab-content\">\n      <div className=\"panel-header\">\n        <h3>Load Saved Flights</h3>\n      </div>\n      \n      <div className=\"control-section\">\n        {/* Search input */}\n        <div style={{ marginBottom: '12px' }}>\n          <label style={{ \n            display: 'block', \n            marginBottom: '5px', \n            fontWeight: 'normal', \n            fontSize: '14px',\n            color: '#e0e0e0'\n          }}>\n            Search Flights:\n          </label>\n          <input \n            type=\"text\" \n            value={searchTerm} \n            onChange={e => setSearchTerm(e.target.value)}\n            placeholder=\"Search by name or status\"\n            style={{ \n              width: 'calc(100% - 18px)', /* Adjusted width to match container below */\n              padding: '5px 8px', \n              border: '1px solid #444', \n              borderRadius: '4px', \n              backgroundColor: 'rgba(30, 30, 30, 0.6)', \n              color: 'white', \n              fontSize: '14px', \n              height: '28px' \n            }}\n          />\n        </div>\n        \n        {/* Flights list */}\n        <div style={{ \n          marginTop: '15px', \n          marginBottom: '15px', \n          maxHeight: '300px', \n          overflowY: 'auto', \n          border: '1px solid #444', \n          borderRadius: '4px', \n          backgroundColor: 'rgba(25, 25, 25, 0.6)',\n          width: '100%' /* Ensure same width as parent */\n        }}>\n          {isLoadingFlights ? (\n            <div style={{ padding: '20px', textAlign: 'center', color: '#999' }}>\n              <span style={{\n                display: 'inline-block',\n                width: '14px',\n                height: '14px',\n                border: '2px solid rgba(255,255,255,0.3)',\n                borderRadius: '50%',\n                borderTopColor: 'white',\n                animation: 'spin 1s ease-in-out infinite',\n                marginRight: '8px'\n              }}></span> \n              Loading flights...\n            </div>\n          ) : filteredFlights.length === 0 ? (\n            <div style={{ padding: '20px', textAlign: 'center', color: '#999' }}>\n              {searchTerm ? 'No flights match your search' : 'No saved flights found'}\n            </div>\n          ) : (\n            filteredFlights.map(flight => (\n              <div \n                key={flight.id}\n                style={{\n                  padding: '10px',\n                  borderBottom: '1px solid #444',\n                  cursor: 'pointer',\n                  transition: 'background-color 0.2s',\n                  backgroundColor: selectedFlightId === flight.id ? 'rgba(60, 130, 180, 0.4)' : 'transparent'\n                }}\n                onClick={() => setSelectedFlightId(flight.id)}\n              >\n                <div style={{ \n                  fontWeight: 'bold', \n                  fontSize: '14px', \n                  marginBottom: '5px'\n                }}>\n                  {flight.name}\n                </div>\n                <div style={{ fontSize: '12px', opacity: 0.8 }}>\n                  {formatDate(flight.date)}\n                </div>\n                <div style={{\n                  fontSize: '12px',\n                  marginTop: '5px',\n                  display: 'inline-block',\n                  padding: '2px 6px',\n                  borderRadius: '3px',\n                  backgroundColor: 'rgba(40, 40, 40, 0.6)',\n                  color: flight.status === 'Completed' ? '#4caf50' : \n                        flight.status === 'Planned' ? '#2196f3' :\n                        flight.status === 'In Progress' ? '#ff9800' : '#f44336'\n                }}>\n                  {flight.status}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n        \n        {/* Bottom buttons - full width, equal size, small gap */}\n        <div style={{ \n          display: 'flex', \n          justifyContent: 'space-between', \n          marginTop: '20px',\n          gap: '8px',\n          width: '100%' /* Ensure same width as parent */\n        }}>\n          <button\n            onClick={loadFlights}\n            disabled={isLoadingFlights}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px',\n              cursor: isLoadingFlights ? 'not-allowed' : 'pointer',\n              fontWeight: 'normal',\n              fontSize: '12px',\n              height: '28px',\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            {isLoadingFlights ? (\n              <>\n                <span style={{\n                  display: 'inline-block',\n                  width: '14px',\n                  height: '14px',\n                  border: '2px solid rgba(255,255,255,0.3)',\n                  borderRadius: '50%',\n                  borderTopColor: 'white',\n                  animation: 'spin 1s ease-in-out infinite',\n                  marginRight: '6px'\n                }}></span> \n                Refresh\n              </>\n            ) : (\n              'Refresh'\n            )}\n          </button>\n          \n          <button\n            onClick={onCancel}\n            style={{\n              backgroundColor: '#444',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px',\n              cursor: 'pointer',\n              fontWeight: 'normal',\n              fontSize: '12px',\n              height: '28px',\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            Cancel\n          </button>\n          \n          <button\n            onClick={handleLoadFlight}\n            disabled={isLoading || !selectedFlightId}\n            style={{\n              backgroundColor: isLoading || !selectedFlightId ? '#444' : '#038dde',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              padding: '5px',\n              cursor: isLoading || !selectedFlightId ? 'not-allowed' : 'pointer',\n              fontWeight: 'normal',\n              fontSize: '12px',\n              height: '28px',\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center'\n            }}\n            className=\"control-button\"\n          >\n            {isLoading ? (\n              <>\n                <span style={{\n                  display: 'inline-block',\n                  width: '14px',\n                  height: '14px',\n                  border: '2px solid rgba(255,255,255,0.3)',\n                  borderRadius: '50%',\n                  borderTopColor: 'white',\n                  animation: 'spin 1s ease-in-out infinite',\n                  marginRight: '6px'\n                }}></span> \n                Load\n              </>\n            ) : (\n              'Load'\n            )}\n          </button>\n        </div>\n      </div>\n      \n      {/* Add loading animation */}\n      <style>\n        {`\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\nexport default LoadFlightsCard;","import React, { useState, useCallback } from 'react';\nimport RightPanelContainer from './RightPanelContainer';\nimport {\n  MainCard,\n  SettingsCard,\n  PerformanceCard,\n  WeatherCard,\n  FinanceCard,\n  EvacuationCard,\n  SaveFlightCard,\n  LoadFlightsCard\n} from './cards';\nimport '../../FastPlannerStyles.css';\nimport { PanelProvider } from '../../context/PanelContext';\n\n/**\n * Right Panel Component\n * \n * Refactored to use a container with individual card components\n * that slide in and out when different tabs are selected.\n * Uses the existing animation system already in the CSS.\n */\nconst RightPanel = ({\n  visible,\n  onToggleVisibility,\n  onClearRoute,\n  onLoadRigData,\n  onToggleChart,\n  onLoadCustomChart,\n  chartsVisible,\n  aircraftType,\n  onAircraftTypeChange,\n  aircraftRegistration,\n  onAircraftRegistrationChange,\n  selectedAircraft,\n  forceUpdate,\n  aircraftsByType,\n  aircraftLoading,\n  payloadWeight,\n  onPayloadWeightChange,\n  reserveFuel,\n  onReserveFuelChange,\n  routeStats,\n  waypoints,\n  onRemoveWaypoint,\n  isAuthenticated,\n  authUserName,\n  rigsLoading,\n  onLogin,\n  // Region selector props\n  regions = [],\n  currentRegion = null,\n  onRegionChange = () => {},\n  regionLoading = false,\n  // Flight settings props\n  deckTimePerStop = 5,\n  deckFuelPerStop = 100,\n  deckFuelFlow = 400,\n  passengerWeight = 220,\n  cargoWeight = 0,\n  taxiFuel = 50,\n  contingencyFuelPercent = 10,\n  reserveMethod = 'fixed',\n  onDeckTimeChange = () => {},\n  onDeckFuelChange = () => {},\n  onDeckFuelFlowChange = () => {},\n  onPassengerWeightChange = () => {},\n  onCargoWeightChange = () => {},\n  onTaxiFuelChange = () => {},\n  onContingencyFuelPercentChange = () => {},\n  onReserveMethodChange = () => {},\n  // Weather props\n  weather = { windSpeed: 15, windDirection: 270 },\n  onWeatherUpdate = () => {}\n}) => {\n  // Handle saving flight from SaveFlightCard\n  const handleSaveFlightSubmit = (flightData) => {\n    console.log('Save flight data from card:', flightData);\n    // Implement your save logic here or pass it to parent component\n    \n    // Return to main card after saving\n    setTimeout(() => {\n      handleCardChange('main');\n    }, 1000);\n  };\n  \n  // Handle cancel from LoadFlightsCard\n  const handleLoadFlightsCancel = () => {\n    // Switch back to main card\n    handleCardChange('main');\n  };\n  \n  // Handle loading a flight from LoadFlightsCard\n  const handleLoadFlight = (flight) => {\n    console.log('Load flight data from card:', flight);\n    // Implement your load logic here or pass it to parent component\n    \n    // Return to main card after loading\n    setTimeout(() => {\n      handleCardChange('main');\n    }, 1000);\n    \n    // Show success message\n    if (window.LoadingIndicator) {\n      window.LoadingIndicator.updateStatusIndicator(\n        `Flight \"${flight.name}\" loaded successfully`, \n        'success'\n      );\n    }\n  };\n  \n  // Handle cancel from SaveFlightCard\n  const handleSaveFlightCancel = () => {\n    // Switch back to main card\n    handleCardChange('main');\n  };\n  \n  // Reference to the RightPanelContainer for triggering card changes\n  const rightPanelRef = React.useRef();\n  \n  // Track active card state within the RightPanel component\n  const [activeCard, setActiveCard] = useState('main');\n  \n  // Create a handler for card changes that will be exposed through context\n  const handleCardChange = useCallback((cardId) => {\n    if (rightPanelRef.current) {\n      // Log the card change for debugging\n      console.log(`Panel context: changing card to ${cardId}`);\n      \n      // Call the actual method on the container\n      rightPanelRef.current.handleCardChange(cardId);\n      \n      // Update our internal state\n      setActiveCard(cardId);\n    } else {\n      console.warn('Panel context: rightPanelRef not available');\n    }\n  }, []);\n  \n  return (\n    <PanelProvider value={{\n      handleCardChange,\n      activeCard\n    }}>\n      <RightPanelContainer\n        visible={visible}\n        onToggleVisibility={onToggleVisibility}\n        initialActiveCard=\"main\"\n        ref={rightPanelRef}\n      >\n      {/* Main Card */}\n      <MainCard\n        id=\"main\"\n        onClearRoute={onClearRoute}\n        onLoadRigData={onLoadRigData}\n        onToggleChart={onToggleChart}\n        chartsVisible={chartsVisible}\n        aircraftType={aircraftType}\n        onAircraftTypeChange={onAircraftTypeChange}\n        aircraftRegistration={aircraftRegistration}\n        onAircraftRegistrationChange={onAircraftRegistrationChange}\n        selectedAircraft={selectedAircraft}\n        aircraftsByType={aircraftsByType}\n        aircraftLoading={aircraftLoading}\n        routeStats={routeStats}\n        isAuthenticated={isAuthenticated}\n        authUserName={authUserName}\n        rigsLoading={rigsLoading}\n        onLogin={onLogin}\n        regions={regions}\n        currentRegion={currentRegion}\n        onRegionChange={onRegionChange}\n        regionLoading={regionLoading}\n        reserveFuel={reserveFuel}\n        waypoints={waypoints}\n        passengerWeight={passengerWeight}\n        deckTimePerStop={deckTimePerStop}\n        deckFuelFlow={deckFuelFlow}\n        contingencyFuelPercent={contingencyFuelPercent} // Pass contingencyFuelPercent to MainCard\n        taxiFuel={taxiFuel} // Pass taxiFuel to MainCard\n        weather={weather}\n        onWeatherUpdate={onWeatherUpdate}\n        // Added cargoWeight for the Save Flight button to calculate payload\n        cargoWeight={cargoWeight}\n      />\n      \n      {/* Settings Card */}\n      <SettingsCard\n        id=\"settings\"\n        deckTimePerStop={deckTimePerStop}\n        deckFuelPerStop={deckFuelPerStop}\n        deckFuelFlow={deckFuelFlow}\n        passengerWeight={passengerWeight}\n        cargoWeight={cargoWeight}\n        taxiFuel={taxiFuel}\n        contingencyFuelPercent={contingencyFuelPercent}\n        reserveMethod={reserveMethod}\n        reserveFuel={reserveFuel}\n        onDeckTimeChange={onDeckTimeChange}\n        onDeckFuelChange={onDeckFuelChange}\n        onDeckFuelFlowChange={onDeckFuelFlowChange}\n        onPassengerWeightChange={onPassengerWeightChange}\n        onCargoWeightChange={onCargoWeightChange}\n        onTaxiFuelChange={onTaxiFuelChange}\n        onContingencyFuelPercentChange={onContingencyFuelPercentChange}\n        onReserveMethodChange={onReserveMethodChange}\n        onReserveFuelChange={onReserveFuelChange}\n        selectedAircraft={selectedAircraft}\n        aircraftType={aircraftType}\n      />\n      \n      {/* Performance Card */}\n      <PerformanceCard id=\"performance\" />\n      \n      {/* Weather Card */}\n      <WeatherCard \n        id=\"weather\" \n        weather={weather}\n        onWeatherUpdate={onWeatherUpdate}\n      />\n      \n      {/* Finance Card */}\n      <FinanceCard id=\"finance\" />\n      \n      {/* Evacuation Card */}\n      <EvacuationCard id=\"evacuation\" />\n      \n      {/* Save Flight Card */}\n      <SaveFlightCard\n        id=\"saveflight\"\n        onSave={handleSaveFlightSubmit}\n        onCancel={handleSaveFlightCancel}\n        waypoints={waypoints}\n        selectedAircraft={selectedAircraft}\n        isSaving={false}\n      />\n      \n      {/* Load Flights Card */}\n      <LoadFlightsCard \n        id=\"loadflights\"\n        onLoad={handleLoadFlight}\n        onCancel={handleLoadFlightsCancel}\n        isLoading={false}\n      />\n    </RightPanelContainer>\n    </PanelProvider>\n  );\n};\n\nexport default RightPanel;","import React, { useEffect, useRef, useState } from 'react';\n\n/**\n * Map Component\n * \n * Renders the MapBox map and handles map-specific event binding\n */\nconst MapComponent = ({ \n  mapManagerRef, \n  onMapReady, \n  className \n}) => {\n  const mapContainerRef = useRef(null);\n  const mapInitializedRef = useRef(false);\n  const [loading, setLoading] = useState(true);\n  const [loadingMessage, setLoadingMessage] = useState('Initializing map...');\n  \n  // Initialize map on component mount - Run only once\n  useEffect(() => {\n    // Ensure mapManagerRef is available and map hasn't been initialized yet\n    if (!mapManagerRef?.current || mapInitializedRef.current) {\n      // If mapManagerRef isn't ready yet, this effect might run again when it becomes available.\n      // If mapInitializedRef is true, we don't want to re-initialize.\n      console.log(\"MapComponent useEffect: Skipping initialization (no mapManagerRef or already initialized).\");\n      return;\n    }\n\n    console.log(\"MapComponent useEffect: Starting map initialization.\");\n    const mapManager = mapManagerRef.current; // Capture current ref value\n\n    const initMap = async () => {\n      try {\n        setLoading(true);\n        setLoadingMessage('Loading map scripts...');\n        console.log('MapComponent initMap: Loading map scripts...');\n        await mapManager.loadScripts();\n        \n        setLoadingMessage('Initializing map...');\n        console.log('MapComponent initMap: Initializing map...');\n        if (mapContainerRef.current) {\n          // Initialize map using the captured mapManager reference\n          // CRITICAL: Use 'fast-planner-map' as the ID to match what other components expect\n          const mapInstance = await mapManager.initializeMap('fast-planner-map');\n          mapInitializedRef.current = true; // Mark as initialized\n          console.log('MapComponent initMap: Map instance created, calling onReady.');\n          \n          setLoading(false); // Hide loading overlay\n          \n          // Call the onMapReady callback provided by the parent\n          if (onMapReady) {\n            onMapReady(mapInstance); // Pass the newly created map instance\n\n            // SIMPLIFIED FIX: Only dispatch event if handlers haven't been initialized\n            console.log(\"🚀 Setting up single delayed initialization for map click handlers...\");\n            \n            // Single attempt with a delay to ensure map is ready\n            setTimeout(() => {\n              console.log(\"MapComponent: Delayed click handler initialization check\");\n              if (mapInstance && !window.mapHandlersInitialized) {\n                // Only dispatch event if handlers haven't been initialized yet\n                console.log(\"Handlers not yet initialized, triggering event\");\n                const event = new CustomEvent('reinitialize-map-handlers');\n                window.dispatchEvent(event);\n              } else {\n                console.log(\"Handlers already initialized, skipping event dispatch\");\n              }\n            }, 1000);\n          } else {\n             console.warn(\"MapComponent initMap: onMapReady callback is not defined.\");\n          }\n        } else {\n           console.error(\"MapComponent initMap: mapContainerRef is not available.\");\n           setLoadingMessage('Error: Map container not found.');\n        }\n      } catch (error) {\n        console.error('MapComponent initMap: Failed to initialize map:', error);\n        setLoadingMessage('Error loading map: ' + error.message);\n        // Keep loading overlay visible to show the error\n      }\n    };\n    \n    initMap(); // Execute the async initialization function\n    \n    // Cleanup function: Runs only on component unmount due to empty dependency array\n    return () => {\n      console.log(\"MapComponent cleanup: Removing map instance.\");\n      const map = mapManager?.getMap(); // Use the captured manager reference\n      if (map && typeof map.remove === 'function') {\n         try {\n           map.remove();\n         } catch (e) {\n           console.error(\"Error removing map during cleanup:\", e);\n         }\n      }\n      // Reset initialized flag if needed, although component is unmounting\n      mapInitializedRef.current = false; \n    };\n  }, []); // Empty dependency array ensures this runs only once on mount/unmount\n  // Disable loading overlay completely\n  useEffect(() => {\n    // Hide any existing loading overlay immediately\n    const loadingOverlay = document.getElementById('loading-overlay');\n    if (loadingOverlay) {\n      loadingOverlay.style.display = 'none';\n    }\n  }, []);\n  \n  return (\n    <>\n      <div \n        id=\"fast-planner-map\" \n        className={className || \"fast-planner-map\"} \n        ref={mapContainerRef}\n      ></div>\n    </>\n  );\n};\n\nexport default MapComponent;\n","/**\n * Loading Indicator Module\n * \n * Creates an animated, elastic loading bar with optional status text\n * Can be used across the application for any loading operations\n */\nconst LoadingIndicator = (() => {\n  // Keep track of all active loaders\n  const activeLoaders = new Map();\n  let loaderIdCounter = 0;\n  \n  // New message queue system\n  let messageQueue = [];\n  let isProcessingQueue = false;\n  let currentMessage = null;\n  let messageTimer = null;\n\n  // Create and inject the CSS if not already present\n  const initializeStyles = () => {\n    if (document.getElementById('loading-indicator-styles')) return;\n\n    const styleEl = document.createElement('style');\n    styleEl.id = 'loading-indicator-styles';\n    styleEl.textContent = `\n      .fp-loading-container {\n        position: absolute;\n        width: 100%;\n        height: 3px;\n        pointer-events: none;\n        overflow: hidden;\n        background-color: transparent; /* Transparent background for the track */\n        bottom: 0;\n        left: 0;\n        transition: opacity 0.5s ease;\n      }\n      \n      .fp-loading-text {\n        position: absolute;\n        bottom: 10px;\n        left: 50%;\n        transform: translateX(-50%);\n        font-size: 11px;\n        color: rgba(0, 200, 255, 0.9);\n        font-weight: 300;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        opacity: 0.9;\n        text-align: center;\n        max-width: 80%;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .fp-loading-bar {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        height: 2px;\n        background: linear-gradient(to right, \n          rgba(0, 180, 255, 0) 0%, \n          rgba(0, 200, 255, 0.7) 35%, \n          rgba(190, 255, 255, 1) 50%, \n          rgba(0, 200, 255, 0.7) 65%, \n          rgba(0, 180, 255, 0) 100%\n        );\n        width: 35%; /* Slightly longer bar */\n        animation: fp-elastic-scroll 1.8s infinite cubic-bezier(0.645, 0.045, 0.355, 1);\n        transform-origin: left center;\n        border-radius: 1px;\n      }\n      \n      /* When finishing, run animation to completion */\n      .fp-loading-bar.finishing {\n        animation: fp-complete-scroll 1s forwards cubic-bezier(0.215, 0.61, 0.355, 1);\n      }\n      \n      @keyframes fp-elastic-scroll {\n        0% {\n          left: -30%;\n          width: 30%;\n        }\n        35% {\n          width: 33%;\n        }\n        50% {\n          width: 30%;\n        }\n        75% {\n          width: 27%;\n        }\n        100% {\n          left: 100%;\n          width: 30%;\n        }\n      }\n      \n      /* Animation for completion - always reaches the end */\n      @keyframes fp-complete-scroll {\n        0% {\n          left: attr(data-current-position);\n          width: 30%;\n        }\n        100% {\n          left: 100%;\n          width: 30%;\n        }\n      }\n      \n      .status-indicator {\n        position: absolute; \n        left: 50%;\n        top: 40%;\n        transform: translateX(-50%);\n        font-size: 10px; /* Slightly smaller */\n        color: rgba(150, 150, 150, 0.95); /* Darker gray */\n        text-align: center;\n        overflow: hidden;\n        white-space: nowrap;\n        height: 14px;\n        max-width: 400px;\n        margin: 0 auto;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n        font-family: 'Arial Narrow', 'Franklin Gothic Medium', Arial, sans-serif;\n        letter-spacing: 0.5px;\n      }\n      \n      .status-indicator.active {\n        opacity: 1;\n      }\n      \n      /* Typewriter effect for status indicator */\n      .typewriter-text {\n        border-right: 2px solid rgba(150, 200, 255, 0.5);\n        white-space: nowrap;\n        overflow: hidden;\n        animation: typing 1.8s steps(40, end), blink-caret 0.75s step-end infinite;\n      }\n      \n      @keyframes typing {\n        from { width: 0 }\n        to { width: 100% }\n      }\n      \n      @keyframes blink-caret {\n        from, to { border-color: transparent }\n        50% { border-color: rgba(150, 200, 255, 0.5) }\n      }\n    `;\n    document.head.appendChild(styleEl);\n  };\n\n  /**\n   * Process the next message in the queue\n   */\n  const processNextMessage = () => {\n    if (isProcessingQueue || messageQueue.length === 0) return;\n    \n    // Set processing flag\n    isProcessingQueue = true;\n    \n    // Get the next message\n    currentMessage = messageQueue.shift();\n    \n    // Filter remaining queue to remove duplicates of current message\n    for (let i = messageQueue.length - 1; i >= 0; i--) {\n      if (messageQueue[i] === currentMessage) {\n        messageQueue.splice(i, 1);\n      }\n    }\n    \n    // Update the status indicator with the current message\n    updateStatusIndicatorInternal(currentMessage);\n    \n    // Calculate display time based on message length\n    // Typing animation runs at 1.8s for the full text, so calculate actual time\n    const textLength = currentMessage.length;\n    // Assume 40 chars would take the full animation time, plus minimum display time\n    const displayTime = Math.max(1800 * (textLength / 40), 800) + 1000;\n    \n    // Set a timer to process the next message\n    messageTimer = setTimeout(() => {\n      isProcessingQueue = false;\n      currentMessage = null;\n      \n      // If queue is empty, hide the indicator after the last message\n      if (messageQueue.length === 0) {\n        clearStatusIndicatorInternal();\n      } else {\n        // Process the next message\n        processNextMessage();\n      }\n    }, displayTime);\n  };\n\n  /**\n   * Shows a loading indicator in the specified container\n   * @param {HTMLElement|string} container - Container element or selector where the loader should appear\n   * @param {string} [loadingText] - Optional text to display with the loader\n   * @param {Object} [options] - Additional options for the loader\n   * @param {string} [options.position='top'] - Position of loader ('top', 'bottom', or 'middle')\n   * @returns {number} Loader ID for later reference\n   */\n  const show = (container, loadingText = \"\", options = {}) => {\n    initializeStyles();\n    \n    // If there's an existing loading bar in the route stats card, use that instead\n    // of creating a new one to avoid duplicates\n    if (document.querySelector('.route-stats-card') && \n        document.querySelector('.route-stats-header') && \n        document.querySelector('.fp-loading-container')) {\n      // Just update the status indicator\n      if (loadingText) {\n        queueMessage(loadingText);\n      }\n      return -1;\n    }\n    \n    // Make sure we have a DOM element\n    const containerEl = typeof container === 'string' \n      ? document.querySelector(container) \n      : container;\n    \n    if (!containerEl) {\n      console.error('LoadingIndicator: Container element not found');\n      return -1;\n    }\n    \n    // Prepare container for positioning\n    if (window.getComputedStyle(containerEl).position === 'static') {\n      containerEl.style.position = 'relative';\n    }\n    \n    // Create the loading container\n    const loadingContainer = document.createElement('div');\n    loadingContainer.className = 'fp-loading-container';\n    \n    // Position the loading bar based on options\n    if (options.position === 'bottom') {\n      loadingContainer.style.position = 'absolute';\n      loadingContainer.style.bottom = '0';\n    } else if (options.position === 'middle') {\n      loadingContainer.style.position = 'absolute';\n      loadingContainer.style.top = '50%';\n      loadingContainer.style.transform = 'translateY(-50%)';\n    } else { // default to top\n      loadingContainer.style.position = 'absolute';\n      loadingContainer.style.top = '0';\n    }\n\n    // Create text element if text is provided\n    if (loadingText) {\n      const textEl = document.createElement('div');\n      textEl.className = 'fp-loading-text';\n      textEl.textContent = loadingText;\n      loadingContainer.appendChild(textEl);\n    }\n    \n    // Create the animated bar\n    const loadingBar = document.createElement('div');\n    loadingBar.className = 'fp-loading-bar';\n    loadingContainer.appendChild(loadingBar);\n    \n    // Add to DOM\n    containerEl.appendChild(loadingContainer);\n    \n    // Generate a unique ID for this loader\n    const loaderId = loaderIdCounter++;\n    \n    // Store references for later removal\n    activeLoaders.set(loaderId, {\n      container: containerEl,\n      element: loadingContainer\n    });\n    \n    // Also update status indicator in the top card\n    if (loadingText) {\n      queueMessage(loadingText);\n    }\n    \n    return loaderId;\n  };\n  \n  /**\n   * Updates the text of an existing loading indicator\n   * @param {number} loaderId - The ID of the loader to update\n   * @param {string} newText - The new text to display\n   */\n  const updateText = (loaderId, newText) => {\n    const loader = activeLoaders.get(loaderId);\n    if (!loader) return false;\n    \n    const textEl = loader.element.querySelector('.fp-loading-text');\n    if (textEl) {\n      textEl.textContent = newText;\n    } else if (newText) {\n      // Create text element if it doesn't exist but text is now provided\n      const newTextEl = document.createElement('div');\n      newTextEl.className = 'fp-loading-text';\n      newTextEl.textContent = newText;\n      loader.element.insertBefore(newTextEl, loader.element.firstChild);\n    }\n    \n    // Also update status indicator in the top card\n    if (newText) {\n      queueMessage(newText);\n    }\n    \n    return true;\n  };\n  \n  /**\n   * Hides and removes a loading indicator\n   * @param {number} loaderId - The ID of the loader to hide\n   */\n  const hide = (loaderId) => {\n    const loader = activeLoaders.get(loaderId);\n    if (!loader) return false;\n    \n    // Remove from DOM\n    if (loader.element && loader.element.parentNode) {\n      loader.element.parentNode.removeChild(loader.element);\n    }\n    \n    // Remove from tracking\n    activeLoaders.delete(loaderId);\n    \n    // Clear status indicator after a delay if no other loaders are active\n    if (activeLoaders.size === 0 && messageQueue.length === 0 && !isProcessingQueue) {\n      clearStatusIndicatorInternal();\n    }\n    \n    return true;\n  };\n  \n  /**\n   * Hides all active loading indicators\n   */\n  const hideAll = () => {\n    activeLoaders.forEach((loader, id) => {\n      hide(id);\n    });\n    \n    // Clean up any intervals\n    const loadingBars = document.querySelectorAll('.fp-loading-bar');\n    loadingBars.forEach(bar => {\n      const intervalId = bar.getAttribute('data-interval-id');\n      if (intervalId) {\n        clearInterval(parseInt(intervalId, 10));\n      }\n    });\n    \n    // Clear message queue and status indicator\n    messageQueue.length = 0;\n    clearTimeout(messageTimer);\n    isProcessingQueue = false;\n    currentMessage = null;\n    clearStatusIndicatorInternal();\n  };\n  \n  /**\n   * Add a message to the queue and start processing if not already running\n   * @param {string} text - The message to display\n   */\n  const queueMessage = (text) => {\n    if (!text) return;\n    \n    try {\n      // Don't add duplicate of current message\n      if (currentMessage === text) {\n        return;\n      }\n      \n      // Don't add if already in queue - simple loop to avoid filter method\n      let alreadyQueued = false;\n      for (let i = 0; i < messageQueue.length; i++) {\n        if (messageQueue[i] === text) {\n          alreadyQueued = true;\n          break;\n        }\n      }\n      if (alreadyQueued) return;\n      \n      // Add message to queue (limit queue size to prevent memory issues)\n      if (messageQueue.length < 10) {\n        messageQueue.push(text);\n      }\n      \n      // Start processing if not already running\n      if (!isProcessingQueue) {\n        processNextMessage();\n      }\n      \n      // Show the loading bar if it's not already visible\n      const loadingContainer = document.querySelector('.fp-loading-container');\n      if (loadingContainer) {\n        loadingContainer.style.display = 'block';\n      }\n    } catch (e) {\n      console.error('Error in queueMessage:', e);\n    }\n  };\n  \n  /**\n   * Updates the status indicator in the top card - public method\n   * @param {string} text - The text to display in the status indicator\n   */\n  const updateStatusIndicator = (text) => {\n    if (!text) return false;\n    \n    // Add message to queue\n    queueMessage(text);\n    return true;\n  };\n  \n  /**\n   * Internal implementation of updating the status indicator\n   * Called by the queue processor, not directly by users\n   * @param {string} text - The text to display\n   */\n  const updateStatusIndicatorInternal = (text) => {\n    // Find the status indicator\n    const statusIndicator = document.querySelector('.status-indicator');\n    if (!statusIndicator) return false;\n    \n    // Clear any existing content first\n    statusIndicator.innerHTML = '';\n    \n    // Create a new div with the typewriter class\n    const typewriterDiv = document.createElement('div');\n    typewriterDiv.className = 'typewriter-text';\n    typewriterDiv.textContent = text;\n    \n    // Add the new typewriter element\n    statusIndicator.appendChild(typewriterDiv);\n    \n    // Make the indicator visible\n    statusIndicator.classList.add('active');\n    \n    // Show the loading bar\n    const loadingContainer = document.querySelector('.fp-loading-container');\n    if (loadingContainer) {\n      loadingContainer.style.display = 'block';\n    }\n    \n    return true;\n  };\n  \n  /**\n   * Clears the status indicator in the top card - public method\n   * Waits for queue to be empty and animations to complete\n   */\n  const clearStatusIndicator = () => {\n    // If we have messages queued or are currently processing,\n    // do not clear yet - it will be cleared when the queue is empty\n    if (messageQueue.length > 0 || isProcessingQueue) {\n      return false;\n    }\n    \n    clearStatusIndicatorInternal();\n    return true;\n  };\n  \n  /**\n   * Internal implementation of clearing the status indicator\n   * Called when queue is empty and all messages are processed\n   */\n  const clearStatusIndicatorInternal = () => {\n    // Find the status indicator\n    const statusIndicator = document.querySelector('.status-indicator');\n    if (!statusIndicator) return false;\n    \n    // Check if there's a typewriter text element\n    const typewriterDiv = statusIndicator.querySelector('.typewriter-text');\n    if (typewriterDiv) {\n      // Get text length to estimate animation duration\n      // Typing animation runs at 1.8s for the full text, so calculate actual time\n      const textLength = typewriterDiv.textContent.length;\n      // Assume 40 chars would take the full animation time\n      const remainingTime = Math.max(1800 * (textLength / 40), 800);\n      \n      // Add ellipses to show completion\n      const originalText = typewriterDiv.textContent;\n      setTimeout(() => {\n        if (typewriterDiv.parentNode) {\n          typewriterDiv.textContent = originalText + \"...\";\n        }\n      }, remainingTime / 2);\n      \n      // Keep the text visible for the estimated remaining time plus a little extra\n      setTimeout(() => {\n        // Then fade out\n        statusIndicator.classList.remove('active');\n        \n        // Make sure the loading bar completes its animation\n        const loadingContainer = document.querySelector('.fp-loading-container');\n        if (loadingContainer) {\n          // Get the loading bar element\n          const loadingBar = loadingContainer.querySelector('.fp-loading-bar');\n          if (loadingBar) {\n            // Add a class to make it complete its animation\n            loadingBar.classList.add('finishing');\n            \n            // Wait for animation to complete before hiding\n            setTimeout(() => {\n              loadingContainer.style.opacity = '0';\n              \n              // Finally remove after fade out\n              setTimeout(() => {\n                loadingContainer.style.display = 'none';\n                loadingContainer.style.opacity = '1';\n                if (loadingBar) {\n                  loadingBar.classList.remove('finishing');\n                }\n              }, 500);\n            }, 1000);\n          } else {\n            loadingContainer.style.display = 'none';\n          }\n        }\n        \n        // Clear the content after fade animation completes\n        setTimeout(() => {\n          statusIndicator.innerHTML = '';\n        }, 300);\n      }, remainingTime + 1000); // Added extra time for the ellipses\n    } else {\n      // No typewriter text, just fade out\n      statusIndicator.classList.remove('active');\n      \n      // Make sure the loading bar completes its animation\n      const loadingContainer = document.querySelector('.fp-loading-container');\n      if (loadingContainer) {\n        // Get the loading bar element\n        const loadingBar = loadingContainer.querySelector('.fp-loading-bar');\n        if (loadingBar) {\n          // Add a class to make it complete its animation\n          loadingBar.classList.add('finishing');\n          \n          // Wait for animation to complete before hiding\n          setTimeout(() => {\n            loadingContainer.style.opacity = '0';\n            \n            // Finally remove after fade out\n            setTimeout(() => {\n              loadingContainer.style.display = 'none';\n              loadingContainer.style.opacity = '1';\n              if (loadingBar) {\n                loadingBar.classList.remove('finishing');\n              }\n            }, 500);\n          }, 1000);\n        } else {\n          loadingContainer.style.display = 'none';\n        }\n      }\n      \n      // Clear the content after fade animation completes\n      setTimeout(() => {\n        statusIndicator.innerHTML = '';\n      }, 300);\n    }\n    \n    return true;\n  };\n  \n  /**\n   * Initialize loading indicator in the RouteStatsCard\n   * Makes sure the loading bar appears at the bottom of the card header\n   * but remains hidden until needed\n   */\n  const initializeRouteStatsLoader = () => {\n    // Find route stats card\n    const statsCard = document.querySelector('.route-stats-card');\n    if (!statsCard) return false;\n    \n    // Find the header\n    const header = statsCard.querySelector('.route-stats-header');\n    if (!header) return false;\n    \n    // Make sure header has position relative\n    header.style.position = 'relative';\n    \n    // First, remove any existing loading containers and bars\n    const existingContainers = document.querySelectorAll('.fp-loading-container');\n    existingContainers.forEach(container => {\n      container.remove();\n    });\n    \n    // Create a single loading container at the bottom\n    const loadingContainer = document.createElement('div');\n    loadingContainer.className = 'fp-loading-container';\n    loadingContainer.style.width = '100%';\n    loadingContainer.style.position = 'absolute';\n    loadingContainer.style.bottom = '0';\n    loadingContainer.style.left = '0';\n    loadingContainer.style.height = '3px';\n    // Initially hidden until needed\n    loadingContainer.style.display = 'none';\n    \n    // Create the loading bar\n    const loadingBar = document.createElement('div');\n    loadingBar.className = 'fp-loading-bar';\n    \n    // Add the data-current-position attribute for the completion animation\n    loadingBar.setAttribute('data-current-position', '-30%');\n    \n    // Track animation progress for smooth completion\n    const updatePosition = () => {\n      if (!loadingBar || !loadingBar.parentNode) return;\n      \n      // Get computed style to determine current position\n      const computedStyle = window.getComputedStyle(loadingBar);\n      const leftPos = computedStyle.getPropertyValue('left');\n      \n      // Update the data attribute (for use when finishing animation)\n      loadingBar.setAttribute('data-current-position', leftPos);\n    };\n    \n    // Start position tracking\n    const positionInterval = setInterval(updatePosition, 100);\n    \n    // Store interval ID for cleanup\n    loadingBar.setAttribute('data-interval-id', positionInterval);\n    \n    loadingContainer.appendChild(loadingBar);\n    \n    // Add to header\n    header.appendChild(loadingContainer);\n    \n    return true;\n  };\n  \n  // Public API\n  return {\n    show,\n    updateText,\n    hide,\n    hideAll,\n    updateStatusIndicator,\n    clearStatusIndicator,\n    initializeRouteStatsLoader,\n    // Debug API for testing\n    getQueueStatus: () => ({\n      length: messageQueue.length,\n      currentMessage,\n      isProcessing: isProcessingQueue\n    })\n  };\n})();\n\n// Make it available globally if not in a module environment\nif (typeof window !== 'undefined') {\n  window.LoadingIndicator = LoadingIndicator;\n}\n\nexport default LoadingIndicator;","import React from 'react';\nimport './FuelStyles.css';\n\n/**\n * EnhancedFuelDisplay Component\n * \n * Displays detailed fuel requirements and passenger capacity information\n * from the enhanced fuel calculator.\n */\nconst EnhancedFuelDisplay = ({ \n  fuelData, \n  selectedAircraft,\n  onAdjustFuel = () => {},\n  onChangeAlternate = () => {}\n}) => {\n  // Return empty state if no data\n  if (!fuelData || !selectedAircraft) {\n    return (\n      <div className=\"fuel-display fuel-display-empty\">\n        <p>Add waypoints and select an aircraft to see fuel calculations</p>\n      </div>\n    );\n  }\n  \n  // Check if we have the enhanced results\n  const enhancedResults = fuelData.enhancedResults;\n  if (!enhancedResults) {\n    return (\n      <div className=\"fuel-display fuel-display-empty\">\n        <p>Enhanced fuel calculations not available</p>\n      </div>\n    );\n  }\n  \n  // Extract relevant data for display\n  const { fuelByStop, maxCapacity, legResults, auxiliaryFuel } = enhancedResults;\n  \n  // Function to format fuel components into a readable string\n  const formatFuelComponents = (components) => {\n    if (!components) return '';\n    \n    const parts = [];\n    \n    if (components.remainingTripFuel) parts.push(`Trip:${components.remainingTripFuel}`);\n    if (components.remainingContingency) parts.push(`Cont:${components.remainingContingency}`);\n    if (components.taxiFuel) parts.push(`Taxi:${components.taxiFuel}`);\n    if (components.remainingDeckFuel) parts.push(`Deck:${components.remainingDeckFuel}`);\n    if (components.reserveFuel) parts.push(`Res:${components.reserveFuel}`);\n    \n    return parts.join(' ');\n  };\n  \n  return (\n    <div className=\"fuel-display\">\n      {/* Top action buttons */}\n      <div className=\"fuel-display-actions\">\n        <button \n          className=\"action-button\" \n          onClick={onAdjustFuel}\n        >\n          <span className=\"material-icons\">local_gas_station</span>\n          Adjust fuel\n        </button>\n        \n        <button \n          className=\"action-button\" \n          onClick={onChangeAlternate}\n        >\n          <span className=\"material-icons\">alt_route</span>\n          Change Alternate leg\n        </button>\n      </div>\n      \n      {/* Fuel Requirements and Passenger Capacity by Stop */}\n      <h3 className=\"fuel-section-title\">\n        Fuel Requirements and Passenger Capacity by Stop\n      </h3>\n      \n      <div className=\"fuel-table-container\">\n        <table className=\"fuel-table\">\n          <thead>\n            <tr>\n              <th>Stop</th>\n              <th>Required Fuel</th>\n              <th>Max Passengers</th>\n              <th>Fuel Components</th>\n              <th>Legs</th>\n            </tr>\n          </thead>\n          <tbody>\n            {fuelByStop.map((stop, index) => (\n              <tr key={index} className={stop.isLastStop ? 'last-stop' : ''}>\n                <td>{stop.waypoint}</td>\n                <td>{stop.requiredFuel} Lbs</td>\n                <td>\n                  {stop.isLastStop ? 'Final Stop' : (\n                    <React.Fragment>\n                      {stop.maxPassengers} ({stop.maxPassengerWeight} Lbs)\n                    </React.Fragment>\n                  )}\n                </td>\n                <td className=\"fuel-components-cell\">\n                  {formatFuelComponents(stop.components)}\n                </td>\n                <td>\n                  {stop.leg ? (\n                    <React.Fragment>\n                      {stop.leg.from}-{stop.leg.to} → {stop.leg.distance.toFixed(1)} nm\n                    </React.Fragment>\n                  ) : (\n                    'Final destination'\n                  )}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n      \n      {/* Minimal Fuel with Maximum Passenger Capacity */}\n      {maxCapacity && (\n        <React.Fragment>\n          <h3 className=\"fuel-section-title\">\n            Minimal Fuel with Maximum Passenger Capacity\n          </h3>\n          \n          <div className=\"fuel-table-container\">\n            <table className=\"fuel-table minimal-fuel-table\">\n              <thead>\n                <tr>\n                  <th>Required Fuel</th>\n                  <th>Max Passengers</th>\n                  <th>Fuel Components</th>\n                  <th>Route</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td>{fuelByStop[0].requiredFuel} LBS</td>\n                  <td>{maxCapacity.maxPassengers} ({maxCapacity.maxPassengerWeight} LBS)</td>\n                  <td className=\"fuel-components-cell\">\n                    {formatFuelComponents(fuelByStop[0].components)}\n                  </td>\n                  <td>Legs to {maxCapacity.limitingWaypoint}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          \n          <div className=\"fuel-extra-info\">\n            <p>\n              Potential landing fuel: {auxiliaryFuel.reserveFuel} LBS \n              (Reserve + FULL Contingency)\n            </p>\n          </div>\n        </React.Fragment>\n      )}\n      \n      {/* Individual leg fuel cards */}\n      <div className=\"leg-fuel-cards\">\n        {legResults.legDetails.map((leg, index) => (\n          <div key={index} className=\"leg-fuel-card\">\n            <div className=\"leg-fuel-header\">\n              <div className=\"leg-route\">\n                <span className=\"leg-from\">{leg.from}</span>\n                <span className=\"leg-arrow\">→</span>\n                <span className=\"leg-to\">{leg.to}</span>\n              </div>\n              \n              <div className=\"leg-stats\">\n                <div className=\"leg-stat\">\n                  <span className=\"material-icons\">straighten</span>\n                  <span>{leg.distance.toFixed(1)} nm</span>\n                </div>\n                \n                <div className=\"leg-stat\">\n                  <span className=\"material-icons\">schedule</span>\n                  <span>{formatTime(leg.flightTimeHours)}</span>\n                </div>\n                \n                <div className=\"leg-stat\">\n                  <span className=\"material-icons\">air</span>\n                  <span>{formatWind(leg.windEffect)}</span>\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"leg-fuel-body\">\n              <div className=\"leg-fuel-section\">\n                <h4>Fuel Requirements</h4>\n                <div className=\"leg-fuel-details\">\n                  <div className=\"leg-fuel-primary\">\n                    <span className=\"leg-fuel-label\">Trip Fuel:</span>\n                    <span className=\"leg-fuel-value\">{leg.fuelRequired} lbs</span>\n                  </div>\n                  \n                  <div className=\"leg-fuel-primary\">\n                    <span className=\"leg-fuel-label\">Ground Speed:</span>\n                    <span className=\"leg-fuel-value\">{Math.round(leg.groundSpeed)} kts</span>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"leg-fuel-section\">\n                <h4>Passenger Capacity</h4>\n                <div className=\"leg-passenger-details\">\n                  <div className=\"leg-passenger-primary\">\n                    <span className=\"leg-passenger-label\">Max Passengers:</span>\n                    <span className=\"leg-passenger-value\">\n                      {fuelByStop[index + 1]?.maxPassengers || 'N/A'}\n                    </span>\n                  </div>\n                  \n                  <div className=\"leg-passenger-weight\">\n                    <span className=\"leg-passenger-label\">Fuel Required:</span>\n                    <span className=\"leg-passenger-value\">\n                      {fuelByStop[index + 1]?.requiredFuel || 'N/A'} lbs\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Format wind component for display\n * @param {number} wind - Wind component in knots\n * @returns {string} Formatted wind string\n */\nfunction formatWind(wind) {\n  if (!wind) return '0 kts';\n  if (wind > 0) return `+${Math.round(wind)} kts`;\n  return `${Math.round(wind)} kts`;\n}\n\n/**\n * Format time in hours to HH:MM format\n * @param {number} timeHours - Time in decimal hours\n * @returns {string} Formatted time string\n */\nfunction formatTime(timeHours) {\n  if (typeof timeHours !== 'number' || timeHours < 0) {\n    return '00:00';\n  }\n  \n  const hours = Math.floor(timeHours);\n  const minutes = Math.floor((timeHours - hours) * 60);\n  \n  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n}\n\nexport default EnhancedFuelDisplay;","import React, { useEffect, useRef, useState } from 'react';\nimport { useAuth } from '../../../../context/AuthContext';\nimport LoadingIndicator from '../../modules/LoadingIndicator';\nimport { EnhancedFuelDisplay } from '../fuel';\n// Import StopCardCalculator for direct fuel calculations\nimport StopCardCalculator from '../../modules/calculations/flight/StopCardCalculator';\n// Import PassengerCalculator for consistent passenger calculations\nimport PassengerCalculator from '../../modules/calculations/passengers/PassengerCalculator';\n\n/**\n * Route Statistics Card Component\n * \n * Displays route statistics in a card format at the top of the page\n * Including total distance, flight time, total time (flight + deck time),\n * trip fuel, total fuel (trip + deck fuel), and passenger numbers\n */\nconst RouteStatsCard = ({ \n  routeStats, \n  selectedAircraft, \n  waypoints = [],\n  deckTimePerStop = 5,  // Add safe default\n  deckFuelPerStop = 100, // Not a critical parameter\n  deckFuelFlow = 400,     // Add safe default\n  passengerWeight = 220,  // Add safe default\n  cargoWeight = 0,  // Not a critical parameter\n  taxiFuel = 50,         // Add safe default\n  contingencyFuelPercent = 5, // Add safe default\n  reserveFuel = 600,      // Add safe default\n  weather = { windSpeed: 0, windDirection: 0 },\n  // Optional stopCards prop to get data from StopCardsContainer\n  stopCards = []\n}) => {\n  // Log received values for debugging\n  console.log('📊 RouteStatsCard received values:', {\n    taxiFuel,\n    passengerWeight,\n    contingencyFuelPercent,\n    reserveFuel,\n    deckTimePerStop,\n    deckFuelFlow,\n    rawContingencyValue: contingencyFuelPercent,\n    rawContingencyType: typeof contingencyFuelPercent\n  });\n  \n  // Force rerendering when routeStats or waypoints change\n  const [forceRerender, setForceRerender] = useState(0);\n  \n  // Removed error handling code to fix React hooks errors\n  // Log received values for debugging\n  console.log('📊 RouteStatsCard received values:', {\n    taxiFuel,\n    passengerWeight,\n    contingencyFuelPercent,\n    reserveFuel,\n    deckTimePerStop,\n    deckFuelFlow,\n    rawContingencyValue: contingencyFuelPercent,\n    rawContingencyType: typeof contingencyFuelPercent\n  });\n  // Use StopCardCalculator directly for consistent fuel calculations\n  const [localStopCards, setLocalStopCards] = useState([]);\n  \n  useEffect(() => {\n    // First try to use passed stop cards\n    if (stopCards && stopCards.length > 0) {\n      console.log('Using existing stop cards:', stopCards.length);\n      setLocalStopCards(stopCards);\n    } \n    // Otherwise calculate cards directly with StopCardCalculator\n    else if (waypoints && waypoints.length >= 2 && selectedAircraft && routeStats) {\n      console.log('Generating stop cards directly from StopCardCalculator');\n      console.log('🚨 PASSING SETTINGS TO STOPCARDCALCULATOR:', {\n        taxiFuel,\n        passengerWeight,\n        contingencyFuelPercent,\n        reserveFuel,\n        deckTimePerStop,\n        deckFuelFlow\n      });\n      \n      const calculatedCards = StopCardCalculator.calculateStopCards(\n        waypoints, \n        routeStats, \n        selectedAircraft, \n        weather, \n        {\n          passengerWeight,\n          taxiFuel,\n          contingencyFuelPercent,\n          reserveFuel,\n          deckTimePerStop,\n          deckFuelFlow\n        }\n      );\n      \n      setLocalStopCards(calculatedCards);\n    }\n  }, [stopCards, waypoints, selectedAircraft, routeStats, weather, passengerWeight, taxiFuel, contingencyFuelPercent, reserveFuel, deckTimePerStop, deckFuelFlow]);\n  \n  // Debug log for stop cards and force update when they change\n  useEffect(() => {\n    console.log('🚨 STOP CARDS CHANGED:', {\n      count: stopCards?.length || 0,\n      firstCard: stopCards && stopCards.length > 0 ? {\n        isDeparture: stopCards[0].isDeparture || false,\n        totalFuel: stopCards[0].totalFuel || 0,\n        deckFuel: stopCards[0].deckFuel || 0\n      } : null,\n      departureCard: stopCards?.find(card => card.isDeparture) ? {\n        totalFuel: stopCards.find(card => card.isDeparture).totalFuel || 0,\n        deckFuel: stopCards.find(card => card.isDeparture).deckFuel || 0,\n        components: stopCards.find(card => card.isDeparture).fuelComponents || ''\n      } : 'No departure card found'\n    });\n    \n    // Force a rerender when stopCards change\n    setForceRerender(prev => prev + 1);\n  }, [stopCards]);\n  \n  // Always fetch the currentRouteStats from window for the latest data\n  useEffect(() => {\n    // Check if window.currentRouteStats exists and has newer data than our local routeStats\n    if (window.currentRouteStats && (!routeStats || !routeStats.timeHours || routeStats.timeHours === 0)) {\n      console.log('⚠️ Found window.currentRouteStats with time data, using for display');\n      \n      // Force a rerender to use the window.currentRouteStats data\n      setForceRerender(prev => prev + 1);\n    }\n  }, [routeStats, forceRerender]);\n  \n  // Force data fetch and calculation immediately before rendering\n  useEffect(() => {\n    // If we should have time data but don't, trigger debug logging\n    if (waypoints && waypoints.length >= 2 && selectedAircraft && \n        (!routeStats || !routeStats.timeHours || routeStats.timeHours === 0)) {\n      console.log('⚠️ Missing time data at render time. Waypoints:', waypoints.length);\n      \n      // If necessary, use window.currentRouteStats for rendering\n      if (window.currentRouteStats && window.currentRouteStats.timeHours > 0) {\n        console.log('⚠️ Using window.currentRouteStats for display with timeHours:', \n                    window.currentRouteStats.timeHours);\n      }\n    }\n  }, [waypoints, selectedAircraft, routeStats]);\n  \n  // Get authentication state and user details\n  const { isAuthenticated, userName } = useAuth();\n  \n  // Reference to card element for adding/removing loading indicator\n  const cardRef = useRef(null);\n  \n  // Reference to track the active loader ID\n  const loaderIdRef = useRef(null);\n  \n  // Force a rerender when routeStats change - added null check to prevent errors\n  useEffect(() => {\n    if (routeStats) {\n      console.log(\"💥 RouteStatsCard - routeStats changed, forcing rerender\");\n      setForceRerender(prev => prev + 1);\n    }\n  }, [routeStats]);\n  \n  // Force a rerender when waypoints change\n  useEffect(() => {\n    if (waypoints && waypoints.length >= 2) {\n      console.log(\"💥 RouteStatsCard - waypoints changed, forcing rerender\");\n      setForceRerender(prev => prev + 1);\n    }\n  }, [waypoints]);\n  \n  // Add debug logging to track the routeStats data\n  console.log(\"💥 RouteStatsCard - received stats:\", {\n    forceRerender,\n    timeHours: routeStats?.timeHours,\n    estimatedTime: routeStats?.estimatedTime,\n    totalDistance: routeStats?.totalDistance,\n    legs: routeStats?.legs?.length || 0\n  });\n  \n  // Extra validation to catch zero or missing time values\n  if (routeStats && \n      (routeStats.timeHours === 0 || !routeStats.timeHours || \n       routeStats.estimatedTime === '00:00' || !routeStats.estimatedTime) && \n      routeStats.totalDistance && parseFloat(routeStats.totalDistance) > 0) {\n    console.error(\"⚠️ RouteStatsCard - Invalid or missing time with non-zero distance!\", {\n      totalDistance: routeStats.totalDistance,\n      timeHours: routeStats.timeHours,\n      estimatedTime: routeStats.estimatedTime\n    });\n    \n    // CRITICAL FIX: If zero time was received but we have distance and a valid selected aircraft, \n    // fix the time calculation immediately\n    if (selectedAircraft && selectedAircraft.cruiseSpeed) {\n      console.log(\"⚠️ RouteStatsCard - Fixing time with wind-adjusted calculation if possible\");\n      \n      // Calculate time based on distance and cruise speed\n      const totalDistance = parseFloat(routeStats.totalDistance);\n      let timeHours;\n      \n      // Check if we can use wind calculations\n      if (window.WindCalculations && routeStats.windData && routeStats.legs && routeStats.legs.length > 0) {\n        console.log(\"⚠️ Using WindCalculations for top card fix\");\n        \n        // Calculate average course from all legs\n        let avgCourse = 0;\n        let legCount = 0;\n        \n        routeStats.legs.forEach(leg => {\n          if (leg.course !== undefined) {\n            avgCourse += leg.course;\n            legCount++;\n          }\n        });\n        \n        if (legCount > 0) {\n          avgCourse = avgCourse / legCount;\n          \n          // Calculate wind-adjusted time\n          timeHours = window.WindCalculations.calculateWindAdjustedTime(\n            totalDistance,\n            selectedAircraft.cruiseSpeed,\n            avgCourse,\n            routeStats.windData.windSpeed,\n            routeStats.windData.windDirection\n          );\n          \n          console.log(\"⚠️ Created wind-adjusted time using avg course:\", {\n            avgCourse,\n            windSpeed: routeStats.windData.windSpeed,\n            windDirection: routeStats.windData.windDirection,\n            timeHours\n          });\n          \n          // Make sure wind adjustment flag is set\n          routeStats.windAdjusted = true;\n        } else {\n          // Basic calculation if we couldn't determine course\n          timeHours = totalDistance / selectedAircraft.cruiseSpeed;\n          console.log(\"⚠️ Using basic time calculation (no valid course data)\");\n        }\n      } else {\n        // Basic calculation without wind effects\n        timeHours = totalDistance / selectedAircraft.cruiseSpeed;\n        console.log(\"⚠️ Using basic time calculation (no wind data)\");\n      }\n      \n      // Format time string\n      const hours = Math.floor(timeHours);\n      const minutes = Math.floor((timeHours - hours) * 60);\n      const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n      \n      // Update the routeStats object directly\n      routeStats.timeHours = timeHours;\n      routeStats.estimatedTime = estimatedTime;\n      \n      // Also update window.currentRouteStats to ensure it's available for map interactions\n      if (window.currentRouteStats) {\n        window.currentRouteStats.timeHours = timeHours;\n        window.currentRouteStats.estimatedTime = estimatedTime;\n        \n        // Ensure wind status is synced\n        if (routeStats.windAdjusted) {\n          window.currentRouteStats.windAdjusted = true;\n          window.currentRouteStats.windData = { ...routeStats.windData };\n        }\n      }\n      \n      console.log(\"⚠️ RouteStatsCard - Fixed time values:\", {\n        timeHours,\n        estimatedTime,\n        windAdjusted: routeStats.windAdjusted || false\n      });\n    }\n  }\n  \n  if (routeStats && routeStats.windAdjusted) {\n    console.log(\"✅ Wind-adjusted stats detected in RouteStatsCard:\", {\n      windSpeed: routeStats.windData?.windSpeed,\n      windDirection: routeStats.windData?.windDirection,\n      estimatedTime: routeStats.estimatedTime,\n      timeHours: routeStats.timeHours,\n      avgHeadwind: routeStats.windData?.avgHeadwind\n    });\n  } else {\n    console.log(\"❌ Route stats WITHOUT wind adjustment in RouteStatsCard\");\n  }\n  \n  // Determine if time has been adjusted due to wind - with safety check\n  const isWindAdjusted = routeStats && routeStats.windAdjusted && routeStats.windData;\n  \n  // Get wind effect direction from actual weather data - with safety check\n  const windEffect = isWindAdjusted && routeStats.windData && routeStats.windData.avgHeadwind !== undefined ? \n    routeStats.windData.avgHeadwind : 0;\n  \n  useEffect(() => {\n    // Add CSS for wind-adjusted time highlight if it doesn't exist\n    if (!document.getElementById('wind-adjusted-style')) {\n      const style = document.createElement('style');\n      style.id = 'wind-adjusted-style';\n      style.innerHTML = `\n        .wind-adjusted-time {\n          position: relative;\n        }\n        .wind-adjusted-time::after {\n          content: ' ★';\n          font-size: 0.7em;\n          color: ${routeStats?.windData?.windSpeed > 0 ? '#e74c3c' : '#2ecc71'};\n          vertical-align: super;\n        }\n      `;\n      document.head.appendChild(style);\n    }\n  }, [routeStats]);\n  \n  // Calculate the number of landings (waypoints - 1 or 0 if no waypoints)\n  const landingsCount = waypoints && waypoints.length > 1 ? waypoints.length - 1 : 0;\n  \n  // Calculate the number of intermediate stops (waypoints - 2 or 0 if less than 3 waypoints)\n  // This matches the StopCardCalculator logic\n  const intermediateStops = waypoints && waypoints.length > 2 ? waypoints.length - 2 : 0;\n  \n  // Calculate total deck fuel using the same formula as StopCardCalculator\n  // FIXED: Force numeric type conversions to avoid string math issues\n  // Use the already defined intermediateStops variable from above\n  const deckTimePerStopNum = Number(deckTimePerStop);\n  const deckFuelFlowNum = Number(deckFuelFlow);\n  \n  // Calculate total deck time in minutes (used for display and total time calculation)\n  const totalDeckTime = intermediateStops * deckTimePerStopNum;\n  const deckTimeHours = (intermediateStops * deckTimePerStopNum) / 60;\n  const calculatedDeckFuel = Math.round(deckTimeHours * deckFuelFlowNum);\n  \n  // DEBUG: Log deck fuel calculation\n  console.log('🚨 ROUTESTATSCARD DECK FUEL CALCULATION:', {\n    intermediateStops,\n    deckTimePerStop_original: deckTimePerStop,\n    deckTimePerStop_asNumber: deckTimePerStopNum,\n    deckFuelFlow_original: deckFuelFlow,\n    deckFuelFlow_asNumber: deckFuelFlowNum,\n    deckTimeHours,\n    calculation: `${intermediateStops} * ${deckTimePerStopNum} / 60 * ${deckFuelFlowNum} = ${calculatedDeckFuel}`,\n    calculatedDeckFuel,\n    routeStats_deckFuel: routeStats?.deckFuel\n  });\n  \n  // Use the calculated value or the one from routeStats if available\n  const totalDeckFuel = routeStats?.deckFuel || calculatedDeckFuel;\n  \n  // Always show the card, even without route stats\n  // Use default values if routeStats is not available\n  const stats = routeStats || {\n    totalDistance: '0',\n    estimatedTime: '00:00',\n    timeHours: 0,\n    fuelRequired: 0,\n    usableLoad: 0,\n    maxPassengers: 0,\n    endurance: '2.3',\n    availableFuel: '3070',\n    takeoffWeight: '24807',\n    operationalRadius: '85'\n  };\n  \n  // Calculate total time (flight time + deck time)\n  const calculateTotalTime = () => {\n    // CRITICAL FIX: Get the exact same flight time that's displayed in the UI\n    const displayedFlightTime = calculateFlightTime(stats, waypoints, selectedAircraft);\n    \n    // Convert displayed time (HH:MM) to hours\n    let flightTimeHours = 0;\n    if (displayedFlightTime && displayedFlightTime !== '00:00') {\n      const [hours, minutes] = displayedFlightTime.split(':').map(Number);\n      flightTimeHours = hours + (minutes / 60);\n    }\n    \n    console.log('⚠️ Total time calculation using UI-displayed flight time:', {\n      displayedFlightTime,\n      flightTimeHours: flightTimeHours.toFixed(2),\n      totalDeckTime,\n      deckTimeHours: (totalDeckTime / 60).toFixed(2)\n    });\n    \n    // Convert deck time from minutes to hours\n    const deckTimeHours = totalDeckTime / 60;\n    \n    // Add flight time and deck time\n    const totalTimeHours = flightTimeHours + deckTimeHours;\n    \n    // Format as HH:MM\n    const hours = Math.floor(totalTimeHours);\n    const minutes = Math.floor((totalTimeHours - hours) * 60);\n    const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n    \n    console.log(`⚠️ Total time (displayed flight time + deck): ${formattedTime}`);\n    return formattedTime;\n  };\n  \n  // Get fuel data directly from StopCardCalculator for consistency\n  const getFuelData = () => {\n    try {\n      console.log('🚨 DEBUG FUEL SETTINGS:', {\n        passedSettings: {\n          passengerWeight,\n          taxiFuel,\n          contingencyFuelPercent,\n          reserveFuel,\n          deckTimePerStop,\n          deckFuelFlow\n        },\n        taxiFuel_type: typeof taxiFuel,\n        taxiFuel_value: Number(taxiFuel)\n      });\n  \n      // Option 1: Try to find the departure card in the existing stop cards\n      if (stopCards && stopCards.length > 0) {\n        const departureCard = stopCards.find(card => card.isDeparture);\n        if (departureCard) {\n          console.log('🚨 DEBUG FUEL DATA FROM STOPCARDS:', {\n            totalFuel: departureCard.totalFuel,\n            tripFuel: departureCard.fuelComponentsObject?.tripFuel,\n            deckFuel: departureCard.deckFuel,\n            contingencyFuel: departureCard.fuelComponentsObject?.contingencyFuel,\n            reserveFuel: departureCard.fuelComponentsObject?.reserveFuel,\n            taxiFuel: departureCard.fuelComponentsObject?.taxiFuel,\n            rawFuelComponents: departureCard.fuelComponents,\n            computedSum: (\n              (departureCard.fuelComponentsObject?.tripFuel || 0) +\n              (departureCard.fuelComponentsObject?.contingencyFuel || 0) +\n              (departureCard.fuelComponentsObject?.taxiFuel || 0) +\n              (departureCard.fuelComponentsObject?.deckFuel || 0) +\n              (departureCard.fuelComponentsObject?.reserveFuel || 0)\n            )\n          });\n          \n          const result = {\n            totalFuel: departureCard.totalFuel || 0,\n            tripFuel: departureCard.fuelComponentsObject?.tripFuel || 0,\n            deckFuel: departureCard.deckFuel || 0,\n            contingencyFuel: departureCard.fuelComponentsObject?.contingencyFuel || 0,\n            reserveFuel: departureCard.fuelComponentsObject?.reserveFuel || 0,\n            taxiFuel: departureCard.fuelComponentsObject?.taxiFuel || 0\n          };\n          \n          // Check if total fuel exceeds max fuel capacity\n          if (selectedAircraft && selectedAircraft.maxFuel && result.totalFuel > selectedAircraft.maxFuel) {\n            const fuelNeeded = result.totalFuel;\n            const maxFuel = selectedAircraft.maxFuel;\n            const refuelAmount = fuelNeeded - maxFuel;\n            \n            console.log(`⚠️ WARNING: Required fuel (${fuelNeeded} lbs) exceeds max fuel capacity (${maxFuel} lbs). Need refuel stop (+${refuelAmount} lbs)`);\n            \n            // Set the total fuel to max capacity\n            result.totalFuel = maxFuel;\n            // Add refuel indicator\n            result.refuelNeeded = refuelAmount;\n          }\n          \n          console.log('🚨 RETURNING FUEL DATA:', result);\n          return result;\n        }\n      }\n      \n      // Option 2: Try to find the departure card in local stop cards (if different from stopCards)\n      if (localStopCards && localStopCards.length > 0 && \n          (!stopCards || localStopCards.length !== stopCards.length)) {\n        const departureCard = localStopCards.find(card => card.isDeparture);\n        if (departureCard) {\n          console.log('RouteStatsCard: Using departure card from localStopCards:', {\n            totalFuel: departureCard.totalFuel,\n            tripFuel: departureCard.fuelComponentsObject?.tripFuel,\n            deckFuel: departureCard.deckFuel\n          });\n          \n          const result = {\n            totalFuel: departureCard.totalFuel || 0,\n            tripFuel: departureCard.fuelComponentsObject?.tripFuel || 0,\n            deckFuel: departureCard.deckFuel || 0,\n            contingencyFuel: departureCard.fuelComponentsObject?.contingencyFuel || 0,\n            reserveFuel: departureCard.fuelComponentsObject?.reserveFuel || 0,\n            taxiFuel: departureCard.fuelComponentsObject?.taxiFuel || 0\n          };\n          \n          // Check if total fuel exceeds max fuel capacity\n          if (selectedAircraft && selectedAircraft.maxFuel && result.totalFuel > selectedAircraft.maxFuel) {\n            const fuelNeeded = result.totalFuel;\n            const maxFuel = selectedAircraft.maxFuel;\n            const refuelAmount = fuelNeeded - maxFuel;\n            \n            console.log(`⚠️ WARNING: Required fuel (${fuelNeeded} lbs) exceeds max fuel capacity (${maxFuel} lbs). Need refuel stop (+${refuelAmount} lbs)`);\n            \n            // Set the total fuel to max capacity\n            result.totalFuel = maxFuel;\n            // Add refuel indicator\n            result.refuelNeeded = refuelAmount;\n          }\n          \n          return result;\n        }\n      }\n      \n    // Option 3: Calculate directly using StopCardCalculator if we have waypoints and aircraft\n      if (waypoints && waypoints.length >= 2 && selectedAircraft && routeStats) {\n        console.log('🚨 DEBUG CALCULATING DIRECTLY FROM STOPCARDCALCULATOR');\n        console.log('🚨 SETTINGS BEING PASSED:', {\n          passengerWeight,\n          taxiFuel,\n          contingencyFuelPercent,\n          reserveFuel,\n          deckTimePerStop,\n          deckFuelFlow,\n          deckTimePerStop_mins: deckTimePerStop,\n          calculatedDeckFuel: Math.round((deckTimePerStop * (waypoints.length - 2) / 60) * deckFuelFlow)\n        });\n        \n        try {\n          // Use StopCardCalculator to calculate stop cards, then extract fuel data from the departure card\n          const calculatedCards = StopCardCalculator.calculateStopCards(\n            waypoints, \n            routeStats, \n            selectedAircraft, \n            weather, \n            {\n              passengerWeight,\n              taxiFuel,\n              contingencyFuelPercent,\n              reserveFuel,\n              deckTimePerStop,\n              deckFuelFlow\n            }\n          );\n          \n          // Additional debug log to confirm values in this code path\n          console.log('🛫 Values passed to StopCardCalculator (direct fuel calculation):', {\n            taxiFuel,\n            passengerWeight\n          });\n          \n          // Find the departure card\n          const departureCard = calculatedCards.find(card => card.isDeparture);\n          if (departureCard) {\n            console.log('🚨 DEBUG FRESH CALCULATION RESULT:', {\n              departure_card_totalFuel: departureCard.totalFuel,\n              departure_card_components: departureCard.fuelComponentsObject,\n              departure_card_text: departureCard.fuelComponents\n            });\n            \n            const result = {\n              totalFuel: departureCard.totalFuel || 0,\n              tripFuel: departureCard.fuelComponentsObject?.tripFuel || 0,\n              deckFuel: departureCard.deckFuel || 0,\n              contingencyFuel: departureCard.fuelComponentsObject?.contingencyFuel || 0,\n              reserveFuel: departureCard.fuelComponentsObject?.reserveFuel || 0,\n              taxiFuel: departureCard.fuelComponentsObject?.taxiFuel || 0\n            };\n            \n            // Check if total fuel exceeds max fuel capacity\n            if (selectedAircraft && selectedAircraft.maxFuel && result.totalFuel > selectedAircraft.maxFuel) {\n              const fuelNeeded = result.totalFuel;\n              const maxFuel = selectedAircraft.maxFuel;\n              const refuelAmount = fuelNeeded - maxFuel;\n              \n              console.log(`⚠️ WARNING: Required fuel (${fuelNeeded} lbs) exceeds max fuel capacity (${maxFuel} lbs). Need refuel stop (+${refuelAmount} lbs)`);\n              \n              // Set the total fuel to max capacity\n              result.totalFuel = maxFuel;\n              // Add refuel indicator\n              result.refuelNeeded = refuelAmount;\n            }\n            \n            return result;\n          }\n        } catch (error) {\n          console.error('Error calculating from StopCardCalculator:', error);\n          // Continue to fallback\n        }\n      }\n      \n    // Option 4: Final fallback to basic calculated values\n      console.log('RouteStatsCard: No departure card found, using fallback calculated values');\n      \n      // Calculate all fuel components properly with simple, direct Number() conversions\n      const calculatedTripFuel = stats?.fuelRequired || 0;\n      \n      try {\n        // Calculate deck fuel simply\n        const calculatedIntermediateStops = Math.max(0, waypoints?.length - 2 || 0);\n        const calculatedDeckTimeHours = (calculatedIntermediateStops * Number(deckTimePerStop)) / 60;\n        const calculatedDeckFuel = Math.round(calculatedDeckTimeHours * Number(deckFuelFlow));\n        \n        // Include ALL fuel components with direct Number conversion\n        const calculatedContingencyFuel = Math.round((calculatedTripFuel * Number(contingencyFuelPercent)) / 100);\n        const calculatedReserveFuel = Number(reserveFuel);\n        const calculatedTaxiFuel = Number(taxiFuel);\n        \n        console.log('⛽ Fallback fuel calculation with direct values:', {\n          taxiFuel,\n          taxiFuel_asNumber: calculatedTaxiFuel,\n          contingencyFuelPercent,\n          reserveFuel,\n          deckTimePerStop,\n          deckFuelFlow\n        });\n        \n        // Calculate total as sum of all components\n        let calculatedTotalFuel = calculatedTripFuel + \n                                calculatedContingencyFuel + \n                                calculatedTaxiFuel + \n                                calculatedDeckFuel + \n                                calculatedReserveFuel;\n        \n        let refuelNeeded = 0;\n        \n        // Check if total fuel exceeds max fuel capacity\n        if (selectedAircraft && selectedAircraft.maxFuel && calculatedTotalFuel > selectedAircraft.maxFuel) {\n          const fuelNeeded = calculatedTotalFuel;\n          const maxFuel = selectedAircraft.maxFuel;\n          refuelNeeded = fuelNeeded - maxFuel;\n          \n          console.log(`⚠️ WARNING: Required fuel (${fuelNeeded} lbs) exceeds max fuel capacity (${maxFuel} lbs). Need refuel stop (+${refuelNeeded} lbs)`);\n          \n          // Set the total fuel to max capacity\n          calculatedTotalFuel = maxFuel;\n        }\n        \n        console.log('🚨 STRICT NUMBER CONVERSION FALLBACK FUEL CALCULATIONS:', {\n          calculatedTripFuel,\n          calculatedContingencyFuel,\n          contingencyCalc: `${calculatedTripFuel} * ${contingencyFuelPercent} / 100 = ${calculatedContingencyFuel}`,\n          calculatedTaxiFuel,\n          taxiFuel_asNumber: calculatedTaxiFuel,\n          calculatedDeckFuel,\n          deckFuelCalc: `${calculatedIntermediateStops} * ${deckTimePerStop} / 60 * ${deckFuelFlow} = ${calculatedDeckFuel}`,\n          calculatedReserveFuel,\n          calculatedTotalFuel,\n          // Original values\n          taxiFuel_original: taxiFuel,\n          deckTimePerStop_original: deckTimePerStop,\n          deckFuelFlow_original: deckFuelFlow,\n          contingencyFuelPercent_original: contingencyFuelPercent,\n          intermediateStops: calculatedIntermediateStops\n        });\n        \n        const result = {\n          tripFuel: calculatedTripFuel,\n          deckFuel: calculatedDeckFuel,\n          totalFuel: calculatedTotalFuel,\n          contingencyFuel: calculatedContingencyFuel,\n          reserveFuel: calculatedReserveFuel,\n          taxiFuel: calculatedTaxiFuel\n        };\n        \n        if (refuelNeeded > 0) {\n          result.refuelNeeded = refuelNeeded;\n        }\n        \n        return result;\n      } catch (error) {\n        console.error('Error in fuel fallback calculation:', error);\n        // Last resort emergency fallback\n        return {\n          tripFuel: 0,\n          deckFuel: 0,\n          totalFuel: 0,\n          contingencyFuel: 0,\n          reserveFuel: 0,\n          taxiFuel: 0\n        };\n      }\n    } catch (error) {\n      console.error('Critical error in getFuelData:', error);\n      // Emergency fallback with zeros\n      return {\n        tripFuel: 0,\n        deckFuel: 0,\n        totalFuel: 0,\n        contingencyFuel: 0,\n        reserveFuel: 0,\n        taxiFuel: 0\n      };\n    }\n  };\n  \n  // Get the fuel data with a safe default\n  const fuelData = getFuelData() || {\n    tripFuel: 0,\n    deckFuel: 0,\n    totalFuel: 0,\n    contingencyFuel: 0,\n    reserveFuel: 0,\n    taxiFuel: 0\n  };\n  \n  // Debug log what's actually being used in the render\n  useEffect(() => {\n    if (fuelData) {\n      console.log('🚨 DEBUG FUEL DATA BEING USED FOR RENDER:', {\n        fuelData,\n        topCardTotalFuel: fuelData.totalFuel,\n        componentSum: (\n          (fuelData.tripFuel || 0) + \n          (fuelData.contingencyFuel || 0) + \n          (fuelData.taxiFuel || 0) + \n          (fuelData.deckFuel || 0) + \n          (fuelData.reserveFuel || 0)\n        ),\n        enhancedResults: routeStats?.enhancedResults ? true : false\n      });\n    } else {\n      console.error('🚨 CRITICAL: fuelData is null or undefined');\n    }\n  }, [fuelData, forceRerender]);\n  \n  // Calculate maximum passengers based on usable load and passenger weight\n  const calculateMaxPassengers = () => {\n    // If we have calculatedPassengers from the flight calculator, use that\n    if (stats.calculatedPassengers !== undefined) {\n      return stats.calculatedPassengers;\n    }\n    \n    // If routeStats has usableLoad and maxPassengers, use those directly\n    if (stats.usableLoad !== undefined && stats.maxPassengers !== undefined) {\n      console.log('Using maxPassengers directly from route stats:', stats.maxPassengers);\n      return stats.maxPassengers;\n    }\n    \n    // Check if we have stop cards with passenger info - most reliable source\n    if (stopCards && stopCards.length > 0) {\n      const departureCard = stopCards.find(card => card.isDeparture);\n      if (departureCard && departureCard.maxPassengers !== undefined) {\n        console.log('Using maxPassengers from departure card:', departureCard.maxPassengers);\n        return departureCard.maxPassengers;\n      }\n    }\n    \n    // If we have local stop cards but no stopCards from props\n    if (localStopCards && localStopCards.length > 0) {\n      const departureCard = localStopCards.find(card => card.isDeparture);\n      if (departureCard && departureCard.maxPassengers !== undefined) {\n        console.log('Using maxPassengers from local departure card:', departureCard.maxPassengers);\n        return departureCard.maxPassengers;\n      }\n    }\n    \n    // If we have fuelData and selectedAircraft, use PassengerCalculator\n    if (selectedAircraft && fuelData && fuelData.totalFuel) {\n      const maxPax = PassengerCalculator.calculateMaxPassengers(\n        selectedAircraft,\n        fuelData.totalFuel,\n        passengerWeight\n      );\n      console.log('Calculated maxPassengers using PassengerCalculator:', maxPax);\n      return maxPax;\n    }\n    \n    // Last resort fallback - return 0 instead of using partial data\n    return 0;\n  };\n  \n  // Add a direct access to passengers from top card\n  const getDisplayPassengers = () => {\n    // First priority: Use the first stop card passenger count if available\n    if (stopCards && stopCards.length > 0) {\n      // Try departure card first\n      const departureCard = stopCards.find(card => card.isDeparture);\n      if (departureCard && departureCard.maxPassengers) {\n        console.log('Using passenger count from departure card:', departureCard.maxPassengers);\n        return departureCard.maxPassengers;\n      }\n      \n      // If no specific departure card, use first card\n      if (stopCards[0] && stopCards[0].maxPassengers) {\n        console.log('Using passenger count from first card:', stopCards[0].maxPassengers);\n        return stopCards[0].maxPassengers;\n      }\n    }\n    \n    // Second priority: Use localStopCards if available\n    if (localStopCards && localStopCards.length > 0) {\n      const departureCard = localStopCards.find(card => card.isDeparture);\n      if (departureCard && departureCard.maxPassengers) {\n        console.log('Using passenger count from local departure card:', departureCard.maxPassengers);\n        return departureCard.maxPassengers;\n      }\n      \n      if (localStopCards[0] && localStopCards[0].maxPassengers) {\n        console.log('Using passenger count from first local card:', localStopCards[0].maxPassengers);\n        return localStopCards[0].maxPassengers;\n      }\n    }\n    \n    // Last priority: Use calculated max passengers\n    const calculated = calculateMaxPassengers();\n    console.log('Using calculated max passengers as last resort:', calculated);\n    return calculated;\n  };\n  \n  // Initialize the route stats loader only once, with a cleanup function to remove any existing loaders first\n  useEffect(() => {\n    // First, remove any existing loading containers\n    const existingContainers = document.querySelectorAll('.fp-loading-container');\n    existingContainers.forEach(container => {\n      container.remove();\n    });\n    \n    // Clear any active status indicators\n    if (LoadingIndicator && LoadingIndicator.clearStatusIndicator) {\n      LoadingIndicator.clearStatusIndicator();\n    }\n    \n    // Initialize the loading bar after a short delay to ensure DOM is ready\n    const initTimer = setTimeout(() => {\n      if (LoadingIndicator && LoadingIndicator.initializeRouteStatsLoader) {\n        LoadingIndicator.initializeRouteStatsLoader();\n      }\n    }, 100);\n    \n    // Cleanup function\n    return () => {\n      clearTimeout(initTimer);\n      \n      // Remove any loading containers\n      const containers = document.querySelectorAll('.fp-loading-container');\n      containers.forEach(container => {\n        container.remove();\n      });\n      \n      // Clean up any loaders\n      if (loaderIdRef.current !== null) {\n        LoadingIndicator.hide(loaderIdRef.current);\n        loaderIdRef.current = null;\n      }\n      \n      // Clear any status messages\n      if (LoadingIndicator && LoadingIndicator.clearStatusIndicator) {\n        LoadingIndicator.clearStatusIndicator();\n      }\n    };\n  }, []);\n  \n  // Log fuel data updates when it changes\n  useEffect(() => {\n    // Log when fuel data changes due to stop cards changes\n    if (stopCards && stopCards.length > 0) {\n      const departureCard = stopCards.find(card => card.isDeparture);\n      if (departureCard) {\n        console.log('⚠️ Fuel data updated from stop cards:', {\n          totalFuel: departureCard.totalFuel,\n          deckFuel: departureCard.deckFuel,\n          tripFuel: departureCard.fuelComponentsObject?.tripFuel\n        });\n      }\n    }\n  }, [stopCards, forceRerender]);\n\n  // Add loading indicator effect for waypoints changes\n  useEffect(() => {\n    // Show loading message when waypoints change\n    if (waypoints && waypoints.length >= 2) {\n      // Update the status indicator with a message\n      if (LoadingIndicator && LoadingIndicator.updateStatusIndicator) {\n        LoadingIndicator.updateStatusIndicator(\"Calculating route\");\n      }\n    }\n  }, [waypoints]);\n  \n  // Format time as HH:MM\n  const formatTime = (timeHours) => {\n    if (!timeHours && timeHours !== 0) return '00:00';\n    const hours = Math.floor(timeHours);\n    const minutes = Math.floor((timeHours - hours) * 60);\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n  };\n  \n  // Calculate total distance directly from waypoints if needed\n  const calculateTotalDistance = (waypointArray) => {\n    if (!waypointArray || waypointArray.length < 2 || !window.turf) return '0';\n    \n    try {\n      let total = 0;\n      for (let i = 0; i < waypointArray.length - 1; i++) {\n        const from = window.turf.point(waypointArray[i].coords);\n        const to = window.turf.point(waypointArray[i + 1].coords);\n        const options = { units: 'nauticalmiles' };\n        const legDistance = window.turf.distance(from, to, options);\n        total += legDistance;\n      }\n      return total.toFixed(1);\n    } catch (error) {\n      console.error('Error calculating distance:', error);\n      return '0';\n    }\n  };\n  \n  // Calculate flight time - use existing values if valid, otherwise calculate\n  const calculateFlightTime = (stats, waypointArray, aircraft) => {\n    // First try to use estimatedTime or timeHours from stats\n    if (stats.estimatedTime && stats.estimatedTime !== '00:00') {\n      console.log('Using existing estimatedTime:', stats.estimatedTime);\n      return stats.estimatedTime;\n    }\n    \n    if (stats.timeHours && stats.timeHours > 0) {\n      console.log('Formatting existing timeHours:', stats.timeHours);\n      return formatTime(stats.timeHours);\n    }\n    \n    // If we don't have valid time values but have waypoints and aircraft, calculate directly\n    if (waypointArray && waypointArray.length >= 2 && aircraft && aircraft.cruiseSpeed && window.turf) {\n      try {\n        console.log('⚠️ Calculating flight time manually in RouteStatsCard');\n        // Calculate distance\n        let totalDistance;\n        \n        // Use existing distance if available, otherwise calculate\n        if (stats.totalDistance && parseFloat(stats.totalDistance) > 0) {\n          totalDistance = parseFloat(stats.totalDistance);\n        } else {\n          totalDistance = parseFloat(calculateTotalDistance(waypointArray));\n        }\n        \n        // Try to use wind calculations if we have weather data\n        let timeHours;\n        const hasWindData = (stats.windData && window.WindCalculations) || (weather && window.WindCalculations);\n        \n        if (hasWindData) {\n          console.log('⚠️ Attempting wind-adjusted flight time calculation');\n          \n          // Get wind data from stats or from weather prop\n          const windData = stats.windData || weather;\n          \n          // Use it only if it actually has non-zero wind\n          if (windData && windData.windSpeed > 0) {\n            // If we have multiple waypoints, calculate average course\n            if (waypointArray.length > 2) {\n              // Calculate total time across all legs\n              let totalTime = 0;\n              \n              for (let i = 0; i < waypointArray.length - 1; i++) {\n                const from = window.turf.point(waypointArray[i].coords);\n                const to = window.turf.point(waypointArray[i + 1].coords);\n                const options = { units: 'nauticalmiles' };\n                \n                const legDistance = window.turf.distance(from, to, options);\n                \n                // Calculate course for this leg\n                const fromPoint = {\n                  lat: waypointArray[i].coords[1],\n                  lon: waypointArray[i].coords[0]\n                };\n                \n                const toPoint = {\n                  lat: waypointArray[i + 1].coords[1],\n                  lon: waypointArray[i + 1].coords[0]\n                };\n                \n                const course = window.WindCalculations.calculateCourse(fromPoint, toPoint);\n                \n                // Calculate time with wind for this leg\n                const legTime = window.WindCalculations.calculateWindAdjustedTime(\n                  legDistance,\n                  aircraft.cruiseSpeed,\n                  course,\n                  windData.windSpeed,\n                  windData.windDirection\n                );\n                \n                totalTime += legTime;\n              }\n              \n              timeHours = totalTime;\n              console.log(`⚠️ Multi-leg wind-adjusted flight time: ${timeHours.toFixed(2)} hours`);\n            } else {\n              // Single leg - calculate course\n              const from = {\n                lat: waypointArray[0].coords[1],\n                lon: waypointArray[0].coords[0]\n              };\n              \n              const to = {\n                lat: waypointArray[1].coords[1],\n                lon: waypointArray[1].coords[0]\n              };\n              \n              const course = window.WindCalculations.calculateCourse(from, to);\n              \n              // Calculate time with wind\n              timeHours = window.WindCalculations.calculateWindAdjustedTime(\n                totalDistance,\n                aircraft.cruiseSpeed,\n                course,\n                windData.windSpeed,\n                windData.windDirection\n              );\n              \n              console.log(`⚠️ Single-leg wind-adjusted flight time: ${timeHours.toFixed(2)} hours`);\n            }\n            \n            // Mark as wind-adjusted\n            if (routeStats) {\n              routeStats.windAdjusted = true;\n              \n              // Set/update wind data\n              if (!routeStats.windData) {\n                routeStats.windData = {\n                  windSpeed: windData.windSpeed,\n                  windDirection: windData.windDirection\n                };\n              }\n            }\n          } else {\n            // No wind or zero speed, fallback to basic calculation\n            timeHours = totalDistance / aircraft.cruiseSpeed;\n            console.log(`⚠️ Basic flight time (no wind): ${timeHours.toFixed(2)} hours`);\n          }\n        } else {\n          // Basic calculation without wind\n          timeHours = totalDistance / aircraft.cruiseSpeed;\n          console.log(`⚠️ Basic flight time: ${timeHours.toFixed(2)} hours`);\n        }\n        \n        // Format time and update stats for future use\n        const formattedTime = formatTime(timeHours);\n        \n        console.log('⚠️ Manual flight time calculation:', {\n          distance: totalDistance,\n          cruiseSpeed: aircraft.cruiseSpeed,\n          timeHours,\n          formattedTime,\n          windAdjusted: hasWindData\n        });\n        \n        // Update routeStats object if it exists\n        if (routeStats) {\n          routeStats.timeHours = timeHours;\n          routeStats.estimatedTime = formattedTime;\n        }\n        \n        // Also update window.currentRouteStats if it exists\n        if (window.currentRouteStats) {\n          window.currentRouteStats.timeHours = timeHours;\n          window.currentRouteStats.estimatedTime = formattedTime;\n          \n          // Also sync wind data\n          if (routeStats && routeStats.windAdjusted) {\n            window.currentRouteStats.windAdjusted = true;\n            window.currentRouteStats.windData = { ...routeStats.windData };\n          }\n        }\n        \n        return formattedTime;\n      } catch (error) {\n        console.error('Error calculating flight time:', error);\n      }\n    }\n    \n    // Fallback to 00:00 if no valid time can be calculated\n    return '00:00';\n  };\n  \n  return (\n    <div className=\"route-stats-card\" ref={cardRef}>\n      <div className=\"route-stats-header\">\n        <div className=\"logo-container\">\n          <img src=\"https://bristow.info/SAR/VTOL-5a215f01.png\" alt=\"VTOL\" className=\"vtol-logo\" />\n        </div>\n        <div className=\"route-stats-title\">\n          {selectedAircraft ? (\n            <span>{selectedAircraft.registration.split(' (')[0]} • {selectedAircraft.modelType}</span>\n          ) : (\n            <span>Route Statistics</span>\n          )}\n        </div>\n        \n        {/* Status indicator positioned in the middle of the header */}\n        <div className=\"status-indicator-container\" style={{\n          position: 'absolute',\n          top: '0',\n          left: '0',\n          right: '0',\n          height: '100%',\n          textAlign: 'center',\n          zIndex: '100',\n          pointerEvents: 'none'\n        }}>\n          <div className=\"status-indicator\">\n            {/* Status text will be updated dynamically with typewriter effect */}\n          </div>\n        </div>\n        \n        {/* Auth status container - always show on the right */}\n        <div className=\"auth-status-container\">\n          {/* Username display with script font */}\n          {isAuthenticated && userName && (\n            <span className=\"username-display\">{userName}</span>\n          )}\n          \n          {/* Connection indicator dot - changes color based on status */}\n          <span \n            className={`connection-indicator ${isAuthenticated ? 'connected' : 'disconnected'}`} \n            title={isAuthenticated ? 'Connected to OSDK' : 'Not connected to OSDK'}\n          ></span>\n        </div>\n      </div>\n      \n      {/* Conditional rendering based on whether we have enhanced fuel calculations */}\n      {routeStats && routeStats.enhancedResults ? (\n        // Display the enhanced fuel display component when we have enhanced calculations\n        <EnhancedFuelDisplay \n          fuelData={routeStats}\n          selectedAircraft={selectedAircraft}\n          onAdjustFuel={() => console.log('Adjust fuel clicked')}\n          onChangeAlternate={() => console.log('Change alternate clicked')}\n        />\n      ) : (\n        // Display the standard fuel display when we don't have enhanced calculations\n        <div className=\"route-stats-content\">\n          <div className=\"stats-row\">\n            {/* Column 1: Total Distance and Trip Fuel */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Total Distance:</div>\n              <div className=\"route-stat-value\">\n                {stats.totalDistance && stats.totalDistance !== '0' ? \n                  `${stats.totalDistance} NM` : \n                  (waypoints && waypoints.length >= 2 ? \n                    `${calculateTotalDistance(waypoints)} NM` : \n                    '0 NM')}\n              </div>\n            </div>\n            \n            {/* Column 2: Deck Time and Deck Fuel */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Deck Time:</div>\n              <div className=\"route-stat-value\">{stats.deckTimeMinutes || totalDeckTime} mins</div>\n            </div>\n            \n            {/* Column 3: Flight Time and Total Time */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">\n                Flight Time:\n                {isWindAdjusted && routeStats && routeStats.windData && routeStats.windData.avgHeadwind !== 0 && (\n                  <span style={{ \n                    fontSize: '0.8em', \n                    marginLeft: '4px', \n                    color: routeStats.windData.avgHeadwind > 0 ? '#e74c3c' : '#2ecc71',\n                    fontWeight: 'bold'\n                  }}\n                  title={`${Math.abs(routeStats.windData.avgHeadwind)} kt ${routeStats.windData.avgHeadwind > 0 ? 'headwind' : 'tailwind'}`}>\n                    {routeStats.windData.avgHeadwind > 0 ? \n                      ` (+${routeStats.windData.avgHeadwind}kt)` : \n                      ` (${routeStats.windData.avgHeadwind}kt)`}\n                  </span>\n                )}\n              </div>\n              <div className=\"route-stat-value\">\n                {/* EMERGENCY FIX: Calculate time if needed */}\n                {calculateFlightTime(stats, waypoints, selectedAircraft)}\n              </div>\n            </div>\n            \n            {/* Column 4: Total Fuel and Passengers */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Total Fuel:</div>\n              <div className=\"route-stat-value\">\n                {(fuelData && fuelData.totalFuel) ? fuelData.totalFuel : '0'} lbs\n                {fuelData && fuelData.refuelNeeded && (\n                  <span style={{ \n                    fontSize: '0.8em', \n                    color: '#e74c3c', \n                    marginLeft: '5px', \n                    fontStyle: 'italic' \n                  }}>\n                    (+{fuelData.refuelNeeded} lbs)\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"stats-row\">\n            {/* Column 1: Trip Fuel (below Total Distance) */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Trip Fuel:</div>\n              <div className=\"route-stat-value\">\n                {(fuelData && fuelData.tripFuel) ? fuelData.tripFuel : '0'} lbs\n              </div>\n            </div>\n            \n            {/* Column 2: Deck Fuel (below Deck Time) */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Deck Fuel:</div>\n              <div className=\"route-stat-value\">\n                {(fuelData && fuelData.deckFuel) ? fuelData.deckFuel : '0'} lbs\n              </div>\n            </div>\n            \n            {/* Column 3: Total Time (below Flight Time) */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Total Time:</div>\n              <div className=\"route-stat-value\">{calculateTotalTime()}</div>\n            </div>\n            \n            {/* Column 4: Passengers (below Total Fuel) */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\">Passengers:</div>\n              <div className=\"route-stat-value\" style={{ display: 'flex', alignItems: 'center' }}>\n                {/* First import passenger icon from stop icons */}\n                <div style={{ marginRight: '4px', display: 'flex', alignItems: 'center' }}>\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M16 11C17.66 11 18.99 9.66 18.99 8C18.99 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 10.99 9.66 10.99 8C10.99 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.67 13 1 14.17 1 16.5V19H15V16.5C15 14.17 10.33 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H23V16.5C23 14.17 18.33 13 16 13Z\" \n                      fill=\"#3498db\" />\n                  </svg>\n                </div>\n                {/* Use our dedicated function to get passenger number */}\n                {getDisplayPassengers()} \n                {stopCards && stopCards.length > 1 && (\n                  <span style={{ fontSize: '0.85em', color: '#fff', marginLeft: '6px', display: 'flex', alignItems: 'center' }}>\n                    {stopCards.filter(card => !card.isDeparture && !card.isDestination)\n                      .map((card, idx) => {\n                        // Define colors matching the menu highlight colors\n                        // Starting with blue for the first stop\n                        const colors = ['#3498db', '#614dd6', '#8c5ed6', '#c05edb', '#e27add', '#1abc9c'];\n                        const color = colors[idx % colors.length];\n                        \n                        return (\n                          <span key={idx} title={`${card.stopName || 'Stop'}: ${card.maxPassengers || 0} passengers`}\n                                style={{ display: 'inline-flex', alignItems: 'center', marginLeft: '6px' }}>\n                            <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style={{ marginRight: '2px' }}>\n                              <path d=\"M16 11C17.66 11 18.99 9.66 18.99 8C18.99 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 10.99 9.66 10.99 8C10.99 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.67 13 1 14.17 1 16.5V19H15V16.5C15 14.17 10.33 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H23V16.5C23 14.17 18.33 13 16 13Z\" \n                                fill={color} />\n                            </svg>\n                            <span style={{ color: '#fff' }}>{card.maxPassengers || 0}</span>\n                          </span>\n                        );\n                      })\n                    }\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          {/* Additional row for secondary fuel numbers */}\n          <div className=\"stats-row\" style={{ marginTop: '4px', fontSize: '0.85em' }}>\n            {/* Column 1: Contingency Fuel */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\" style={{ color: '#777' }}>Contingency:</div>\n              <div className=\"route-stat-value\" style={{ color: '#777' }}>\n                {(fuelData && fuelData.contingencyFuel) ? fuelData.contingencyFuel : '0'} lbs\n              </div>\n            </div>\n            \n            {/* Column 2: Taxi Fuel */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\" style={{ color: '#777' }}>Taxi Fuel:</div>\n              <div className=\"route-stat-value\" style={{ color: '#777' }}>\n                {(fuelData && fuelData.taxiFuel) ? fuelData.taxiFuel : '0'} lbs\n              </div>\n            </div>\n            \n            {/* Column 3: Reserve Fuel */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\" style={{ color: '#777' }}>Reserve:</div>\n              <div className=\"route-stat-value\" style={{ color: '#777' }}>\n                {(fuelData && fuelData.reserveFuel) ? fuelData.reserveFuel : '0'} lbs\n              </div>\n            </div>\n            \n            {/* Column 4: Empty for alignment */}\n            <div className=\"route-stat-item\">\n              <div className=\"route-stat-label\" style={{ color: '#777' }}></div>\n              <div className=\"route-stat-value\" style={{ color: '#777' }}></div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Enhanced info message if we're using enhanced calculations */}\n      {routeStats && routeStats.enhancedResults && (\n        <div className=\"enhanced-calculations-indicator\" style={{\n          textAlign: 'center',\n          fontSize: '0.8em',\n          color: '#3498db',\n          padding: '4px',\n          backgroundColor: 'rgba(52, 152, 219, 0.1)',\n          borderRadius: '4px',\n          margin: '2px 0'\n        }}>\n          Using enhanced fuel calculations\n        </div>\n      )}\n      \n      {/* Local stop cards display */}\n      {localStopCards && localStopCards.length > 0 && (\n        <div className=\"route-stops\" style={{ margin: '5px 0', padding: '8px 10px' }}>\n          <h4 className=\"route-stops-title\" style={{ \n            margin: '0 0 8px 0', \n            color: '#3498db', \n            fontSize: '0.85em', \n            fontWeight: '600', \n            textTransform: 'uppercase' \n          }}>ROUTE STOPS</h4>\n          \n          <div className=\"stop-cards-stack\" style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\n            {localStopCards.map((card, index) => {\n              // Determine styling based on stop type\n              const borderColor = card.isDeparture ? '#2ecc71' : \n                                card.isDestination ? '#e74c3c' : \n                                '#3498db';\n              const bgColor = card.isDeparture ? 'rgba(45, 55, 45, 0.95)' : \n                             card.isDestination ? 'rgba(55, 45, 45, 0.95)' : \n                             'rgba(45, 45, 55, 0.95)';\n              \n              // Format time as HH:MM\n              const formatTime = (timeHours) => {\n                if (!timeHours && timeHours !== 0) return '00:00';\n                const hours = Math.floor(timeHours);\n                const minutes = Math.floor((timeHours - hours) * 60);\n                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n              };\n              \n              // Determine stop number display\n              const stopNumberDisplay = card.isDeparture ? 'D' : \n                                       card.isDestination ? 'F' : \n                                       card.index;\n                                       \n              return (\n                <div key={`stop-${index}`} className={`stop-card ${card.isDeparture ? 'departure-card' : ''} ${card.isDestination ? 'destination-card' : ''}`} style={{\n                  backgroundColor: bgColor,\n                  borderLeft: `3px solid ${borderColor}`,\n                  borderRadius: '3px',\n                  padding: '8px 10px',\n                  boxShadow: '0 2px 6px rgba(0, 0, 0, 0.25)',\n                  cursor: 'pointer',\n                  marginBottom: '5px'\n                }}>\n                  {/* Stop header with number and name */}\n                  <div className=\"stop-header\" style={{ display: 'flex', alignItems: 'center', marginBottom: '6px' }}>\n                    <div className=\"stop-number\" style={{ \n                      backgroundColor: borderColor,\n                      color: 'white',\n                      borderRadius: '50%',\n                      width: '18px',\n                      height: '18px',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      fontSize: '0.75em',\n                      fontWeight: 'bold',\n                      marginRight: '8px',\n                      boxShadow: '0 1px 2px rgba(0, 0, 0, 0.25)'\n                    }}>\n                      {stopNumberDisplay}\n                    </div>\n                    <div className=\"stop-name\" style={{\n                      fontWeight: '600',\n                      fontSize: '0.85em',\n                      color: 'white',\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      maxWidth: '180px',\n                      textShadow: '0 1px 1px rgba(0, 0, 0, 0.3)'\n                    }}>\n                      {card.stopName || `Stop ${index + 1}`}\n                    </div>\n                  </div>\n                  \n                  {/* Stop details */}\n                  <div className=\"stop-details\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\n                    {/* Distance */}\n                    <div className=\"stop-metric\">\n                      <span className=\"icon\" style={{ color: borderColor }}>📍</span>\n                      <div className=\"metric-value\" style={{ fontSize: '0.75em', color: '#f5f5f5' }}>\n                        {card.totalDistance || '0'} nm\n                      </div>\n                    </div>\n                    \n                    {/* Time */}\n                    <div className=\"stop-metric\">\n                      <span className=\"icon\" style={{ color: borderColor }}>⏱️</span>\n                      <div className=\"metric-value\" style={{ fontSize: '0.75em', color: '#f5f5f5' }}>\n                        {formatTime(card.totalTime)}\n                      </div>\n                    </div>\n                    \n                    {/* Fuel */}\n                    <div className=\"stop-metric\">\n                      <span className=\"icon\" style={{ color: borderColor }}>⛽</span>\n                      <div className=\"metric-value\" style={{ fontSize: '0.75em', color: '#f5f5f5' }}>\n                        {card.totalFuel || '0'} lbs\n                      </div>\n                    </div>\n                    \n                    {/* Passengers */}\n                    <div className=\"stop-metric\">\n                      <span className=\"icon\" style={{ color: borderColor }}>👥</span>\n                      <div className=\"metric-value\" style={{ fontSize: '0.75em', color: '#f5f5f5' }}>\n                        {card.maxPassengersDisplay || card.maxPassengers || '0'}\n                      </div>\n                    </div>\n                  </div>\n                  \n                  {/* Fuel Components */}\n                  <div className=\"fuel-components\" style={{ \n                    marginTop: '6px', \n                    paddingTop: '4px', \n                    borderTop: '1px solid rgba(255, 255, 255, 0.1)',\n                    fontSize: '0.7em',\n                    color: 'rgba(255, 255, 255, 0.8)',\n                    whiteSpace: 'nowrap',\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis'\n                  }}>\n                    <div className=\"fuel-components-text\">\n                      {/* Display fuel components using the prettier format for debugging */}\n                      Trip: {card.fuelComponentsObject?.tripFuel || 0} • \n                      Cont: {card.fuelComponentsObject?.contingencyFuel || 0} • \n                      Taxi: {card.fuelComponentsObject?.taxiFuel || 0} • \n                      Deck: {card.fuelComponentsObject?.deckFuel || 0} • \n                      Res: {card.fuelComponentsObject?.reserveFuel || 0}\n                    </div>\n                    <div className=\"fuel-components-text\" style={{ marginTop: '3px', color: '#999' }}>\n                      {/* Show original string if available */}\n                      {card.fuelComponents ? `Original: ${card.fuelComponents}` : ''}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default RouteStatsCard;","/**\n * EnhancedFuelCalculator.js\n * \n * Advanced fuel calculation module that enhances the existing FlightCalculations\n * with more detailed per-leg and stop-specific calculations.\n * \n * IMPORTANT: This module NEVER uses fallback data - all calculations require\n * actual aircraft performance data from OSDK.\n */\n\nclass EnhancedFuelCalculator {\n  constructor() {\n    // Default configuration values\n    this.config = {\n      passengerWeight: 0,       // Changed to 0 to make missing settings obvious\n      taxiFuel: 0,              // Changed to 0 to make missing settings obvious\n      contingencyFuelPercent: 0, // Changed to 0 to make missing settings obvious\n      reserveFuel: 0,           // Changed to 0 to make missing settings obvious\n      reserveMethod: 'fixed',     // Default reserve method ('fixed' or 'percent')\n      reserveFuelPercent: 0,     // Changed to 0 to make missing settings obvious\n      deckTimePerStop: 0,         // Changed to 0 to make missing settings obvious\n      deckFuelFlow: 0,          // Changed to 0 to make missing settings obvious\n      deckFuelPerStop: 0,       // Changed to 0 to make missing settings obvious\n      callbacks: {}               // Callback functions\n    };\n  }\n  \n  /**\n   * Update configuration settings\n   * @param {Object} newConfig - Updated configuration values\n   */\n  updateConfig(newConfig) {\n    if (!newConfig) return;\n    \n    console.log('EnhancedFuelCalculator: Updating config with:', newConfig);\n    \n    // Update specific configuration properties\n    Object.keys(newConfig).forEach(key => {\n      if (key !== 'callbacks' && key in this.config) {\n        this.config[key] = newConfig[key];\n      }\n    });\n    \n    // Update callbacks separately\n    if (newConfig.callbacks) {\n      this.config.callbacks = {\n        ...this.config.callbacks,\n        ...newConfig.callbacks\n      };\n    }\n    \n    console.log('EnhancedFuelCalculator: Updated config:', this.config);\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} eventName - Event name for the callback\n   * @param {Function} callback - Callback function\n   */\n  setCallback(eventName, callback) {\n    if (typeof callback === 'function') {\n      this.config.callbacks[eventName] = callback;\n    }\n  }\n\n  /**\n   * Calculate fuel requirements for a route\n   * @param {Object} data - Route and aircraft data\n   * @param {Array} data.waypoints - Waypoints array\n   * @param {Object} data.aircraft - Aircraft object from OSDK\n   * @param {Object} data.weather - Weather data\n   * @param {number} data.cargoWeight - Additional cargo weight\n   * @returns {Object} Fuel calculation results\n   */\n  calculateFuelRequirements(data) {\n    // Validate input data - NEVER calculate with missing data\n    if (!this.validateInputData(data)) {\n      console.error('EnhancedFuelCalculator: Invalid input data, cannot calculate');\n      return null;\n    }\n    \n    const { waypoints, aircraft, weather, cargoWeight = 0 } = data;\n    \n    console.log('EnhancedFuelCalculator: Calculating fuel requirements', {\n      waypointsCount: waypoints.length,\n      aircraft: aircraft.registration,\n      weather,\n      cargoWeight\n    });\n    \n    // Calculate fuel for each leg and stop\n    const legResults = this.calculateLegFuel(waypoints, aircraft, weather);\n    \n    // Calculate additional fuel components\n    const auxiliaryFuel = this.calculateAuxiliaryFuel(legResults.totalTripFuel, waypoints.length - 1);\n    \n    // Calculate per-stop fuel and passenger capacity\n    const fuelByStop = this.calculateFuelByStop(waypoints, legResults.legDetails, auxiliaryFuel, aircraft);\n    \n    // Calculate available capacity for entire route\n    const maxCapacity = this.calculateMaxCapacity(fuelByStop, aircraft);\n    \n    // Compile and return results\n    const results = {\n      legResults,\n      auxiliaryFuel,\n      fuelByStop,\n      maxCapacity,\n      \n      // Summary for quick access\n      totalTripFuel: legResults.totalTripFuel,\n      totalAuxFuel: auxiliaryFuel.total,\n      totalFuel: legResults.totalTripFuel + auxiliaryFuel.total,\n      \n      // Raw input data for reference\n      aircraft,\n      waypoints,\n      weather,\n      cargoWeight,\n      config: { ...this.config }\n    };\n    \n    // Call callback if it exists\n    if (this.config.callbacks.onCalculationComplete) {\n      this.config.callbacks.onCalculationComplete(results);\n    }\n    \n    return results;\n  }\n  \n  /**\n   * Validate input data to ensure we have all required information\n   * @param {Object} data - Input data object\n   * @returns {boolean} True if data is valid, false otherwise\n   */\n  validateInputData(data) {\n    // Check if we have the required data objects\n    if (!data || !data.waypoints || !data.aircraft) {\n      console.error('EnhancedFuelCalculator: Missing required data objects');\n      return false;\n    }\n    \n    // Ensure we have at least 2 waypoints\n    if (!Array.isArray(data.waypoints) || data.waypoints.length < 2) {\n      console.error('EnhancedFuelCalculator: Need at least 2 waypoints');\n      return false;\n    }\n    \n    // Check if all waypoints have coordinates\n    for (const waypoint of data.waypoints) {\n      if (!waypoint.coords || !Array.isArray(waypoint.coords) || waypoint.coords.length !== 2) {\n        console.error('EnhancedFuelCalculator: Invalid waypoint coordinates:', waypoint);\n        return false;\n      }\n    }\n    \n    // Validate aircraft data - we MUST have these properties\n    const requiredAircraftProps = ['cruiseSpeed', 'fuelBurn', 'emptyWeight', 'maxTakeoffWeight', 'maxFuel'];\n    for (const prop of requiredAircraftProps) {\n      if (typeof data.aircraft[prop] !== 'number' || data.aircraft[prop] <= 0) {\n        console.error(`EnhancedFuelCalculator: Missing or invalid aircraft property: ${prop}`, data.aircraft[prop]);\n        return false;\n      }\n    }\n    \n    // All validations passed\n    return true;\n  }\n  \n  /**\n   * Calculate fuel for each leg of the route\n   * @param {Array} waypoints - Array of waypoint objects\n   * @param {Object} aircraft - Aircraft data\n   * @param {Object} weather - Weather data\n   * @returns {Object} Leg fuel calculation results\n   */\n  calculateLegFuel(waypoints, aircraft, weather) {\n    const legDetails = [];\n    let totalDistance = 0;\n    let totalTime = 0;\n    let totalTripFuel = 0;\n    \n    // Process each leg (between waypoints)\n    for (let i = 0; i < waypoints.length - 1; i++) {\n      const from = waypoints[i];\n      const to = waypoints[i + 1];\n      \n      // Calculate distance for this leg\n      const distance = this.calculateDistance(from.coords, to.coords);\n      \n      // Calculate flight time with wind adjustment if available\n      const timeResult = this.calculateFlightTime(distance, aircraft.cruiseSpeed, from.coords, to.coords, weather);\n      \n      // Calculate fuel consumption for this leg\n      const fuelRequired = timeResult.flightTimeHours * aircraft.fuelBurn;\n      \n      // Update totals\n      totalDistance += distance;\n      totalTime += timeResult.flightTimeHours;\n      totalTripFuel += fuelRequired;\n      \n      // Store leg details\n      legDetails.push({\n        from: from.name || `Waypoint ${i}`,\n        to: to.name || `Waypoint ${i+1}`,\n        distance,\n        flightTimeHours: timeResult.flightTimeHours,\n        fuelRequired: Math.round(fuelRequired),\n        groundSpeed: timeResult.groundSpeed,\n        heading: timeResult.heading,\n        windEffect: timeResult.windEffect\n      });\n    }\n    \n    return {\n      legDetails,\n      totalDistance,\n      totalTime,\n      totalTripFuel: Math.round(totalTripFuel)\n    };\n  }\n  \n  /**\n   * Calculate distance between two coordinates\n   * @param {Array} from - [lon, lat] coordinates\n   * @param {Array} to - [lon, lat] coordinates\n   * @returns {number} Distance in nautical miles\n   */\n  calculateDistance(from, to) {\n    if (!window.turf) {\n      console.error('EnhancedFuelCalculator: Turf.js not available for distance calculation');\n      // Return 0 instead of using fallback data\n      return 0;\n    }\n    \n    try {\n      const fromPoint = window.turf.point(from);\n      const toPoint = window.turf.point(to);\n      return window.turf.distance(fromPoint, toPoint, { units: 'nauticalmiles' });\n    } catch (error) {\n      console.error('EnhancedFuelCalculator: Error calculating distance:', error);\n      return 0;\n    }\n  }\n  \n  /**\n   * Calculate flight time between two points, with wind adjustment if available\n   * @param {number} distance - Distance in nautical miles\n   * @param {number} cruiseSpeed - Cruise speed in knots\n   * @param {Array} fromCoords - [lon, lat] coordinates of origin\n   * @param {Array} toCoords - [lon, lat] coordinates of destination\n   * @param {Object} weather - Weather data (optional)\n   * @returns {Object} Flight time and related data\n   */\n  calculateFlightTime(distance, cruiseSpeed, fromCoords, toCoords, weather) {\n    // Default result with no wind\n    const result = {\n      flightTimeHours: distance / cruiseSpeed,\n      groundSpeed: cruiseSpeed,\n      heading: 0,\n      windEffect: 0\n    };\n    \n    // If we have WindCalculations and weather data, use it\n    if (window.WindCalculations && weather && weather.windSpeed > 0) {\n      try {\n        // Create lat/lon objects from coordinates\n        const from = {\n          lat: fromCoords[1],\n          lon: fromCoords[0]\n        };\n        \n        const to = {\n          lat: toCoords[1],\n          lon: toCoords[0]\n        };\n        \n        // Calculate heading between points\n        const heading = window.WindCalculations.calculateHeading(from, to);\n        \n        // Calculate wind effect\n        const windEffect = window.WindCalculations.calculateWindComponent(\n          heading,\n          weather.windDirection,\n          weather.windSpeed\n        );\n        \n        // Calculate ground speed\n        const groundSpeed = Math.max(10, cruiseSpeed - windEffect);\n        \n        // Calculate time with wind\n        const flightTimeHours = distance / groundSpeed;\n        \n        // Update the result\n        result.flightTimeHours = flightTimeHours;\n        result.groundSpeed = groundSpeed;\n        result.heading = heading;\n        result.windEffect = windEffect;\n      } catch (error) {\n        console.error('EnhancedFuelCalculator: Error calculating wind effect:', error);\n        // Keep the default no-wind calculation\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * Calculate auxiliary fuel components (taxi, contingency, reserve, deck)\n   * @param {number} tripFuel - Total trip fuel in lbs\n   * @param {number} numStops - Number of intermediate stops\n   * @returns {Object} Auxiliary fuel components\n   */\n  calculateAuxiliaryFuel(tripFuel, numStops) {\n    // Calculate taxi fuel\n    const taxiFuel = this.config.taxiFuel;\n    \n    // Calculate contingency fuel (percentage of trip fuel)\n    const contingencyFuel = (tripFuel * this.config.contingencyFuelPercent) / 100;\n    \n    // Calculate reserve fuel\n    let reserveFuel = this.config.reserveFuel;\n    if (this.config.reserveMethod === 'percent') {\n      reserveFuel = (tripFuel * this.config.reserveFuelPercent) / 100;\n    }\n    \n    // Calculate deck fuel for intermediate stops\n    // numStops includes the final destination, so subtract 1\n    const intermediateStops = Math.max(0, numStops - 1);\n    const deckTimeHours = (intermediateStops * this.config.deckTimePerStop) / 60; // Convert from minutes to hours\n    const deckFuel = deckTimeHours * this.config.deckFuelFlow;\n    \n    // Calculate total auxiliary fuel\n    const total = taxiFuel + contingencyFuel + reserveFuel + deckFuel;\n    \n    return {\n      taxiFuel: Math.round(taxiFuel),\n      contingencyFuel: Math.round(contingencyFuel),\n      reserveFuel: Math.round(reserveFuel),\n      deckFuel: Math.round(deckFuel),\n      total: Math.round(total),\n      \n      // Additional details\n      contingencyFuelPercent: this.config.contingencyFuelPercent,\n      reserveMethod: this.config.reserveMethod,\n      reserveFuelPercent: this.config.reserveFuelPercent,\n      deckTimePerStop: this.config.deckTimePerStop,\n      deckFuelFlow: this.config.deckFuelFlow,\n      intermediateStops\n    };\n  }\n  \n  /**\n   * Calculate fuel required at each stop\n   * @param {Array} waypoints - Waypoints array\n   * @param {Array} legDetails - Leg details from calculateLegFuel\n   * @param {Object} auxiliaryFuel - Auxiliary fuel components\n   * @param {Object} aircraft - Aircraft data\n   * @returns {Array} Fuel requirements at each stop\n   */\n  calculateFuelByStop(waypoints, legDetails, auxiliaryFuel, aircraft) {\n    const fuelByStop = [];\n    \n    // For each waypoint\n    for (let i = 0; i < waypoints.length; i++) {\n      const waypoint = waypoints[i];\n      const isFirstStop = i === 0;\n      const isLastStop = i === waypoints.length - 1;\n      \n      // Calculate fuel needed for remaining legs\n      let remainingTripFuel = 0;\n      for (let j = i; j < legDetails.length; j++) {\n        remainingTripFuel += legDetails[j].fuelRequired;\n      }\n      \n      // Calculate contingency fuel for remaining legs\n      const remainingContingency = (auxiliaryFuel.contingencyFuelPercent / 100) * remainingTripFuel;\n      \n      // Calculate deck fuel for remaining intermediate stops\n      const remainingIntermediateStops = Math.max(0, waypoints.length - i - 2);\n      const remainingDeckTimeHours = (remainingIntermediateStops * this.config.deckTimePerStop) / 60;\n      const remainingDeckFuel = remainingDeckTimeHours * this.config.deckFuelFlow;\n      \n      // Taxi fuel only applies at the first stop\n      const taxiFuel = isFirstStop ? auxiliaryFuel.taxiFuel : 0;\n      \n      // Reserve fuel is always needed\n      const reserveFuel = auxiliaryFuel.reserveFuel;\n      \n      // Calculate total fuel required at this stop\n      const requiredFuel = remainingTripFuel + \n                          remainingContingency + \n                          remainingDeckFuel + \n                          reserveFuel + \n                          taxiFuel;\n      \n      // Clamp required fuel to aircraft max fuel capacity\n      const actualFuel = Math.min(requiredFuel, aircraft.maxFuel);\n      \n      // Calculate maximum passengers based on weight limitations\n      const maxTakeoffWeight = aircraft.maxTakeoffWeight;\n      const emptyWeight = aircraft.emptyWeight;\n      const maxPassengerWeight = Math.max(0, maxTakeoffWeight - emptyWeight - actualFuel);\n      const maxPassengers = Math.floor(maxPassengerWeight / this.config.passengerWeight);\n      \n      // Ensure we don't exceed aircraft capacity\n      const aircraftMaxPassengers = aircraft.maxPassengers || 19; // Default to 19 if not specified\n      const limitedMaxPassengers = Math.min(maxPassengers, aircraftMaxPassengers);\n      \n      // Store stop details\n      fuelByStop.push({\n        index: i,\n        waypoint: waypoint.name || `Waypoint ${i}`,\n        isFirstStop,\n        isLastStop,\n        requiredFuel: Math.round(requiredFuel),\n        actualFuel: Math.round(actualFuel),\n        maxPassengers: limitedMaxPassengers,\n        maxPassengerWeight: limitedMaxPassengers * this.config.passengerWeight,\n        \n        // Fuel components\n        components: {\n          remainingTripFuel: Math.round(remainingTripFuel),\n          remainingContingency: Math.round(remainingContingency),\n          remainingDeckFuel: Math.round(remainingDeckFuel),\n          taxiFuel: Math.round(taxiFuel),\n          reserveFuel: Math.round(reserveFuel)\n        },\n        \n        // Related waypoint and leg data\n        waypoint: waypoint,\n        leg: i < legDetails.length ? legDetails[i] : null\n      });\n    }\n    \n    return fuelByStop;\n  }\n  \n  /**\n   * Calculate maximum passenger capacity for the entire route\n   * @param {Array} fuelByStop - Fuel requirements at each stop\n   * @param {Object} aircraft - Aircraft data\n   * @returns {Object} Maximum capacity data\n   */\n  calculateMaxCapacity(fuelByStop, aircraft) {\n    // Find the limiting waypoint (lowest passenger capacity)\n    let minPassengers = Infinity;\n    let limitingStop = null;\n    \n    for (const stop of fuelByStop) {\n      // Skip the final stop\n      if (stop.isLastStop) continue;\n      \n      if (stop.maxPassengers < minPassengers) {\n        minPassengers = stop.maxPassengers;\n        limitingStop = stop;\n      }\n    }\n    \n    // If we couldn't find a limiting stop, return null\n    if (!limitingStop) {\n      return {\n        maxPassengers: 0,\n        maxPassengerWeight: 0,\n        requiredFuel: 0,\n        limitingWaypoint: null\n      };\n    }\n    \n    // Return the route's maximum capacity, limited by the most restrictive stop\n    return {\n      maxPassengers: minPassengers,\n      maxPassengerWeight: minPassengers * this.config.passengerWeight,\n      requiredFuel: fuelByStop[0].requiredFuel, // Fuel needed at first stop\n      limitingWaypoint: limitingStop.waypoint,\n      limitingStop\n    };\n  }\n  \n  /**\n   * Format time in hours to HH:MM format\n   * @param {number} timeHours - Time in decimal hours\n   * @returns {string} Formatted time string\n   */\n  formatTime(timeHours) {\n    if (typeof timeHours !== 'number' || timeHours < 0) {\n      return '00:00';\n    }\n    \n    const hours = Math.floor(timeHours);\n    const minutes = Math.floor((timeHours - hours) * 60);\n    \n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n  }\n}\n\nexport default EnhancedFuelCalculator;","/**\n * Fuel Calculation Modules\n * \n * This file exports the enhanced fuel calculation modules\n * and provides a simple interface for using them.\n */\n\nimport EnhancedFuelCalculator from './EnhancedFuelCalculator';\n\n// Create and export a default instance\nconst enhancedFuelCalculator = new EnhancedFuelCalculator();\n\nexport {\n  EnhancedFuelCalculator\n};\n\nexport default enhancedFuelCalculator;","/**\n * FuelIntegration.js\n * \n * This module integrates the enhanced fuel calculator with the existing\n * fuel calculation system in the Fast Planner application.\n */\n\nimport enhancedFuelCalculator from './index';\n\n/**\n * Initialize the fuel calculator with the application's settings\n * @param {Object} settings - Application settings\n */\nexport function initializeFuelCalculator(settings) {\n  if (!settings) return;\n  \n  console.log('FuelIntegration: Initializing fuel calculator with settings:', settings);\n  \n  enhancedFuelCalculator.updateConfig({\n    passengerWeight: settings.passengerWeight || 220,\n    taxiFuel: settings.taxiFuel || 50,\n    contingencyFuelPercent: settings.contingencyFuelPercent || 10,\n    reserveFuel: settings.reserveFuel || 500,\n    deckTimePerStop: settings.deckTimePerStop || 5,\n    deckFuelFlow: settings.deckFuelFlow || 400\n  });\n}\n\n/**\n * Calculate fuel requirements using the enhanced calculator\n * @param {Array} waypoints - Array of waypoint objects\n * @param {Object} aircraft - Aircraft data\n * @param {Object} weather - Weather data\n * @param {Object} settings - Additional calculation settings\n * @returns {Object} Fuel calculation results\n */\nexport function calculateFuelRequirements(waypoints, aircraft, weather, settings = {}) {\n  // Check if we have valid input data\n  if (!waypoints || waypoints.length < 2 || !aircraft) {\n    console.error('FuelIntegration: Missing required data for calculation');\n    return null;\n  }\n  \n  // Log the calculation request\n  console.log('FuelIntegration: Calculating fuel requirements:', {\n    waypoints: waypoints.length,\n    aircraft: aircraft.registration,\n    weather\n  });\n  \n  // Update calculator settings if provided\n  if (settings) {\n    enhancedFuelCalculator.updateConfig(settings);\n  }\n  \n  // Perform the calculation\n  const results = enhancedFuelCalculator.calculateFuelRequirements({\n    waypoints,\n    aircraft,\n    weather,\n    cargoWeight: settings.cargoWeight || 0\n  });\n  \n  // Log if calculation failed\n  if (!results) {\n    console.error('FuelIntegration: Calculation failed, no results returned');\n    return null;\n  }\n  \n  // Convert the enhanced results to the format expected by the existing code\n  return convertToExistingFormat(results, waypoints, aircraft);\n}\n\n/**\n * Convert the enhanced fuel calculation results to the format expected\n * by the existing code in FastPlannerApp.jsx\n * @param {Object} results - Enhanced fuel calculation results\n * @param {Array} waypoints - Original waypoints array\n * @param {Object} aircraft - Aircraft data\n * @returns {Object} Results in the existing format\n */\nfunction convertToExistingFormat(results, waypoints, aircraft) {\n  // Extract needed values from results\n  const { legResults, auxiliaryFuel, fuelByStop, maxCapacity } = results;\n  \n  // Create legs array in the format expected by RouteCalculator\n  const legs = legResults.legDetails.map((leg, index) => {\n    const formattedTime = formatTime(leg.flightTimeHours);\n    \n    return {\n      from: leg.from,\n      to: leg.to,\n      distance: leg.distance.toFixed(1),\n      time: leg.flightTimeHours,\n      timeFormatted: formattedTime,\n      fuel: leg.fuelRequired,\n      groundSpeed: leg.groundSpeed,\n      headwind: leg.windEffect,\n      source: 'enhanced'\n    };\n  });\n  \n  // Create wind data object if applicable\n  const windData = results.weather?.windSpeed > 0 ? {\n    windSpeed: results.weather.windSpeed,\n    windDirection: results.weather.windDirection,\n    avgHeadwind: legResults.legDetails.reduce((sum, leg) => sum + leg.windEffect, 0) / legResults.legDetails.length\n  } : null;\n  \n  // Format total time\n  const totalTimeFormatted = formatTime(legResults.totalTime);\n  \n  // Build the result object\n  return {\n    // Distance and time fields\n    totalDistance: legResults.totalDistance.toFixed(1),\n    timeHours: legResults.totalTime,\n    estimatedTime: totalTimeFormatted,\n    \n    // Fuel calculations\n    fuelRequired: legResults.totalTripFuel,\n    tripFuel: legResults.totalTripFuel,\n    deckFuel: auxiliaryFuel.deckFuel,\n    contingencyFuel: auxiliaryFuel.contingencyFuel,\n    taxiFuel: auxiliaryFuel.taxiFuel,\n    reserveFuel: auxiliaryFuel.reserveFuel,\n    totalFuel: legResults.totalTripFuel + auxiliaryFuel.total,\n    \n    // Flight parameters\n    deckTimeMinutes: auxiliaryFuel.deckTimePerStop * auxiliaryFuel.intermediateStops,\n    totalTimeHours: legResults.totalTime + (auxiliaryFuel.deckTimePerStop * auxiliaryFuel.intermediateStops / 60),\n    totalTimeFormatted, // Already formatted above\n    \n    // Weight calculations\n    dryOperatingWeight: aircraft.emptyWeight,\n    maxTakeoffWeight: aircraft.maxTakeoffWeight,\n    usefulLoad: aircraft.maxFuel + (aircraft.maxPassengers || 19) * results.config.passengerWeight,\n    usableLoad: aircraft.maxTakeoffWeight - aircraft.emptyWeight - (legResults.totalTripFuel + auxiliaryFuel.total),\n    \n    // Passenger calculation\n    maxPassengers: aircraft.maxPassengers || 19,\n    maxPassengersByWeight: maxCapacity.maxPassengers,\n    calculatedPassengers: maxCapacity.maxPassengers,\n    \n    // Aircraft data reference\n    aircraft,\n    \n    // Route data\n    legs,\n    numStops: waypoints.length - 1,\n    intermediateStops: auxiliaryFuel.intermediateStops,\n    \n    // Wind data\n    windAdjusted: windData !== null,\n    windData,\n    \n    // Reference to full enhanced results\n    enhancedResults: results,\n    \n    // Flag to indicate this came from the enhanced calculator\n    source: 'enhanced-fuel-calculator'\n  };\n}\n\n/**\n * Format time in hours to HH:MM format\n * @param {number} timeHours - Time in decimal hours\n * @returns {string} Formatted time string\n */\nfunction formatTime(timeHours) {\n  if (typeof timeHours !== 'number' || timeHours < 0) {\n    return '00:00';\n  }\n  \n  const hours = Math.floor(timeHours);\n  const minutes = Math.floor((timeHours - hours) * 60);\n  \n  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n}\n\nexport default {\n  initializeFuelCalculator,\n  calculateFuelRequirements,\n  calculator: enhancedFuelCalculator\n};","/**\n * WindCalculations.js\n * \n * Module for calculating wind effects on flight routes\n * Handles headwind/tailwind components, crosswind, and effects on groundspeed\n */\n\n/**\n * Convert degrees to radians\n * @param {number} degrees - Angle in degrees\n * @returns {number} Angle in radians\n */\nconst degreesToRadians = (degrees) => {\n  return degrees * Math.PI / 180;\n};\n\n/**\n * Convert radians to degrees\n * @param {number} radians - Angle in radians\n * @returns {number} Angle in degrees\n */\nconst radiansToDegrees = (radians) => {\n  return radians * 180 / Math.PI;\n};\n\n/**\n * Calculate the relative angle between two compass bearings\n * @param {number} course - Aircraft course in degrees (0-360)\n * @param {number} windDirection - Direction wind is coming FROM in degrees (0-360)\n * @returns {number} Angle between course and wind in degrees (0-180)\n */\nconst calculateWindAngle = (course, windDirection) => {\n  // Convert wind direction from meteorological (direction wind is coming FROM)\n  // to mathematical (direction wind is going TO)\n  const windDirectionMath = (windDirection + 180) % 360;\n  \n  // Calculate the absolute difference between the two angles\n  let angleDiff = Math.abs(course - windDirectionMath);\n  \n  // Ensure the result is the smaller angle (max 180 degrees)\n  if (angleDiff > 180) {\n    angleDiff = 360 - angleDiff;\n  }\n  \n  return angleDiff;\n};\n\n/**\n * Calculate the headwind/tailwind component\n * Positive value = headwind, Negative value = tailwind\n * @param {number} windSpeed - Wind speed in knots\n * @param {number} course - Aircraft course in degrees (0-360)\n * @param {number} windDirection - Direction wind is coming FROM in degrees (0-360)\n * @returns {number} Headwind/tailwind component in knots\n */\nconst calculateHeadwindComponent = (windSpeed, course, windDirection) => {\n  // Convert wind direction from meteorological to mathematical\n  const windDirectionMath = (windDirection + 180) % 360;\n  \n  // Convert to radians\n  const courseRad = degreesToRadians(course);\n  const windRad = degreesToRadians(windDirectionMath);\n  \n  // Calculate headwind/tailwind component\n  // Note: The negative sign is because a headwind (wind coming from ahead)\n  // means the angle diff is near 180°, which gives a negative cosine\n  return -windSpeed * Math.cos(courseRad - windRad);\n};\n\n/**\n * Calculate the crosswind component\n * @param {number} windSpeed - Wind speed in knots\n * @param {number} course - Aircraft course in degrees (0-360)\n * @param {number} windDirection - Direction wind is coming FROM in degrees (0-360)\n * @returns {number} Crosswind component in knots (positive = from right, negative = from left)\n */\nconst calculateCrosswindComponent = (windSpeed, course, windDirection) => {\n  // Convert wind direction from meteorological to mathematical\n  const windDirectionMath = (windDirection + 180) % 360;\n  \n  // Convert to radians\n  const courseRad = degreesToRadians(course);\n  const windRad = degreesToRadians(windDirectionMath);\n  \n  // Calculate crosswind component\n  return windSpeed * Math.sin(courseRad - windRad);\n};\n\n/**\n * Calculate the ground speed of an aircraft given airspeed and wind\n * @param {number} airspeed - Aircraft's airspeed in knots\n * @param {number} course - Aircraft's course in degrees (0-360)\n * @param {number} windSpeed - Wind speed in knots\n * @param {number} windDirection - Direction wind is coming FROM in degrees (0-360)\n * @returns {number} Ground speed in knots\n */\nconst calculateGroundSpeed = (airspeed, course, windSpeed, windDirection) => {\n  // Calculate headwind/tailwind component\n  const headwindComponent = calculateHeadwindComponent(windSpeed, course, windDirection);\n  \n  // Calculate crosswind component\n  const crosswindComponent = calculateCrosswindComponent(windSpeed, course, windDirection);\n  \n  // Calculate ground speed\n  // Ground speed = airspeed - headwind component\n  // (headwind is positive, so we subtract)\n  const groundSpeed = airspeed - headwindComponent;\n  \n  // We include a small correction for crosswind effect on groundspeed\n  // This is a simplification, but provides a more accurate estimate\n  const crosswindCorrection = Math.abs(crosswindComponent) > 0 \n    ? -0.02 * Math.pow(crosswindComponent, 2) / airspeed \n    : 0;\n  \n  return groundSpeed + crosswindCorrection;\n};\n\n/**\n * Calculate the course angle between two waypoints\n * @param {Object} from - Starting waypoint with lat, lon properties\n * @param {Object} to - Ending waypoint with lat, lon properties\n * @returns {number} Course in degrees (0-360)\n */\nconst calculateCourse = (from, to) => {\n  const fromLat = degreesToRadians(from.lat);\n  const fromLon = degreesToRadians(from.lon);\n  const toLat = degreesToRadians(to.lat);\n  const toLon = degreesToRadians(to.lon);\n  \n  const y = Math.sin(toLon - fromLon) * Math.cos(toLat);\n  const x = Math.cos(fromLat) * Math.sin(toLat) -\n            Math.sin(fromLat) * Math.cos(toLat) * Math.cos(toLon - fromLon);\n  \n  let bearing = radiansToDegrees(Math.atan2(y, x));\n  bearing = (bearing + 360) % 360; // Normalize to 0-360\n  \n  return bearing;\n};\n\n/**\n * Calculate flight time with wind adjustments\n * @param {number} distance - Distance in nautical miles\n * @param {number} airspeed - Aircraft airspeed in knots\n * @param {number} course - Course in degrees (0-360)\n * @param {number} windSpeed - Wind speed in knots\n * @param {number} windDirection - Direction wind is coming FROM in degrees (0-360)\n * @returns {number} Flight time in hours\n */\nconst calculateWindAdjustedTime = (distance, airspeed, course, windSpeed, windDirection) => {\n  // If there's no wind, use simple calculation\n  if (windSpeed === 0) {\n    return distance / airspeed;\n  }\n  \n  // Calculate ground speed with wind adjustment\n  const groundSpeed = calculateGroundSpeed(airspeed, course, windSpeed, windDirection);\n  \n  // Calculate time (hours) = distance / groundSpeed\n  return distance / groundSpeed;\n};\n\n/**\n * Calculate additional fuel needed due to wind conditions\n * @param {number} baseFuelBurn - Base fuel burn rate in lbs/hr\n * @param {number} time - Flight time in hours\n * @param {number} headwindComponent - Headwind component in knots\n * @returns {number} Additional fuel in lbs\n */\nconst calculateWindAdjustedFuel = (baseFuelBurn, time, headwindComponent) => {\n  // In a headwind, aircraft typically burns slightly more fuel\n  // This is a simplified model - in reality, the relationship is complex\n  // For positive headwind values (true headwind), we increase fuel burn slightly\n  let adjustmentFactor = 1.0;\n  \n  if (headwindComponent > 0) {\n    // Increase fuel burn by up to 5% for strong headwinds\n    adjustmentFactor = 1.0 + Math.min(headwindComponent / 100, 0.05);\n  } else if (headwindComponent < 0) {\n    // Decrease fuel burn by up to 3% for tailwinds\n    // Tailwind component is negative, so we add its absolute value\n    adjustmentFactor = 1.0 - Math.min(Math.abs(headwindComponent) / 150, 0.03);\n  }\n  \n  return baseFuelBurn * time * adjustmentFactor;\n};\n\n/**\n * Calculate leg information with wind adjustments\n * @param {Object} from - Starting waypoint with lat, lon properties\n * @param {Object} to - Ending waypoint with lat, lon properties\n * @param {number} distance - Distance in nautical miles\n * @param {Object} aircraft - Aircraft object with airspeed and fuelBurn properties\n * @param {Object} weather - Weather object with windSpeed and windDirection properties\n * @returns {Object} Object with time, fuel, headwind, groundSpeed properties\n */\nconst calculateLegWithWind = (from, to, distance, aircraft, weather) => {\n  // Default values if data is missing\n  const airspeed = aircraft?.cruiseSpeed || 145;\n  const fuelBurn = aircraft?.fuelBurn || 1100;\n  const windSpeed = weather?.windSpeed || 0;\n  const windDirection = weather?.windDirection || 0;\n  \n  // Calculate course between waypoints\n  const course = calculateCourse(from, to);\n  \n  // Calculate headwind component\n  const headwindComponent = calculateHeadwindComponent(windSpeed, course, windDirection);\n  \n  // Calculate crosswind component\n  const crosswindComponent = calculateCrosswindComponent(windSpeed, course, windDirection);\n  \n  // Calculate groundspeed\n  const groundSpeed = calculateGroundSpeed(airspeed, course, windSpeed, windDirection);\n  \n  // Calculate time with wind adjustment\n  const time = calculateWindAdjustedTime(distance, airspeed, course, windSpeed, windDirection);\n  \n  // Calculate fuel with wind adjustment\n  const fuel = calculateWindAdjustedFuel(fuelBurn, time, headwindComponent);\n  \n  return {\n    time,\n    fuel,\n    headwindComponent,\n    crosswindComponent,\n    groundSpeed,\n    course\n  };\n};\n\nexport {\n  calculateWindAngle,\n  calculateHeadwindComponent,\n  calculateCrosswindComponent,\n  calculateGroundSpeed,\n  calculateCourse,\n  calculateWindAdjustedTime,\n  calculateWindAdjustedFuel,\n  calculateLegWithWind\n};\n","/**\n * ComprehensiveFuelCalculator.js\n *\n * This module orchestrates all fuel calculations for the Fast Planner,\n * combining results for both the top fuel display and the stop cards.\n */\n\nimport FuelIntegration from './FuelIntegration';\nimport StopCardCalculator from '../flight/StopCardCalculator';\n\n/**\n * Calculate all necessary fuel data for the flight plan.\n *\n * @param {Array} waypoints - Array of waypoint objects.\n * @param {Object} selectedAircraft - Selected aircraft object with performance data.\n * @param {Object} flightSettings - Flight settings object.\n * @param {Object} weather - Weather data object.\n * @param {Object} routeStats - Current route statistics (may be needed by StopCardCalculator).\n * @returns {Object} An object containing enhanced fuel results and stop card data.\n */\nconst calculateAllFuelData = (waypoints, selectedAircraft, flightSettings, weather, routeStats) => {\n  // Ensure required inputs are available\n  if (!waypoints || waypoints.length < 2 || !selectedAircraft || !flightSettings) {\n    console.warn('ComprehensiveFuelCalculator: Missing required inputs for calculation.');\n    return { enhancedResults: null, stopCards: [] };\n  }\n\n  console.log('ComprehensiveFuelCalculator: Starting comprehensive fuel calculation with settings:', flightSettings);\n\n  // Ensure all settings are properly converted to numeric values\n  const numericSettings = {\n    passengerWeight: Number(flightSettings.passengerWeight || 0),\n    taxiFuel: Number(flightSettings.taxiFuel || 0),\n    contingencyFuelPercent: Number(flightSettings.contingencyFuelPercent || 0),\n    reserveFuel: Number(flightSettings.reserveFuel || 0),\n    deckTimePerStop: Number(flightSettings.deckTimePerStop || 0),\n    deckFuelFlow: Number(flightSettings.deckFuelFlow || 0),\n    cargoWeight: Number(flightSettings.cargoWeight || 0)\n  };\n\n  console.log('ComprehensiveFuelCalculator: Using numeric settings:', numericSettings);\n\n  // 1. Calculate enhanced fuel data for the top display\n  const enhancedResults = FuelIntegration.calculateFuelRequirements(\n    waypoints,\n    selectedAircraft,\n    weather,\n    numericSettings\n  );\n\n  // 2. Calculate stop card data with the same numeric settings\n  const stopCards = StopCardCalculator.calculateStopCards(\n    waypoints,\n    // StopCardCalculator also uses routeStats, pass it along\n    routeStats,\n    selectedAircraft,\n    weather,\n    numericSettings\n  );\n\n  console.log('ComprehensiveFuelCalculator: Calculation complete.', {\n    hasEnhancedResults: enhancedResults ? true : false,\n    stopCardCount: stopCards.length\n  });\n\n  // Return both sets of results\n  return {\n    enhancedResults: enhancedResults,\n    stopCards: stopCards\n  };\n};\n\nexport default {\n  calculateAllFuelData,\n};\n","/**\n * MapManager.js\n * \n * Handles map initialization, event setup, and basic map interactions\n */\n\nclass MapManager {\n  constructor() {\n    this.map = null;\n    this.mapboxToken = 'pk.eyJ1IjoiZGlya3N0ZXIxMDEiLCJhIjoiY204YW9mdm4yMTliMTJscXVnaXRqNmptNyJ9.VDLt_kE5BnAV8S4vXjFMlg';\n    this._isLoaded = false; // Internal flag to track load state\n    this._loadCallbacks = []; // Queue for callbacks added before load\n  }\n\n  /**\n   * Initialize the MapBox map\n   * @param {string} containerId - The DOM element ID for the map container\n   * @returns {Promise} - Resolves with the map instance immediately after creation\n   */\n  initializeMap(containerId) {\n    return new Promise((resolve, reject) => {\n      try {\n        if (!window.mapboxgl) {\n          reject(new Error('Mapbox GL JS not loaded'));\n          return;\n        }\n        \n        const mapContainer = document.getElementById(containerId);\n        if (!mapContainer) {\n          reject(new Error('Map container element not found'));\n          return;\n        }\n        \n        // Set Mapbox access token\n        window.mapboxgl.accessToken = this.mapboxToken;\n        \n        console.log('Creating MapBox instance...');\n        \n        // Create map instance with simpler style\n        this.map = new window.mapboxgl.Map({\n          container: containerId,\n          style: 'mapbox://styles/mapbox/dark-v11',\n          center: [-90.5, 27.5], // Gulf of Mexico center\n          zoom: 6,\n          attributionControl: false,\n          preserveDrawingBuffer: true\n        });\n        \n        console.log('Map instance created successfully');\n        \n        // Navigation controls removed to clean up UI\n\n        this._isLoaded = false; // Reset flag on initialization\n        this._loadCallbacks = []; // Clear any previous callbacks\n\n        // Attach the single 'load' event listener\n        this.map.once('load', () => {\n          console.log('Map loaded event fired');\n          this._isLoaded = true; // Set the internal flag\n          \n          // Add the grid first\n          this.addGridToMap(); \n          \n          // Execute and clear any pending callbacks\n          console.log(`Executing ${this._loadCallbacks.length} queued onMapLoaded callbacks.`);\n          this._loadCallbacks.forEach(cb => {\n            try {\n              cb();\n            } catch (e) {\n              console.error(\"Error executing onMapLoaded callback:\", e);\n            }\n          });\n          this._loadCallbacks = []; \n        });\n        \n        // Handle map errors\n        this.map.on('error', (e) => {\n          console.error('MapBox error:', e);\n          reject(e); \n        });\n\n        // Resolve the promise immediately after map instance creation\n        resolve(this.map); \n\n      } catch (error) {\n        console.error('Error initializing map:', error);\n        reject(error);\n      }\n    });\n  }\n  \n  /**\n   * Load the necessary scripts for the map\n   * @returns {Promise} - Resolves when all scripts are loaded\n   */\n  loadScripts() {\n    return new Promise((resolve, reject) => {\n      try {\n        // Create and load MapBox script\n        const mapboxScript = document.createElement('script');\n        mapboxScript.src = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js';\n        mapboxScript.async = true;\n        document.body.appendChild(mapboxScript);\n        \n        // Create and load MapBox CSS\n        const mapboxCss = document.createElement('link');\n        mapboxCss.href = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css';\n        mapboxCss.rel = 'stylesheet';\n        document.head.appendChild(mapboxCss);\n        \n        // Create and load Turf.js\n        const turfScript = document.createElement('script');\n        turfScript.src = 'https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js';\n        turfScript.async = true;\n        document.body.appendChild(turfScript);\n        \n        // Check if scripts are loaded\n        const checkScriptsLoaded = setInterval(() => {\n          if (window.mapboxgl && window.turf) {\n            clearInterval(checkScriptsLoaded);\n            console.log('MapBox and Turf scripts loaded successfully');\n            resolve();\n          }\n        }, 100);\n        \n        // Set a timeout to avoid infinite waiting\n        setTimeout(() => {\n          if (!window.mapboxgl || !window.turf) {\n            clearInterval(checkScriptsLoaded);\n            reject(new Error('Timeout loading map scripts'));\n          }\n        }, 10000);\n      } catch (error) {\n        console.error('Error loading map scripts:', error);\n        reject(error);\n      }\n    });\n  }\n  \n  /**\n   * Add grid lines to map\n   */\n  addGridToMap() {\n    const map = this.map;\n    if (!map) return;\n    \n    console.log('Adding grid to map (called from map load event)');\n    \n    try {\n      // Map is guaranteed to be loaded here as this is called from the 'load' event handler\n      this._addSimpleGrid(); \n    } catch (error) {\n      console.error('Error adding grid to map:', error);\n    }\n  }\n  \n  /**\n   * Add a simple grid to the map\n   * @private\n   */\n  _addSimpleGrid() {\n    const map = this.map;\n    if (!map) return;\n    \n    try {\n      console.log('Adding simple grid to map');\n      // No need to double-check map.loaded() here\n      this._addSimpleGridSafely();\n    } catch (error) {\n      console.error('Error in _addSimpleGrid:', error);\n    }\n  }\n  \n  /**\n   * Add grid with additional safety checks\n   * @private\n   */\n  _addSimpleGridSafely() {\n    const map = this.map;\n    if (!map) {\n      console.error('Map is null in _addSimpleGridSafely');\n      return;\n    }\n    \n    try {\n      console.log('Creating grid data');\n      // Create grid with simple lines\n      const latLines = [];\n      const longLines = [];\n      \n      // Create latitude lines every 1 degree from 24° to 31° N\n      for (let lat = 24; lat <= 31; lat++) {\n        const line = {\n          type: 'Feature',\n          properties: {\n            name: `${lat}°N`\n          },\n          geometry: {\n            type: 'LineString',\n            coordinates: [\n              [-98, lat], // Western Gulf\n              [-83, lat]  // Eastern Gulf\n            ]\n          }\n        };\n        latLines.push(line);\n      }\n      \n      // Create longitude lines every 1 degree from -98° to -83° W\n      for (let long = -98; long <= -83; long++) {\n        const line = {\n          type: 'Feature',\n          properties: {\n            name: `${Math.abs(long)}°W`\n          },\n          geometry: {\n            type: 'LineString',\n            coordinates: [\n              [long, 24], // Southern Gulf\n              [long, 31]  // Northern Gulf\n            ]\n          }\n        };\n        longLines.push(line);\n      }\n      \n      // Using separate try/catch blocks for each operation for maximum safety\n      \n      // Remove existing layers first\n      try {\n        console.log('Checking for existing grid layers');\n        if (map.getLayer('grid-labels')) {\n          console.log('Removing grid-labels layer');\n          map.removeLayer('grid-labels');\n        }\n      } catch (e) {\n        console.warn('Could not remove grid-labels layer:', e.message);\n      }\n      \n      try {\n        if (map.getLayer('longitude-lines')) {\n          console.log('Removing longitude-lines layer');\n          map.removeLayer('longitude-lines');\n        }\n      } catch (e) {\n        console.warn('Could not remove longitude-lines layer:', e.message);\n      }\n      \n      try {\n        if (map.getLayer('latitude-lines')) {\n          console.log('Removing latitude-lines layer');\n          map.removeLayer('latitude-lines');\n        }\n      } catch (e) {\n        console.warn('Could not remove latitude-lines layer:', e.message);\n      }\n      \n      try {\n        if (map.getSource('grid-lines')) {\n          console.log('Removing grid-lines source');\n          map.removeSource('grid-lines');\n        }\n      } catch (e) {\n        console.warn('Could not remove grid-lines source:', e.message);\n      }\n      \n      // Add source\n      try {\n        console.log('Adding grid-lines source');\n        map.addSource('grid-lines', {\n          type: 'geojson',\n          data: {\n            type: 'FeatureCollection',\n            features: [...latLines, ...longLines]\n          }\n        });\n      } catch (e) {\n        console.error('Error adding grid-lines source:', e.message);\n        return; // Stop if we can't add the source\n      }\n      \n      // Add latitude lines layer\n      try {\n        console.log('Adding latitude-lines layer');\n        map.addLayer({\n          id: 'latitude-lines',\n          type: 'line',\n          source: 'grid-lines',\n          filter: ['all', ['has', 'name'], ['match', ['slice', ['get', 'name'], -1], ['N'], true, false]],\n          paint: {\n            'line-color': 'rgba(255, 255, 255, 0.3)',\n            'line-width': 1,\n            'line-dasharray': [3, 3]\n          }\n        });\n      } catch (e) {\n        console.error('Error adding latitude-lines layer:', e.message);\n      }\n      \n      // Add longitude lines layer\n      try {\n        console.log('Adding longitude-lines layer');\n        map.addLayer({\n          id: 'longitude-lines',\n          type: 'line',\n          source: 'grid-lines',\n          filter: ['all', ['has', 'name'], ['match', ['slice', ['get', 'name'], -1], ['W'], true, false]],\n          paint: {\n            'line-color': 'rgba(255, 255, 255, 0.3)',\n            'line-width': 1,\n            'line-dasharray': [3, 3]\n          }\n        });\n      } catch (e) {\n        console.error('Error adding longitude-lines layer:', e.message);\n      }\n      \n      // Add grid labels layer\n      try {\n        console.log('Adding grid-labels layer');\n        map.addLayer({\n          id: 'grid-labels',\n          type: 'symbol',\n          source: 'grid-lines',\n          filter: ['has', 'name'],\n          layout: {\n            'text-field': ['get', 'name'],\n            'text-size': 12,\n            'text-offset': [0, -1],\n            'text-variable-anchor': ['top', 'bottom', 'left', 'right'],\n            'text-radial-offset': 0.5,\n            'text-justify': 'auto'\n          },\n          paint: {\n            'text-color': 'rgba(255, 255, 255, 0.5)',\n            'text-halo-color': 'rgba(0, 0, 0, 0.5)',\n            'text-halo-width': 1\n          }\n        });\n      } catch (e) {\n        console.error('Error adding grid-labels layer:', e.message);\n      }\n      \n      console.log('Grid added successfully');\n    } catch (error) {\n      console.error('Error in _addSimpleGridSafely:', error);\n    }\n  }\n  \n  /**\n   * Fit map to the given coordinates\n   * @param {Array} bounds - Array of [lng, lat] coordinates\n   */\n  fitMapToBounds(bounds) {\n    if (!this.map) return;\n    \n    this.map.fitBounds(bounds, {\n      padding: 50,\n      maxZoom: 10\n    });\n  }\n  \n  /**\n   * Get the current map instance\n   * @returns {Object} - The MapBox map instance\n   */\n  getMap() {\n    return this.map;\n  }\n  \n  /**\n   * Check if the map is loaded using our internal flag\n   * @returns {boolean} - True if the map's load event has fired\n   */\n  isMapLoaded() {\n    // Primarily rely on our internal flag, but check map existence too\n    return this._isLoaded && !!this.map; \n  }\n  \n  /**\n   * Add a callback to be executed once the map is loaded.\n   * If the map is already loaded, executes immediately.\n   * @param {Function} callback - Function to call when the map is loaded\n   */\n  onMapLoaded(callback) {\n    if (this.isMapLoaded()) {\n      // Map is already loaded, execute immediately\n      console.log(\"onMapLoaded: Map already loaded, executing callback immediately.\");\n      try {\n        callback();\n      } catch (e) {\n         console.error(\"Error executing immediate onMapLoaded callback:\", e);\n      }\n    } else if (this.map) {\n      // Map exists but not loaded, queue the callback\n      console.log(\"onMapLoaded: Map not loaded, queuing callback.\");\n      this._loadCallbacks.push(callback);\n    } else {\n       console.error(\"onMapLoaded called before map instance exists.\");\n    }\n  }\n  \n  /**\n   * Set up route dragging functionality\n   * @param {Function} onRoutePointAdded - Callback when a new point is added via drag\n   */\n  setupRouteDragging(onRoutePointAdded) {\n    const map = this.map;\n    if (!map) return;\n\n    console.log('Setting up route dragging functionality');\n\n    let isDragging = false;\n    let draggedLineCoordinates = [];\n    let originalLineCoordinates = [];\n    let dragStartPoint = null;\n    let closestPointIndex = -1;\n    let dragLineSource = null;\n\n    // Function to add the temporary drag line\n    const addDragLine = (coordinates) => {\n      try {\n        if (map.getSource('drag-line')) {\n          map.removeLayer('drag-line');\n          map.removeSource('drag-line');\n        }\n        \n        map.addSource('drag-line', {\n          'type': 'geojson',\n          'data': {\n            'type': 'Feature',\n            'properties': {},\n            'geometry': {\n              'type': 'LineString',\n              'coordinates': coordinates\n            }\n          }\n        });\n        \n        map.addLayer({\n          'id': 'drag-line',\n          'type': 'line',\n          'source': 'drag-line',\n          'layout': {\n            'line-join': 'round',\n            'line-cap': 'round'\n          },\n          'paint': {\n            'line-color': '#ff0000', // Red for the dragging line\n            'line-width': 4,\n            'line-dasharray': [2, 1] // Dashed line for the temp route\n          }\n        });\n\n        dragLineSource = map.getSource('drag-line');\n      } catch (error) {\n        console.error('Error adding drag line:', error);\n      }\n    };\n\n    // Helper to find closest point on the line and the segment it belongs to\n    const findClosestPointOnLine = (mouseLngLat, mousePoint) => {\n      try {\n        if (!map.getSource('route')) return null;\n        \n        // First check if the mouse is over a route feature using rendered features\n        // This is more accurate than calculating distance and works better for user interaction\n        const routeFeatures = map.queryRenderedFeatures(mousePoint, { layers: ['route'] });\n        const isMouseOverRoute = routeFeatures && routeFeatures.length > 0;\n        \n        const routeSource = map.getSource('route');\n        if (!routeSource || !routeSource._data) return null;\n        \n        const coordinates = routeSource._data.geometry.coordinates;\n        if (!coordinates || coordinates.length < 2) return null;\n        \n        let minDistance = Infinity;\n        let closestPoint = null;\n        let segmentIndex = -1;\n        \n        // Check each segment of the line\n        for (let i = 0; i < coordinates.length - 1; i++) {\n          const line = window.turf.lineString([coordinates[i], coordinates[i + 1]]);\n          const point = window.turf.point([mouseLngLat.lng, mouseLngLat.lat]);\n          const snapped = window.turf.nearestPointOnLine(line, point);\n          \n          if (snapped.properties.dist < minDistance) {\n            minDistance = snapped.properties.dist;\n            closestPoint = snapped.geometry.coordinates;\n            segmentIndex = i;\n          }\n        }\n        \n        // Convert distance to nautical miles for easy comparison\n        const distanceNM = window.turf.distance(\n          window.turf.point([mouseLngLat.lng, mouseLngLat.lat]),\n          window.turf.point(closestPoint),\n          { units: 'nauticalmiles' }\n        );\n        \n        // If mouse is directly over the route (pixel-perfect), return regardless of distance\n        // Otherwise use a more generous distance threshold (0.5 nautical miles)\n        const maxDistanceThreshold = 0.5; // More generous distance in nautical miles\n        \n        if (isMouseOverRoute || distanceNM < maxDistanceThreshold) {\n          return { \n            point: closestPoint, \n            index: segmentIndex,\n            distance: distanceNM,\n            isDirectlyOver: isMouseOverRoute\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.error('Error finding closest point on line:', error);\n        return null;\n      }\n    };\n\n    // Setup mousedown event for starting the drag\n    map.on('mousedown', (e) => {\n      // Skip if no route or if clicking on a waypoint\n      if (!map.getSource('route')) return;\n      \n      // Don't start drag if right-click\n      if (e.originalEvent.button === 2) return;\n      \n      // Check for platform markers and don't start drag if clicked on one\n      const platformFeatures = map.queryRenderedFeatures(e.point, { layers: ['platforms-layer'] });\n      if (platformFeatures.length > 0) return;\n      \n      // Find the closest point on the route line\n      const mousePos = e.lngLat;\n      const closestInfo = findClosestPointOnLine(mousePos, e.point);\n      \n      // If mouse is directly over the route or within distance threshold\n      if (closestInfo) {\n        console.log('Starting route drag operation at segment:', closestInfo.index, \n                   'Distance:', closestInfo.distance.toFixed(2) + ' nm',\n                   'Directly over route:', closestInfo.isDirectlyOver);\n        \n        // Get the original route coordinates\n        const routeSource = map.getSource('route');\n        if (!routeSource || !routeSource._data) return;\n        originalLineCoordinates = [...routeSource._data.geometry.coordinates];\n        \n        // Start dragging\n        isDragging = true;\n        dragStartPoint = closestInfo.point;\n        closestPointIndex = closestInfo.index;\n        \n        // Make a copy of the coordinates for dragging\n        draggedLineCoordinates = [...originalLineCoordinates];\n        \n        // Insert a new point at the drag location, right after the closest segment start\n        draggedLineCoordinates.splice(\n          closestPointIndex + 1, \n          0, \n          closestInfo.point\n        );\n        \n        // Add the temporary drag line\n        addDragLine(draggedLineCoordinates);\n        \n        // Hide the original route and glow during dragging\n        map.setLayoutProperty('route', 'visibility', 'none');\n        if (map.getLayer('route-glow')) {\n          map.setLayoutProperty('route-glow', 'visibility', 'none');\n        }\n        \n        // Change cursor to grabbing\n        map.getCanvas().style.cursor = 'grabbing';\n        \n        // Prevent default behavior\n        e.preventDefault();\n      }\n    });\n\n    // Set up route hover effect to make it clear it can be dragged\n    map.on('mousemove', (e) => {\n      if (isDragging) {\n        // Update the position of the dragged point\n        draggedLineCoordinates[closestPointIndex + 1] = [e.lngLat.lng, e.lngLat.lat];\n        \n        // Update the drag line\n        if (dragLineSource) {\n          dragLineSource.setData({\n            'type': 'Feature',\n            'properties': {},\n            'geometry': {\n              'type': 'LineString',\n              'coordinates': draggedLineCoordinates\n            }\n          });\n        }\n      } else {\n        // Check if mouse is over the route when not dragging\n        const closestInfo = findClosestPointOnLine(e.lngLat, e.point);\n        \n        if (closestInfo && closestInfo.isDirectlyOver) {\n          // Change cursor to indicate draggable route\n          map.getCanvas().style.cursor = 'pointer';\n        } else if (map.getCanvas().style.cursor === 'pointer') {\n          // Reset cursor if it was previously set by this handler\n          // (but don't reset if it might have been set by platform hover)\n          const platformFeatures = map.queryRenderedFeatures(e.point, { layers: ['platforms-layer'] });\n          if (platformFeatures.length === 0) {\n            map.getCanvas().style.cursor = '';\n          }\n        }\n      }\n    });\n\n    // Setup mouseup for completing the drag\n    map.on('mouseup', (e) => {\n      if (!isDragging) return;\n      \n      // Clean up\n      isDragging = false;\n      \n      // Remove the temporary drag line\n      if (map.getSource('drag-line')) {\n        map.removeLayer('drag-line');\n        map.removeSource('drag-line');\n      }\n      \n      // Show the original route and glow again\n      map.setLayoutProperty('route', 'visibility', 'visible');\n      if (map.getLayer('route-glow')) {\n        map.setLayoutProperty('route-glow', 'visibility', 'visible');\n      }\n      \n      // Call the callback with the segment index and new point\n      if (onRoutePointAdded && typeof onRoutePointAdded === 'function') {\n        console.log('Route drag complete, adding new point at index:', closestPointIndex + 1);\n        onRoutePointAdded(closestPointIndex + 1, [e.lngLat.lng, e.lngLat.lat]);\n      }\n      \n      // Reset cursor\n      map.getCanvas().style.cursor = '';\n      \n      // Reset variables\n      draggedLineCoordinates = [];\n      originalLineCoordinates = [];\n      dragStartPoint = null;\n      closestPointIndex = -1;\n      dragLineSource = null;\n    });\n\n    // Cancel the drag operation if the mouse leaves the map\n    map.on('mouseout', () => {\n      if (!isDragging) return;\n      \n      console.log('Mouse left map area, canceling route drag');\n      \n      // Clean up\n      isDragging = false;\n      \n      // Remove the temporary drag line\n      if (map.getSource('drag-line')) {\n        map.removeLayer('drag-line');\n        map.removeSource('drag-line');\n      }\n      \n      // Show the original route and glow again\n      map.setLayoutProperty('route', 'visibility', 'visible');\n      if (map.getLayer('route-glow')) {\n        map.setLayoutProperty('route-glow', 'visibility', 'visible');\n      }\n      \n      // Reset cursor\n      map.getCanvas().style.cursor = '';\n      \n      // Reset variables\n      draggedLineCoordinates = [];\n      originalLineCoordinates = [];\n      dragStartPoint = null;\n      closestPointIndex = -1;\n      dragLineSource = null;\n    });\n  }\n}\n\nexport default MapManager;\n","/**\n * WaypointManager.js\n * \n * Handles waypoint creation, deletion, and manipulation\n */\n\nclass WaypointManager {\n  constructor(mapManager, platformManager = null) {\n    this.mapManager = mapManager;\n    this.platformManager = platformManager; // Store the platform manager reference\n    this.waypoints = [];\n    this.markers = [];\n    this.callbacks = {\n      onChange: null,\n      onWaypointAdded: null,\n      onWaypointRemoved: null,\n      onRouteUpdated: null\n    };\n  }\n  \n  /**\n   * Set the platform manager if not provided in constructor\n   * @param {Object} platformManager - Platform manager instance\n   */\n  setPlatformManager(platformManager) {\n    this.platformManager = platformManager;\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} type - The callback type (onChange, onWaypointAdded, etc.)\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n  \n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n  \n  /**\n   * Add a waypoint to the route\n   * @param {Array} coords - [lng, lat] coordinates\n   * @param {string} name - The waypoint name\n   * @param {Object} options - Additional options (e.g., isWaypoint flag)\n   * @returns {Object} - The added waypoint\n   */\n  addWaypoint(coords, name, options = {}) {\n    const map = this.mapManager.getMap();\n    if (!map) {\n      console.error('Cannot add waypoint: Map is not initialized');\n      return null;\n    }\n    \n    // FIXED: Determine if this is a waypoint by checking options OR the global flag\n    const isWaypointOption = options && (options.isWaypoint === true || options.type === 'WAYPOINT');\n    const isWaypointGlobal = window.isWaypointModeActive === true;\n    const isWaypoint = isWaypointOption || isWaypointGlobal;\n    \n    console.log(`Adding ${isWaypoint ? 'WAYPOINT' : 'STOP'} at coordinates: ${coords} with name: ${name || 'Unnamed'}, explicit isWaypoint: ${isWaypointOption}, global flag: ${isWaypointGlobal}`);\n    \n    // Create a unique ID for the waypoint\n    const id = `waypoint-${Date.now()}`;\n    \n    // Create waypoint object with appropriate type\n    const waypoint = {\n      id: id,\n      coords: coords,\n      name: name || (isWaypoint ? `Waypoint ${this.waypoints.length + 1}` : `Stop ${this.waypoints.length + 1}`),\n      isNew: true, // Mark as new for highlighting\n      isWaypoint: isWaypoint, // FIXED: Always include this flag\n      type: isWaypoint ? 'WAYPOINT' : 'STOP', // FIXED: Always include type\n      ...options // Include any other options\n    };\n    \n    // Add to waypoints array\n    this.waypoints.push(waypoint);\n    \n    try {\n      // Create marker on the map - make sure options include the isWaypoint flag\n      const markerOptions = { \n        ...options,\n        isWaypoint: isWaypoint, // Ensure this flag is set correctly\n        type: isWaypoint ? 'WAYPOINT' : 'STOP' // Ensure type is set correctly\n      };\n      \n      const marker = this.createWaypointMarker(coords, name, markerOptions);\n      \n      if (marker) {\n        // Add drag end event to update route\n        marker.on('dragend', () => {\n          const lngLat = marker.getLngLat();\n          const index = this.markers.indexOf(marker);\n          if (index !== -1 && index < this.waypoints.length) {\n            console.log(`Marker at index ${index} dragged to [${lngLat.lng}, ${lngLat.lat}]`);\n            \n            // Store the old coordinates for reference\n            const oldCoords = this.waypoints[index].coords;\n            \n            // Update the waypoint coordinates\n            this.waypoints[index].coords = [lngLat.lng, lngLat.lat];\n            \n            // Check for nearest platform to the new location and update name if found\n            this.updateWaypointNameAfterDrag(index, [lngLat.lng, lngLat.lat]);\n            \n            // Update route with new waypoint\n            this.updateRoute();\n            \n            // Trigger onChange callback to update UI\n            this.triggerCallback('onChange', this.waypoints);\n          }\n        });\n        \n        this.markers.push(marker);\n      } else {\n        console.error('Failed to create waypoint marker');\n      }\n      \n      // Update route - don't pass route stats here as they'll be calculated by the callback\n      this.updateRoute(null);\n      \n      // Log the operation for debugging\n      console.log(`Added ${isWaypoint ? 'WAYPOINT' : 'STOP'} ${waypoint.name} at the end, ID: ${id}`);\n      \n      // Trigger callbacks\n      this.triggerCallback('onWaypointAdded', waypoint);\n      this.triggerCallback('onChange', this.waypoints);\n      \n      return waypoint;\n    } catch (error) {\n      console.error('Error adding waypoint:', error);\n      // Remove the waypoint if marker creation failed\n      this.waypoints = this.waypoints.filter(wp => wp.id !== id);\n      return null;\n    }\n  }\n  \n  /**\n   * Updates a waypoint's name after it has been dragged to a new location\n   * @param {number} index - The index of the waypoint\n   * @param {Array} newCoords - [lng, lat] new coordinates\n   */\n  updateWaypointNameAfterDrag(index, newCoords) {\n    // Skip if we don't have access to a platform manager\n    if (!window.platformManager && !this.platformManager) {\n      console.log('No platform manager available to check for nearby locations');\n      return;\n    }\n    \n    const platformMgr = window.platformManager || this.platformManager;\n    \n    try {\n      // Use findNearestPlatform to check if we're now near a platform\n      const nearestPlatform = platformMgr.findNearestPlatform(newCoords[1], newCoords[0], 2);\n      \n      if (nearestPlatform) {\n        console.log(`Found nearest platform after drag: ${nearestPlatform.name} (${nearestPlatform.distance.toFixed(2)} nm)`);\n        \n        // Update the waypoint name with the platform name\n        this.waypoints[index].name = nearestPlatform.name;\n        console.log(`Updated waypoint name to: ${nearestPlatform.name}`);\n      } else {\n        // If not near a platform, check if the current name is a generated one\n        // and update the number if needed\n        const currentName = this.waypoints[index].name;\n        if (currentName.startsWith('Waypoint ')) {\n          this.waypoints[index].name = `Waypoint ${index + 1}`;\n        }\n        // If it has a custom name, leave it as is\n      }\n    } catch (error) {\n      console.error('Error updating waypoint name after drag:', error);\n    }\n  }\n  \n  /**\n   * Add a waypoint at a specific index in the route\n   * @param {Array} coords - [lng, lat] coordinates\n   * @param {string} name - The waypoint name\n   * @param {number} index - The index to insert at\n   * @param {Object} options - Additional options (e.g., isWaypoint flag)\n   * @returns {Object} - The added waypoint\n   */\n  addWaypointAtIndex(coords, name, index, options = {}) {\n    const map = this.mapManager.getMap();\n    if (!map) return null;\n    \n    // FIXED: Determine if this is a waypoint by checking options OR the global flag\n    const isWaypointOption = options && (options.isWaypoint === true || options.type === 'WAYPOINT');\n    const isWaypointGlobal = window.isWaypointModeActive === true;\n    const isWaypoint = isWaypointOption || isWaypointGlobal;\n    \n    console.log(`Adding ${isWaypoint ? 'WAYPOINT' : 'STOP'} at index ${index}, coordinates: ${coords} with name: ${name || 'Unnamed'}`);\n    \n    // Create a unique ID for the waypoint\n    const id = `waypoint-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n    \n    // Prepare default name if not provided\n    const defaultName = isWaypoint ? `Waypoint ${index + 1}` : `Stop ${index + 1}`;\n    \n    // Create the waypoint object with appropriate type\n    const waypoint = {\n      id: id,\n      coords: coords,\n      name: name || defaultName,\n      isNew: true, // Mark as new for highlighting\n      isWaypoint: isWaypoint, // FIXED: Always include this flag\n      type: isWaypoint ? 'WAYPOINT' : 'STOP', // FIXED: Always include type\n      ...options // Include any other options\n    };\n    \n    // Create marker on the map - make sure options include the isWaypoint flag\n    const markerOptions = { \n      ...options,\n      isWaypoint: isWaypoint, // Ensure this flag is set correctly\n      type: isWaypoint ? 'WAYPOINT' : 'STOP' // Ensure type is set correctly\n    };\n    \n    const marker = this.createWaypointMarker(coords, name, markerOptions);\n    \n    // Add drag end event to update route\n    marker.on('dragend', () => {\n      const lngLat = marker.getLngLat();\n      const markerIndex = this.markers.indexOf(marker);\n      if (markerIndex !== -1 && markerIndex < this.waypoints.length) {\n        this.waypoints[markerIndex].coords = [lngLat.lng, lngLat.lat];\n        this.updateRoute();\n      }\n    });\n    \n    // Insert at specific index\n    this.waypoints.splice(index, 0, waypoint);\n    this.markers.splice(index, 0, marker);\n    \n    // Update route - don't pass route stats here as they'll be calculated by the callback\n    this.updateRoute(null);\n    \n    // Log the operation for debugging\n    console.log(`Added ${isWaypoint ? 'WAYPOINT' : 'STOP'} ${waypoint.name} at index ${index}, ID: ${id}`);\n    \n    // Ensure we trigger callbacks in this order:\n    // 1. First onWaypointAdded for the specific waypoint\n    // 2. Then onChange for the entire waypoints array\n    this.triggerCallback('onWaypointAdded', waypoint);\n    this.triggerCallback('onChange', this.waypoints);\n    \n    return waypoint;\n  }\n  \n  /**\n   * Create a custom marker for a waypoint\n   * @param {Array} coords - [lng, lat] coordinates\n   * @param {string} name - The waypoint name\n   * @param {Object} options - Additional options (e.g., isWaypoint flag)\n   * @returns {Object} - The created marker\n   */\n  createWaypointMarker(coords, name, options = {}) {\n    try {\n      const map = this.mapManager.getMap();\n      if (!map) {\n        console.error('Cannot create waypoint marker: Map is not initialized');\n        return null;\n      }\n      \n      if (!window.mapboxgl) {\n        console.error('Cannot create waypoint marker: MapboxGL is not loaded');\n        return null;\n      }\n      \n      // Ensure coordinates are valid\n      if (!coords || coords.length !== 2 || \n          typeof coords[0] !== 'number' || typeof coords[1] !== 'number') {\n        console.error('Invalid coordinates for waypoint marker:', coords);\n        return null;\n      }\n      \n      // Check if this is a navigation waypoint vs. a regular stop\n      // Look in both the options object and the waypoint mode flag\n      const isWaypoint = options.isWaypoint === true || \n                         options.type === 'WAYPOINT' ||\n                         window.isWaypointModeActive === true;\n      \n      console.log(`Creating ${isWaypoint ? 'WAYPOINT' : 'STOP'} marker at ${coords} with name ${name || 'Unnamed'}`);\n      \n      // Create a marker with appropriate color based on type\n      const marker = new window.mapboxgl.Marker({\n        color: isWaypoint ? \"#FFCC00\" : \"#FF4136\", // Yellow for waypoints, red for stops\n        draggable: true,\n        scale: 0.6 // Keep them small (60% of normal size)\n      })\n        .setLngLat(coords)\n        .addTo(map);\n      \n      // Add popup with coordinates and name - now with a close button and favorite button\n      const popup = new window.mapboxgl.Popup({\n        closeButton: true, // Add close button\n        closeOnClick: false,\n        offset: 15, // Smaller offset for smaller marker\n        className: isWaypoint ? 'waypoint-popup' : 'stop-popup', // Different class for styling\n        maxWidth: '240px'\n      });\n      \n      const displayName = name || (isWaypoint ? 'Waypoint' : 'Stop');\n      \n      // Enhance popup with more styling based on the type\n      const popupContent = `\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;\">\n          <strong style=\"color: ${isWaypoint ? '#825500' : '#333333'}\">${displayName}</strong>\n          <span class=\"favorite-button\" title=\"Add to favorites\" style=\"cursor: pointer; font-size: 18px;\" onclick=\"window.addToFavorites('${displayName}', [${coords}])\">❤️</span>\n        </div>\n        <span class=\"coord-label\">Lat:</span> <span class=\"coord-value\">${coords[1].toFixed(5)}</span><br>\n        <span class=\"coord-label\">Lon:</span> <span class=\"coord-value\">${coords[0].toFixed(5)}</span>\n        ${isWaypoint ? \n          '<div style=\"margin-top: 5px; font-size: 10px; padding: 1px 4px; background-color: #FFCC00; color: #333; display: inline-block; border-radius: 3px;\">WAYPOINT</div>' : \n          ''\n        }\n      `;\n      \n      popup.setHTML(popupContent);\n      \n      // Show popup on hover\n      const markerElement = marker.getElement();\n      if (markerElement) {\n        // Add a CSS class to the marker element based on type\n        if (isWaypoint) {\n          markerElement.classList.add('waypoint-map-marker');\n          \n          // Make the marker element visually distinct based on type \n          // by adding a special attribute that CSS can target\n          markerElement.setAttribute('data-marker-type', 'waypoint');\n        } else {\n          markerElement.setAttribute('data-marker-type', 'stop');\n        }\n        \n        markerElement.addEventListener('mouseenter', () => {\n          popup.setLngLat(marker.getLngLat()).addTo(map);\n        });\n        \n        markerElement.addEventListener('mouseleave', () => {\n          popup.remove();\n        });\n      }\n      \n      // Add a global CSS style to enhance marker display if not already added\n      if (!document.getElementById('marker-type-styles')) {\n        const styleSheet = document.createElement('style');\n        styleSheet.id = 'marker-type-styles';\n        styleSheet.innerHTML = `\n          /* Make waypoint markers look distinct */\n          .mapboxgl-marker[data-marker-type=\"waypoint\"] {\n            filter: drop-shadow(0 0 2px rgba(255, 204, 0, 0.9));\n          }\n          \n          /* Add a subtle glow to stop markers */\n          .mapboxgl-marker[data-marker-type=\"stop\"] {\n            filter: drop-shadow(0 0 1px rgba(255, 65, 54, 0.7));\n          }\n          \n          /* Style the popups differently based on type */\n          .waypoint-popup .mapboxgl-popup-content {\n            border-left: 3px solid #FFCC00;\n          }\n          \n          .stop-popup .mapboxgl-popup-content {\n            border-left: 3px solid #FF4136;\n          }\n        `;\n        document.head.appendChild(styleSheet);\n      }\n      \n      return marker;\n    } catch (error) {\n      console.error('Error creating waypoint marker:', error);\n      return null;\n    }\n  }\n  \n  /**\n   * Create arrow markers along a route line\n   * @param {Array} coordinates - Array of [lng, lat] coordinates\n   * @param {Object} routeStats - Route statistics\n   * @returns {Object} - GeoJSON feature collection of arrow markers\n   */\n  createArrowsAlongLine(coordinates, routeStats = null) {\n    if (!coordinates || coordinates.length < 2) {\n      return {\n        type: 'FeatureCollection',\n        features: []\n      };\n    }\n    \n    // CRITICAL FIX: Check if routeStats has wind adjustments first\n    const hasWindAdjustments = routeStats && routeStats.windAdjusted && routeStats.windData;\n    console.log(`⚓ createArrowsAlongLine - Wind adjustments: ${hasWindAdjustments ? 'YES' : 'NO'}`);\n    \n    // CRITICAL FIX: Always check if currentRouteStats has wind-adjusted values that we should use\n    // This is important because it means the weather settings were just updated\n    let useCurrentStats = false;\n    if (window.currentRouteStats && window.currentRouteStats.windAdjusted && \n        (!routeStats || !routeStats.windAdjusted)) {\n      console.log(`⚓ Found wind-adjusted data in window.currentRouteStats that's not in routeStats`);\n      console.log(`⚓ currentRouteStats wind data:`, {\n        windSpeed: window.currentRouteStats.windData?.windSpeed,\n        windDirection: window.currentRouteStats.windData?.windDirection,\n        timeHours: window.currentRouteStats.timeHours,\n        estimatedTime: window.currentRouteStats.estimatedTime\n      });\n      useCurrentStats = true;\n    }\n    \n    // If we should use currentRouteStats, update routeStats with its values\n    if (useCurrentStats && window.currentRouteStats) {\n      // Create a copy or use the existing routeStats object\n      routeStats = routeStats || {};\n      \n      // Copy wind-adjusted values from currentRouteStats\n      routeStats.timeHours = window.currentRouteStats.timeHours;\n      routeStats.estimatedTime = window.currentRouteStats.estimatedTime;\n      routeStats.windAdjusted = true;\n      routeStats.windData = window.currentRouteStats.windData;\n      routeStats.legs = window.currentRouteStats.legs;\n      \n      console.log(`⚓ Updated routeStats with wind-adjusted data from window.currentRouteStats`);\n    }\n    \n    // CRITICAL FIX: Add a safety check to verify if routeStats contains sane time values\n    // For a single leg, check if the total time makes sense for the total distance\n    if (routeStats && routeStats.totalDistance) {\n      const totalDistance = parseFloat(routeStats.totalDistance);\n      \n      // Check if time values are present and valid\n      if (!routeStats.timeHours || routeStats.timeHours === 0 || \n          !routeStats.estimatedTime || routeStats.estimatedTime === '00:00') {\n        console.error(`❌ Missing or zero time values in routeStats! Distance: ${totalDistance} nm`);\n        \n        // Try to calculate reasonable time values\n        let cruiseSpeed = 135; // Default to 135 knots\n        \n        // Try to get cruise speed from routeStats, selectedAircraft, or currentSelectedAircraft\n        if (routeStats.aircraft && routeStats.aircraft.cruiseSpeed) {\n          cruiseSpeed = routeStats.aircraft.cruiseSpeed;\n        } else if (window.selectedAircraft && window.selectedAircraft.cruiseSpeed) {\n          cruiseSpeed = window.selectedAircraft.cruiseSpeed;\n        } else if (window.currentSelectedAircraft && window.currentSelectedAircraft.cruiseSpeed) {\n          cruiseSpeed = window.currentSelectedAircraft.cruiseSpeed;\n        }\n        \n        // Now check if we can calculate with wind effects\n        let calculatedTimeHours;\n        \n        // If we have wind data and WindCalculations, calculate with wind effects\n        if (window.WindCalculations && routeStats.windData) {\n          console.log(`⚓ Calculating time with wind effects for ${totalDistance} nm`);\n          \n          // Get the first and last waypoint to calculate course\n          const firstWaypoint = coordinates[0];\n          const lastWaypoint = coordinates[coordinates.length - 1];\n          \n          // Create lat/lon objects from coordinates\n          const from = { lat: firstWaypoint[1], lon: firstWaypoint[0] };\n          const to = { lat: lastWaypoint[1], lon: lastWaypoint[0] };\n          \n          // Calculate course between waypoints\n          const course = window.WindCalculations.calculateCourse(from, to);\n          \n          // Calculate time with wind adjustment\n          calculatedTimeHours = window.WindCalculations.calculateWindAdjustedTime(\n            totalDistance,\n            cruiseSpeed,\n            course,\n            routeStats.windData.windSpeed,\n            routeStats.windData.windDirection\n          );\n          \n          console.log(`⚓ Wind-adjusted time calculation: ${calculatedTimeHours.toFixed(2)} hours`);\n        } else {\n          // Calculate without wind effects\n          calculatedTimeHours = totalDistance / cruiseSpeed;\n          console.log(`⚓ Basic time calculation: ${calculatedTimeHours.toFixed(2)} hours`);\n        }\n        \n        // Format time string\n        const hours = Math.floor(calculatedTimeHours);\n        const minutes = Math.floor((calculatedTimeHours - hours) * 60);\n        const calculatedTimeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n        \n        console.log(`⚓ Generated calculated time: ${calculatedTimeString} (${calculatedTimeHours.toFixed(2)} hours) for display`);\n        \n        // Update the passed routeStats object with calculated values\n        routeStats.timeHours = calculatedTimeHours;\n        routeStats.estimatedTime = calculatedTimeString;\n        \n        // Also update window.currentRouteStats\n        if (window.currentRouteStats) {\n          window.currentRouteStats.timeHours = calculatedTimeHours;\n          window.currentRouteStats.estimatedTime = calculatedTimeString;\n          \n          // Make sure wind data is properly set\n          if (routeStats.windData) {\n            window.currentRouteStats.windAdjusted = true;\n            window.currentRouteStats.windData = { ...routeStats.windData };\n          }\n        } else {\n          // If no window.currentRouteStats, create a minimal one\n          window.currentRouteStats = {\n            ...routeStats,\n            timeHours: calculatedTimeHours,\n            estimatedTime: calculatedTimeString\n          };\n        }\n      } \n      // If time values exist, check if they're reasonable\n      else {\n        // Only do this sanity check if it's not wind-adjusted data\n        // Wind effects can cause significant time differences from basic calculations\n        if (!routeStats.windAdjusted) {\n          const cruiseSpeed = routeStats.aircraft?.cruiseSpeed || 135; // Default S92 speed\n          const expectedTimeHours = totalDistance / cruiseSpeed;\n          const timeHoursDifference = Math.abs(routeStats.timeHours - expectedTimeHours);\n          \n          if (timeHoursDifference > 1) { // More than 1 hour difference\n            console.error(`❌ Route time value is unreasonable! Got ${routeStats.timeHours.toFixed(2)} hours but expected ~${expectedTimeHours.toFixed(2)} hours based on distance ${totalDistance} nm at ${cruiseSpeed} kts`);\n            \n            // Don't set to null, but fix the values instead\n            const fixedTimeHours = expectedTimeHours;\n            const hours = Math.floor(fixedTimeHours);\n            const minutes = Math.floor((fixedTimeHours - hours) * 60);\n            const fixedTimeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n            \n            console.log(`❌ Fixing time values to: ${fixedTimeString} (${fixedTimeHours.toFixed(2)} hours) for display`);\n            \n            // Update the routeStats object\n            routeStats.timeHours = fixedTimeHours;\n            routeStats.estimatedTime = fixedTimeString;\n            \n            // Update window.currentRouteStats\n            if (window.currentRouteStats) {\n              window.currentRouteStats.timeHours = fixedTimeHours;\n              window.currentRouteStats.estimatedTime = fixedTimeString;\n            }\n          }\n        } else {\n          console.log(`⚓ Using wind-adjusted time: ${routeStats.timeHours.toFixed(2)} hours for ${totalDistance} nm`);\n        }\n      }\n    }\n    \n    const features = [];\n    \n    // Process each segment of the route\n    for (let i = 0; i < coordinates.length - 1; i++) {\n      const startPoint = coordinates[i];\n      const endPoint = coordinates[i + 1];\n      \n      // Calculate distance of this segment\n      const distance = window.turf.distance(\n        window.turf.point(startPoint),\n        window.turf.point(endPoint),\n        { units: 'nauticalmiles' }\n      );\n      \n      // Calculate bearing between points\n      const bearing = window.turf.bearing(\n        window.turf.point(startPoint),\n        window.turf.point(endPoint)\n      );\n      \n      // Find the midpoint of the segment\n      const midpointFraction = 0.5;\n      const midPoint = window.turf.along(\n        window.turf.lineString([startPoint, endPoint]),\n        distance * midpointFraction,\n        { units: 'nauticalmiles' }\n      );\n      \n      // Calculate leg time and fuel if aircraft data is available\n      let legTime = null;\n      let legFuel = null;\n      \n      // Try to get aircraft data from routeStats or window.currentRouteStats\n      let stats = routeStats || window.currentRouteStats;\n      \n      // If no stats at all, create minimal stats with aircraft data\n      if (!stats && window.currentSelectedAircraft) {\n        console.log(`❗ Creating emergency minimal stats for leg ${i+1} display`);\n        stats = {\n          aircraft: window.currentSelectedAircraft,\n          windAdjusted: false\n        };\n      }\n      \n      // Log available stats for debugging\n      console.log(`Drawing leg ${i+1} with stats:`, {\n        hasStats: !!stats,\n        hasLegs: !!(stats && stats.legs),\n        legCount: stats?.legs?.length || 0,\n        legHasTime: !!(stats?.legs && stats?.legs[i]?.time),\n        windAdjusted: stats?.windAdjusted || false\n      });\n      \n      // CRITICAL EMERGENCY FIX: Always ensure we have a legTime value\n      // We must calculate the time for each leg with proper wind adjustments\n      \n      if (stats && stats.legs && stats.legs[i] && stats.legs[i].time !== undefined) {\n        // Best case: Use pre-calculated time from legs data (includes wind effects)\n        const timeHours = stats.legs[i].time;\n        \n        // Format time as minutes only, rounded to the nearest minute\n        const totalMinutes = Math.round(timeHours * 60);\n        legTime = `${totalMinutes}m`;\n        \n        // Add wind indicator if needed\n        if (stats.windAdjusted && stats.windData && stats.windData.windSpeed > 0) {\n          // Check if leg has headwind data\n          if (stats.legs[i] && stats.legs[i].headwind !== undefined) {\n            const headwind = stats.legs[i].headwind;\n            console.log(`🌬️ Checking wind effect for leg ${i+1}: headwind=${headwind}, windAdjusted=${stats.windAdjusted}`);\n            \n            if (Math.abs(headwind) > 1) {\n              legTime = `${totalMinutes}m*`; // Add an asterisk to indicate wind adjusted time\n              console.log(`🌬️ Added wind indicator to leg ${i+1} time: ${legTime}`);\n            }\n          } else {\n            // If we have wind data but no specific leg headwind, still mark it as wind-adjusted\n            legTime = `${totalMinutes}m*`;\n            console.log(`🌬️ Added wind indicator to leg ${i+1} without headwind data: ${legTime}`);\n          }\n        } else {\n          console.log(`Wind data missing for leg ${i+1}: windAdjusted=${stats.windAdjusted}, hasWindData=${stats.windData ? 'yes' : 'no'}`);\n        }\n        \n        console.log(`Using leg time from legs data for leg ${i+1}: ${legTime}`);\n        \n        // Use the pre-calculated fuel if available\n        if (stats.legs[i].fuel) {\n          legFuel = Math.round(stats.legs[i].fuel);\n        }\n      }\n      else {\n        // Fallback: Calculate time with wind adjustment if possible\n        console.log(`❗ No leg data for leg ${i+1}, calculating with wind effects if possible`);\n        \n        // Get cruise speed - try multiple sources\n        let cruiseSpeed = 135; // Default S92 speed\n        \n        if (stats && stats.aircraft && stats.aircraft.cruiseSpeed) {\n          cruiseSpeed = stats.aircraft.cruiseSpeed;\n        } else if (window.currentSelectedAircraft && window.currentSelectedAircraft.cruiseSpeed) {\n          cruiseSpeed = window.currentSelectedAircraft.cruiseSpeed;\n        }\n        \n        // Determine if we can use wind calculations\n        let timeHours;\n        let useWindCalculation = false;\n        \n        // Check if we have WindCalculations module and wind data\n        if (window.WindCalculations && stats && stats.windAdjusted && stats.windData) {\n          console.log(`🌬️ Attempting wind calculation for leg ${i+1}`);\n          \n          try {\n            // Create from/to points for course calculation\n            const fromPoint = {\n              lat: coordinates[i][1],\n              lon: coordinates[i][0]\n            };\n            \n            const toPoint = {\n              lat: coordinates[i+1][1],\n              lon: coordinates[i+1][0]\n            };\n            \n            // Calculate course between points\n            const course = window.WindCalculations.calculateCourse(fromPoint, toPoint);\n            \n            // Calculate wind-adjusted time\n            timeHours = window.WindCalculations.calculateWindAdjustedTime(\n              distance,\n              cruiseSpeed,\n              course,\n              stats.windData.windSpeed,\n              stats.windData.windDirection\n            );\n            \n            console.log(`🌬️ Wind-adjusted time for leg ${i+1}: ${timeHours.toFixed(2)} hours`);\n            useWindCalculation = true;\n          } catch (error) {\n            console.error(`🌬️ Error calculating wind-adjusted time for leg ${i+1}:`, error);\n            // Fall back to basic calculation\n            timeHours = distance / cruiseSpeed;\n          }\n        } else {\n          // Basic calculation without wind\n          timeHours = distance / cruiseSpeed;\n        }\n        \n        // Format time as minutes only, rounded to the nearest minute\n        const totalMinutes = Math.round(timeHours * 60);\n        legTime = useWindCalculation ? `${totalMinutes}m*` : `${totalMinutes}m`;\n        \n        console.log(`Calculated time for leg ${i+1}: ${legTime} based on distance ${distance.toFixed(1)} nm at speed ${cruiseSpeed} kts`);\n        \n        // Calculate fuel for this leg\n        let fuelBurn = 1100; // Default fuel burn\n        \n        if (stats && stats.aircraft && stats.aircraft.fuelBurn) {\n          fuelBurn = stats.aircraft.fuelBurn;\n        } else if (window.currentSelectedAircraft && window.currentSelectedAircraft.fuelBurn) {\n          fuelBurn = window.currentSelectedAircraft.fuelBurn;\n        }\n        \n        legFuel = Math.round(timeHours * fuelBurn);\n      }\n      \n      // CRITICAL: Ensure we always have a leg time - final emergency fallback\n      if (!legTime) {\n        console.error(`❌ Critical failure - no legTime calculated for leg ${i+1}. Using emergency fallback.`);\n        const emergencyTimeMinutes = Math.round((distance / 135) * 60);\n        legTime = `${emergencyTimeMinutes}m`;\n      }\n      \n      // CRITICAL FIX: All text on one line\n      // Format elements\n      const distanceText = `${distance.toFixed(1)} nm`;\n      \n      // Format the time with wind indicator if needed\n      let timeText = \"\";\n      if (legTime) {\n        // If the time already has the wind marker (*), use it as is\n        if (legTime.includes('*')) {\n          // For wind-adjusted time, add wind-specific styling\n          timeText = legTime;\n          console.log(`🌬️ Using wind-adjusted time: ${timeText}`);\n        } else if (stats && stats.windAdjusted && weather && weather.windSpeed > 0) {\n          // If we have wind settings but legTime doesn't show it, add the asterisk\n          timeText = `${legTime}*`;\n          console.log(`🌬️ Adding wind indicator to time: ${timeText}`);\n        } else {\n          timeText = legTime;\n        }\n      }\n      \n      // We'll keep fuel hidden for now\n      \n      // Left/right arrow based on direction\n      const startLng = startPoint[0];\n      const endLng = endPoint[0];\n      const goingLeftToRight = endLng > startLng;\n      const leftArrow = '←';\n      const rightArrow = '→';\n      \n      // Create label with proper arrow placement - ALL ON ONE LINE\n      let labelText = '';\n      \n      // Add left arrow at beginning if going right to left\n      if (!goingLeftToRight) {\n        labelText += leftArrow + ' ';\n      }\n      \n      // Add distance\n      labelText += distanceText;\n      \n      // Add time if available - on same line with dot separator\n      if (timeText) {\n        labelText += ` • ${timeText}`;\n        \n        // We've removed the wind indicator display from route lines\n        // Wind correction is already shown in the top card and stop cards\n      }\n      \n      // Add right arrow at end if going left to right\n      if (goingLeftToRight) {\n        labelText += ' ' + rightArrow;\n      }\n      \n      // Determine the adjusted bearing for text orientation\n      // Make the text parallel to the line and ensure it's never upside down\n      let adjustedBearing = bearing;\n      \n      // First make it parallel to the flight path by rotating 90 degrees\n      adjustedBearing += 90;\n      \n      // Ensure text is always right-side up\n      // If the text would be upside down (90° to 270°), flip it to be right-side up\n      if (adjustedBearing > 90 && adjustedBearing < 270) {\n        adjustedBearing = (adjustedBearing + 180) % 360;\n      }\n      \n      // Add label feature with the adjusted bearing\n      features.push({\n        type: 'Feature',\n        geometry: midPoint.geometry,\n        properties: {\n          isLabel: true,\n          bearing: bearing,           // Original bearing for reference\n          textBearing: adjustedBearing, // Adjusted bearing for text orientation\n          text: labelText,\n          legIndex: i\n        }\n      });\n    }\n    \n    return {\n      type: 'FeatureCollection',\n      features: features\n    };\n  }\n  \n  /**\n   * Remove a waypoint by ID and index\n   * @param {string} id - The waypoint ID\n   * @param {number} index - The waypoint index\n   */\n  removeWaypoint(id, index) {\n    console.log(`WaypointManager: Removing waypoint with ID ${id} at index ${index}`);\n    \n    // If index is not provided or invalid, find it from the ID\n    if (index === undefined || index < 0 || index >= this.waypoints.length) {\n      console.log(`WaypointManager: Invalid index ${index}, searching by ID`);\n      index = this.waypoints.findIndex(wp => wp.id === id);\n      \n      if (index === -1) {\n        console.error(`WaypointManager: Cannot find waypoint with ID ${id}`);\n        return;\n      }\n    }\n    \n    // Find the waypoint for callback before removing\n    const removedWaypoint = this.waypoints[index];\n    \n    // Remove the marker from the map\n    if (this.markers[index]) {\n      console.log(`WaypointManager: Removing marker at index ${index}`);\n      try {\n        this.markers[index].remove();\n      } catch (error) {\n        console.error('Error removing marker:', error);\n      }\n    } else {\n      console.warn(`WaypointManager: No marker found at index ${index}`);\n    }\n    \n    // Remove from arrays\n    this.markers.splice(index, 1);\n    this.waypoints.splice(index, 1);\n    \n    console.log(`WaypointManager: After removal, ${this.waypoints.length} waypoints and ${this.markers.length} markers remain`);\n    \n    // Update route\n    this.updateRoute();\n    \n    // Trigger callbacks\n    if (removedWaypoint) {\n      this.triggerCallback('onWaypointRemoved', removedWaypoint);\n    }\n    this.triggerCallback('onChange', this.waypoints);\n  }\n  \n  /**\n   * Update the route line on the map\n   * @param {Object} routeStats - Optional route statistics to use for leg labels\n   */\n  updateRoute(routeStats = null) {\n    const map = this.mapManager.getMap();\n    if (!map) return;\n    \n    // Log routeStats passed to updateRoute for debugging\n    if (routeStats) {\n      console.log('🔄 WaypointManager.updateRoute called with routeStats:', {\n        timeHours: routeStats.timeHours,\n        estimatedTime: routeStats.estimatedTime,\n        totalDistance: routeStats.totalDistance,\n        hasLegs: routeStats.legs ? true : false,\n        legCount: routeStats.legs?.length || 0,\n        windAdjusted: routeStats.windAdjusted || false\n      });\n      \n      // CRITICAL FIX: Ensure time values are available\n      if (!routeStats.timeHours || routeStats.timeHours === 0 || !routeStats.estimatedTime || routeStats.estimatedTime === '00:00') {\n        console.warn('⚠️ CRITICAL: Missing time values in routeStats passed to updateRoute!');\n        \n        if (routeStats.totalDistance && parseFloat(routeStats.totalDistance) > 0) {\n          console.log('⚠️ Calculating emergency time values for route display');\n          \n          // Get cruiseSpeed from the aircraft or use a default\n          let cruiseSpeed = 135; // Default S92 speed\n          if (routeStats.aircraft && routeStats.aircraft.cruiseSpeed) {\n            cruiseSpeed = routeStats.aircraft.cruiseSpeed;\n          } else if (window.currentSelectedAircraft && window.currentSelectedAircraft.cruiseSpeed) {\n            cruiseSpeed = window.currentSelectedAircraft.cruiseSpeed;\n          }\n          \n          const totalDistance = parseFloat(routeStats.totalDistance);\n          const timeHours = totalDistance / cruiseSpeed;\n          \n          // Format time\n          const hours = Math.floor(timeHours);\n          const minutes = Math.floor((timeHours - hours) * 60);\n          const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n          \n          // Update routeStats directly\n          routeStats.timeHours = timeHours;\n          routeStats.estimatedTime = estimatedTime;\n          \n          console.log('⚠️ Fixed routeStats time values:', {\n            timeHours,\n            estimatedTime\n          });\n          \n          // Also update window.currentRouteStats\n          if (window.currentRouteStats) {\n            window.currentRouteStats.timeHours = timeHours;\n            window.currentRouteStats.estimatedTime = estimatedTime;\n          } else {\n            window.currentRouteStats = {\n              ...routeStats\n            };\n          }\n        }\n      }\n    } else {\n      console.log('🔄 WaypointManager.updateRoute called without routeStats');\n      \n      // Try to use window.currentRouteStats if available\n      if (window.currentRouteStats) {\n        console.log('🔄 Using window.currentRouteStats for route display');\n        routeStats = window.currentRouteStats;\n      }\n    }\n    \n    // Remove existing route, glow, and arrows if they exist\n    if (map.getSource('route')) {\n      if (map.getLayer('route-glow')) {\n        map.removeLayer('route-glow');\n      }\n      if (map.getLayer('route')) {\n        map.removeLayer('route');\n      }\n      map.removeSource('route');\n    }\n    \n    // Remove existing arrows and labels if they exist\n    if (map.getSource('route-arrows')) {\n      if (map.getLayer('route-arrows')) {\n        map.removeLayer('route-arrows');\n      }\n      if (map.getLayer('leg-labels')) {\n        map.removeLayer('leg-labels');\n      }\n      map.removeSource('route-arrows');\n    }\n    \n    // If we have at least 2 waypoints, draw the route\n    if (this.waypoints.length >= 2) {\n      const coordinates = this.waypoints.map(wp => wp.coords);\n      \n      map.addSource('route', {\n        'type': 'geojson',\n        'data': {\n          'type': 'Feature',\n          'properties': {},\n          'geometry': {\n            'type': 'LineString',\n            'coordinates': coordinates\n          }\n        }\n      });\n      \n      // Add main route line (make it wider for easier interaction)\n      map.addLayer({\n        'id': 'route',\n        'type': 'line',\n        'source': 'route',\n        'layout': {\n          'line-join': 'round',\n          'line-cap': 'round',\n          'line-sort-key': 1 // Ensure it appears above the glow but below symbols\n        },\n        'paint': {\n          'line-color': '#007bff', // Bright blue for the main route\n          'line-width': 6,         // Wider line for easier grabbing\n          'line-opacity': 0.8      // Slightly transparent\n        }\n      });\n      \n      // Add a \"glow\" effect around the route to make it more visible\n      map.addLayer({\n        'id': 'route-glow',\n        'type': 'line',\n        'source': 'route',\n        'layout': {\n          'line-join': 'round',\n          'line-cap': 'round',\n          'visibility': 'visible',\n          'line-sort-key': 0 // Ensure it appears below the main line\n        },\n        'paint': {\n          'line-color': '#ffffff',  // White glow\n          'line-width': 10,         // Wider than the main route\n          'line-opacity': 0.15,     // Very transparent\n          'line-blur': 3            // Blur effect for glow\n        },\n        'filter': ['==', '$type', 'LineString']\n      }, 'route'); // Insert below the main route\n      \n      // CRITICAL FIX: Prefer the passed routeStats over any global state\n      // This ensures the leg times and other data are consistent with the current calculation\n      const stats = routeStats || window.currentRouteStats;\n      \n      // Store current stats for debugging\n      window.currentRouteStats = stats;\n      \n      // Log the stats being used for createArrowsAlongLine\n      console.log('🔄 Using route stats for arrows:', {\n        timeHours: stats?.timeHours,\n        estimatedTime: stats?.estimatedTime,\n        legs: stats?.legs?.length || 0\n      });\n      \n      // Create a GeoJSON source for the route arrows and leg labels\n      const arrowsData = this.createArrowsAlongLine(coordinates, stats);\n      \n      // Add a source for the arrows and labels\n      map.addSource('route-arrows', {\n        'type': 'geojson',\n        'data': arrowsData\n      });\n      \n      // Use a custom arrow image or create one\n      // First check if we've already loaded the arrow image\n      if (!map.hasImage('arrow-icon')) {\n        // Create a canvas to draw the arrow\n        const size = 24;\n        const canvas = document.createElement('canvas');\n        canvas.width = size;\n        canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        \n        // Draw a simple arrow\n        ctx.clearRect(0, 0, size, size);\n        \n        // Draw an arrow shape\n        ctx.fillStyle = '#ffffff';\n        ctx.beginPath();\n        ctx.moveTo(size/2, 0);       // Top center\n        ctx.lineTo(size, size);      // Bottom right\n        ctx.lineTo(size/2, size*0.7); // Middle bottom\n        ctx.lineTo(0, size);         // Bottom left\n        ctx.closePath();\n        ctx.fill();\n        \n        // Add the image to the map\n        map.addImage('arrow-icon', { \n          data: ctx.getImageData(0, 0, size, size).data, \n          width: size, \n          height: size \n        });\n      }\n      \n      // Since we now include arrows in the text labels, we'll disable the separate arrow markers\n      // We'll keep the layer definition but make it invisible in case we want to revert this change\n      map.addLayer({\n        'id': 'route-arrows',\n        'type': 'symbol',\n        'source': 'route-arrows',\n        'layout': {\n          'symbol-placement': 'point',\n          'icon-image': 'arrow-icon', // Custom arrow icon\n          'icon-size': 0.5,\n          'icon-rotate': ['get', 'bearing'],\n          'icon-rotation-alignment': 'map',\n          'icon-allow-overlap': true,\n          'icon-ignore-placement': true,\n          'symbol-sort-key': 2, // Ensure arrows appear above the line\n          'visibility': 'none'  // Hide the arrows since they're now in the labels\n        },\n        'paint': {\n          'icon-opacity': 0\n        },\n        'filter': ['!', ['has', 'isLabel']] // Only show arrows, not labels\n      });\n      \n      // Add a layer for the leg labels with direct text property\n      map.addLayer({\n        'id': 'leg-labels',\n        'type': 'symbol',\n        'source': 'route-arrows',\n        'layout': {\n          'symbol-placement': 'point',\n          'text-field': ['get', 'text'], // Use direct text field\n          'text-size': 11,               // Smaller text\n          'text-font': ['Arial Unicode MS Bold'],\n          'text-offset': [0, -0.5],      // Original offset\n          'text-anchor': 'center',\n          'text-rotate': ['get', 'textBearing'], // Use the adjusted bearing for proper orientation\n          'text-rotation-alignment': 'map',\n          'text-allow-overlap': true,\n          'text-ignore-placement': true,\n          'text-max-width': 30,          // Wider to keep everything on one line\n          'text-line-height': 1.0,       // Tighter line height\n          'symbol-sort-key': 3           // Ensure labels appear above everything\n        },\n        'paint': {\n          'text-color': '#ffffff',\n          'text-halo-color': '#000000',  // Original halo color\n          'text-halo-width': 3,          // Original halo width\n          'text-opacity': 0.9            // Original opacity\n        },\n        'filter': ['has', 'isLabel']     // Only show labels, not arrows\n      });\n      \n      // Trigger route updated callback with coordinates\n      const routeData = {\n        waypoints: this.waypoints,\n        coordinates: coordinates\n      };\n      this.triggerCallback('onRouteUpdated', routeData);\n      \n      // Always calculate basic distance even when no aircraft is selected\n      // This ensures distance is displayed regardless of aircraft selection\n      if (window.routeCalculator) {\n        window.routeCalculator.calculateDistanceOnly(coordinates);\n      }\n    }\n  }\n  \n  /**\n   * Clear all waypoints and the route\n   */\n  clearRoute() {\n    const map = this.mapManager.getMap();\n    \n    // Remove all markers\n    this.markers.forEach(marker => {\n      marker.remove();\n    });\n    \n    this.markers = [];\n    this.waypoints = [];\n    \n    // Remove route, glow, and arrows from map\n    if (map) {\n      // Remove route layers and source\n      if (map.getSource('route')) {\n        if (map.getLayer('route-glow')) {\n          map.removeLayer('route-glow');\n        }\n        if (map.getLayer('route')) {\n          map.removeLayer('route');\n        }\n        map.removeSource('route');\n      }\n      \n      // Remove arrow layers, leg labels, and source\n      if (map.getSource('route-arrows')) {\n        if (map.getLayer('route-arrows')) {\n          map.removeLayer('route-arrows');\n        }\n        if (map.getLayer('leg-labels')) {\n          map.removeLayer('leg-labels');\n        }\n        map.removeSource('route-arrows');\n      }\n    }\n    \n    // Trigger callbacks\n    this.triggerCallback('onChange', this.waypoints);\n  }\n  \n  /**\n   * Reorder waypoints based on drag and drop\n   * @param {string} draggedId - The ID of the waypoint being dragged\n   * @param {string} dropTargetId - The ID of the waypoint being dropped onto\n   */\n  reorderWaypoints(draggedId, dropTargetId) {\n    const draggedIndex = this.waypoints.findIndex(wp => wp.id === draggedId);\n    const dropTargetIndex = this.waypoints.findIndex(wp => wp.id === dropTargetId);\n    \n    if (draggedIndex === -1 || dropTargetIndex === -1) {\n      console.error('Invalid waypoint IDs for reordering');\n      return;\n    }\n    \n    // Get the waypoint and marker being moved\n    const movedWaypoint = this.waypoints[draggedIndex];\n    const movedMarker = this.markers[draggedIndex];\n    \n    // Remove from current position\n    this.waypoints.splice(draggedIndex, 1);\n    this.markers.splice(draggedIndex, 1);\n    \n    // Insert at new position\n    this.waypoints.splice(dropTargetIndex, 0, movedWaypoint);\n    this.markers.splice(dropTargetIndex, 0, movedMarker);\n    \n    // Update route\n    this.updateRoute();\n    \n    // Trigger callbacks\n    console.log(`Reordered waypoint ${movedWaypoint.name} from index ${draggedIndex} to ${dropTargetIndex}`);\n    this.triggerCallback('onChange', this.waypoints);\n  }\n  \n  /**\n   * Find the insertion index for a new waypoint when clicking on a path\n   * @param {Object} clickedPoint - The clicked point {lng, lat}\n   * @returns {number} - The index to insert at\n   */\n  findPathInsertIndex(clickedPoint) {\n    if (this.waypoints.length < 2) return this.waypoints.length;\n    \n    let minDistance = Number.MAX_VALUE;\n    let insertIndex = 1;\n    \n    try {\n      for (let i = 0; i < this.waypoints.length - 1; i++) {\n        const segment = window.turf.lineString([\n          this.waypoints[i].coords,\n          this.waypoints[i + 1].coords\n        ]);\n        \n        const point = window.turf.point([clickedPoint.lng, clickedPoint.lat]);\n        const nearestPoint = window.turf.nearestPointOnLine(segment, point, { units: 'nauticalmiles' });\n        \n        if (nearestPoint.properties.dist < minDistance) {\n          minDistance = nearestPoint.properties.dist;\n          insertIndex = i + 1;\n        }\n      }\n    } catch (error) {\n      console.error('Error finding path insert index:', error);\n      // Default to adding at the end if there's an error\n      return this.waypoints.length;\n    }\n    \n    return insertIndex;\n  }\n  \n  /**\n   * Get all waypoints\n   * @returns {Array} - Array of waypoint objects\n   */\n  getWaypoints() {\n    return this.waypoints;\n  }\n  \n  /**\n   * Get a waypoint by ID\n   * @param {string} id - The waypoint ID\n   * @returns {Object|null} - The waypoint or null if not found\n   */\n  getWaypointById(id) {\n    return this.waypoints.find(wp => wp.id === id) || null;\n  }\n  \n  /**\n   * Update a waypoint's name\n   * @param {string} id - The waypoint ID\n   * @param {string} name - The new name\n   */\n  updateWaypointName(id, name) {\n    const waypoint = this.getWaypointById(id);\n    if (waypoint) {\n      waypoint.name = name;\n      this.triggerCallback('onChange', this.waypoints);\n    }\n  }\n\n  /**\n   * Set up route dragging functionality\n   * @param {Function} onRoutePointAdded - Callback when a new point is added via drag\n   */\n  setupRouteDragging(onRoutePointAdded) {\n    const map = this.mapManager.getMap();\n    if (!map) return;\n\n    console.log('Setting up route dragging functionality');\n\n    let isDragging = false;\n    let draggedLineCoordinates = [];\n    let originalLineCoordinates = [];\n    let dragStartPoint = null;\n    let closestPointIndex = -1;\n    let dragLineSource = null;\n\n    // Function to add the temporary drag line\n    const addDragLine = (coordinates) => {\n      try {\n        if (map.getSource('drag-line')) {\n          map.removeLayer('drag-line');\n          map.removeSource('drag-line');\n        }\n        \n        map.addSource('drag-line', {\n          'type': 'geojson',\n          'data': {\n            'type': 'Feature',\n            'properties': {},\n            'geometry': {\n              'type': 'LineString',\n              'coordinates': coordinates\n            }\n          }\n        });\n        \n        // FIXED: Change drag line color based on mode\n        // Yellow for waypoint mode, red for normal mode\n        const isWaypointMode = window.isWaypointModeActive === true;\n        \n        map.addLayer({\n          'id': 'drag-line',\n          'type': 'line',\n          'source': 'drag-line',\n          'layout': {\n            'line-join': 'round',\n            'line-cap': 'round'\n          },\n          'paint': {\n            'line-color': isWaypointMode ? '#FFCC00' : '#ff0000', // Yellow for waypoint mode, red for normal\n            'line-width': 4,\n            'line-dasharray': [2, 1] // Dashed line for the temp route\n          }\n        });\n\n        dragLineSource = map.getSource('drag-line');\n      } catch (error) {\n        console.error('Error adding drag line:', error);\n      }\n    };\n\n    // Helper to find closest point on the line and the segment it belongs to\n    const findClosestPointOnLine = (mouseLngLat, mousePoint) => {\n      try {\n        if (!map.getSource('route')) return null;\n        \n        // First check if the mouse is over a route feature using rendered features\n        // This is more accurate than calculating distance and works better for user interaction\n        const routeFeatures = map.queryRenderedFeatures(mousePoint, { layers: ['route'] });\n        const isMouseOverRoute = routeFeatures && routeFeatures.length > 0;\n        \n        const routeSource = map.getSource('route');\n        if (!routeSource || !routeSource._data) return null;\n        \n        const coordinates = routeSource._data.geometry.coordinates;\n        if (!coordinates || coordinates.length < 2) return null;\n        \n        let minDistance = Infinity;\n        let closestPoint = null;\n        let segmentIndex = -1;\n        \n        // Check each segment of the line\n        for (let i = 0; i < coordinates.length - 1; i++) {\n          const line = window.turf.lineString([coordinates[i], coordinates[i + 1]]);\n          const point = window.turf.point([mouseLngLat.lng, mouseLngLat.lat]);\n          const snapped = window.turf.nearestPointOnLine(line, point);\n          \n          if (snapped.properties.dist < minDistance) {\n            minDistance = snapped.properties.dist;\n            closestPoint = snapped.geometry.coordinates;\n            segmentIndex = i;\n          }\n        }\n        \n        // Convert distance to nautical miles for easy comparison\n        const distanceNM = window.turf.distance(\n          window.turf.point([mouseLngLat.lng, mouseLngLat.lat]),\n          window.turf.point(closestPoint),\n          { units: 'nauticalmiles' }\n        );\n        \n        // If mouse is directly over the route (pixel-perfect), return regardless of distance\n        // Otherwise use a more generous distance threshold (0.5 nautical miles)\n        const maxDistanceThreshold = 0.5; // More generous distance in nautical miles\n        \n        if (isMouseOverRoute || distanceNM < maxDistanceThreshold) {\n          return { \n            point: closestPoint, \n            index: segmentIndex,\n            distance: distanceNM,\n            isDirectlyOver: isMouseOverRoute\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.error('Error finding closest point on line:', error);\n        return null;\n      }\n    };\n\n    // Setup mousedown event for starting the drag\n    map.on('mousedown', (e) => {\n      // Skip if no route or if clicking on a waypoint\n      if (!map.getSource('route')) return;\n      \n      // Don't start drag if right-click\n      if (e.originalEvent.button === 2) return;\n      \n      // Check for platform markers and don't start drag if clicked on one\n      const platformFeatures = map.queryRenderedFeatures(e.point, { layers: ['platforms-layer'] });\n      if (platformFeatures.length > 0) return;\n      \n      // Find the closest point on the route line\n      const mousePos = e.lngLat;\n      const closestInfo = findClosestPointOnLine(mousePos, e.point);\n      \n      // If mouse is directly over the route or within distance threshold\n      if (closestInfo) {\n        console.log('Starting route drag operation at segment:', closestInfo.index, \n                   'Distance:', closestInfo.distance.toFixed(2) + ' nm',\n                   'Directly over route:', closestInfo.isDirectlyOver);\n        \n        // Get the original route coordinates\n        const routeSource = map.getSource('route');\n        if (!routeSource || !routeSource._data) return;\n        originalLineCoordinates = [...routeSource._data.geometry.coordinates];\n        \n        // Start dragging\n        isDragging = true;\n        dragStartPoint = closestInfo.point;\n        closestPointIndex = closestInfo.index;\n        \n        // Make a copy of the coordinates for dragging\n        draggedLineCoordinates = [...originalLineCoordinates];\n        \n        // Insert a new point at the drag location, right after the closest segment start\n        draggedLineCoordinates.splice(\n          closestPointIndex + 1, \n          0, \n          closestInfo.point\n        );\n        \n        // Add the temporary drag line\n        addDragLine(draggedLineCoordinates);\n        \n        // Hide the original route and glow during dragging\n        map.setLayoutProperty('route', 'visibility', 'none');\n        if (map.getLayer('route-glow')) {\n          map.setLayoutProperty('route-glow', 'visibility', 'none');\n        }\n        \n        // Change cursor to grabbing\n        map.getCanvas().style.cursor = 'grabbing';\n        \n        // Prevent default behavior\n        e.preventDefault();\n      }\n    });\n\n    // Set up route hover effect to make it clear it can be dragged\n    map.on('mousemove', (e) => {\n      if (isDragging) {\n        // Update the position of the dragged point\n        draggedLineCoordinates[closestPointIndex + 1] = [e.lngLat.lng, e.lngLat.lat];\n        \n        // Update the drag line\n        if (dragLineSource) {\n          dragLineSource.setData({\n            'type': 'Feature',\n            'properties': {},\n            'geometry': {\n              'type': 'LineString',\n              'coordinates': draggedLineCoordinates\n            }\n          });\n        }\n      } else {\n        // Check if mouse is over the route when not dragging\n        const closestInfo = findClosestPointOnLine(e.lngLat, e.point);\n        \n        if (closestInfo && closestInfo.isDirectlyOver) {\n          // Change cursor to indicate draggable route\n          map.getCanvas().style.cursor = 'pointer';\n        } else if (map.getCanvas().style.cursor === 'pointer') {\n          // Reset cursor if it was previously set by this handler\n          // (but don't reset if it might have been set by platform hover)\n          const platformFeatures = map.queryRenderedFeatures(e.point, { layers: ['platforms-layer'] });\n          if (platformFeatures.length === 0) {\n            map.getCanvas().style.cursor = '';\n          }\n        }\n      }\n    });\n\n    // Setup mouseup for completing the drag\n    map.on('mouseup', (e) => {\n      if (!isDragging) return;\n      \n      // Clean up\n      isDragging = false;\n      \n      // Remove the temporary drag line\n      if (map.getSource('drag-line')) {\n        map.removeLayer('drag-line');\n        map.removeSource('drag-line');\n      }\n      \n      // Show the original route and glow again\n      map.setLayoutProperty('route', 'visibility', 'visible');\n      if (map.getLayer('route-glow')) {\n        map.setLayoutProperty('route-glow', 'visibility', 'visible');\n      }\n      \n      // FIXED: Check if we're in waypoint mode\n      const isWaypointMode = window.isWaypointModeActive === true;\n      \n      // Log the mode for debugging\n      console.log(`Route drag completed in ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'} mode`);\n      \n      // Call the callback with the segment index and new point\n      if (onRoutePointAdded && typeof onRoutePointAdded === 'function') {\n        console.log(`Route drag complete, adding new point at index: ${closestPointIndex + 1}`);\n        \n        // Include mode information in the drag data\n        const dragData = {\n          index: closestPointIndex + 1,\n          coords: [e.lngLat.lng, e.lngLat.lat],\n          isWaypointMode: isWaypointMode\n        };\n        \n        onRoutePointAdded(dragData.index, dragData.coords, dragData);\n      }\n      \n      // Reset cursor\n      map.getCanvas().style.cursor = '';\n      \n      // Reset variables\n      draggedLineCoordinates = [];\n      originalLineCoordinates = [];\n      dragStartPoint = null;\n      closestPointIndex = -1;\n      dragLineSource = null;\n    });\n\n    // Cancel the drag operation if the mouse leaves the map\n    map.on('mouseout', () => {\n      if (!isDragging) return;\n      \n      console.log('Mouse left map area, canceling route drag');\n      \n      // Clean up\n      isDragging = false;\n      \n      // Remove the temporary drag line\n      if (map.getSource('drag-line')) {\n        map.removeLayer('drag-line');\n        map.removeSource('drag-line');\n      }\n      \n      // Show the original route and glow again\n      map.setLayoutProperty('route', 'visibility', 'visible');\n      if (map.getLayer('route-glow')) {\n        map.setLayoutProperty('route-glow', 'visibility', 'visible');\n      }\n      \n      // Reset cursor\n      map.getCanvas().style.cursor = '';\n      \n      // Reset variables\n      draggedLineCoordinates = [];\n      originalLineCoordinates = [];\n      dragStartPoint = null;\n      closestPointIndex = -1;\n      dragLineSource = null;\n    });\n  }\n}\n\nexport default WaypointManager;","/**\n * PlatformManager.js\n * \n * Handles loading, displaying, and interacting with platform/rig data\n */\nimport LoadingIndicator from './LoadingIndicator';\n\nclass PlatformManager {\n  constructor(mapManager) {\n    this.mapManager = mapManager;\n    this.platforms = [];\n    this.waypoints = []; // New array to store waypoints separately\n    this.isVisible = true;\n    this.waypointModeActive = false; // New flag to track waypoint insertion mode\n    this.callbacks = {\n      onPlatformsLoaded: null,\n      onVisibilityChanged: null,\n      onError: null,\n      onWaypointsLoaded: null // New callback for when waypoints are loaded\n    };\n    // Flag to prevent duplicate source/layer creation\n    this.skipNextClear = false;\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} type - The callback type\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n  \n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n  \n  /**\n   * Load platform data from Foundry\n   * @param {Object} client - The OSDK client\n   * @param {string} regionName - The region name to filter by\n   * @returns {Promise} - Resolves when platforms are loaded\n   */\n  async loadPlatformsFromFoundry(client, regionName = \"GULF OF MEXICO\") {\n    // Show loading indicator\n    const loaderId = LoadingIndicator.show('.route-stats-title', \n      `Loading platform data for ${regionName}...`, \n      { position: 'bottom' });\n    \n    // Only clear platforms if skipNextClear is false\n    if (!this.skipNextClear) {\n      // Clear any existing data first to ensure fresh load\n      this.clearPlatforms();\n    } else {\n      console.log(`Skipping clearPlatforms due to skipNextClear flag for region: ${regionName}`);\n      // Reset the flag for next time\n      this.skipNextClear = false;\n    }\n    console.log(`Loading platforms for region: ${regionName}`);\n    \n    // Validate region name\n    if (!regionName) {\n      console.error(\"No region name provided - defaulting to GULF OF MEXICO\");\n      regionName = \"GULF OF MEXICO\";\n    }\n    const map = this.mapManager.getMap();\n    if (!map) {\n      LoadingIndicator.hide(loaderId);\n      return Promise.reject(new Error('Map is not initialized'));\n    }\n    \n    try {\n      // Check if we have a client - but don't reject the promise\n      if (!client) {\n        console.warn(\"No OSDK client provided - this may be expected on region changes\");\n        \n        // Update loading indicator\n        LoadingIndicator.updateText(loaderId, \"No client available - reconnecting...\");\n        setTimeout(() => {\n          LoadingIndicator.hide(loaderId);\n        }, 2000);\n        \n        // Return empty array instead of rejecting to prevent UI errors\n        this.platforms = [];\n        this.triggerCallback('onPlatformsLoaded', []);\n        return [];\n      }\n      \n      // We'll remove the problematic authentication check and rely on the client implementation\n      // to handle authentication errors properly during the API call\n      console.log(\"Using OSDK client to load platforms...\");\n      \n      try {\n        // Import the SDK\n        const sdk = await import('@flight-app/sdk');\n        \n        // Find location object without excessive logging\n        let locationObject = null;\n        if (sdk.AllGtLocationsV2) {\n          locationObject = sdk.AllGtLocationsV2;\n        } else if (sdk.AllGtLocations) {\n          locationObject = sdk.AllGtLocations;\n        } else {\n          // Look for any location-related objects\n          const locationOptions = Object.keys(sdk).filter(key => \n            key.includes('Location') || key.includes('location')\n          );\n          \n          if (locationOptions.length > 0) {\n            locationObject = sdk[locationOptions[0]];\n          } else {\n            throw new Error('No location-related objects found in SDK');\n          }\n        }\n        \n        // Query for platforms and locations without excessive logging\n        console.log(`Querying for platforms and airports in ${regionName}`);\n        \n        // Update loading indicator\n        LoadingIndicator.updateText(loaderId, `Querying for platforms in ${regionName}...`);\n        \n        // Fetch for this region, explicitly excluding reporting points\n        const result = await client(locationObject)\n          .where({ \n            region: regionName,\n            locationType: { $ne: \"REPORTING POINT OFFSHORE\" }\n          })\n          .fetchPage({\n            $pageSize: 5000, // Increased to make sure we get everything\n            $filter: `locationType ne 'REPORTING POINT ONSHORE'` // Also exclude onshore reporting points\n          });\n        \n        console.log(`Found ${result.data ? result.data.length : 0} total items for region ${regionName}`);\n        \n        // Then filter for fixed platforms on the client side to catch all variations\n        if (result.data && result.data.length > 0) {\n          // Before filtering, log all location types for reference\n          const allTypes = new Set();\n          result.data.forEach(item => {\n            if (item.locationType) {\n              allTypes.add(item.locationType);\n            }\n          });\n          console.log(\"All location types in results:\", Array.from(allTypes));\n          \n          // Filter to include only active items (for all types)\n          const originalCount = result.data.length;\n          \n          // Update loading indicator\n          LoadingIndicator.updateText(loaderId, `Filtering ${originalCount} locations...`);\n          \n          result.data = result.data.filter(item => {\n            // CRITICAL FILTER: Only include items with activeSite = \"Active\"\n            if (item.activeSite !== \"Active\") {\n              return false;\n            }\n            \n            if (!item.locationType) return false;\n            \n            const type = item.locationType.toUpperCase();\n            \n            // Explicitly exclude reporting points\n            if (type.includes(\"REPORTING POINT\")) return false;\n            \n            // Include all platform types\n            if (type.includes(\"PLATFORM\") || \n                type.includes(\"RIG\") ||\n                type.includes(\"VESSEL\") ||\n                type.includes(\"SHIP\") ||\n                type.includes(\"BLOCKS\") ||\n                type.includes(\"JACKUP\") ||\n                type.includes(\"MOVABLE\") ||\n                type.includes(\"MOVEABLE\") ||\n                type.includes(\"FPSO\") ||\n                type.includes(\"TLP\") ||\n                type.includes(\"SPAR\") ||\n                type.includes(\"DRILL\") ||\n                type.includes(\"PRODUCTION\") ||\n                type.includes(\"OIL\") ||\n                type.includes(\"GAS\") ||\n                type.includes(\"JACKET\") ||\n                (type.includes(\"OFFSHORE\") && !type.includes(\"REPORTING\"))) {\n              return true;\n            }\n            \n            // Include airports/airfields\n            if (item.ISAIRPORT === 'Yes' || item.isAirport === 'Yes' ||\n                type.includes('AIRPORT') || \n                type.includes('AIRFIELD') || \n                type.includes('BASE') || \n                type.includes('HELIPORT')) {\n              return true;\n            }\n            \n            // For Gulf of Mexico, be more inclusive with platform detection\n            if (item.region === \"GULF OF MEXICO\" && \n                (item.name?.startsWith('X') || item.locName?.startsWith('X'))) {\n              return true;\n            }\n            \n            // Exclude everything else\n            return false;\n          });\n          \n          console.log(`Filtered from ${originalCount} to ${result.data.length} ACTIVE items (platforms and airports)`);\n          \n          // Log how many inactive items were filtered out\n          const inactiveCount = originalCount - result.data.length;\n          console.log(`Filtered out ${inactiveCount} inactive items (activeSite ≠ \"Active\")`);\n          \n          // Check platform count by region to ensure we're getting data for all regions\n          let platformCountByRegion = {};\n          result.data.forEach(item => {\n            if (item.region) {\n              platformCountByRegion[item.region] = (platformCountByRegion[item.region] || 0) + 1;\n            }\n          });\n          console.log(`Platform count by region after filtering:`, platformCountByRegion);\n          \n          // Check for key platforms in Norway as a sanity check\n          if (regionName === \"NORWAY\") {\n            const criticalPlatforms = [\"ENLE\", \"ENWS\", \"ENWV\"];\n            criticalPlatforms.forEach(platform => {\n              const found = result.data.some(item => item.locName === platform);\n              console.log(`Platform ${platform} found in filtered results: ${found}`);\n            });\n          } \n          // Check for platforms in Gulf of Mexico\n          else if (regionName === \"GULF OF MEXICO\") {\n            console.log(`Gulf of Mexico platform count: ${result.data.filter(item => !item.ISAIRPORT && !item.isAirport).length}`);\n            // Log a sample of platform names\n            const samplePlatforms = result.data\n              .filter(item => !item.ISAIRPORT && !item.isAirport)\n              .slice(0, 5)\n              .map(item => item.locName || \"Unknown\");\n            console.log(`Sample Gulf of Mexico platforms: ${samplePlatforms.join(\", \")}`);\n          }\n        }\n        \n        console.log(`Found ${result.data ? result.data.length : 0} items for region: ${regionName}`);\n        \n        // Double-check that we're getting the right region\n        if (result.data && result.data.length > 0) {\n          // Count items by region to verify filtering is working\n          const regionCount = {};\n          result.data.forEach(item => {\n            if (item.region) {\n              regionCount[item.region] = (regionCount[item.region] || 0) + 1;\n            }\n          });\n          console.log(\"Region distribution in results:\", regionCount);\n        }\n          \n        console.log(`Query returned ${result.data ? result.data.length : 0} results`);\n        \n        // Always run specific queries for our key locations regardless of other results\n        console.log(\"Running specific queries for critical locations...\");\n        \n        // Track what we've already found\n        const existingNames = new Set();\n        if (result.data) {\n          result.data.forEach(item => {\n            if (item.locName) {\n              existingNames.add(item.locName);\n            }\n          });\n        }\n        \n        // Always query for airfields/airports in THIS SPECIFIC region\n        try {\n          console.log(`Specifically searching for airports in REGION: \"${regionName}\"`);\n          \n          // Simpler, more direct query to ensure proper filtering\n          const airportResult = await client(locationObject)\n            .where({ \n              region: regionName,\n              // We'll filter by type on the client side instead\n            })\n            .fetchPage({ $pageSize: 3000 }); // Increased from 2000 to ensure we get all airports\n            \n          // Filter for airports on client side\n          let airports = [];\n          if (airportResult.data && airportResult.data.length > 0) {\n            airports = airportResult.data.filter(item => {\n              if (!item) return false;\n              \n              // Check ISAIRPORT flag\n              if (item.ISAIRPORT === 'Yes' || item.isAirport === 'Yes') \n                return true;\n                \n              // Check locationType\n              if (item.locationType) {\n                const type = item.locationType.toUpperCase();\n                return type.includes('AIRPORT') || \n                       type.includes('AIRFIELD') || \n                       type.includes('BASE') ||\n                       type.includes('HELIPORT');\n              }\n              \n              return false;\n            });\n          }\n            \n          if (airports.length > 0) {\n            console.log(`Found ${airports.length} airports in region ${regionName}`);\n            \n            // Log some sample airports\n            console.log(\"Sample airports:\", airports.slice(0, 5).map(a => a.locName || 'Unknown'));\n            \n            // Combine results\n            if (!result.data) {\n              result.data = [];\n            }\n            \n            // Add only new items\n            for (const airport of airports) {\n              if (airport.locName && !existingNames.has(airport.locName)) {\n                result.data.push(airport);\n                existingNames.add(airport.locName);\n              }\n            }\n          } else {\n            console.log(`No airports found in region ${regionName}`);\n          }\n        } catch (err) {\n          console.warn(\"Error in airport-specific query:\", err);\n        }\n        \n        // Only search for critical locations in the current region\n        try {\n          // Map of critical locations to the regions they should be in\n          const criticalLocationsByRegion = {\n            \"GULF OF MEXICO\": [\"KHUM\"],\n            \"NORWAY\": [\"ENZV\", \"SVG\", \"STAVANGER\", \"SOLA\"]\n          };\n          \n          // Get critical locations for this region\n          const criticalLocations = criticalLocationsByRegion[regionName] || [];\n          \n          // No need for special case platform handling anymore since our filter is now correctly\n          // detecting all platform types including our key fixed platforms\n          console.log(`Using standard filtering for all platform types in ${regionName}`);\n          \n          if (criticalLocations.length > 0) {\n            console.log(`Looking for critical locations in ${regionName}: ${criticalLocations.join(', ')}`);\n            \n            for (const locName of criticalLocations) {\n              if (!existingNames.has(locName)) {\n                console.log(`Specifically searching for ${locName} in ${regionName}...`);\n                \n                const specificResult = await client(locationObject)\n                  .where({ \n                    region: regionName,\n                    locName: locName \n                  })\n                  .fetchPage({ $pageSize: 10 });\n                  \n                if (specificResult.data && specificResult.data.length > 0) {\n                  console.log(`Found ${locName} in ${regionName}!`);\n                  \n                  if (!result.data) {\n                    result.data = [];\n                  }\n                  \n                  for (const item of specificResult.data) {\n                    if (item.locName && !existingNames.has(item.locName)) {\n                      result.data.push(item);\n                      existingNames.add(item.locName);\n                    }\n                  }\n                } else {\n                  console.log(`${locName} not found in ${regionName} specific search`);\n                }\n              }\n            }\n          } else {\n            console.log(`No critical locations defined for region: ${regionName}`);\n          }\n        } catch (err) {\n          console.warn(\"Error in critical location search:\", err);\n        }\n        \n        if (!result || !result.data) {\n          console.error(\"No result data returned from API\");\n          return Promise.reject(new Error(\"No data returned from API\"));\n        }\n        \n        console.log(`Successfully fetched ${result.data.length} items`);\n        \n        // Log the structure of the data to understand what we're working with\n        if (result.data.length > 0) {\n          const sample = result.data[0];\n          console.log(\"Sample data structure:\", Object.keys(sample));\n          console.log(\"Sample item:\", sample);\n          \n          // Try to identify potential coordinate fields\n          const potentialCoordFields = [];\n          for (const key of Object.keys(sample)) {\n            const value = sample[key];\n            // Look for objects with latitude/longitude or array coordinates\n            if (value && typeof value === 'object') {\n              if (value.latitude !== undefined && value.longitude !== undefined) {\n                potentialCoordFields.push(key);\n              }\n              if (Array.isArray(value) && value.length === 2 && \n                  typeof value[0] === 'number' && typeof value[1] === 'number') {\n                potentialCoordFields.push(key);\n              }\n              if (value.coordinates && Array.isArray(value.coordinates)) {\n                potentialCoordFields.push(key);\n              }\n            }\n          }\n          console.log(\"Potential coordinate fields:\", potentialCoordFields);\n        }\n        \n        // Process data with improved type classification \n        const locations = [];\n        const processedNames = new Set(); // Track processed items to avoid duplicates\n        \n        // Update loading indicator\n        LoadingIndicator.updateText(loaderId, `Processing ${result.data ? result.data.length : 0} locations...`);\n        \n        // Debug counters\n        let fixedPlatformCount = 0;\n        let movablePlatformCount = 0;\n        let airportsCount = 0; // Changed name to avoid duplicate declaration\n        \n        // First, log what types are available in the data\n        const typeCount = {};\n        if (result.data) {\n          result.data.forEach(item => {\n            if (item.locationType) {\n              typeCount[item.locationType] = (typeCount[item.locationType] || 0) + 1;\n            }\n          });\n        }\n        console.log(\"Location types in results:\", typeCount);\n        \n        if (!result.data || result.data.length === 0) {\n          console.warn(\"No data returned for processing\");\n          return [];\n        }\n        \n        for (const item of result.data) {\n          // CRITICAL: Skip items from other regions\n          if (item.region && item.region !== regionName) {\n            console.log(`Skipping item from wrong region: ${item.locName} (${item.region})`);\n            continue;\n          }\n          \n          let name = '';\n          let coords = null;\n          let type = '';\n          let isAirfield = false;\n          let isMovable = false; // New property to track if this is a movable platform\n          \n          // Try to extract name\n          if (item.locName) name = item.locName;\n          else if (item.name) name = item.name;\n          else if (item.location_name) name = item.location_name;\n          else if (item.id) name = item.id.toString();\n          else continue; // Skip items with no identifiable name\n          \n          // Skip duplicates\n          if (processedNames.has(name)) {\n            continue;\n          }\n          \n          // Try to extract coordinates\n          // First check for geoPoint field\n          if (item.geoPoint) {\n            if (typeof item.geoPoint.longitude === 'number' && typeof item.geoPoint.latitude === 'number') {\n              coords = [item.geoPoint.longitude, item.geoPoint.latitude];\n            } else if (Array.isArray(item.geoPoint) && item.geoPoint.length === 2) {\n              coords = item.geoPoint;\n            } else if (item.geoPoint.coordinates && Array.isArray(item.geoPoint.coordinates)) {\n              coords = item.geoPoint.coordinates;\n            }\n          }\n          \n          // Check for direct lat/lon fields\n          if (!coords) {\n            if (item.LAT !== undefined && item.LON !== undefined) {\n              coords = [parseFloat(item.LON), parseFloat(item.LAT)];\n            } else if (item.lat !== undefined && item.lon !== undefined) {\n              coords = [parseFloat(item.lon), parseFloat(item.lat)];\n            } else if (item.latitude !== undefined && item.longitude !== undefined) {\n              coords = [parseFloat(item.longitude), parseFloat(item.latitude)];\n            }\n          }\n          \n          // Skip if we still couldn't get coordinates\n          if (!coords) {\n            console.log(`Skipping ${name} - no coordinates found`);\n            continue;\n          }\n          \n          // Try to determine type\n          if (item.locationType) type = item.locationType;\n          else if (item.type) type = item.type;\n          else if (item.location_type) type = item.location_type;\n          \n          // Final filter for unwanted types - skip waypoints and reporting points\n          if (type) {\n            const upperType = type.toUpperCase();\n            \n            // CRITICAL CHECKS for platform type identification\n            // First check if it's any kind of platform/rig/vessel\n            const isPlatformOrVessel = \n                upperType.includes('PLATFORM') || \n                upperType.includes('RIG') ||\n                upperType.includes('VESSEL') ||\n                upperType.includes('SHIP') ||\n                upperType.includes('JACKUP') ||\n                upperType.includes('FPSO') ||\n                upperType.includes('TLP') ||\n                upperType.includes('SPAR') ||\n                upperType.includes('DRILL') ||\n                upperType.includes('OFFSHORE');\n            \n            // Determine if it's specifically a fixed platform    \n            const isFixedPlatform = \n                (upperType.includes('FIXED') && upperType.includes('PLATFORM')) ||\n                (upperType === 'FIXED PLATFORM');\n                \n            // Skip unwanted navigation points ONLY if they're not any kind of platform\n            if (!isPlatformOrVessel && \n                (upperType.includes('WAYPOINT') || \n                upperType.includes('REPORTING POINT') || \n                upperType.includes('FIX') ||\n                upperType.includes('INTERSECTION') ||\n                upperType.includes('NAVAID'))) {\n              console.log(`Skipping navigation point: ${name} (${type})`);\n              continue;\n            }\n            \n            // Process item type without excessive logging\n            \n            // Skip reporting points explicitly\n            if (upperType.includes('REPORTING POINT')) {\n              continue;\n            }\n              \n            // First check for airfields (take priority over platform detection)\n            if (item.ISAIRPORT === 'Yes' || item.isAirport === 'Yes' || \n                upperType.includes('AIRPORT') || \n                upperType.includes('AIRFIELD') || \n                upperType.includes('BASE') || \n                upperType.includes('HELIPORT')) {\n              isAirfield = true;\n              isMovable = false;\n            }\n            // Check for platform types\n            else if (upperType.includes('PLATFORM') || \n                    upperType.includes('RIG') ||\n                    upperType.includes('VESSEL') ||\n                    upperType.includes('SHIP') ||\n                    upperType.includes('BLOCKS') ||\n                    upperType.includes('JACKUP') ||\n                    upperType.includes('FPSO') ||\n                    upperType.includes('TLP') ||\n                    upperType.includes('SPAR') ||\n                    upperType.includes('DRILL') ||\n                    upperType.includes('PRODUCTION') ||\n                    upperType.includes('OIL') ||\n                    upperType.includes('GAS') ||\n                    upperType.includes('JACKET') ||\n                    (upperType.includes('OFFSHORE') && !upperType.includes('REPORTING'))) {\n              \n              isAirfield = false;\n              \n              // Check if it's a movable platform\n              if (upperType.includes('MOVABLE') || \n                  upperType.includes('MOVEABLE') || \n                  upperType.includes('SHIP') || \n                  upperType.includes('VESSEL') ||\n                  upperType.includes('JACK-UP') ||\n                  upperType.includes('JACKUP') ||\n                  upperType.includes('DRILL SHIP') ||\n                  upperType.includes('SEMI-SUBMERSIBLE')) {\n                isMovable = true;\n              } \n              // Fixed platform detection\n              else if (upperType.includes('FIXED') || upperType.includes('STATIC')) {\n                isMovable = false;\n              }\n              // Default case for other platforms - treat as fixed\n              else {\n                isMovable = false;\n              }\n            }\n            // Gulf of Mexico special case - X prefixed platforms\n            else if (item.region === \"GULF OF MEXICO\" && \n                    (name.startsWith('X') || name.startsWith('K'))) {\n              isAirfield = false;\n              isMovable = false;\n            }\n            // Skip other types\n            else {\n              continue; \n            }\n          }\n          \n          // Special handling for specific key locations (without excessive logging)\n          if (name === 'ENZV' || name === 'SVG' || name.includes('STAVANGER') || name.includes('SOLA')) {\n            isAirfield = true;\n            \n            // Ensure ENZV has correct coordinates if found\n            if (name === 'ENZV' && (!coords || coords[0] === 0 || coords[1] === 0)) {\n              coords = [5.6316667, 58.8816667]; // Correct coordinates for ENZV\n            }\n          }\n          \n          if (name === 'KHUM' || name.includes('HOUMA')) {\n            isAirfield = true;\n            \n            // Ensure KHUM has correct coordinates if found\n            if (name === 'KHUM' && (!coords || coords[0] === 0 || coords[1] === 0)) {\n              coords = [-90.65383, 29.55583]; // Correct coordinates for KHUM\n            }\n          }\n          \n          // Count by type for debugging\n          if (isAirfield) {\n            airportsCount++; // Updated variable name\n          } else if (isMovable) {\n            movablePlatformCount++;\n          } else {\n            fixedPlatformCount++;\n          }\n          \n          // Add the processed location\n          locations.push({\n            name: name,\n            coordinates: coords,\n            operator: type || 'Unknown',\n            isAirfield: isAirfield,\n            isMovable: isMovable\n          });\n          \n          // Mark as processed\n          processedNames.add(name);\n        }\n        \n        // Simplified logging - just show summary\n        console.log(`Processed ${locations.length} locations (${airportsCount} airports, ${fixedPlatformCount} fixed platforms, ${movablePlatformCount} movable platforms)`);\n        \n        // Update loading indicator\n        LoadingIndicator.updateText(loaderId, `Adding ${locations.length} locations to map...`);\n        \n        // Add to map even if few or no locations found - this will at least show what we got\n        \n        // Check if we have at least some locations\n        if (locations.length > 0) {\n          console.log(`Adding ${locations.length} locations to map`);\n          this.addPlatformsToMap(locations);\n          \n          // Hide loading indicator after adding to map (the map loading will show its own indicator)\n          LoadingIndicator.hide(loaderId);\n          return locations;\n        } else {\n          console.warn(\"No valid locations found with coordinates\");\n          \n          // Update loading indicator\n          LoadingIndicator.updateText(loaderId, \"No locations found for this region\");\n          setTimeout(() => {\n            LoadingIndicator.hide(loaderId);\n          }, 2000);\n          \n          // Create empty array to avoid errors in the UI\n          this.platforms = [];\n          this.triggerCallback('onPlatformsLoaded', []);\n          return [];\n        }\n        \n      } catch (error) {\n        console.error('OSDK API error:', error);\n        \n        // Update loading indicator with error\n        LoadingIndicator.updateText(loaderId, `Error loading platforms: ${error.message}`);\n        setTimeout(() => {\n          LoadingIndicator.hide(loaderId);\n        }, 3000);\n        \n        // Even on error, don't throw so the app won't crash\n        console.warn(\"Error occurred, returning empty locations array\");\n        \n        // Create empty array to avoid errors in the UI\n        this.platforms = [];\n        this.triggerCallback('onPlatformsLoaded', []);\n        return [];\n      }\n    } catch (error) {\n      console.error('General error in loadPlatformsFromFoundry:', error);\n      \n      // Update loading indicator with error\n      LoadingIndicator.updateText(loaderId, `Error: ${error.message}`);\n      setTimeout(() => {\n        LoadingIndicator.hide(loaderId);\n      }, 3000);\n      \n      // Create empty array to avoid errors in the UI\n      this.platforms = [];\n      this.triggerCallback('onPlatformsLoaded', []);\n      return [];\n    }\n  }\n  \n  /**\n   * Clear all platforms from the map\n   */\n  clearPlatforms() {\n    const map = this.mapManager.getMap();\n    if (!map) return;\n    \n    console.log('Clearing all platforms from map');\n    \n    // Make sure the map is loaded before attempting to remove layers\n    this.mapManager.onMapLoaded(() => {\n      try {\n        // Define all possible platform-related layer IDs\n        const allLayers = [\n          'platforms-layer',           // Main platform layer\n          'platforms-fixed-layer',     // Fixed platforms layer\n          'platforms-movable-layer',   // Movable platforms layer\n          'platforms-labels',          // Main platform labels\n          'platforms-fixed-labels',    // Fixed platform labels\n          'platforms-movable-labels',  // Movable platform labels\n          'airfields-layer',           // Airfields layer\n          'airfields-labels'           // Airfield labels\n        ];\n        \n        // First remove all layers\n        for (const layerId of allLayers) {\n          if (map.getLayer(layerId)) {\n            try {\n              map.removeLayer(layerId);\n              console.log(`Successfully removed layer: ${layerId}`);\n            } catch (e) {\n              console.warn(`Error removing layer ${layerId}:`, e);\n            }\n          }\n        }\n        \n        // Wait a moment before removing the source\n        setTimeout(() => {\n          // THEN remove the source (after all layers using it are gone)\n          if (map.getSource('major-platforms')) {\n            try {\n              map.removeSource('major-platforms');\n              console.log('Successfully removed source: major-platforms');\n            } catch (e) {\n              console.warn('Error removing source major-platforms:', e);\n            }\n          }\n        }, 100);\n        \n        // Clear the platforms array\n        this.platforms = [];\n        \n      } catch (error) {\n        console.error('Error clearing platforms:', error);\n      }\n    });\n  }\n  \n  /**\n   * Add platforms to the map\n   * @param {Array} platforms - Array of platform objects\n   */\n  addPlatformsToMap(platforms) {\n    const map = this.mapManager.getMap();\n    if (!map) return;\n    \n    // Count how many of each type for debugging\n    const airfieldCount = platforms.filter(p => p.isAirfield).length;\n    const platformCount = platforms.length - airfieldCount;\n    \n    console.log(`Adding ${platforms.length} locations to map: ${platformCount} platforms and ${airfieldCount} airfields`);\n    \n    // Store the platforms\n    this.platforms = platforms;\n\n    // Define the function to actually add layers/sources\n    const addLayersAndSource = () => {\n      const map = this.mapManager.getMap(); // Re-get map instance inside callback if needed\n      if (!map) {\n        console.error(\"Map became unavailable before adding platforms.\");\n        this.triggerCallback('onError', \"Map became unavailable\");\n        return;\n      }\n      \n      // Load airport icon if not already loaded\n      // This ensures we have a proper airport icon even if the default style doesn't include it\n      if (!map.hasImage('airport-icon')) {\n        try {\n          // Create a simple airport icon as fallback\n          const size = 16;\n          const halfSize = size / 2;\n          const canvas = document.createElement('canvas');\n          canvas.width = size;\n          canvas.height = size;\n          const ctx = canvas.getContext('2d');\n          \n          // Draw a blue circle\n          ctx.beginPath();\n          ctx.arc(halfSize, halfSize, halfSize - 2, 0, 2 * Math.PI);\n          ctx.fillStyle = '#043277'; // Lighter blue\n          ctx.fill();\n          ctx.strokeStyle = '#ffffff';\n          ctx.lineWidth = 1;\n          ctx.stroke();\n          \n          // Draw an \"A\" letter in white\n          ctx.fillStyle = '#ffffff';\n          ctx.font = 'bold 8px sans-serif'; // Smaller A\n          ctx.textAlign = 'center';\n          ctx.textBaseline = 'middle';\n          ctx.fillText('A', halfSize, halfSize);\n          \n          map.addImage('airport-icon', { \n            data: ctx.getImageData(0, 0, size, size).data, \n            width: size, \n            height: size \n          });\n          console.log('Created custom airport icon');\n        } catch (error) {\n          console.error('Error creating airport icon:', error);\n        }\n      }\n      \n      try {\n        // CRITICAL FIX: Check if we should skip removing/recreating sources\n        // to avoid the \"already exists\" error during region changes\n        if (!this.skipNextClear) {\n          console.log(\"Removing existing platform layers and sources...\");\n          // Remove existing layers first if they exist\n          const platformLayers = [\n            'platforms-layer',         // Check for old layer name too\n            'platforms-fixed-layer',\n            'platforms-movable-layer',\n            'platforms-fixed-labels',\n            'platforms-movable-labels',\n            'airfields-layer',\n            'airfields-labels'\n          ];\n          \n          // First remove all layers\n          platformLayers.forEach(layerId => {\n            if (map.getLayer(layerId)) {\n              try {\n                map.removeLayer(layerId);\n              } catch (e) {\n                console.warn(`Error removing layer ${layerId}:`, e);\n              }\n            }\n          });\n          \n          // IMPORTANT: Wait briefly before removing the source\n          // This helps avoid \"source in use\" errors\n          setTimeout(() => {\n            // Then remove source\n            if (map.getSource('major-platforms')) {\n              try {\n                map.removeSource('major-platforms');\n              } catch (e) {\n                console.warn(\"Error removing source:\", e);\n              }\n            }\n          }, 50);\n        } else {\n          console.log(\"SKIPPING source/layer removal due to skipNextClear flag\");\n          // Reset the flag for next time\n          this.skipNextClear = false;\n        }\n        \n        // Check if source already exists to prevent duplicate error\n        const sourceExists = map.getSource('major-platforms');\n        \n        // Debug - check for specific platforms before mapping\n        const debugPlatforms = [\"ENLE\", \"ENWS\", \"ENWV\", \"ENZV\"];\n        console.log(\"CHECKING PLATFORMS IN MAP DATA:\");\n        debugPlatforms.forEach(name => {\n          const found = platforms.find(p => p.name === name);\n          if (found) {\n            console.log(`🗺️ Found ${name} in map data at coordinates [${found.coordinates}]`);\n          } else {\n            console.log(`❓ ${name} NOT found in map data`);\n          }\n        });\n        \n        // Create GeoJSON data with isAirfield and isMovable properties\n        console.log(\"Creating features for map display from\", platforms.length, \"platforms\");\n        \n        // Count for debugging\n        let fixedPlatformsCount = 0;\n        let movablePlatformsCount = 0;\n        let airfieldsCount = 0;\n        \n        const features = platforms.map(platform => {\n          // Debug any platforms with invalid coordinates\n          if (!Array.isArray(platform.coordinates) || platform.coordinates.length !== 2 ||\n              typeof platform.coordinates[0] !== 'number' || typeof platform.coordinates[1] !== 'number') {\n            console.log(`⚠️ Platform ${platform.name} has invalid coordinates: ${JSON.stringify(platform.coordinates)}`);\n          }\n          \n          // Count by type for debugging\n          if (platform.isAirfield) {\n            airfieldsCount++;\n          } else if (platform.isMovable) {\n            movablePlatformsCount++;\n          } else {\n            fixedPlatformsCount++;\n          }\n          \n          return {\n            type: 'Feature',\n            properties: {\n              name: platform.name,\n              operator: platform.operator || 'Unknown',\n              isAirfield: !!platform.isAirfield, // Convert to boolean\n              isMovable: !!platform.isMovable   // Convert to boolean\n            },\n            geometry: {\n              type: 'Point',\n              coordinates: platform.coordinates\n            }\n          };\n        });\n        \n        // Debug log to verify we have features of each type\n        console.log(`Created ${features.length} features for map:`);\n        console.log(`- ${airfieldsCount} airfields`);\n        console.log(`- ${fixedPlatformsCount} fixed platforms`);\n        console.log(`- ${movablePlatformsCount} movable platforms`);\n        \n        console.log(\"Adding source with features data\");\n        // Add source\n        // Add source only if it doesn't exist yet\n        if (!sourceExists) {\n          try {\n            map.addSource('major-platforms', {\n              type: 'geojson',\n              data: {\n                type: 'FeatureCollection',\n                features: features\n              }\n            });\n          } catch (e) {\n            // If source already exists error, try to update it\n            if (e.message && e.message.includes(\"already exists\")) {\n              console.log(\"Source already exists, trying to update data instead\");\n              try {\n                const source = map.getSource('major-platforms');\n                if (source && typeof source.setData === 'function') {\n                  source.setData({\n                    type: 'FeatureCollection',\n                    features: features\n                  });\n                }\n              } catch (updateError) {\n                console.error(\"Error updating source data:\", updateError);\n              }\n            }\n          }\n        } else {\n          // If source exists, update its data\n          try {\n            const source = map.getSource('major-platforms');\n            if (source && typeof source.setData === 'function') {\n              source.setData({\n                type: 'FeatureCollection',\n                features: features\n              });\n            }\n          } catch (updateError) {\n            console.error(\"Error updating source data:\", updateError);\n          }\n        }\n\n        console.log(\"Adding fixed platforms layer\");\n        // Add FIXED platforms with teal ring and darker blue center\n        map.addLayer({\n          id: 'platforms-layer',  // Changed to match event handler in MapComponent\n          type: 'circle',\n          source: 'major-platforms',\n          filter: ['all', \n                  ['==', ['get', 'isAirfield'], false],  // Not an airfield\n                  ['==', ['get', 'isMovable'], false]    // Not a movable platform\n                 ], \n          paint: {\n            'circle-radius': 2,              // Slightly larger\n            'circle-color': '#073b8e',       // Darker blue center\n            'circle-stroke-width': 1,        // Thicker stroke for better visibility\n            'circle-stroke-color': '#03bf42', // Teal ring\n            'circle-opacity': 1              // Fully opaque\n          }\n        });\n        \n        console.log(\"Adding movable platforms layer\");\n        // Add MOVABLE platforms with orange ring and dark red center\n        map.addLayer({\n          id: 'platforms-movable-layer',\n          type: 'circle',\n          source: 'major-platforms',\n          filter: ['all', \n                  ['==', ['get', 'isAirfield'], false],  // Not an airfield\n                  ['==', ['get', 'isMovable'], true]     // Is a movable platform\n                 ],\n          paint: {\n            'circle-radius': 2,              // Slightly larger\n            'circle-color': '#ad0303',       // Dark red center\n            'circle-stroke-width': 1,        // Thicker stroke for better visibility\n            'circle-stroke-color': '#f2efef', // Orange ring\n            'circle-opacity': 1              // Fully opaque\n          }\n        });\n\n        // No debug layer - just use the regular platform layers\n        \n        // Add airfields with pin-style markers\n        map.addLayer({\n          id: 'airfields-layer',\n          type: 'symbol',\n          source: 'major-platforms',\n          filter: ['==', ['get', 'isAirfield'], true], // Only airfields\n          layout: {\n            // Try to use our custom icon first, fallback to built-in if available\n            'icon-image': map.hasImage('airport-icon') ? 'airport-icon' : 'airport-15',\n            'icon-size': 1,                 // Make it slightly larger\n            'icon-allow-overlap': true,       // Allow icons to overlap\n            'icon-anchor': 'bottom',          // Anchor at bottom so it looks like a pin\n            'icon-offset': [0, -5]            // Small offset to fine-tune position\n          }\n        });\n        \n        // Add platform labels for fixed platforms - white text\n        map.addLayer({\n          id: 'platforms-fixed-labels',\n          type: 'symbol',\n          source: 'major-platforms',\n          filter: ['all', \n                  ['==', ['get', 'isAirfield'], false],  // Not an airfield\n                  ['==', ['get', 'isMovable'], false]    // Not a movable platform\n                 ],\n          layout: {\n            'text-field': ['get', 'name'],\n            'text-size': 10,               // Slightly larger for readability\n            'text-anchor': 'top',\n            'text-offset': [0, 0.8],       // Moved further from the marker\n            'text-allow-overlap': false,\n            'text-ignore-placement': false,\n            'symbol-sort-key': ['get', 'name']\n          },\n          paint: {\n            'text-color': '#7192c4',       // White text\n            'text-halo-color': '#000000',  \n            'text-halo-width': 1           // Thicker halo for better contrast\n          }\n        });\n        \n        // Add platform labels for movable platforms - light orange text\n        map.addLayer({\n          id: 'platforms-movable-labels',\n          type: 'symbol',\n          source: 'major-platforms',\n          filter: ['all', \n                  ['==', ['get', 'isAirfield'], false],  // Not an airfield\n                  ['==', ['get', 'isMovable'], true]     // Is a movable platform\n                 ],\n          layout: {\n            'text-field': ['get', 'name'],\n            'text-size': 10,               // Slightly larger for readability\n            'text-anchor': 'top',\n            'text-offset': [0, 0.8],       // Moved further from the marker\n            'text-allow-overlap': false,\n            'text-ignore-placement': false,\n            'symbol-sort-key': ['get', 'name']\n          },\n          paint: {\n            'text-color': '#7192c4',       // Light orange text\n            'text-halo-color': '#000000',  \n            'text-halo-width': 1           // Thicker halo for better contrast\n          }\n        });\n        \n        // Add airfield labels - lighter blue text, closer to icon\n        map.addLayer({\n          id: 'airfields-labels',\n          type: 'symbol',\n          source: 'major-platforms',\n          filter: ['==', ['get', 'isAirfield'], true], // Only airfields\n          layout: {\n            'text-field': ['get', 'name'],\n            'text-size': 12,                // Larger text\n            'text-anchor': 'top',\n            'text-offset': [0, 0.6],       // Move text closer to icon\n            'text-allow-overlap': false,\n            'text-ignore-placement': false,\n            'symbol-sort-key': ['get', 'name']\n          },\n          paint: {\n            'text-color': '#66aaff',       // Lighter blue text\n            'text-halo-color': '#000000',  \n            'text-halo-width': 1.5         // Thicker halo for better visibility\n          }\n        });\n        \n        // Trigger callback\n        this.triggerCallback('onPlatformsLoaded', platforms);\n      } catch (error) {\n        console.error('Error adding platforms to map:', error);\n        this.triggerCallback('onError', error.message);\n      }\n    };\n\n    // Use onMapLoaded to handle timing, whether map is already loaded or needs to wait\n    console.log('Requesting to add layers/source, using onMapLoaded for timing.');\n    this.mapManager.onMapLoaded(addLayersAndSource);\n  }\n  \n  /**\n   * Toggle visibility of platforms\n   * @returns {boolean} - The new visibility state\n   */\n  toggleVisibility() {\n    const map = this.mapManager.getMap();\n    if (!map) return this.isVisible;\n    \n    this.isVisible = !this.isVisible;\n    \n    try {\n      // Toggle visibility of all platform and airfield layers\n      const allLayers = [\n        'platforms-layer',             // Main fixed platforms layer\n        'platforms-fixed-layer',       // Alternative fixed platforms layer\n        'platforms-movable-layer',     // Movable platforms layer\n        'platforms-fixed-labels',      // Fixed platform labels\n        'platforms-movable-labels',    // Movable platform labels\n        'airfields-layer',             // Airfield markers\n        'airfields-labels'             // Airfield labels\n      ];\n      const visibility = this.isVisible ? 'visible' : 'none';\n      \n      allLayers.forEach(layerId => {\n        if (map.getLayer(layerId)) {\n          map.setLayoutProperty(layerId, 'visibility', visibility);\n        }\n      });\n    } catch (error) {\n      console.warn('Error toggling platform visibility:', error);\n    }\n    \n    this.triggerCallback('onVisibilityChanged', this.isVisible);\n    return this.isVisible;\n  }\n  \n  /**\n   * Find the nearest navigation waypoint to a given coordinate\n   * Specifically for finding navigation waypoints (not platforms/rigs)\n   * \n   * @param {number} lat - Latitude\n   * @param {number} lng - Longitude\n   * @param {number} maxDistance - Maximum distance in nautical miles (default: 5)\n   * @returns {Object|null} - The nearest waypoint or null if none found within maxDistance\n   */\n  findNearestWaypoint(lat, lng, maxDistance = 5) {\n    // Check if we have waypoints loaded\n    if (!this.waypoints || this.waypoints.length === 0) {\n      console.log(\"PlatformManager: No waypoints available. Try activating waypoint mode first.\");\n      return null;\n    }\n    \n    // Check if turf.js is available for distance calculations\n    if (!window.turf) {\n      console.error(\"PlatformManager: Turf.js not loaded, cannot find nearest waypoint\");\n      return null;\n    }\n    \n    try {\n      // Create a point at the click location\n      const clickPoint = window.turf.point([lng, lat]);\n      \n      // Find the nearest waypoint\n      let nearestWaypoint = null;\n      let minDistance = Number.MAX_VALUE;\n      \n      this.waypoints.forEach(waypoint => {\n        // Skip if waypoint has no coordinates\n        if (!waypoint.coordinates || waypoint.coordinates.length !== 2) {\n          return;\n        }\n        \n        // Create a point at the waypoint location\n        const waypointPoint = window.turf.point(waypoint.coordinates);\n        \n        // Calculate distance in nautical miles\n        const distance = window.turf.distance(clickPoint, waypointPoint, { units: 'nauticalmiles' });\n        \n        if (distance < minDistance) {\n          minDistance = distance;\n          nearestWaypoint = {\n            ...waypoint,\n            distance: distance\n          };\n        }\n      });\n      \n      // Only return if within reasonable distance\n      if (nearestWaypoint && minDistance <= maxDistance) {\n        console.log(`PlatformManager: Found nearest waypoint ${nearestWaypoint.name} at distance ${nearestWaypoint.distance.toFixed(2)} nm`);\n        return nearestWaypoint;\n      } else if (nearestWaypoint) {\n        console.log(`PlatformManager: Nearest waypoint ${nearestWaypoint.name} is too far (${nearestWaypoint.distance.toFixed(2)} nm > ${maxDistance} nm)`);\n      } else {\n        console.log(`PlatformManager: No waypoints found`);\n      }\n      \n      return null;\n    } catch (error) {\n      console.error(\"PlatformManager: Error finding nearest waypoint:\", error);\n      return null;\n    }\n  }\n  \n  /**\n   * Get all platforms\n   * @returns {Array} - Array of platform objects\n   */\n  getPlatforms() {\n    return this.platforms;\n  }\n  \n  /**\n   * Get visibility state\n   * @returns {boolean} - True if platforms are visible\n   */\n  getVisibility() {\n    return this.isVisible;\n  }\n  \n  /**\n   * Search platforms by name\n   * @param {string} query - The search query\n   * @param {number} limit - Maximum number of results to return\n   * @returns {Array} - Array of matching platforms\n   */\n  searchPlatformsByName(query, limit = 5) {\n    if (!query || !this.platforms || this.platforms.length === 0) {\n      return [];\n    }\n    \n    const normalizedQuery = query.toLowerCase().trim();\n    \n    // If empty query after trimming, return empty array\n    if (!normalizedQuery) {\n      return [];\n    }\n    \n    // First look for exact matches\n    const exactMatches = this.platforms.filter(platform => \n      platform.name.toLowerCase() === normalizedQuery\n    );\n    \n    // Then look for platforms whose names start with the query\n    const startsWithMatches = this.platforms.filter(platform => \n      platform.name.toLowerCase().startsWith(normalizedQuery) &&\n      !exactMatches.includes(platform)\n    );\n    \n    // Finally look for platforms whose names contain the query\n    const containsMatches = this.platforms.filter(platform => \n      platform.name.toLowerCase().includes(normalizedQuery) &&\n      !exactMatches.includes(platform) &&\n      !startsWithMatches.includes(platform)\n    );\n    \n    // Combine results with priority: exact > starts with > contains\n    const results = [\n      ...exactMatches,\n      ...startsWithMatches,\n      ...containsMatches\n    ].slice(0, limit);\n    \n    return results;\n  }\n  \n  /**\n   * Find a single platform by name (exact or close match)\n   * @param {string} name - The platform name to find\n   * @returns {Object|null} - The platform object or null if not found\n   */\n  findPlatformByName(name) {\n    if (!name || !this.platforms || this.platforms.length === 0) {\n      return null;\n    }\n    \n    const normalizedName = name.toLowerCase().trim();\n    \n    // If empty name after trimming, return null\n    if (!normalizedName) {\n      return null;\n    }\n    \n    console.log(`PlatformManager: Looking for platform with name: ${normalizedName}`);\n    \n    // First try exact match\n    let platform = this.platforms.find(p => \n      p.name.toLowerCase() === normalizedName\n    );\n    \n    // If not found, try case-insensitive match\n    if (!platform) {\n      platform = this.platforms.find(p => \n        p.name.toLowerCase().includes(normalizedName)\n      );\n    }\n    \n    if (platform) {\n      console.log(`PlatformManager: Found platform \"${platform.name}\" at coordinates [${platform.coordinates}]`);\n      return platform;\n    } else {\n      console.log(`PlatformManager: No platform found with name: ${normalizedName}`);\n      return null;\n    }\n  }\n  \n  /**\n   * Load waypoints from Foundry OSDK\n   * This function loads waypoints instead of platforms and rigs.\n   * Used for waypoint insertion mode.\n   * \n   * @param {Object} client - The OSDK client\n   * @param {string} regionName - The region name to filter by\n   * @returns {Promise} - Resolves when waypoints are loaded\n   */\n  async loadWaypointsFromFoundry(client, regionName = \"NORWAY\") {\n    // Show loading indicator\n    const loaderId = LoadingIndicator.show('.route-stats-title', \n      `Loading waypoints for ${regionName}...`, \n      { position: 'bottom' });\n    \n    // SIMPLE FIX: Make sure regionName is valid\n    if (!regionName) {\n      console.warn(\"Empty region name provided, defaulting to NORWAY\");\n      regionName = \"NORWAY\";\n    }\n    \n    // Debug output\n    console.log(`🗺️ Loading waypoints for region: ${regionName} (type: ${typeof regionName})`);\n    \n    // Clear any existing waypoints first\n    this.clearWaypoints();\n    \n    try {\n      // Check if we have a client\n      if (!client) {\n        console.warn(\"🗺️ No OSDK client provided for waypoint loading\");\n        \n        // Try to get from global window.client\n        if (window.client) {\n          console.log(\"🗺️ Using global window.client instead\");\n          client = window.client;\n        } else {\n          LoadingIndicator.updateText(loaderId, \"No client available - reconnecting...\");\n          setTimeout(() => {\n            LoadingIndicator.hide(loaderId);\n          }, 2000);\n          \n          // Return empty array\n          this.waypoints = [];\n          this.triggerCallback('onWaypointsLoaded', []);\n          return [];\n        }\n      }\n      \n      console.log(\"🗺️ Using OSDK client to load waypoints...\");\n      \n      try {\n        // Import the SDK\n        const sdk = await import('@flight-app/sdk');\n        \n        // Find location object\n        let locationObject = null;\n        \n        // First try to find exact reporting point objects\n        if (sdk.ReportingPointsOffshore) {\n          console.log(\"🗺️ Found ReportingPointsOffshore object\");\n          locationObject = sdk.ReportingPointsOffshore;\n        } else if (sdk.ReportingPointsAll) {\n          console.log(\"🗺️ Found ReportingPointsAll object\");\n          locationObject = sdk.ReportingPointsAll;\n        } else if (sdk.ReportingPoints) {\n          console.log(\"🗺️ Found ReportingPoints object\");\n          locationObject = sdk.ReportingPoints;\n        } else if (sdk.Waypoints) {\n          console.log(\"🗺️ Found Waypoints object\");\n          locationObject = sdk.Waypoints;\n        } else if (sdk.NavigationWaypoints) {\n          console.log(\"🗺️ Found NavigationWaypoints object\");\n          locationObject = sdk.NavigationWaypoints;\n        } else if (sdk.AllGtLocationsV2) {\n          console.log(\"🗺️ Using AllGtLocationsV2 object as fallback\");\n          locationObject = sdk.AllGtLocationsV2;\n        } else if (sdk.AllGtLocations) {\n          console.log(\"🗺️ Using AllGtLocations object as fallback\");\n          locationObject = sdk.AllGtLocations;\n        } else {\n          // Look for any location-related objects\n          const locationOptions = Object.keys(sdk).filter(key => \n            key.includes('Location') || key.includes('location') || \n            key.includes('Waypoint') || key.includes('waypoint') ||\n            key.includes('Reporting') || key.includes('reporting')\n          );\n          \n          console.log(\"🗺️ Available location options:\", locationOptions);\n          \n          if (locationOptions.length > 0) {\n            locationObject = sdk[locationOptions[0]];\n            console.log(`🗺️ Using ${locationOptions[0]} object`);\n          } else {\n            throw new Error('No location-related objects found in SDK');\n          }\n        }\n        \n        // Update loading indicator\n        LoadingIndicator.updateText(loaderId, `Querying for waypoints in ${regionName}...`);\n        \n        // Try two different approaches: first try to use specific reporting points query\n        console.log(\"🗺️ APPROACH 1: Querying specifically for reporting points...\");\n        \n        let result = null;\n        \n        try {\n          // If we have reporting points specific object, no filter needed\n          if (sdk.ReportingPointsOffshore || sdk.ReportingPointsAll || sdk.ReportingPoints || \n              sdk.Waypoints || sdk.NavigationWaypoints) {\n            \n            result = await client(locationObject)\n              .where({ region: regionName })\n              .fetchPage({ $pageSize: 2000 });\n              \n            console.log(`🗺️ Specific reporting points query returned ${result?.data?.length || 0} items`);\n          } \n          // Otherwise use the fallback with type filter\n          else {\n            // Broader query for waypoints\n            result = await client(locationObject)\n              .where({ \n                region: regionName,\n                locationType: \"REPORTING POINT OFFSHORE\"\n              })\n              .fetchPage({ $pageSize: 2000 });\n              \n            console.log(`🗺️ First query returned ${result?.data?.length || 0} items`);\n            \n            // If no results, try with a different locationType\n            if (!result?.data || result.data.length === 0) {\n              console.log(\"🗺️ No results with REPORTING POINT OFFSHORE, trying with FIX type...\");\n              \n              result = await client(locationObject)\n                .where({ \n                  region: regionName,\n                  locationType: \"FIX\"\n                })\n                .fetchPage({ $pageSize: 2000 });\n                \n              console.log(`🗺️ FIX query returned ${result?.data?.length || 0} items`);\n            }\n          }\n        } catch (e) {\n          console.warn(\"🗺️ Error with first approach:\", e);\n        }\n        \n        // If first approach returned no results, try a broader query\n        if (!result?.data || result.data.length === 0) {\n          console.log(\"🗺️ APPROACH 2: Using broader query for all locations...\");\n          \n          // Get all locations for this region and filter client-side\n          result = await client(locationObject)\n            .where({ region: regionName })\n            .fetchPage({ $pageSize: 5000 });\n            \n          console.log(`🗺️ Broader query returned ${result?.data?.length || 0} total items`);\n        }\n        \n        if (!result || !result.data || result.data.length === 0) {\n          console.warn(`🗺️ No locations found for region ${regionName}`);\n          \n          LoadingIndicator.updateText(loaderId, `No waypoints found for ${regionName}`);\n          setTimeout(() => {\n            LoadingIndicator.hide(loaderId);\n          }, 2000);\n          \n          this.waypoints = [];\n          this.triggerCallback('onWaypointsLoaded', []);\n          return [];\n        }\n        \n        console.log(`🗺️ Found ${result.data.length} total locations for region ${regionName}`);\n        \n        // Log all location types for debugging\n        const allTypes = new Set();\n        result.data.forEach(item => {\n          if (item.locationType) {\n            allTypes.add(item.locationType);\n          }\n        });\n        console.log(\"🗺️ All location types in results:\", Array.from(allTypes));\n        \n        // Filter for waypoints on client side\n        const waypoints = [];\n        let processedCount = 0;\n        let skippedNoName = 0;\n        let skippedNoCoords = 0;\n        let waypointCount = 0;\n        let reportingPointCount = 0;\n        let fixCount = 0;\n        let intersectionCount = 0;\n        let navaidCount = 0;\n        \n        // SIMPLE FIX: Process all locations but filter to keep only waypoints\n        for (const item of result.data) {\n          let name = '';\n          let coords = null;\n          let type = '';\n          \n          // Get type first to filter faster\n          if (item.locationType) type = item.locationType;\n          else if (item.type) type = item.type;\n          else if (item.location_type) type = item.location_type;\n          \n          // IMPROVED FILTER: Keep only navigation points\n          const upperType = type.toUpperCase();\n          \n          // Count types for debugging\n          if (upperType.includes('WAYPOINT')) waypointCount++;\n          else if (upperType.includes('REPORTING POINT')) reportingPointCount++;\n          else if (upperType.includes('FIX')) fixCount++;\n          else if (upperType.includes('INTERSECTION')) intersectionCount++;\n          else if (upperType.includes('NAVAID')) navaidCount++;\n          \n          const isWaypoint = upperType.includes('WAYPOINT') || \n                           upperType.includes('REPORTING POINT') || \n                           upperType.includes('FIX') ||\n                           upperType.includes('INTERSECTION') ||\n                           upperType.includes('NAVAID') ||\n                           upperType.includes('POINT'); // General POINT as fallback\n          \n          // Skip non-waypoint items immediately\n          if (!isWaypoint) {\n            continue;\n          }\n          \n          // Try to extract name\n          if (item.locName) name = item.locName;\n          else if (item.name) name = item.name;\n          else if (item.location_name) name = item.location_name;\n          else if (item.id) name = item.id.toString();\n          else {\n            skippedNoName++;\n            continue; // Skip items with no identifiable name\n          }\n          \n          // Try to extract coordinates\n          if (item.geoPoint) {\n            if (typeof item.geoPoint.longitude === 'number' && typeof item.geoPoint.latitude === 'number') {\n              coords = [item.geoPoint.longitude, item.geoPoint.latitude];\n            } else if (Array.isArray(item.geoPoint) && item.geoPoint.length === 2) {\n              coords = item.geoPoint;\n            } else if (item.geoPoint.coordinates && Array.isArray(item.geoPoint.coordinates)) {\n              coords = item.geoPoint.coordinates;\n            }\n          }\n          \n          // Check for direct lat/lon fields\n          if (!coords) {\n            if (item.LAT !== undefined && item.LON !== undefined) {\n              coords = [parseFloat(item.LON), parseFloat(item.LAT)];\n            } else if (item.lat !== undefined && item.lon !== undefined) {\n              coords = [parseFloat(item.lon), parseFloat(item.lat)];\n            } else if (item.latitude !== undefined && item.longitude !== undefined) {\n              coords = [parseFloat(item.longitude), parseFloat(item.latitude)];\n            }\n          }\n          \n          // Skip if we couldn't get coordinates\n          if (!coords) {\n            skippedNoCoords++;\n            continue;\n          }\n          \n          // Add to waypoints array\n          waypoints.push({\n            name: name,\n            coordinates: coords,\n            type: type || 'WAYPOINT'\n          });\n          processedCount++;\n        }\n        \n        console.log(`🗺️ Successfully processed ${processedCount} waypoints`);\n        console.log(`Skipped ${skippedNoName} items with no name, ${skippedNoCoords} items with no coordinates`);\n        console.log(`Waypoint types found: Waypoints=${waypointCount}, Reporting Points=${reportingPointCount}, Fixes=${fixCount}, Intersections=${intersectionCount}, Navaids=${navaidCount}`);\n        \n        // Store the waypoints\n        this.waypoints = waypoints;\n        \n        // Add waypoints to the map\n        this.addWaypointsToMap(waypoints);\n        \n        // Hide loading indicator\n        LoadingIndicator.hide(loaderId);\n        \n        // Trigger callback\n        this.triggerCallback('onWaypointsLoaded', waypoints);\n        \n        // Make sure to toggle visibility based on current waypointModeActive state\n        this.toggleWaypointMode(this.waypointModeActive);\n        \n        return waypoints;\n        \n      } catch (error) {\n        console.error('🗺️ OSDK API error loading waypoints:', error);\n        \n        LoadingIndicator.updateText(loaderId, `Error loading waypoints: ${error.message}`);\n        setTimeout(() => {\n          LoadingIndicator.hide(loaderId);\n        }, 3000);\n        \n        this.waypoints = [];\n        this.triggerCallback('onWaypointsLoaded', []);\n        return [];\n      }\n    } catch (error) {\n      console.error('🗺️ General error loading waypoints:', error);\n      \n      LoadingIndicator.updateText(loaderId, `Error: ${error.message}`);\n      setTimeout(() => {\n        LoadingIndicator.hide(loaderId);\n      }, 3000);\n      \n      this.waypoints = [];\n      this.triggerCallback('onWaypointsLoaded', []);\n      return [];\n    }\n  }\n  \n  /**\n   * Clear all waypoints from the map\n   */\n  clearWaypoints() {\n    const map = this.mapManager.getMap();\n    if (!map) return;\n    \n    console.log('Clearing all waypoints from map');\n    \n    this.mapManager.onMapLoaded(() => {\n      try {\n        // Define waypoint layer IDs\n        const waypontLayers = [\n          'waypoints-layer',\n          'waypoints-labels'\n        ];\n        \n        // Remove layers\n        for (const layerId of waypontLayers) {\n          if (map.getLayer(layerId)) {\n            try {\n              map.removeLayer(layerId);\n            } catch (e) {\n              console.warn(`Error removing waypoint layer ${layerId}:`, e);\n            }\n          }\n        }\n        \n        // Wait before removing source\n        setTimeout(() => {\n          if (map.getSource('waypoints-source')) {\n            try {\n              map.removeSource('waypoints-source');\n            } catch (e) {\n              console.warn('Error removing waypoints source:', e);\n            }\n          }\n        }, 100);\n        \n        // Clear the waypoints array\n        this.waypoints = [];\n        \n      } catch (error) {\n        console.error('Error clearing waypoints:', error);\n      }\n    });\n  }\n  \n  /**\n   * Add waypoints to the map\n   * @param {Array} waypoints - Array of waypoint objects\n   */\n  addWaypointsToMap(waypoints) {\n    const map = this.mapManager.getMap();\n    if (!map) {\n      console.error(\"Cannot add waypoints: map is not initialized\");\n      return;\n    }\n    \n    // Validate waypoints array\n    if (!waypoints || !Array.isArray(waypoints) || waypoints.length === 0) {\n      console.warn(\"No valid waypoints to add to map\");\n      return;\n    }\n    \n    console.log(`🗺️ Adding ${waypoints.length} waypoints to map`);\n    \n    // Store the waypoints\n    this.waypoints = waypoints;\n    \n    // Define function to add layers/source\n    const addWaypointLayers = () => {\n      const map = this.mapManager.getMap();\n      if (!map) {\n        console.error(\"Map unavailable when adding waypoints\");\n        return;\n      }\n      \n      try {\n        // Remove existing waypoint layers/source if they exist\n        const waypointLayers = ['waypoints-layer', 'waypoints-labels'];\n        \n        waypointLayers.forEach(layerId => {\n          if (map.getLayer(layerId)) {\n            map.removeLayer(layerId);\n          }\n        });\n        \n        // Wait a moment for layer removal to complete\n        setTimeout(() => {\n          if (map.getSource('waypoints-source')) {\n            map.removeSource('waypoints-source');\n          }\n          \n          // Create features for GeoJSON\n          const features = waypoints.map(waypoint => ({\n            type: 'Feature',\n            properties: {\n              name: waypoint.name,\n              type: waypoint.type || 'WAYPOINT'\n            },\n            geometry: {\n              type: 'Point',\n              coordinates: waypoint.coordinates\n            }\n          }));\n          \n          // Add source\n          map.addSource('waypoints-source', {\n            type: 'geojson',\n            data: {\n              type: 'FeatureCollection',\n              features: features\n            }\n          });\n          \n          // Add waypoints layer - use a tiny bright yellow circle with thin dark outline\n          map.addLayer({\n            id: 'waypoints-layer',\n            type: 'circle',\n            source: 'waypoints-source',\n            paint: {\n              'circle-radius': 3,                // Small but visible circles\n              'circle-color': '#FFCC00',         // Bright yellow\n              'circle-stroke-width': 1,          // Thin stroke\n              'circle-stroke-color': '#000000',  // Black outline\n              'circle-opacity': 0.9              // Slightly transparent \n            }\n          });\n          \n          // Add waypoint labels with white text and dark outline, visible only at certain zoom levels\n          map.addLayer({\n            id: 'waypoints-labels',\n            type: 'symbol',\n            source: 'waypoints-source',\n            layout: {\n              'text-field': ['get', 'name'],\n              // Only show labels at zoom level 10 and above\n              'text-size': [\n                'interpolate',\n                ['linear'],\n                ['zoom'],\n                8, 0,      // Hide text at zoom level 8 and below\n                9, 8,      // Small text at zoom level 9\n                11, 10     // Normal text at zoom level 11+\n              ],\n              'text-anchor': 'top',\n              'text-offset': [0, 0.8],           // Position above the waypoint\n              'text-allow-overlap': false,\n              'text-ignore-placement': false,\n              'text-max-width': 10,              // Wider text wrapping for readability\n              'text-letter-spacing': 0.05        // Slightly increased letter spacing for readability\n            },\n            paint: {\n              'text-color': '#FFCC00',           // Yellow text to match markers\n              'text-halo-color': '#000000',      // Black halo for contrast\n              'text-halo-width': 2.0             // Thicker halo for better visibility\n            }\n          });\n          \n          // Set visibility based on current mode\n          const visibility = this.waypointModeActive ? 'visible' : 'none';\n          map.setLayoutProperty('waypoints-layer', 'visibility', visibility);\n          map.setLayoutProperty('waypoints-labels', 'visibility', visibility);\n          \n          // Trigger callback\n          this.triggerCallback('onWaypointsLoaded', waypoints);\n          \n        }, 100);\n      } catch (error) {\n        console.error('Error adding waypoints to map:', error);\n      }\n    };\n    \n    // Use onMapLoaded to handle timing\n    this.mapManager.onMapLoaded(addWaypointLayers);\n  }\n  \n  /**\n   * Find the nearest navigation waypoint to a given coordinate\n   * Specifically for finding navigation waypoints (not platforms/rigs)\n   * \n   * @param {number} lat - Latitude\n   * @param {number} lng - Longitude\n   * @param {number} maxDistance - Maximum distance in nautical miles (default: 5)\n   * @returns {Object|null} - The nearest waypoint or null if none found within maxDistance\n   */\n  findNearestWaypoint(lat, lng, maxDistance = 5) {\n    // Check if we have waypoints loaded\n    if (!this.waypoints || this.waypoints.length === 0) {\n      console.log(\"PlatformManager: No waypoints available for nearest search\");\n      return null;\n    }\n    \n    // Check if turf.js is available for distance calculations\n    if (!window.turf) {\n      console.error(\"PlatformManager: Turf.js not loaded, cannot find nearest waypoint\");\n      return null;\n    }\n    \n    try {\n      // Create a point at the click location\n      const clickPoint = window.turf.point([lng, lat]);\n      \n      // Find the nearest waypoint\n      let nearestWaypoint = null;\n      let minDistance = Number.MAX_VALUE;\n      \n      this.waypoints.forEach(waypoint => {\n        // Skip if waypoint has no coordinates\n        if (!waypoint.coordinates || waypoint.coordinates.length !== 2) {\n          return;\n        }\n        \n        // Create a point at the waypoint location\n        const waypointPoint = window.turf.point(waypoint.coordinates);\n        \n        // Calculate distance in nautical miles\n        const distance = window.turf.distance(clickPoint, waypointPoint, { units: 'nauticalmiles' });\n        \n        if (distance < minDistance) {\n          minDistance = distance;\n          nearestWaypoint = {\n            ...waypoint,\n            distance: distance\n          };\n        }\n      });\n      \n      // Only return if within reasonable distance\n      if (nearestWaypoint && minDistance <= maxDistance) {\n        console.log(`PlatformManager: Found nearest waypoint ${nearestWaypoint.name} at distance ${nearestWaypoint.distance.toFixed(2)} nm`);\n        return nearestWaypoint;\n      } else if (nearestWaypoint) {\n        console.log(`PlatformManager: Nearest waypoint ${nearestWaypoint.name} is too far (${nearestWaypoint.distance.toFixed(2)} nm > ${maxDistance} nm)`);\n      } else {\n        console.log(`PlatformManager: No waypoints found`);\n      }\n      \n      return null;\n    } catch (error) {\n      console.error(\"PlatformManager: Error finding nearest waypoint:\", error);\n      return null;\n    }\n  }\n  \n  /**\n   * Toggle between platform mode and waypoint mode\n   * @param {boolean} waypointMode - Whether to show waypoints (true) or platforms (false)\n   */\n  toggleWaypointMode(waypointMode) {\n    console.log(`🔄 PlatformManager: Toggling waypoint mode: ${waypointMode ? 'ON' : 'OFF'}`);\n    \n    // Store the waypoint mode state\n    this.waypointModeActive = waypointMode;\n    \n    const map = this.mapManager.getMap();\n    if (!map) {\n      console.error(\"Cannot toggle waypoint mode: map is not initialized\");\n      return;\n    }\n    \n    // Verify that we have the global mode flag correctly set\n    if (window.isWaypointModeActive !== waypointMode) {\n      console.warn(`🔄 PlatformManager: Global waypoint flag (${window.isWaypointModeActive}) doesn't match local state (${waypointMode})`);\n      // Don't override the global flag here since this is just for visualization\n    }\n    \n    // Automatically try to load waypoints if entering waypoint mode and none are loaded yet\n    if (waypointMode && (!this.waypoints || this.waypoints.length === 0)) {\n      console.log(\"🔄 PlatformManager: Loading waypoints since none are available yet...\");\n      \n      // Try to determine current region\n      let currentRegion = \"NORWAY\"; // Default to Norway if we can't determine\n      \n      try {\n        // Check if we have a currentRegion object property\n        if (this.currentRegion) {\n          if (typeof this.currentRegion === 'string') {\n            currentRegion = this.currentRegion;\n          } else if (this.currentRegion.id) {\n            currentRegion = this.currentRegion.id;\n          } else if (this.currentRegion.name) {\n            currentRegion = this.currentRegion.name;\n          }\n        }\n        // Check if we have access to global current region\n        else if (window.currentRegion) {\n          if (typeof window.currentRegion === 'string') {\n            currentRegion = window.currentRegion;\n          } else if (window.currentRegion.id) {\n            currentRegion = window.currentRegion.id;\n          } else if (window.currentRegion.name) {\n            currentRegion = window.currentRegion.name;\n          }\n        }\n      } catch (e) {\n        console.error(\"🔄 Error determining current region:\", e);\n      }\n      \n      // Show a loading message\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator(\n          `Loading waypoints for ${currentRegion}...`, \n          \"info\"\n        );\n      }\n      \n      // Try to load waypoints in the background\n      // This will use the OSDK client if available\n      this.loadWaypointsFromFoundry(window.client, currentRegion)\n        .then(waypoints => {\n          console.log(`🔄 Successfully loaded ${waypoints.length} waypoints`);\n          \n          // Show a message\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(\n              `${waypoints.length} navigation waypoints loaded. Click on yellow markers to add them to your route.`, \n              \"success\"\n            );\n          }\n        })\n        .catch(error => {\n          console.error(\"🔄 Error loading waypoints:\", error);\n          \n          // Show an error message\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(\n              `Error loading waypoints: ${error.message}`, \n              \"error\"\n            );\n          }\n        });\n    }\n    \n    // Hide/show the appropriate layers based on mode\n    this.mapManager.onMapLoaded(() => {\n      try {\n        // Platform layers to toggle\n        const platformLayers = [\n          'platforms-layer',\n          'platforms-movable-layer',\n          'platforms-fixed-labels',\n          'platforms-movable-labels',\n          'airfields-layer',\n          'airfields-labels'\n        ];\n        \n        // Waypoint layers\n        const waypointLayers = [\n          'waypoints-layer',\n          'waypoints-labels'\n        ];\n        \n        // Show/hide layers based on mode\n        if (waypointMode) {\n          console.log(\"🔄 Setting waypoint mode ON - showing waypoint layers, hiding platform layers\");\n          \n          // Hide platform layers\n          platformLayers.forEach(layerId => {\n            if (map.getLayer(layerId)) {\n              map.setLayoutProperty(layerId, 'visibility', 'none');\n            }\n          });\n          \n          // Show waypoint layers if they exist\n          let foundWaypointLayers = false;\n          waypointLayers.forEach(layerId => {\n            if (map.getLayer(layerId)) {\n              map.setLayoutProperty(layerId, 'visibility', 'visible');\n              foundWaypointLayers = true;\n            }\n          });\n          \n          // If no waypoint layers were found but we have waypoints data, try adding them\n          if (!foundWaypointLayers && this.waypoints && this.waypoints.length > 0) {\n            console.log(`🔄 No waypoint layers found but we have ${this.waypoints.length} waypoints - adding to map now`);\n            // Add waypoints to map if not already displayed\n            this.addWaypointsToMap(this.waypoints);\n          }\n          \n          // Add CSS class to the map container to indicate waypoint mode\n          const mapContainer = document.getElementById('fast-planner-map');\n          if (mapContainer) {\n            mapContainer.classList.add('waypoint-mode');\n          }\n          \n          // Also add global cursor style to indicate waypoint mode\n          document.body.classList.add('waypoint-mode-cursor');\n          \n        } else {\n          console.log(\"🔄 Setting waypoint mode OFF - showing platform layers, hiding waypoint layers\");\n          \n          // Show platform layers\n          platformLayers.forEach(layerId => {\n            if (map.getLayer(layerId)) {\n              map.setLayoutProperty(layerId, 'visibility', 'visible');\n            }\n          });\n          \n          // Hide waypoint layers\n          waypointLayers.forEach(layerId => {\n            if (map.getLayer(layerId)) {\n              map.setLayoutProperty(layerId, 'visibility', 'none');\n            }\n          });\n          \n          // Remove waypoint mode CSS class\n          const mapContainer = document.getElementById('fast-planner-map');\n          if (mapContainer) {\n            mapContainer.classList.remove('waypoint-mode');\n          }\n          \n          // Remove global cursor style\n          document.body.classList.remove('waypoint-mode-cursor');\n        }\n        \n        // Add a global CSS style to highlight waypoint markers if not already added\n        if (waypointMode && !document.getElementById('waypoint-mode-styles')) {\n          const styleSheet = document.createElement('style');\n          styleSheet.id = 'waypoint-mode-styles';\n          styleSheet.innerHTML = `\n            .waypoint-mode .mapboxgl-canvas-container {\n              cursor: crosshair !important;\n            }\n            \n            .waypoint-mode-cursor {\n              cursor: crosshair !important;\n            }\n            \n            .waypoint-mode-active-indicator {\n              position: fixed;\n              top: 70px;\n              left: 50%;\n              transform: translateX(-50%);\n              background-color: rgba(255, 204, 0, 0.8);\n              color: black;\n              font-weight: bold;\n              padding: 5px 10px;\n              border-radius: 4px;\n              z-index: 1000;\n              pointer-events: none;\n              box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n            }\n          `;\n          document.head.appendChild(styleSheet);\n          \n          // Add a visible indicator that waypoint mode is active\n          if (!document.querySelector('.waypoint-mode-active-indicator')) {\n            const indicator = document.createElement('div');\n            indicator.className = 'waypoint-mode-active-indicator';\n            indicator.textContent = '👉 WAYPOINT MODE ACTIVE 👈';\n            document.body.appendChild(indicator);\n          }\n        } else if (!waypointMode) {\n          // Remove the waypoint mode indicator when deactivating\n          const indicator = document.querySelector('.waypoint-mode-active-indicator');\n          if (indicator) {\n            indicator.remove();\n          }\n        }\n      } catch (error) {\n        console.error('🔄 Error toggling waypoint mode layers:', error);\n        \n        // Show error message to user\n        if (window.LoadingIndicator) {\n          window.LoadingIndicator.updateStatusIndicator(\n            `Error toggling waypoint mode: ${error.message}`, \n            \"error\"\n          );\n        }\n      }\n    });\n  }\n}\n\nexport default PlatformManager;","/**\n * RouteCalculator.js\n * \n * Handles route calculations including distance, time, fuel, and passenger capacity\n * IMPORTANT: This module has been updated to ONLY use actual aircraft data from OSDK\n * and will NOT use any dummy data or fallbacks.\n */\n\nclass RouteCalculator {\n  constructor() {\n    // Only initialize callbacks - NO default aircraft data\n    this.callbacks = {\n      onCalculationComplete: null\n    };\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} type - The callback type\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n  \n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n  \n  /**\n   * Calculate route statistics\n   * @param {Array} coordinates - Array of [lng, lat] coordinates\n   * @param {Object} options - Calculation options\n   * @returns {Object} - Route statistics\n   */\n  calculateRouteStats(coordinates, options = {}) {\n    if (!window.turf) {\n      console.error('RouteCalculator: Turf.js not loaded');\n      return null;\n    }\n    \n    // Log call with a distinct marker for tracking in console\n    console.log('⭐ RouteCalculator.calculateRouteStats called with:', {\n      coordinates: coordinates.length,\n      options: options.selectedAircraft ? \n        `Aircraft: ${options.selectedAircraft.registration || 'Unknown'}` : 'No aircraft',\n      weather: options.weather ? \n        `Wind ${options.weather.windSpeed}kts from ${options.weather.windDirection}°` : 'No weather',\n      // CRITICAL FIX: Log the forceTimeCalculation flag\n      forceTime: options.forceTimeCalculation ? 'true' : 'false'\n    });\n    \n    // Get options with defaults for non-aircraft values only\n    const {\n      selectedAircraft = null,\n      payloadWeight = 0,\n      reserveFuel = 0,\n      weather = null,\n      // CRITICAL FIX: Add forceTimeCalculation flag\n      forceTimeCalculation = false\n    } = options;\n    \n    // Check if we have a selectedAircraft object\n    if (!selectedAircraft) {\n      console.error('RouteCalculator: No aircraft data provided, calculating distance only');\n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    // Check if aircraft has all required properties\n    if (!selectedAircraft.cruiseSpeed) {\n      console.error('RouteCalculator: Aircraft missing cruiseSpeed property');\n      \n      // CRITICAL FIX: If forceTimeCalculation is true and we have coordinates, calculate time manually\n      if (forceTimeCalculation && coordinates && coordinates.length >= 2) {\n        console.log('⭐ Forcing time calculation for map click even without proper aircraft data');\n        return this.createBackupTimeCalculation(coordinates, 145); // Use default cruise speed of 145 knots\n      }\n      \n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    if (!selectedAircraft.fuelBurn) {\n      console.error('RouteCalculator: Aircraft missing fuelBurn property');\n      \n      // CRITICAL FIX: If forceTimeCalculation is true and we have coordinates, calculate time manually\n      if (forceTimeCalculation && coordinates && coordinates.length >= 2) {\n        console.log('⭐ Forcing time calculation for map click even without complete aircraft data');\n        return this.createBackupTimeCalculation(coordinates, selectedAircraft.cruiseSpeed);\n      }\n      \n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    // All required data is present, calculate route stats\n    const results = this.calculateRouteStatsLocally(\n      coordinates,\n      null, // Not using predefined aircraft types\n      selectedAircraft, // Pass the full aircraft object\n      payloadWeight,\n      reserveFuel,\n      weather\n    );\n    \n    // Validate time calculations before returning\n    if (!results || results.timeHours === 0 || !results.estimatedTime || results.estimatedTime === '00:00') {\n      console.error('⭐ RouteCalculator: Calculation produced invalid time results:', results);\n      \n      // Attempt to fix the calculation if we have valid inputs\n      if (coordinates.length >= 2 && selectedAircraft.cruiseSpeed > 0) {\n        console.log('⭐ RouteCalculator: Attempting to manually recalculate time...');\n        \n        // Calculate the total distance\n        let totalDistance = 0;\n        for (let i = 0; i < coordinates.length - 1; i++) {\n          const from = window.turf.point(coordinates[i]);\n          const to = window.turf.point(coordinates[i+1]);\n          const options = { units: 'nauticalmiles' };\n          totalDistance += window.turf.distance(from, to, options);\n        }\n        \n        // Calculate time based on distance and cruise speed\n        const timeHours = totalDistance / selectedAircraft.cruiseSpeed;\n        \n        // Format time\n        const hours = Math.floor(timeHours);\n        const minutes = Math.floor((timeHours - hours) * 60);\n        const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n        \n        console.log('⭐ Manual time calculation:', {\n          totalDistance,\n          cruiseSpeed: selectedAircraft.cruiseSpeed,\n          timeHours,\n          estimatedTime\n        });\n        \n        // Update the results with the corrected time\n        if (results) {\n          results.timeHours = timeHours;\n          results.estimatedTime = estimatedTime;\n        }\n      }\n    }\n    \n    // Final log of results for tracking\n    console.log('⭐ RouteCalculator final results:', {\n      estimatedTime: results?.estimatedTime,\n      timeHours: results?.timeHours,\n      totalDistance: results?.totalDistance,\n      windAdjusted: results?.windAdjusted || false\n    });\n    \n    return results;\n  }\n  \n  /**\n   * Calculate distance only without requiring aircraft\n   * @param {Array} coordinates - Array of [lng, lat] coordinates\n   * @returns {Object} - Distance results\n   */\n  calculateDistanceOnly(coordinates) {\n    if (!window.turf) {\n      console.error('Turf.js not loaded');\n      return null;\n    }\n    \n    // Calculate total distance\n    let totalDistance = 0;\n    let legs = [];\n    \n    console.log('⭐ RouteCalculator: Calculating distance for', coordinates.length, 'waypoints');\n    \n    for (let i = 0; i < coordinates.length - 1; i++) {\n      const from = window.turf.point(coordinates[i]);\n      const to = window.turf.point(coordinates[i + 1]);\n      const options = { units: 'nauticalmiles' };\n      \n      const legDistance = window.turf.distance(from, to, options);\n      totalDistance += legDistance;\n      \n      console.log(`⭐ RouteCalculator: Leg ${i+1} distance: ${legDistance.toFixed(1)} nm`);\n      \n      legs.push({\n        from: coordinates[i],\n        to: coordinates[i + 1],\n        distance: legDistance.toFixed(1)\n      });\n    }\n    \n    console.log('⭐ RouteCalculator: Total distance calculated:', totalDistance.toFixed(1), 'nm');\n    \n    // Compile results with consistent fields that the UI expects\n    const result = {\n      totalDistance: totalDistance.toFixed(1),\n      estimatedTime: '00:00',\n      timeHours: 0,\n      legs: legs,\n      distanceOnly: true // Flag to indicate this is distance-only calculation\n    };\n    \n    // Trigger callback with results\n    this.triggerCallback('onCalculationComplete', result);\n    \n    return result;\n  }\n  \n  /**\n   * Calculate route statistics locally without API calls\n   * @param {Array} coordinates - Array of [lng, lat] coordinates\n   * @param {Object} aircraftTypes - No longer used, kept for backwards compatibility\n   * @param {Object} aircraftObject - The aircraft object with performance data\n   * @param {number} payloadWeight - Additional payload weight (lbs)\n   * @param {number} reserveFuel - Reserve fuel amount (lbs)\n   * @param {Object} weather - Weather data with windSpeed and windDirection\n   * @returns {Object} - Route statistics\n   */\n  calculateRouteStatsLocally(coordinates, aircraftTypes, aircraftObject, payloadWeight, reserveFuel, weather) {\n    console.log(\"RouteCalculator: Starting calculation with:\", { \n      coordinatesLength: coordinates?.length,\n      aircraftObject: aircraftObject ? \n        `${aircraftObject.registration || 'Unknown'} (${aircraftObject.modelType || 'Unknown'})` : 'None',\n      weather: weather,\n      turf: !!window.turf\n    });\n    \n    if (!coordinates || coordinates.length < 2) {\n      console.error('RouteCalculator: Invalid coordinates - need at least 2 waypoints');\n      return { totalDistance: '0', estimatedTime: '00:00', timeHours: 0 };\n    }\n    \n    if (!window.turf) {\n      console.error('RouteCalculator: Turf.js not loaded');\n      return { totalDistance: '0', estimatedTime: '00:00', timeHours: 0 };\n    }\n    \n    // Ensure we have all required aircraft properties - no fallbacks\n    if (!aircraftObject) {\n      console.error('RouteCalculator: No aircraft object provided');\n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    // Double check that all required properties are present\n    if (!aircraftObject.cruiseSpeed) {\n      console.error('RouteCalculator: Aircraft object missing cruiseSpeed property');\n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    if (!aircraftObject.fuelBurn) {\n      console.error('RouteCalculator: Aircraft object missing fuelBurn property');\n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    // Use the aircraft object directly - no fallbacks to window.selectedAircraft\n    const aircraft = aircraftObject;\n    \n    // Log a summary of what will be calculated\n    console.log(\"⭐ RouteCalculator Stats Input:\", {\n      waypoints: coordinates.length,\n      aircraft: `${aircraft.registration || 'Unknown'} (${aircraft.modelType || 'Unknown'})`,\n      cruiseSpeed: aircraft.cruiseSpeed,\n      fuelBurn: aircraft.fuelBurn,\n      weather: weather ? `${weather.windSpeed}kts from ${weather.windDirection}°` : 'None'\n    });\n    \n    // Calculate each leg\n    let totalDistance = 0;\n    let totalTimeHours = 0;\n    let totalFuel = 0;\n    let legs = [];\n    let totalHeadwind = 0;\n    let legCount = 0;\n    \n    try {\n      // Import the wind calculation functions\n      const WindCalculations = window.WindCalculations || \n                             (typeof require !== 'undefined' ? require('./calculations/WindCalculations') : null);\n      \n      // If WindCalculations is not available, calculate only distance\n      if (!WindCalculations) {\n        console.error('⭐ WindCalculations module not available');\n        return this.calculateDistanceOnly(coordinates);\n      }\n      \n      // Process each leg using WindCalculations - no fallbacks\n      const { calculateLegWithWind, calculateCourse } = WindCalculations;\n      \n      // Add debug log to check for weather object\n      console.log('⭐ RouteCalculator processing with weather:', weather);\n      \n      for (let i = 0; i < coordinates.length - 1; i++) {\n        // Create proper lat/lon objects from coordinates\n        const fromCoords = {\n          lat: coordinates[i][1],\n          lon: coordinates[i][0]\n        };\n        \n        const toCoords = {\n          lat: coordinates[i+1][1],\n          lon: coordinates[i+1][0]\n        };\n        \n        console.log(`⭐ Processing leg ${i+1} from ${fromCoords.lat},${fromCoords.lon} to ${toCoords.lat},${toCoords.lon}`);\n        \n        // Calculate distance using turf\n        const from = window.turf.point(coordinates[i]);\n        const to = window.turf.point(coordinates[i+1]);\n        const options = { units: 'nauticalmiles' };\n        \n        const legDistance = window.turf.distance(from, to, options);\n        \n        // Add distance to total\n        totalDistance += legDistance;\n        \n        // Use the provided weather data - no fallbacks\n        console.log(`⭐ Using weather for leg ${i+1}:`, weather);\n        \n        // Calculate leg details including wind effects\n        const legDetails = calculateLegWithWind(\n          fromCoords,\n          toCoords,\n          legDistance,\n          aircraft,\n          weather\n        );\n        \n        console.log(`⭐ Leg ${i+1} details:`, {\n          distance: legDistance.toFixed(1),\n          time: legDetails.time.toFixed(2),\n          groundSpeed: Math.round(legDetails.groundSpeed),\n          headwind: Math.round(legDetails.headwindComponent),\n          course: Math.round(legDetails.course)\n        });\n        \n        // Add leg time to total - verify it's a valid number\n        if (isNaN(legDetails.time) || legDetails.time <= 0) {\n          console.error(`⭐ Invalid leg time for leg ${i+1}:`, legDetails.time);\n          \n          // Calculate a fallback time based on distance and cruise speed\n          const fallbackTime = legDistance / aircraft.cruiseSpeed;\n          console.log(`⭐ Using fallback time calculation: ${fallbackTime}`);\n          totalTimeHours += fallbackTime;\n        } else {\n          totalTimeHours += legDetails.time;\n        }\n        \n        // Add leg fuel to total\n        totalFuel += legDetails.fuel;\n        \n        // Track headwind for calculating average\n        totalHeadwind += legDetails.headwindComponent;\n        legCount++;\n        \n        // Store leg data\n        legs.push({\n          from: coordinates[i],\n          to: coordinates[i+1],\n          distance: legDistance.toFixed(1),\n          time: legDetails.time,\n          fuel: Math.round(legDetails.fuel),\n          course: legDetails.course,\n          groundSpeed: legDetails.groundSpeed,\n          headwind: legDetails.headwindComponent\n        });\n      }\n    } catch (error) {\n      console.error('⭐ RouteCalculator: Error calculating route with wind:', error);\n      // Just calculate distance instead of using fallbacks\n      return this.calculateDistanceOnly(coordinates);\n    }\n    \n    // Final verification of calculated time\n    if (totalTimeHours === 0 && totalDistance > 0) {\n      console.error('⭐ RouteCalculator: Zero time calculated for non-zero distance!');\n      \n      // Force calculate a time based on distance and cruise speed\n      totalTimeHours = totalDistance / aircraft.cruiseSpeed;\n      console.log(`⭐ Forced time calculation: ${totalTimeHours} hours for ${totalDistance} nm`);\n    }\n    \n    // Calculate average headwind\n    const avgHeadwind = legCount > 0 ? Math.round(totalHeadwind / legCount) : 0;\n    \n    console.log(`RouteCalculator: Total route stats:`, {\n      distance: totalDistance.toFixed(1),\n      time: totalTimeHours.toFixed(2),\n      avgHeadwind: avgHeadwind\n    });\n    \n    // Format time as HH:MM\n    const hours = Math.floor(totalTimeHours);\n    const minutes = Math.floor((totalTimeHours - hours) * 60);\n    const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n    \n    // Add reserve fuel (ensure it's a number)\n    const reserveFuelValue = Number(reserveFuel) || 0;\n    const fuelRequired = Math.round(totalFuel + reserveFuelValue);\n    \n    // Calculate usable load - only if we have all required aircraft properties\n    let usableLoad = 0;\n    let maxPassengers = 0;\n    \n    if (aircraft.maxTakeoffWeight && aircraft.emptyWeight) {\n      // Calculate usable load from actual aircraft data\n      usableLoad = Math.max(0, aircraft.maxTakeoffWeight - aircraft.emptyWeight - fuelRequired - (Number(payloadWeight) || 0));\n      \n      // Only calculate passengers if we have passengerWeight\n      if (aircraft.passengerWeight) {\n        maxPassengers = Math.floor(usableLoad / aircraft.passengerWeight);\n      } else {\n        console.error('RouteCalculator: Missing passengerWeight data, cannot calculate max passengers');\n      }\n    } else {\n      console.error('RouteCalculator: Missing aircraft weight data, cannot calculate usable load');\n    }\n    \n    // Compile results with clean, consistent property names\n    const result = {\n      totalDistance: totalDistance.toFixed(1),\n      estimatedTime: formattedTime,\n      timeHours: totalTimeHours,\n      fuelRequired: fuelRequired,\n      tripFuel: Math.round(totalFuel),\n      usableLoad: usableLoad,\n      maxPassengers: maxPassengers,\n      aircraft: aircraft,\n      legs: legs,\n      windAdjusted: weather && weather.windSpeed > 0,\n      windData: {\n        windSpeed: weather ? weather.windSpeed : 0,\n        windDirection: weather ? weather.windDirection : 0,\n        avgHeadwind: avgHeadwind\n      }\n    };\n    \n    console.log('🔄 RouteCalculator: Final route stats:', {\n      distance: result.totalDistance,\n      time: result.estimatedTime,\n      timeHours: result.timeHours,\n      tripFuel: result.tripFuel,\n      legCount: result.legs.length,\n      waypoints: coordinates.length\n    });\n    \n    // Trigger callback with results\n    this.triggerCallback('onCalculationComplete', result);\n    \n    return result;\n  }\n  \n  /**\n   * Methods for aircraft types have been removed\n   * ONLY use real aircraft data from OSDK\n   */\n   \n  /**\n   * Create backup time calculation for when we need to force time calculation\n   * @param {Array} coordinates - Array of [lng, lat] coordinates\n   * @param {number} cruiseSpeed - Aircraft cruise speed to use for calculation\n   * @returns {Object} - Route statistics with time\n   */\n  createBackupTimeCalculation(coordinates, cruiseSpeed) {\n    console.log('⭐ Creating backup time calculation with cruise speed:', cruiseSpeed);\n    \n    if (!window.turf) {\n      console.error('RouteCalculator: Turf.js not loaded for backup calculation');\n      return { totalDistance: '0', estimatedTime: '00:00', timeHours: 0 };\n    }\n    \n    if (!coordinates || coordinates.length < 2 || !cruiseSpeed) {\n      console.error('RouteCalculator: Invalid inputs for backup calculation');\n      return { totalDistance: '0', estimatedTime: '00:00', timeHours: 0 };\n    }\n    \n    try {\n      // Calculate total distance\n      let totalDistance = 0;\n      let legs = [];\n      \n      for (let i = 0; i < coordinates.length - 1; i++) {\n        const from = window.turf.point(coordinates[i]);\n        const to = window.turf.point(coordinates[i + 1]);\n        const options = { units: 'nauticalmiles' };\n        \n        const legDistance = window.turf.distance(from, to, options);\n        totalDistance += legDistance;\n        \n        legs.push({\n          from: coordinates[i],\n          to: coordinates[i + 1],\n          distance: legDistance.toFixed(1)\n        });\n      }\n      \n      // Calculate time based on total distance and cruise speed\n      const timeHours = totalDistance / cruiseSpeed;\n      \n      // Format time as HH:MM\n      const hours = Math.floor(timeHours);\n      const minutes = Math.floor((timeHours - hours) * 60);\n      const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n      \n      console.log('⭐ Backup time calculation results:', {\n        totalDistance: totalDistance.toFixed(1),\n        timeHours: timeHours,\n        estimatedTime: estimatedTime\n      });\n      \n      // Create the result object\n      const result = {\n        totalDistance: totalDistance.toFixed(1),\n        estimatedTime: estimatedTime,\n        timeHours: timeHours,\n        legs: legs,\n        // Add minimal properties to make it compatible with UI expectations\n        fuelRequired: Math.round(timeHours * 1100), // Use a default fuel burn of 1100 lbs/hr\n        tripFuel: Math.round(timeHours * 1100),\n        usableLoad: 0,\n        maxPassengers: 0\n      };\n      \n      // Trigger callback with results\n      this.triggerCallback('onCalculationComplete', result);\n      \n      return result;\n    } catch (error) {\n      console.error('RouteCalculator: Error in backup time calculation:', error);\n      return { totalDistance: '0', estimatedTime: '00:00', timeHours: 0 };\n    }\n  }\n}\n\nexport default RouteCalculator;","/**\n * regions.js\n * \n * Contains region definitions for the Fast Planner application\n */\n\n// Region definitions with center coordinates and bounds\nconst regions = [\n  {\n    id: 'gulf-of-mexico',\n    name: 'Gulf of Mexico',\n    center: [-90.5, 27.5],\n    zoom: 6,\n    bounds: [\n      [-98, 24], // Southwest corner [lng, lat]\n      [-83, 31]  // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'GULF OF MEXICO' // Matches the region name in Foundry database\n  },\n  {\n    id: 'norway',\n    name: 'Norway',\n    center: [4.0, 59.0],\n    zoom: 5.5,\n    bounds: [\n      [1, 55], // Southwest corner [lng, lat]\n      [9, 63]  // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'NORWAY' // Matches the region name in Foundry database\n  },\n  {\n    id: 'united-kingdom',\n    name: 'United Kingdom',\n    center: [-1.5, 57.0],\n    zoom: 5.5,\n    bounds: [\n      [-5, 51], // Southwest corner [lng, lat]\n      [1, 62]   // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'UNITED KINGDOM' // Matches the region name in Foundry database\n  },\n  {\n    id: 'west-africa',\n    name: 'West Africa',\n    center: [5.0, 2.0],\n    zoom: 5,\n    bounds: [\n      [-1, -5], // Southwest corner [lng, lat]\n      [11, 9]   // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'NIGERIA' // Updated to match Foundry database\n  },\n  {\n    id: 'brazil',\n    name: 'Brazil',\n    center: [-38.0, -22.0],\n    zoom: 5,\n    bounds: [\n      [-45, -26], // Southwest corner [lng, lat]\n      [-31, -18]  // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'EAST BRAZIL' // Updated to match Foundry database\n  },\n  {\n    id: 'australia',\n    name: 'Australia NW Shelf',\n    center: [116.0, -19.0],\n    zoom: 5,\n    bounds: [\n      [110, -23], // Southwest corner [lng, lat]\n      [122, -15]  // Northeast corner [lng, lat]\n    ],\n    osdkRegion: 'WESTERN AUSTRALIA' // Updated to match Foundry database\n  }\n];\n\nexport default regions;\n","/**\n * RegionManager.js\n * \n * Handles region selection, map navigation, and region-specific data loading\n */\n\nimport regions from './data/regions';\n\nclass RegionManager {\n  constructor(mapManager, platformManager) {\n    this.mapManager = mapManager;\n    this.platformManager = platformManager;\n    this.currentRegion = null;\n    this.regions = regions;\n    this.callbacks = {\n      onRegionChanged: null,\n      onRegionLoaded: null,\n      onError: null\n    };\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} type - The callback type\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n  \n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n  \n  /**\n   * Get all available regions\n   * @returns {Array} - Array of region objects\n   */\n  getRegions() {\n    return this.regions;\n  }\n  \n  /**\n   * Get the current active region\n   * @returns {Object|null} - The current region or null if none selected\n   */\n  getCurrentRegion() {\n    return this.currentRegion;\n  }\n  \n  /**\n   * Find a region by ID\n   * @param {string} id - The region ID to find\n   * @returns {Object|null} - The region object or null if not found\n   */\n  getRegionById(id) {\n    return this.regions.find(region => region.id === id) || null;\n  }\n  \n  /**\n   * Set the current region and update the map view\n   * @param {string} regionId - The ID of the region to switch to\n   * @returns {Object|null} - The selected region or null if not found\n   */\n  setRegion(regionId) {\n    const region = this.getRegionById(regionId);\n    if (!region) {\n      console.error(`Region with ID \"${regionId}\" not found`);\n      this.triggerCallback('onError', `Region \"${regionId}\" not found`);\n      return null;\n    }\n    \n    console.log(`RegionManager: Setting region to ${regionId}`);\n    \n    // Clear any static data flags to ensure we load fresh data for the new region\n    window.staticDataLoaded = false;\n    window.platformsLoaded = false;\n    window.aircraftLoaded = false;\n    console.log('Cleared data flags for new region');\n    \n    // Store the current region\n    this.currentRegion = region;\n    \n    // Get the map instance\n    const map = this.mapManager.getMap();\n    if (!map) {\n      console.error('Cannot set region: Map is not initialized');\n      this.triggerCallback('onError', 'Map is not initialized');\n      return null;\n    }\n    \n    // Use onMapLoaded to ensure the map is ready for operations\n    this.mapManager.onMapLoaded(() => {\n      try {\n        // Fly to the region\n        map.fitBounds(region.bounds, {\n          padding: 50,\n          maxZoom: region.zoom || 6\n        });\n        \n        // Trigger the region changed callback\n        this.triggerCallback('onRegionChanged', region);\n        \n        // If platform manager is available, load region-specific platforms\n        if (this.platformManager) {\n          console.log(`Loading platforms for region: ${region.name}`);\n          // The loadPlatformsFromFoundry method will need to be modified to accept region info\n          this.platformManager.loadPlatformsFromFoundry(null, region.osdkRegion)\n            .then(platforms => {\n              console.log(`Loaded ${platforms.length} platforms for ${region.name}`);\n              this.triggerCallback('onRegionLoaded', {\n                region: region,\n                platforms: platforms\n              });\n            })\n            .catch(error => {\n              console.error(`Error loading platforms for region ${region.name}:`, error);\n              this.triggerCallback('onError', `Failed to load platforms for ${region.name}: ${error.message}`);\n            });\n        }\n      } catch (error) {\n        console.error(`Error setting region ${region.name}:`, error);\n        this.triggerCallback('onError', `Failed to set region ${region.name}: ${error.message}`);\n      }\n    });\n    \n    return region;\n  }\n  \n  /**\n   * Initialize the region manager and set the default region\n   * @param {string} defaultRegionId - The ID of the default region to use\n   */\n  initialize(defaultRegionId = 'gulf-of-mexico') {\n    // Wait for the map to be ready\n    this.mapManager.onMapLoaded(() => {\n      // Set the default region\n      this.setRegion(defaultRegionId);\n    });\n  }\n}\n\nexport default RegionManager;\n","/**\n * FavoriteLocationsManager.js\n * \n * Manages a list of user-defined favorite locations (e.g., common airports, bases).\n * Supports categorization by region.\n */\n\nclass FavoriteLocationsManager {\n  constructor() {\n    // Structure to store favorite locations, keyed by region ID\n    // Example: { 'gulf-of-mexico': [{ id: 'khou', name: 'Houston Hobby', coords: [-95.2789, 29.6451] }] }\n    this.favoriteLocations = {};\n    this.callbacks = {\n      onChange: null, // Callback when the list of favorites changes\n    };\n\n    // Load from localStorage if available\n    this.loadFromLocalStorage();\n\n    // If no data was loaded, use default static data\n    if (Object.keys(this.favoriteLocations).length === 0) {\n      this.loadStaticData();\n    }\n  }\n\n  /**\n   * Set a callback function.\n   * @param {string} type - The callback type (e.g., 'onChange').\n   * @param {Function} callback - The callback function.\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n\n  /**\n   * Trigger a callback if it exists.\n   * @param {string} type - The callback type.\n   * @param {*} data - The data to pass to the callback.\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n\n  /**\n   * Load favorites from localStorage\n   */\n  loadFromLocalStorage() {\n    try {\n      const savedFavorites = localStorage.getItem('fastPlannerFavorites');\n      if (savedFavorites) {\n        this.favoriteLocations = JSON.parse(savedFavorites);\n        console.log('Loaded favorites from localStorage:', this.favoriteLocations);\n      }\n    } catch (error) {\n      console.error('Error loading favorites from localStorage:', error);\n      // Fall back to static data\n      this.loadStaticData();\n    }\n  }\n\n  /**\n   * Save favorites to localStorage\n   */\n  saveToLocalStorage() {\n    try {\n      localStorage.setItem('fastPlannerFavorites', JSON.stringify(this.favoriteLocations));\n      console.log('Saved favorites to localStorage');\n    } catch (error) {\n      console.error('Error saving favorites to localStorage:', error);\n    }\n  }\n\n  /**\n   * Load initial static favorite locations data.\n   * In a real application, this would load from user preferences/storage.\n   */\n  loadStaticData() {\n    console.log('Loading static favorites data');\n    this.favoriteLocations = {\n      'gulf-of-mexico': [\n        { id: 'khou', name: 'Houston Hobby', coords: [-95.2789, 29.6451] },\n        { id: 'kmsy', name: 'New Orleans Intl', coords: [-90.2594, 29.9934] },\n        { id: 'kgls', name: 'Galveston', coords: [-94.8604, 29.2653] },\n        { id: 'kefd', name: 'Ellington Field', coords: [-95.1587, 29.6073] },\n      ],\n      'norway': [\n        { id: 'enro', name: 'Florø Airport', coords: [5.0256, 61.5833] },\n        { id: 'enbr', name: 'Bergen Airport', coords: [5.3214, 60.2933] },\n        { id: 'engo', name: 'Flesland Heliport', coords: [5.3400, 60.2850] }, // Example base\n      ],\n      'united-kingdom': [\n        { id: 'egpd', name: 'Aberdeen Airport', coords: [-2.1978, 57.2047] },\n        { id: 'egjj', name: 'Jersey Airport', coords: [-2.1978, 49.2078] },\n      ],\n       'west-africa': [\n        { id: 'dnmm', name: 'Murtala Muhammed Intl', coords: [3.3222, 6.5775] },\n      ],\n       'brazil': [\n        { id: 'sbrj', name: 'Santos Dumont Airport', coords: [-43.1656, -22.9100] },\n      ],\n       'australia': [\n        { id: 'ypph', name: 'Perth Airport', coords: [115.9669, -31.9361] },\n      ],\n    };\n    // Save static data to localStorage\n    this.saveToLocalStorage();\n  }\n\n  /**\n   * Get favorite locations for a specific region.\n   * @param {string} regionId - The ID of the region.\n   * @returns {Array} - Array of favorite location objects for the region.\n   */\n  getFavoriteLocationsByRegion(regionId) {\n    return this.favoriteLocations[regionId] || [];\n  }\n\n  /**\n   * Add a favorite location to a region.\n   * @param {string} regionId - The ID of the region.\n   * @param {Object} location - The location object { id, name, coords }.\n   */\n  addFavoriteLocation(regionId, location) {\n    console.log(`Adding favorite location to region ${regionId}:`, location);\n    \n    // Make sure region exists in our data structure\n    if (!this.favoriteLocations[regionId]) {\n      this.favoriteLocations[regionId] = [];\n    }\n\n    // Ensure location has a unique ID (or generate one)\n    if (!location.id) {\n        // Generate a more unique ID by including a timestamp\n        const timestamp = new Date().getTime();\n        location.id = `${location.name.toLowerCase().replace(/[^a-z0-9]/g, '-')}-${timestamp}`; // Better ID generation\n        console.log(`Generated ID for location: ${location.id}`);\n    }\n\n    // Check for duplicates (both by ID and by similar name+coordinates)\n    const isDuplicate = this.favoriteLocations[regionId].some(fav => \n      fav.id === location.id || \n      (fav.name === location.name && \n       Math.abs(fav.coords[0] - location.coords[0]) < 0.001 && \n       Math.abs(fav.coords[1] - location.coords[1]) < 0.001)\n    );\n\n    if (!isDuplicate) {\n      this.favoriteLocations[regionId].push(location);\n      console.log(`Added favorite location \"${location.name}\" to region \"${regionId}\"`);\n      \n      // Save to localStorage after adding\n      this.saveToLocalStorage();\n      \n      // IMPORTANT: Pass specific data for the current region to callback\n      if (this.callbacks.onChange) {\n        console.log(`Triggering onChange callback for region ${regionId} with ${this.favoriteLocations[regionId].length} favorites`);\n        this.callbacks.onChange({\n          region: regionId,\n          favorites: this.favoriteLocations[regionId]\n        });\n      } else {\n        console.log('No onChange callback registered');\n      }\n    } else {\n      console.log(`Favorite location \"${location.name}\" already exists in region \"${regionId}\"`);\n    }\n  }\n\n  /**\n   * Remove a favorite location from a region by ID.\n   * @param {string} regionId - The ID of the region.\n   * @param {string} locationId - The ID of the location to remove.\n   */\n  removeFavoriteLocation(regionId, locationId) {\n    console.log(`Removing favorite location from region ${regionId} with ID: ${locationId}`);\n    \n    if (this.favoriteLocations[regionId]) {\n      const initialLength = this.favoriteLocations[regionId].length;\n      this.favoriteLocations[regionId] = this.favoriteLocations[regionId].filter(\n        (location) => location.id !== locationId\n      );\n      \n      if (this.favoriteLocations[regionId].length < initialLength) {\n        console.log(`Removed favorite location with ID \"${locationId}\" from region \"${regionId}\"`);\n        \n        // Save to localStorage after removing\n        this.saveToLocalStorage();\n        \n        // IMPORTANT: Pass specific data for the current region to callback\n        if (this.callbacks.onChange) {\n          console.log(`Triggering onChange callback for region ${regionId} with ${this.favoriteLocations[regionId].length} favorites after removal`);\n          this.callbacks.onChange({\n            region: regionId,\n            favorites: this.favoriteLocations[regionId]\n          });\n        } else {\n          console.log('No onChange callback registered');\n        }\n      } else {\n        console.log(`Favorite location with ID \"${locationId}\" not found in region \"${regionId}\"`);\n        console.log(`Available IDs:`, this.favoriteLocations[regionId].map(loc => loc.id));\n      }\n    } else {\n      console.log(`Region \"${regionId}\" not found in favorites`);\n    }\n  }\n\n  // Future enhancement: Methods for user-specific favorites, persistence (localStorage, API), etc.\n}\n\nexport default FavoriteLocationsManager;\n","/**\n * AircraftManager.js\n * \n * Handles loading, filtering, and management of aircraft data from Palantir OSDK.\n * Provides aircraft performance data for route calculations.\n */\n\nclass AircraftManager {\n  constructor() {\n    // Store all loaded aircraft data\n    this.aircraftList = [];\n    \n    // Store filtered aircraft data (by region, type, etc.)\n    this.filteredAircraft = [];\n    \n    // Store aircraft organized by region and type\n    this.aircraftByRegion = {};\n    \n    // Store available types by region\n    this.typesByRegion = {};\n    \n    // Track whether we've loaded all aircraft\n    this.allAircraftLoaded = false;\n    \n    // Currently selected aircraft\n    this.selectedAircraft = null;\n    \n    // Callbacks for different events\n    this.callbacks = {\n      onAircraftLoaded: null,     // When aircraft data is loaded\n      onAircraftFiltered: null,   // When aircraft are filtered\n      onAircraftSelected: null,   // When an aircraft is selected\n      onError: null               // When an error occurs\n    };\n    \n    // Default aircraft performance data by type\n    this.defaultPerformanceData = {\n      's92': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,   // lbs per hour\n        maxFuel: 5000,    // lbs\n        maxPassengers: 19,\n        maxRange: 450,    // nm\n        usefulLoad: 7000  // lbs\n      },\n      's76': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 3000,    // lbs\n        maxPassengers: 12,\n        maxRange: 400,    // nm\n        usefulLoad: 5000  // lbs\n      },\n      's76d': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 3300,    // lbs\n        maxPassengers: 12,\n        maxRange: 420,    // nm\n        usefulLoad: 5200  // lbs\n      },\n      'aw139': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 4000,    // lbs\n        maxPassengers: 15,\n        maxRange: 400,    // nm\n        usefulLoad: 6000  // lbs\n      },\n      'aw189': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 4500,    // lbs\n        maxPassengers: 16,\n        maxRange: 430,    // nm\n        usefulLoad: 6300  // lbs\n      },\n      'h175': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 4200,    // lbs\n        maxPassengers: 16,\n        maxRange: 440,    // nm\n        usefulLoad: 6500  // lbs\n      },\n      'h160': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 3200,    // lbs\n        maxPassengers: 12,\n        maxRange: 420,    // nm\n        usefulLoad: 4800  // lbs\n      },\n      'ec135': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 2000,    // lbs\n        maxPassengers: 7,\n        maxRange: 350,    // nm\n        usefulLoad: 3300  // lbs\n      },\n      'ec225': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,   // lbs per hour\n        maxFuel: 4800,    // lbs\n        maxPassengers: 19,\n        maxRange: 450,    // nm\n        usefulLoad: 6800  // lbs\n      },\n      'as350': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 1500,    // lbs\n        maxPassengers: 6,\n        maxRange: 360,    // nm\n        usefulLoad: 2500  // lbs\n      },\n      'a119': {\n        cruiseSpeed: 0, // knots\n        fuelBurn: 0,    // lbs per hour\n        maxFuel: 1800,    // lbs\n        maxPassengers: 7,\n        maxRange: 380,    // nm\n        usefulLoad: 3000  // lbs\n      }\n    };\n  }\n\n  /**\n   * Set a callback function\n   * @param {string} type - The callback type (e.g., 'onAircraftLoaded')\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n\n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n\n  /**\n   * Load ALL aircraft data from Palantir OSDK and organize by region\n   * @param {Object} client - The OSDK client instance\n   * @returns {Promise} - Resolves with the loaded aircraft data\n   */\n  async loadAircraftFromOSDK(client) {\n    try {\n      // Only fetch all aircraft once to improve performance\n      if (this.allAircraftLoaded && this.aircraftList.length > 0) {\n        console.log(`%c===== USING EXISTING AIRCRAFT DATA =====`, 'background: #00a; color: #fff; font-size: 16px; font-weight: bold;');\n        console.log(`Using existing ${this.aircraftList.length} aircraft already loaded in memory`);\n        \n        // Just trigger the callback with the existing data\n        this.triggerCallback('onAircraftLoaded', this.aircraftList);\n        return this.aircraftList;\n      }\n      \n      console.log(`%c===== LOADING ALL AIRCRAFT DATA FROM OSDK =====`, 'background: #00a; color: #fff; font-size: 16px; font-weight: bold;');\n      \n      // Use LoadingIndicator to show loading status in the top card\n      // Instead of using the full-page overlay\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Loading aircraft data...');\n      }\n      \n      // Check if client exists\n      if (!client) {\n        throw new Error('OSDK client is not provided');\n      }\n      \n      try {\n        // Use the dynamic import to get the Asset interface\n        const sdk = await import('@flight-app/sdk');\n        \n        // Based on the screenshots, we're looking for Asset (not AircraftAsset)\n        const Asset = sdk.Asset;\n        \n        if (!Asset) {\n          throw new Error(`Required 'Asset' object not found in SDK: ${Object.keys(sdk).join(', ')}`);\n        }\n        \n        console.log(`Querying ALL aircraft data from OSDK...`);\n        \n        // Query for ALL aircraft - no region filtering\n        const query = client(Asset);\n        \n        // Fetch the data with larger page size to get all aircraft\n        console.log('Executing fetchPage query for all aircraft...');\n        const response = await query.fetchPage({\n          $pageSize: 1000 // Increased to get all aircraft in one request\n        });\n        \n        console.log(`Query returned ${response.data ? response.data.length : 0} aircraft`);\n        \n        // Process the response\n        if (response && response.data) {\n          console.log(`%c===== PROCESSING AIRCRAFT DATA =====`, 'background: #070; color: #fff; font-size: 14px;');\n          \n          // Log sample data to understand the structure\n          if (response.data.length > 0) {\n            console.log('Sample aircraft data fields:', Object.keys(response.data[0]).join(', '));\n          }\n          \n          // Process each aircraft and create standardized objects\n          this.aircraftList = response.data.map(aircraft => {\n            // Extract aircraft region from regionName field\n            let region = aircraft.regionName || '';\n            // Extract org unit field\n            let orgUnit = aircraft.orgUnit || '';\n            // Extract registration from assetIdentifier\n            let registration = aircraft.assetIdentifier || '';\n            // Extract model type from acModelName or model\n            let modelName = aircraft.acModelName || aircraft.model || '';\n            let modelType = '';\n            \n            // Determine aircraft type based on model name\n            modelType = this.determineAircraftType(modelName);\n            \n            // Create a display registration with both registration and region\n            const displayRegistration = `${registration} (${region})`;\n            \n            // Create standardized aircraft object\n            return {\n              assetId: aircraft.assetIdx || '',\n              registration: displayRegistration, // Use the combined format\n              rawRegistration: registration, // Keep the original registration\n              modelName: modelName,\n              modelType: modelType,\n              maxPassengers: aircraft.maxPassengers || 0,\n              cruiseSpeed: aircraft.cruseSpeed || 0,\n              fuelBurn: aircraft.fuelBurn || 0,\n              maxFuel: aircraft.maxFuelCapacity || 0,\n              dryWeight: aircraft.dryOperatingWeightLbs || 0,\n              usefulLoad: aircraft.usefulLoad || 0,\n              company: aircraft.company || aircraft.orgName || 'Unknown',\n              region: region,\n              orgUnit: orgUnit, // Store the orgUnit field\n              status: aircraft.acStatus || 'ACTIVE',\n              rawData: aircraft // Keep the full data for reference\n            };\n          });\n          \n          // Filter out aircraft with invalid data, inactive status, or in long-term maintenance\n          this.aircraftList = this.aircraftList.filter(aircraft => {\n            // Check for required fields\n            if (!aircraft.registration || !aircraft.modelName) {\n              return false;\n            }\n            \n            // Check for inactive statuses\n            if (aircraft.status === 'INACTIVE' || aircraft.status === 'RETIRED') {\n              return false;\n            }\n            \n            // Check for long-term maintenance\n            if (aircraft.status && \n                (aircraft.status.toUpperCase().includes('MAINTENANCE') || \n                 aircraft.status.toUpperCase().includes('REPAIR') || \n                 aircraft.status.toUpperCase().includes('OVERHAUL'))) {\n              console.log(`Filtering out aircraft in maintenance: ${aircraft.registration}, Status: ${aircraft.status}`);\n              return false;\n            }\n            \n            return true;\n          });\n          \n          console.log(`Processed ${this.aircraftList.length} valid aircraft`);\n          \n          // Now organize aircraft by region and type for quick access\n          console.log(`Organizing aircraft by region and type...`);\n          this.organizeAircraftByRegion();\n          \n          // Mark that we've loaded all aircraft\n          this.allAircraftLoaded = true;\n          \n          // Trigger the callback with ALL aircraft\n          console.log(`Triggering onAircraftLoaded callback with ${this.aircraftList.length} aircraft`);\n          this.triggerCallback('onAircraftLoaded', this.aircraftList);\n          \n          // Update status and then clear loading status\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(`Loaded ${this.aircraftList.length} aircraft successfully`);\n          }\n          \n          // Return the final aircraft list\n          return this.aircraftList;\n        } else {\n          console.warn('No aircraft data in response');\n          this.aircraftList = [];\n          this.triggerCallback('onAircraftLoaded', []);\n          \n          // Update status and then clear loading status\n          if (window.LoadingIndicator) {\n            window.LoadingIndicator.updateStatusIndicator(`No aircraft data found`);\n          }\n          \n          return [];\n        }\n      } catch (sdkError) {\n        console.error('Error with SDK import or query:', sdkError);\n        throw sdkError;\n      }\n    } catch (error) {\n      // Provide detailed error logging\n      console.error('Error loading aircraft from OSDK:', error);\n      \n      // Trigger error callback\n      this.triggerCallback('onError', error);\n      \n      // Update status with error message\n      if (window.LoadingIndicator) {\n        window.LoadingIndicator.updateStatusIndicator('Error loading aircraft data');\n        window.LoadingIndicator.updateStatusIndicator('Please try again later');\n      }\n      \n      // No mock data, just return empty list\n      this.aircraftList = [];\n      this.triggerCallback('onAircraftLoaded', this.aircraftList);\n      \n      return this.aircraftList;\n    }\n  }\n  \n  /**\n   * Organize aircraft by region and type for quick filtering\n   * Called after loading all aircraft data\n   */\n  organizeAircraftByRegion() {\n    console.log(`%c===== ORGANIZING AIRCRAFT BY REGION AND TYPE =====`, 'background: #005; color: #fff; font-size: 14px;');\n    \n    // Clear the existing data\n    this.aircraftByRegion = {};\n    this.typesByRegion = {};\n    \n    // First count aircraft by region for logging\n    const regionCount = {};\n    \n    // Count aircraft by region AND type\n    const typeCountByRegion = {};\n    \n    // Create a set of all known aircraft types\n    const allKnownTypes = new Set();\n    \n    // Log raw aircraft data to diagnose issues\n    console.log(`Total aircraft in raw list: ${this.aircraftList.length}`);\n    \n    // Log a sample aircraft to check structure\n    if (this.aircraftList.length > 0) {\n      console.log(\"Sample aircraft data:\", {\n        region: this.aircraftList[0].region,\n        type: this.aircraftList[0].modelType,\n        registration: this.aircraftList[0].registration\n      });\n    }\n    \n    // Check active status before organizing\n    const activeAircraft = this.aircraftList.filter(aircraft => \n      aircraft.status !== 'INACTIVE' && aircraft.status !== 'RETIRED'\n    );\n    console.log(`Total active aircraft: ${activeAircraft.length} of ${this.aircraftList.length}`);\n    \n    // Process all aircraft\n    this.aircraftList.forEach(aircraft => {\n      const region = aircraft.region || 'Unknown';\n      const type = aircraft.modelType || 'S92';\n      \n      // Track all known types\n      allKnownTypes.add(type);\n      \n      // Count aircraft by region\n      regionCount[region] = (regionCount[region] || 0) + 1;\n      \n      // Count by region and type\n      if (!typeCountByRegion[region]) {\n        typeCountByRegion[region] = {};\n      }\n      typeCountByRegion[region][type] = (typeCountByRegion[region][type] || 0) + 1;\n      \n      // Initialize region in aircraftByRegion if not exists\n      if (!this.aircraftByRegion[region]) {\n        this.aircraftByRegion[region] = {\n          all: [], // All aircraft in this region\n          byType: {} // Aircraft by type in this region\n        };\n      }\n      \n      // Add to all aircraft for this region\n      this.aircraftByRegion[region].all.push(aircraft);\n      \n      // Add to byType for this region\n      if (!this.aircraftByRegion[region].byType[type]) {\n        this.aircraftByRegion[region].byType[type] = [];\n      }\n      this.aircraftByRegion[region].byType[type].push(aircraft);\n      \n      // Update typesByRegion\n      if (!this.typesByRegion[region]) {\n        this.typesByRegion[region] = [];\n      }\n      if (!this.typesByRegion[region].includes(type)) {\n        this.typesByRegion[region].push(type);\n      }\n    });\n    \n    // Print detailed aircraft counts by type for GULF OF MEXICO\n    if (typeCountByRegion['GULF OF MEXICO']) {\n      console.log(`%c===== GULF OF MEXICO AIRCRAFT BY TYPE =====`, 'background: #00a; color: #fff;');\n      Object.entries(typeCountByRegion['GULF OF MEXICO']).forEach(([type, count]) => {\n        console.log(`${type}: ${count} aircraft`);\n      });\n      \n      // Add detailed debugging for all aircraft in Gulf of Mexico\n      console.log(`%c===== DETAILED AIRCRAFT INSPECTION IN GULF OF MEXICO =====`, 'background: #f00; color: #fff;');\n      \n      // Get specific registrations to check\n      const registrationsToCheck = [\n        'N145JW', 'N290BG', 'N293BG', 'N524PB', 'N592BG',\n        'N692BG', 'N806AP', 'N920VH', 'N92EH'\n      ];\n      \n      // Find all these registrations in the aircraft list\n      console.log('CHECKING SPECIFIC REGISTRATIONS:');\n      registrationsToCheck.forEach(reg => {\n        const matches = this.aircraftList.filter(aircraft => \n          aircraft.registration.includes(reg)\n        );\n        \n        console.log(`${reg}: Found ${matches.length} matches`);\n        \n        matches.forEach(aircraft => {\n          console.log(`  - Registration: ${aircraft.registration}`);\n          console.log(`    Type: ${aircraft.modelType}`);\n          console.log(`    Model Name: ${aircraft.modelName}`);\n          console.log(`    Region: ${aircraft.region}`);\n          console.log(`    Status: ${aircraft.status}`);\n        });\n      });\n      \n      // Get all S92 aircraft in Gulf of Mexico\n      const s92AircraftInGOM = this.aircraftList.filter(aircraft => \n        aircraft.modelType === 'S92' && \n        this.regionsMatch(aircraft.region, 'GULF OF MEXICO')\n      );\n      \n      console.log(`Found ${s92AircraftInGOM.length} S92 aircraft in Gulf of Mexico`);\n      \n      // Print the details of each S92 aircraft\n      s92AircraftInGOM.forEach(aircraft => {\n        console.log(`Registration: ${aircraft.registration}`);\n        console.log(`Type: ${aircraft.modelType}`);\n        console.log(`Model Name: ${aircraft.modelName}`);\n        console.log(`Region: ${aircraft.region}`);\n        console.log(`Status: ${aircraft.status}`);\n        console.log('---------');\n      });\n      \n      // Count each unique type in Gulf of Mexico\n      const actualTypeCounts = {};\n      this.aircraftList.filter(a => this.regionsMatch(a.region, 'GULF OF MEXICO'))\n                       .forEach(a => {\n                         actualTypeCounts[a.modelType] = (actualTypeCounts[a.modelType] || 0) + 1;\n                       });\n      \n      console.log('Actual type counts in Gulf of Mexico:', actualTypeCounts);\n    }\n    \n    // Also check flexible region matches for alternate region names\n    const regionAliases = {\n      'GULF OF MEXICO': ['US', 'GOM', 'MEXICO', 'UNITED STATES'],\n      'NIGERIA': ['WEST AFRICA', 'AFRICAN'],\n      'UNITED KINGDOM': ['UK', 'BRITAIN', 'SCOTLAND'],\n      'TRINIDAD AND TOBAGO': ['TRINIDAD', 'TOBAGO'],\n      'BRAZIL': ['BRAZIL EAST', 'BRAZILIAN', 'SOUTH AMERICA'],\n      'NORWAY': ['NORWEGIAN', 'SCANDINAVIAN'],\n      'NETHERLANDS': ['DUTCH', 'HOLLAND'],\n      'IRELAND': ['IRISH']\n    };\n    \n    // For each region with aliases, ensure aircraft can be found with either name\n    Object.entries(regionAliases).forEach(([primaryRegion, aliases]) => {\n      if (this.aircraftByRegion[primaryRegion]) {\n        // For each alias, create a reference to the primary region's data\n        aliases.forEach(alias => {\n          if (!this.aircraftByRegion[alias] && alias !== primaryRegion) {\n            // Reference the primary region's data\n            this.aircraftByRegion[alias] = this.aircraftByRegion[primaryRegion];\n            this.typesByRegion[alias] = [...this.typesByRegion[primaryRegion]];\n            console.log(`Created alias mapping: ${alias} -> ${primaryRegion} with ${this.aircraftByRegion[primaryRegion].all.length} aircraft`);\n          }\n        });\n      }\n    });\n    \n    // For each known region, ensure we have complete byType collections\n    Object.keys(this.aircraftByRegion).forEach(region => {\n      allKnownTypes.forEach(type => {\n        if (!this.aircraftByRegion[region].byType[type]) {\n          this.aircraftByRegion[region].byType[type] = [];\n        }\n      });\n    });\n    \n    // Log a summary of aircraft by region\n    console.log('Aircraft counts by region:', regionCount);\n    console.log(`Total regions with aircraft: ${Object.keys(this.aircraftByRegion).length}`);\n    console.log(`Total known aircraft types: ${allKnownTypes.size}`);\n    \n    // Log detailed breakdown of aircraft by type for each region\n    Object.keys(this.aircraftByRegion).forEach(region => {\n      console.log(`Region: ${region} - ${this.aircraftByRegion[region].all.length} total aircraft`);\n      const typeCount = {};\n      Object.keys(this.aircraftByRegion[region].byType).forEach(type => {\n        const count = this.aircraftByRegion[region].byType[type].length;\n        if (count > 0) {\n          typeCount[type] = count;\n        }\n      });\n      console.log(`Types available in ${region}:`, typeCount);\n    });\n  }\n\n  /**\n   * Format region name to match OSDK format\n   * @param {string} region - The region ID (e.g., 'gulf-of-mexico')\n   * @returns {string} - The formatted region name\n   */\n  formatRegionForOSDK(region) {\n    if (!region) return '';\n    \n    console.log(`Formatting region: \"${region}\"`);\n    \n    // Map of region IDs to OSDK region names\n    const regionMap = {\n      'gulf-of-mexico': 'GULF OF MEXICO',\n      'gom': 'GULF OF MEXICO',\n      'gulf of mexico': 'GULF OF MEXICO',\n      'gulf-mexico': 'GULF OF MEXICO',\n      'norway': 'NORWAY',\n      'united-kingdom': 'UNITED KINGDOM',\n      'uk': 'UNITED KINGDOM',\n      'west-africa': 'NIGERIA', // Updated to match actual data\n      'nigeria': 'NIGERIA',\n      'brazil': 'BRAZIL',\n      'brazil-east': 'BRAZIL EAST',\n      'australia': 'AUSTRALIA',\n      'us': 'GULF OF MEXICO', // Alias\n      'usa': 'GULF OF MEXICO', // Alias\n      'united-states': 'GULF OF MEXICO', // Alias\n      'united states': 'GULF OF MEXICO', // Alias\n      'netherlands': 'NETHERLANDS',\n      'trinidad': 'TRINIDAD AND TOBAGO',\n      'trinidad-and-tobago': 'TRINIDAD AND TOBAGO',\n      'ireland': 'IRELAND'\n    };\n    \n    // First check if we are passing a region that's already in the correct format\n    const upperRegion = region.toUpperCase();\n    \n    // If the uppercase version is already a known region name, use it\n    if (Object.values(regionMap).includes(upperRegion)) {\n      console.log(`Region already in correct format: \"${upperRegion}\"`);\n      return upperRegion;\n    }\n    \n    // Check if direct mapping exists\n    const lowerRegion = region.toLowerCase();\n    if (regionMap[lowerRegion]) {\n      console.log(`Direct mapping found for \"${region}\": \"${regionMap[lowerRegion]}\"`);\n      return regionMap[lowerRegion];\n    }\n    \n    // If no direct mapping, try to find a close match\n    for (const [key, value] of Object.entries(regionMap)) {\n      if (lowerRegion.includes(key) || key.includes(lowerRegion)) {\n        console.log(`No exact region match for \"${region}\", using \"${value}\" as closest match`);\n        return value;\n      }\n    }\n    \n    // Default: convert to uppercase\n    console.log(`No region mapping found for \"${region}\", defaulting to uppercase: \"${upperRegion}\"`);\n    return upperRegion;\n  }\n\n  /**\n   * Determine aircraft type from model name\n   * @param {string} modelName - The aircraft model name\n   * @returns {string} - The aircraft type\n   */\n  determineAircraftType(modelName) {\n    // If no model name provided, return UNKNOWN instead of defaulting to S92\n    if (!modelName) {\n      console.log('No model name provided, using UNKNOWN type');\n      return 'UNKNOWN';\n    }\n    \n    // Convert to uppercase for consistent matching\n    const model = modelName.toUpperCase();\n    \n    // Type mapping table for all known aircraft types\n    const typeMap = {\n      // Sikorsky types\n      'S92': 'S92',\n      'S-92': 'S92',\n      'S92A': 'S92',\n      'S76': 'S76',\n      'S-76': 'S76',\n      'S76D': 'S76D',\n      'S-76D': 'S76D',\n      'S76C': 'S76',\n      'S-76C': 'S76',\n      'SIKORSKY': 'S92', // Default Sikorsky to S92\n      \n      // Leonardo/AgustaWestland types\n      'AW139': 'AW139',\n      'AW-139': 'AW139',\n      'AW189': 'AW189',\n      'AW-189': 'AW189',\n      'AGUSTA': 'AW139', // Default Agusta to AW139\n      'LEONARDO': 'AW139', // Default Leonardo to AW139\n      'AGUSTAWESTLAND': 'AW139',\n      'AGUSTA WESTLAND': 'AW139',\n      'A119': 'A119',\n      \n      // Airbus/Eurocopter types\n      'H175': 'H175',\n      'H-175': 'H175',\n      'H160': 'H160',\n      'H-160': 'H160',\n      'EC135': 'EC135',\n      'EC-135': 'EC135',\n      'EC225': 'EC225',\n      'EC-225': 'EC225',\n      'AS350': 'AS350',\n      'AS-350': 'AS350',\n      'AIRBUS': 'H175' // Default Airbus to H175\n    };\n    \n    // Check for ASXXX format in the model name, where XXX is a number\n    if (model.includes('AS3') || model.includes('AS5')) {\n      console.log(`Detected Airbus AS series in model name: ${modelName}`);\n      // For AS350, AS355, etc.\n      if (model.includes('AS350') || model.includes('AS-350')) {\n        return 'AS350';\n      }\n    }\n    \n    // Check for specific model numbers that indicate type\n    if (model.includes('AW119')) {\n      return 'A119';\n    }\n    \n    // Parse the display format we're seeing in the dropdown\n    // e.g. extract S92 from \"N228BJ (GULF OF MEXICO) | S92\"\n    const regExMatch = model.match(/\\| (\\w+\\d+\\w*)$/);\n    if (regExMatch && regExMatch[1]) {\n      console.log(`Found type ${regExMatch[1]} via regex from ${modelName}`);\n      return regExMatch[1];\n    }\n    \n    // Try to match with type map\n    for (const [key, value] of Object.entries(typeMap)) {\n      if (model.includes(key)) {\n        console.log(`Found type ${value} by matching key ${key} in ${modelName}`);\n        return value;\n      }\n    }\n    \n    // Extract any pattern that looks like an aircraft type\n    // Look for common patterns like: letter(s) + number(s) + optional letter(s)\n    const typePattern = model.match(/[A-Z]+\\d+[A-Z]*/g);\n    if (typePattern && typePattern.length > 0) {\n      const extractedType = typePattern[0];\n      console.log(`Extracted potential type ${extractedType} from ${modelName}`);\n      \n      // Check if it's in our known types\n      for (const [key, value] of Object.entries(typeMap)) {\n        if (extractedType.includes(key) || key.includes(extractedType)) {\n          console.log(`Matched extracted type ${extractedType} to known type ${value}`);\n          return value;\n        }\n      }\n      \n      // If we extracted something but don't recognize it, use it as the type\n      console.log(`Using extracted but unrecognized type: ${extractedType}`);\n      return extractedType;\n    }\n    \n    // Use the actual model name instead of defaulting to S92\n    console.log(`Unrecognized aircraft model: \"${modelName}\" - using as type`);\n    \n    // Extract the first part of the model name if it's too long\n    const simplifiedModel = modelName.split(' ')[0];\n    return simplifiedModel;\n  }\n\n  /**\n   * NEVER USE THIS METHOD - Mock data should not be used\n   * @deprecated Always use loadAircraftFromOSDK instead\n   * @param {string} region - The region to filter by (optional)\n   */\n  async loadStaticAircraftData(region = null) {\n    console.error('⚠️ IMPORTANT - NEVER USE STATIC AIRCRAFT DATA! ⚠️');\n    console.error('Static aircraft data should never be used. Real aircraft data should be loaded from OSDK.');\n    \n    // Return empty list\n    this.aircraftList = [];\n    \n    // Trigger callback with empty list\n    this.triggerCallback('onAircraftLoaded', this.aircraftList);\n    \n    return this.aircraftList;\n  }\n\n  /**\n   * Get aircraft for a specific region from memory\n   * @param {string} region - Region ID to filter by\n   * @returns {Array} - Array of aircraft in that region\n   */\n  getAircraftByRegion(region) {\n    if (!region) return this.aircraftList;\n    \n    // Format region for consistency\n    const formattedRegion = this.formatRegionForOSDK(region);\n    console.log(`Getting aircraft for region: ${formattedRegion}`);\n    \n    // Special handling for Gulf of Mexico - log all aircraft in this region\n    if (formattedRegion === 'GULF OF MEXICO') {\n      console.log(`%c===== ALL AIRCRAFT IN GULF OF MEXICO =====`, 'background: #00a; color: #fff;');\n      \n      // Find all aircraft that match this region\n      const gulfAircraft = this.aircraftList.filter(aircraft => \n        this.regionsMatch(aircraft.region, formattedRegion)\n      );\n      \n      console.log(`Total aircraft in Gulf of Mexico: ${gulfAircraft.length}`);\n      \n      // Print basic info for each aircraft\n      gulfAircraft.forEach(aircraft => {\n        console.log(`- ${aircraft.registration} (${aircraft.modelType}): Status=${aircraft.status || 'Unknown'}`);\n      });\n    }\n    \n    // Check if we have pre-organized data for this region\n    if (this.aircraftByRegion[formattedRegion]) {\n      const result = this.aircraftByRegion[formattedRegion].all;\n      console.log(`Found ${result.length} aircraft in ${formattedRegion} from organized data`);\n      return result;\n    }\n    \n    // If not found in organized data, use flexible matching\n    console.log(`Region ${formattedRegion} not found in pre-organized data, using flexible matching`);\n    \n    const matchedAircraft = this.aircraftList.filter(aircraft => {\n      // Check region property with flexible matching\n      if (aircraft.region && this.regionsMatch(aircraft.region, formattedRegion)) {\n        return true;\n      }\n      \n      // Check orgUnit property with flexible matching\n      if (aircraft.orgUnit && this.regionsMatch(aircraft.orgUnit, formattedRegion)) {\n        return true;\n      }\n      \n      // Check registration which might contain region\n      const matchRegex = /\\(([^)]+)\\)/;\n      const match = aircraft.registration.match(matchRegex);\n      const displayedRegion = match ? match[1] : '';\n      \n      return this.regionsMatch(displayedRegion, formattedRegion);\n    });\n    \n    console.log(`Found ${matchedAircraft.length} aircraft in ${formattedRegion} using flexible matching`);\n    \n    // Store the results for future use\n    if (matchedAircraft.length > 0 && !this.aircraftByRegion[formattedRegion]) {\n      this.aircraftByRegion[formattedRegion] = {\n        all: matchedAircraft,\n        byType: {}\n      };\n      \n      // Organize by type\n      const types = {};\n      matchedAircraft.forEach(aircraft => {\n        const type = aircraft.modelType;\n        if (!types[type]) {\n          types[type] = [];\n        }\n        types[type].push(aircraft);\n      });\n      \n      this.aircraftByRegion[formattedRegion].byType = types;\n      \n      // Update types for this region\n      this.typesByRegion[formattedRegion] = Object.keys(types);\n      \n      console.log(`Added ${formattedRegion} to organized data with ${matchedAircraft.length} aircraft`);\n      console.log(`Types in ${formattedRegion}:`, this.typesByRegion[formattedRegion]);\n    }\n    \n    return matchedAircraft;\n  }\n  \n  /**\n   * Get available aircraft types for a specific region\n   * @param {string} region - Region ID\n   * @returns {Array} - Array of available aircraft types in that region\n   */\n  getAvailableTypesInRegion(region) {\n    if (!region) return this.getAvailableTypes();\n    \n    // Format region for consistency\n    const formattedRegion = this.formatRegionForOSDK(region);\n    console.log(`Getting available types for region: ${formattedRegion}`);\n    \n    // Get from pre-calculated data if available\n    if (this.typesByRegion[formattedRegion]) {\n      // Filter to only include types that actually have aircraft\n      const typesWithAircraft = this.typesByRegion[formattedRegion].filter(type => {\n        const hasAircraft = this.aircraftByRegion[formattedRegion] && \n                           this.aircraftByRegion[formattedRegion].byType[type] && \n                           this.aircraftByRegion[formattedRegion].byType[type].length > 0;\n        return hasAircraft;\n      });\n      \n      console.log(`Found ${typesWithAircraft.length} types with aircraft in ${formattedRegion}:`, typesWithAircraft);\n      return typesWithAircraft;\n    }\n    \n    // Try flexible region matching to find region\n    console.log(`Region ${formattedRegion} not found in pre-calculated data, trying flexible matching`);\n    \n    // Try each known region and check if it matches\n    for (const knownRegion of Object.keys(this.typesByRegion)) {\n      if (this.regionsMatch(knownRegion, formattedRegion)) {\n        console.log(`Found matching region: ${knownRegion} matches ${formattedRegion}`);\n        \n        // Filter to only include types that actually have aircraft\n        const typesWithAircraft = this.typesByRegion[knownRegion].filter(type => {\n          const hasAircraft = this.aircraftByRegion[knownRegion] && \n                             this.aircraftByRegion[knownRegion].byType[type] && \n                             this.aircraftByRegion[knownRegion].byType[type].length > 0;\n          return hasAircraft;\n        });\n        \n        console.log(`Found ${typesWithAircraft.length} types with aircraft in ${knownRegion} (match for ${formattedRegion}):`, typesWithAircraft);\n        \n        // Store for future use\n        this.typesByRegion[formattedRegion] = typesWithAircraft;\n        \n        return typesWithAircraft;\n      }\n    }\n    \n    // If no matching region found in pre-calculated data, compute it now\n    console.log(`No matching region found, computing types for ${formattedRegion}`);\n    const aircraftInRegion = this.getAircraftByRegion(region);\n    const types = [...new Set(aircraftInRegion.map(aircraft => aircraft.modelType))].filter(Boolean);\n    \n    // Store for future use\n    this.typesByRegion[formattedRegion] = types;\n    \n    console.log(`Computed ${types.length} types for ${formattedRegion}:`, types);\n    return types;\n  }\n  \n  /**\n   * Filter aircraft by region and type - enhanced memory-based implementation\n   * @param {string} region - Region to filter by\n   * @param {string} type - Aircraft type to filter by (optional)\n   * @returns {Array} - Filtered aircraft array\n   */\n  filterAircraft(region = null, type = null) {\n    console.log(`%c===== FILTERING AIRCRAFT =====`, 'background: #ff0; color: #000; font-size: 16px; font-weight: bold;');\n    console.log(`Region: \"${region}\", Type: \"${type}\"`);\n    \n    // Log filtering operation\n    console.log(`Filtering aircraft for ${region || 'all regions'}${type ? `, type: ${type}` : ''}`);\n\n    \n    // STEP 1: First filter by region\n    let filtered = [];\n    let formattedRegion = null;\n    \n    if (region) {\n      formattedRegion = this.formatRegionForOSDK(region);\n      console.log(`Formatted region name: \"${formattedRegion}\"`);\n      \n      // Check if we have pre-organized data for this exact region\n      if (this.aircraftByRegion[formattedRegion] && this.aircraftByRegion[formattedRegion].all) {\n        filtered = [...this.aircraftByRegion[formattedRegion].all];\n        console.log(`Using pre-organized data: ${filtered.length} aircraft in ${formattedRegion}`);\n      } else {\n        // Try to find a matching region using flexible matching\n        console.log(`Region \"${formattedRegion}\" not found in pre-organized data, trying flexible matching`);\n        \n        // Try each known region and check if it matches\n        let matchFound = false;\n        for (const knownRegion of Object.keys(this.aircraftByRegion)) {\n          if (this.regionsMatch(knownRegion, formattedRegion)) {\n            console.log(`Found matching region: \"${knownRegion}\" matches \"${formattedRegion}\"`);\n            filtered = [...this.aircraftByRegion[knownRegion].all];\n            console.log(`Using data from matched region: ${filtered.length} aircraft in ${knownRegion}`);\n            \n            // Create an alias for faster future access\n            this.aircraftByRegion[formattedRegion] = this.aircraftByRegion[knownRegion];\n            this.typesByRegion[formattedRegion] = this.typesByRegion[knownRegion] || [];\n            \n            matchFound = true;\n            break;\n          }\n        }\n        \n        // If no pre-organized match, fall back to manual filtering\n        if (!matchFound) {\n          console.log(`No matching pre-organized region found, using manual filtering`);\n          filtered = this.aircraftList.filter(aircraft => this.regionsMatch(aircraft.region, formattedRegion));\n          console.log(`Manually filtered to ${filtered.length} aircraft for region \"${formattedRegion}\"`);\n        }\n      }\n    } else {\n      // No region specified, use all aircraft\n      filtered = [...this.aircraftList];\n      console.log(`No region specified, using all ${filtered.length} aircraft`);\n    }\n    \n    // STEP 2: Filter by type if specified and not empty\n    if (type && type !== 'all' && type !== '') {\n      // Try to use pre-organized type data if available\n      if (formattedRegion && \n          this.aircraftByRegion[formattedRegion] && \n          this.aircraftByRegion[formattedRegion].byType && \n          this.aircraftByRegion[formattedRegion].byType[type]) {\n        \n        filtered = [...this.aircraftByRegion[formattedRegion].byType[type]];\n        console.log(`Using pre-organized type data: ${filtered.length} ${type} aircraft in ${formattedRegion}`);\n      } else {\n        // Filter manually using flexible type matching\n        console.log(`Filtering by type \"${type}\" using flexible matching`);\n        \n        // First try direct type match\n        const directMatches = filtered.filter(aircraft => aircraft.modelType === type);\n        \n        if (directMatches.length > 0) {\n          console.log(`Found ${directMatches.length} direct type matches for ${type}`);\n          filtered = directMatches;\n        } else {\n          // Fall back to flexible type matching\n          console.log(`No direct matches for type ${type}, using flexible matching`);\n          filtered = filtered.filter(aircraft => {\n            // Check modelType with flexible matching\n            if (this.typesMatch(aircraft.modelType, type)) {\n              return true;\n            }\n            \n            // Check for type in registration\n            const typeRegex = /\\|\\s*(\\S+)$/;\n            const match = aircraft.registration.match(typeRegex);\n            const displayedType = match ? match[1] : '';\n            \n            // Use flexible matching on displayed type or model name\n            return this.typesMatch(displayedType, type) || \n                  (aircraft.modelName && this.typesMatch(aircraft.modelName, type));\n          });\n          \n          console.log(`Found ${filtered.length} aircraft using flexible type matching`);\n        }\n      }\n    }\n    \n    // Additional detailed logging for S92 after filtering for Gulf of Mexico\n    if (formattedRegion === 'GULF OF MEXICO' && (type === 'S92' || !type)) {\n      const s92Aircraft = filtered.filter(aircraft => aircraft.modelType === 'S92');\n      console.log(`%c===== S92 AIRCRAFT AFTER FILTERING (count: ${s92Aircraft.length}) =====`, 'background: #f00; color: #fff;');\n      \n      // Show each S92 aircraft in detail\n      s92Aircraft.forEach(aircraft => {\n        console.log(`- Registration: ${aircraft.registration}`);\n        console.log(`  Model: ${aircraft.modelName}`);\n        console.log(`  Type: ${aircraft.modelType}`);\n        console.log(`  Region: ${aircraft.region}`);\n        console.log(`  Status: ${aircraft.status || 'Unknown'}`);\n      });\n      \n      // Look for potential duplicates\n      const registrations = s92Aircraft.map(a => a.registration);\n      const uniqueRegs = new Set(registrations);\n      \n      if (registrations.length !== uniqueRegs.size) {\n        console.log(`%c⚠️ WARNING: FOUND DUPLICATE REGISTRATIONS IN S92 AIRCRAFT`, 'background: #f00; color: #ff0; font-weight: bold;');\n        // Find the duplicates\n        const counts = {};\n        registrations.forEach(reg => {\n          counts[reg] = (counts[reg] || 0) + 1;\n        });\n        \n        for (const [reg, count] of Object.entries(counts)) {\n          if (count > 1) {\n            console.log(`Registration ${reg} appears ${count} times!`);\n          }\n        }\n      }\n    }\n    \n    // Temporarily cache the results in this.filteredAircraft for quick access\n    this.filteredAircraft = filtered;\n    \n    // Create a temporary overlay to display the results\n    this.showFilteringResults(filtered.length, region, type);\n    \n    // STEP 3: Create type buckets for the UI even if filtering by a specific type\n    // This allows the UI to show counts for all types even when a specific type is selected\n    const typeBuckets = {};\n    \n    // If we've filtered by region only (no type filter)\n    if (region && !type && formattedRegion && this.aircraftByRegion[formattedRegion]) {\n      // Use pre-calculated type buckets\n      console.log(`Using pre-calculated type buckets for region ${formattedRegion}`);\n      \n      // Get all type buckets for this region\n      Object.keys(this.aircraftByRegion[formattedRegion].byType).forEach(typeKey => {\n        typeBuckets[typeKey] = this.aircraftByRegion[formattedRegion].byType[typeKey];\n      });\n    } else {\n      // Create type buckets from the filtered aircraft\n      console.log(`Creating type buckets from filtered aircraft`);\n      \n      // Build a map of known types with empty arrays\n      const allTypes = this.getAvailableTypes();\n      allTypes.forEach(typeKey => {\n        typeBuckets[typeKey] = [];\n      });\n      \n      // Group filtered aircraft by type\n      filtered.forEach(aircraft => {\n        const aircraftType = aircraft.modelType || 'S92';\n        if (!typeBuckets[aircraftType]) {\n          typeBuckets[aircraftType] = [];\n        }\n        typeBuckets[aircraftType].push(aircraft);\n      });\n    }\n    \n    // Trigger the callback with additional info for the UI\n    const callbackData = {\n      filtered: this.filteredAircraft,\n      byType: typeBuckets\n    };\n    \n    this.triggerCallback('onAircraftFiltered', this.filteredAircraft);\n    \n    return this.filteredAircraft;\n  }\n  \n  /**\n   * Show filtering results in the console\n   * @param {number} count - Number of aircraft after filtering\n   * @param {string} region - Region filter applied\n   * @param {string} type - Type filter applied\n   */\n  showFilteringResults(count, region, type) {\n    // Just log to console to avoid any issues\n    const regionText = region ? this.formatRegionForOSDK(region) : 'All Regions';\n    const typeText = type ? type : 'All Types';\n    \n    console.log(`Aircraft filtered: ${count} aircraft found for ${regionText}, ${typeText}`);\n    \n    // Only attempt to update the status indicator if it exists and is working properly\n    try {\n      if (window.LoadingIndicator && typeof window.LoadingIndicator.updateStatusIndicator === 'function') {\n        window.LoadingIndicator.updateStatusIndicator(`Found: ${count} aircraft`);\n      }\n    } catch (e) {\n      console.error('Error updating status indicator:', e);\n    }\n  }\n  \n  /**\n   * Filter aircraft by region specifically - alias for filterAircraft\n   * @param {string} region - The region ID to filter by\n   * @param {string} type - Optional aircraft type\n   * @returns {Array} - The filtered aircraft list\n   */\n  filterAircraftByRegion(region, type = null) {\n    console.log(`Filtering aircraft by region: ${region}`);\n    return this.filterAircraft(region, type);\n  }\n\n  /**\n   * Reset aircraft filtering for region changes\n   * Clears the filtered aircraft and prepares for new region data\n   * but doesn't clear our permanent data\n   */\n  resetAircraftForRegion() {\n    console.log('Resetting filtered aircraft for region change');\n    this.filteredAircraft = [];\n    \n    // We won't clear the main aircraftList or our organized data\n    // but we'll trigger the callback to reset the UI\n    this.triggerCallback('onAircraftFiltered', []);\n  }\n  \n  /**\n   * Get counts of aircraft by type for a specific region\n   * @param {string} region - Region ID to get counts for\n   * @returns {Object} - Object with type keys and count values\n   */\n  getAircraftCountsByType(region) {\n    if (!region) return {};\n    \n    // Format region for consistency\n    const formattedRegion = this.formatRegionForOSDK(region);\n    console.log(`Getting aircraft counts by type for region: ${formattedRegion}`);\n    \n    // Use the pre-organized data if available\n    if (this.aircraftByRegion[formattedRegion]) {\n      const typeCounts = {};\n      Object.keys(this.aircraftByRegion[formattedRegion].byType).forEach(type => {\n        typeCounts[type] = this.aircraftByRegion[formattedRegion].byType[type].length;\n      });\n      return typeCounts;\n    }\n    \n    // If not available, calculate it now\n    const aircraftInRegion = this.getAircraftByRegion(region);\n    \n    // Group by type and count\n    const typeCounts = {};\n    aircraftInRegion.forEach(aircraft => {\n      const type = aircraft.modelType || 'S92';\n      typeCounts[type] = (typeCounts[type] || 0) + 1;\n    });\n    \n    return typeCounts;\n  }\n  \n  /**\n   * Get all available aircraft types across all regions\n   * @returns {Array} - Array of available aircraft types\n   */\n  getAvailableTypes() {\n    // Get unique aircraft types from all aircraft\n    const types = [...new Set(this.aircraftList.map(aircraft => aircraft.modelType))];\n    return types.filter(type => type); // Remove null/undefined\n  }\n\n  /**\n   * Get aircraft by registration\n   * @param {string} registration - The aircraft registration\n   * @returns {Object} - The aircraft data or null if not found\n   */\n  getAircraftByRegistration(registration) {\n    return this.aircraftList.find(aircraft => aircraft.registration === registration) || null;\n  }\n\n  /**\n   * Select an aircraft by registration\n   * @param {string} registration - The aircraft registration\n   */\n  selectAircraft(registration) {\n    const aircraft = this.getAircraftByRegistration(registration);\n    if (aircraft) {\n      this.selectedAircraft = aircraft;\n      this.triggerCallback('onAircraftSelected', aircraft);\n    } else {\n      console.warn(`Aircraft with registration ${registration} not found`);\n    }\n  }\n\n  /**\n   * Get performance data for an aircraft type\n   * @param {string} type - The aircraft type\n   * @param {string} registration - Specific aircraft registration (optional)\n   * @returns {Object} - Performance data\n   */\n  getPerformanceData(type, registration = null) {\n    // Try to get data for specific aircraft if registration is provided\n    if (registration) {\n      const aircraft = this.getAircraftByRegistration(registration);\n      if (aircraft) {\n        return {\n          cruiseSpeed: aircraft.cruiseSpeed || this.defaultPerformanceData[type]?.cruiseSpeed || 145,\n          fuelBurn: aircraft.fuelBurn || this.defaultPerformanceData[type]?.fuelBurn || 1100,\n          maxFuel: aircraft.maxFuel || this.defaultPerformanceData[type]?.maxFuel || 5000,\n          maxPassengers: aircraft.maxPassengers || this.defaultPerformanceData[type]?.maxPassengers || 19,\n          usefulLoad: aircraft.usefulLoad || this.defaultPerformanceData[type]?.usefulLoad || 7000\n        };\n      }\n    }\n    \n    // Fall back to default data for the type\n    return this.defaultPerformanceData[type] || this.defaultPerformanceData['s92']; // Default to S-92\n  }\n\n  /**\n   * Calculate performance for a route\n   * @param {string} aircraftType - The aircraft type\n   * @param {Array} coordinates - Array of waypoint coordinates\n   * @param {Object} params - Additional parameters (payload, fuel, etc.)\n   * @returns {Object} - Calculated performance data\n   */\n  calculateRoutePerformance(aircraftType, coordinates, params = {}) {\n    // Get performance data for the aircraft type\n    const aircraft = this.getPerformanceData(aircraftType, params.registration);\n    \n    // Extract parameters with defaults\n    const payloadWeight = params.payloadWeight || 2000; // lbs\n    const reserveFuel = params.reserveFuel || 600; // lbs\n    \n    // Calculate total distance\n    let totalDistance = 0;\n    for (let i = 0; i < coordinates.length - 1; i++) {\n      const [lng1, lat1] = coordinates[i];\n      const [lng2, lat2] = coordinates[i + 1];\n      \n      // Use Haversine formula to calculate distance\n      const R = 3440.07; // Earth radius in nautical miles\n      const dLat = this.toRad(lat2 - lat1);\n      const dLon = this.toRad(lng2 - lng1);\n      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n                Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) * \n                Math.sin(dLon / 2) * Math.sin(dLon / 2);\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n      const distance = R * c;\n      \n      totalDistance += distance;\n    }\n    \n    // Calculate flight time\n    const flightTime = totalDistance / aircraft.cruiseSpeed; // hours\n    \n    // Calculate fuel required\n    const fuelRequired = (flightTime * aircraft.fuelBurn) + reserveFuel;\n    \n    // Calculate remaining useful load\n    const usableLoad = aircraft.usefulLoad - fuelRequired;\n    \n    // Calculate max passengers (assuming 200 lbs per passenger including baggage)\n    const passengerWeightWithBaggage = 200; // lbs per passenger\n    const maxPassengers = Math.floor((usableLoad - payloadWeight) / passengerWeightWithBaggage);\n    \n    // Format time as HH:MM\n    const hours = Math.floor(flightTime);\n    const minutes = Math.round((flightTime - hours) * 60);\n    const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n    \n    return {\n      totalDistance: Math.round(totalDistance),\n      flightTime: flightTime,\n      formattedTime: formattedTime,\n      fuelRequired: Math.round(fuelRequired),\n      usableLoad: Math.round(usableLoad),\n      maxPassengers: Math.max(0, maxPassengers), // Ensure it's not negative\n      aircraft: aircraft\n    };\n  }\n  \n  /**\n   * Helper method to check if two regions match using flexible matching\n   * @param {string} region1 - First region name\n   * @param {string} region2 - Second region name\n   * @returns {boolean} - True if regions are considered a match\n   */\n  regionsMatch(region1, region2) {\n    if (!region1 || !region2) return false;\n    \n    // Convert to uppercase for comparison\n    const r1 = region1.toUpperCase().trim();\n    const r2 = region2.toUpperCase().trim();\n    \n    // Direct match\n    if (r1 === r2) return true;\n    \n    // Check if one contains the other\n    if (r1.includes(r2) || r2.includes(r1)) return true;\n    \n    // Special case mappings\n    const regionAliases = {\n      'GULF OF MEXICO': ['US', 'GOM', 'MEXICO', 'UNITED STATES'],\n      'NIGERIA': ['WEST AFRICA', 'AFRICAN'],\n      'UNITED KINGDOM': ['UK', 'BRITAIN', 'SCOTLAND'],\n      'TRINIDAD AND TOBAGO': ['TRINIDAD', 'TOBAGO'],\n      'BRAZIL': ['BRAZIL EAST', 'BRAZILIAN', 'SOUTH AMERICA'],\n      'NORWAY': ['NORWEGIAN', 'SCANDINAVIAN'],\n      'NETHERLANDS': ['DUTCH', 'HOLLAND'],\n      'IRELAND': ['IRISH']\n    };\n    \n    // Check region aliases\n    for (const [key, aliases] of Object.entries(regionAliases)) {\n      // If r1 is the key, check if r2 is in aliases\n      if (r1 === key && aliases.some(alias => r2.includes(alias))) return true;\n      \n      // If r2 is the key, check if r1 is in aliases\n      if (r2 === key && aliases.some(alias => r1.includes(alias))) return true;\n      \n      // If r1 contains any alias, check if r2 is the key\n      if (aliases.some(alias => r1.includes(alias)) && r2 === key) return true;\n      \n      // If r2 contains any alias, check if r1 is the key\n      if (aliases.some(alias => r2.includes(alias)) && r1 === key) return true;\n    }\n    \n    return false;\n  }\n  \n  /**\n   * Helper method to check if two aircraft types match using flexible matching\n   * @param {string} type1 - First aircraft type\n   * @param {string} type2 - Second aircraft type\n   * @returns {boolean} - True if types are considered a match\n   */\n  typesMatch(type1, type2) {\n    if (!type1 || !type2) return false;\n    \n    // Convert to uppercase for comparison\n    const t1 = type1.toUpperCase().trim();\n    const t2 = type2.toUpperCase().trim();\n    \n    // Direct match\n    if (t1 === t2) return true;\n    \n    // Extract basic type pattern (letters followed by numbers)\n    const t1Base = t1.match(/^[A-Z]+\\d+/);\n    const t2Base = t2.match(/^[A-Z]+\\d+/);\n    \n    // If we have base patterns and they match\n    if (t1Base && t2Base && t1Base[0] === t2Base[0]) return true;\n    \n    // Check if one type contains the other\n    if (t1.includes(t2) || t2.includes(t1)) return true;\n    \n    // Type families and variations\n    const typeFamilies = {\n      'S92': ['S92A', 'S-92', 'S-92A', 'SIKORSKY 92'],\n      'S76': ['S76D', 'S76C', 'S-76', 'S-76C', 'S-76D', 'SIKORSKY 76'],\n      'AW139': ['AW-139', 'AGUSTA 139', 'AGUSTA WESTLAND 139'],\n      'AW189': ['AW-189', 'AGUSTA 189', 'AGUSTA WESTLAND 189'],\n      'H175': ['H-175', 'EC175', 'EC-175', 'AIRBUS 175'],\n      'H160': ['H-160', 'EC160', 'EC-160', 'AIRBUS 160'],\n      'EC135': ['EC-135', 'EUROCOPTER 135', 'H135', 'H-135'],\n      'EC225': ['EC-225', 'H225', 'H-225', 'EUROCOPTER 225'],\n      'AS350': ['AS-350', 'EUROCOPTER 350', 'H125', 'H-125']\n    };\n    \n    // Check type families\n    for (const [key, variations] of Object.entries(typeFamilies)) {\n      // If t1 is the key, check if t2 is in variations\n      if (t1 === key && variations.some(v => t2.includes(v))) return true;\n      \n      // If t2 is the key, check if t1 is in variations\n      if (t2 === key && variations.some(v => t1.includes(v))) return true;\n      \n      // If t1 is in variations, check if t2 is the key\n      if (variations.some(v => t1.includes(v)) && t2 === key) return true;\n      \n      // If t2 is in variations, check if t1 is the key\n      if (variations.some(v => t2.includes(v)) && t1 === key) return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Convert degrees to radians\n   * @param {number} degrees - Angle in degrees\n   * @returns {number} - Angle in radians\n   */\n  toRad(degrees) {\n    return degrees * (Math.PI / 180);\n  }\n}\n\nexport default AircraftManager;","/**\n * Flight Calculations Module\n * \n * A dedicated module for performing all flight-related calculations including:\n * - Fuel requirements and consumption\n * - Passenger capacity based on load\n * - Flight timing with future wind calculations\n */\n\nclass FlightCalculations {\n  constructor() {\n    // Default values for calculations\n    this.defaults = {\n      passengerWeight: 0, // lbs per passenger including baggage\n      contingencyFuelPercent: 10, // 10% contingency fuel\n      taxiFuel: 50, // lbs\n      reserveFuel: 0, // lbs\n      deckTimePerStop: 5, // minutes\n      deckFuelFlow: 400, // lbs per hour during deck operations\n      callbacks: {} // For notifying UI of calculation results\n    };\n    \n    // Current configuration, initialized with defaults\n    this.config = {...this.defaults};\n  }\n  \n  /**\n   * Update configuration settings\n   * \n   * @param {Object} newConfig Configuration parameters to update\n   */\n  updateConfig(newConfig) {\n    // Debug log to track configuration updates\n    console.log(\"FlightCalculations: Updating config with:\", newConfig);\n    \n    // Only update properties that exist in defaults\n    const validConfig = {};\n    Object.keys(newConfig).forEach(key => {\n      if (key !== 'callbacks' && (this.defaults.hasOwnProperty(key) || key === 'payloadWeight')) {\n        validConfig[key] = newConfig[key];\n      }\n    });\n    \n    // Merge the valid config with the current config\n    this.config = {...this.config, ...validConfig};\n    \n    // Log the new configuration\n    console.log(\"FlightCalculations: Config updated:\", this.config);\n  }\n  \n  /**\n   * Set a callback function to be called when calculations are complete\n   * \n   * @param {string} event The event name\n   * @param {Function} callback The callback function\n   */\n  setCallback(event, callback) {\n    if (typeof callback === 'function') {\n      this.config.callbacks[event] = callback;\n    }\n  }\n  \n  /**\n   * Calculate all flight parameters based on route and aircraft data\n   * \n   * @param {Array} coordinates Array of [lng, lat] coordinates for the route\n   * @param {Object} aircraft Aircraft data object\n   * @param {Object} params Additional parameters for calculations\n   * @returns {Object} Complete set of calculated flight statistics\n   */\n  calculateFlightStats(coordinates, aircraft, params = {}) {\n    // Exit early if no valid inputs\n    if (!coordinates || coordinates.length < 2 || !aircraft) {\n      console.error(\"Invalid inputs for flight calculations\");\n      return null;\n    }\n    \n    // Log input parameters for debugging\n    console.log(\"FlightCalculations: calculateFlightStats called with:\", {\n      coordinates: coordinates.length + \" waypoints\",\n      aircraft: aircraft.registration || \"Generic aircraft\",\n      params\n    });\n    \n    // Merge passed parameters with config\n    const calculationParams = {\n      ...this.config,\n      ...params\n    };\n    \n    console.log(\"FlightCalculations: Using calculation parameters:\", calculationParams);\n    \n    // Extract aircraft parameters, using defaults for missing values\n    const {\n      cruseSpeed = 145, // knots - note the field is spelled \"cruseSpeed\" in the data\n      fuelBurn = 0,   // lbs per hour\n      maxFuelCapacity = 5000, // lbs\n      maxFuel = 5000, // lbs (alternative field name)\n      dryOperatingWeightLbs = 15000, // lbs (empty weight)\n      emptyWeight = 0, // lbs (alternative field name)\n      usefulLoad = 7000, // lbs\n      maxPassengers = 19\n    } = aircraft;\n    \n    // Use cruseSpeed (matches the field spelling in the aircraft data)\n    // But check alternative field names to handle different data structures\n    const cruiseSpeed = aircraft.cruiseSpeed || cruseSpeed;\n    const fuelCapacity = maxFuel || maxFuelCapacity;\n    const operatingWeight = dryOperatingWeightLbs || emptyWeight;\n    \n    // Calculate total distance\n    const totalDistance = this.calculateTotalDistance(coordinates);\n    \n    // Calculate number of stops (waypoints - 1)\n    const numStops = coordinates.length - 1;\n    \n    // Calculate flight time in hours\n    const flightTimeHours = totalDistance / cruiseSpeed;\n    \n    // Format flight time as HH:MM\n    const flightTimeFormatted = this.formatTimeHHMM(flightTimeHours);\n    \n    // Calculate fuel requirements\n    const tripFuel = flightTimeHours * fuelBurn;\n    \n    // Deck fuel - only for intermediate stops (not final destination)\n    const intermediateStops = Math.max(0, numStops - 1); // Don't count final destination\n    const deckTimeHours = (intermediateStops * calculationParams.deckTimePerStop) / 60;\n    const deckFuel = deckTimeHours * calculationParams.deckFuelFlow;\n    \n    // Additional fuel components\n    const contingencyFuel = tripFuel * (calculationParams.contingencyFuelPercent / 100);\n    const taxiFuel = calculationParams.taxiFuel;\n    const reserveFuel = calculationParams.reserveFuel;\n    \n    // Total fuel required\n    const totalFuel = Math.round(tripFuel + deckFuel + contingencyFuel + taxiFuel + reserveFuel);\n    \n    // Get payload weight from params or use a default\n    const payloadWeight = calculationParams.payloadWeight || 0;\n    \n    // Calculate effective max takeoff weight\n    const maxTakeoffWeight = operatingWeight + usefulLoad; \n    \n    // Calculate usable load after fuel\n    const usableLoad = Math.max(0, usefulLoad - totalFuel);\n    \n    // Calculate maximum passenger capacity based on weight\n    const maxPassengersByWeight = Math.floor((usableLoad - payloadWeight) / calculationParams.passengerWeight);\n    const calculatedPassengers = Math.min(maxPassengersByWeight, maxPassengers);\n    \n    // Calculate total time (flight time + deck time)\n    const totalTimeHours = flightTimeHours + deckTimeHours;\n    const totalTimeFormatted = this.formatTimeHHMM(totalTimeHours);\n    \n    // Compile results\n    const result = {\n      // Distance\n      totalDistance: totalDistance.toFixed(1),\n      \n      // Time calculations\n      timeHours: flightTimeHours, // Keep the field name compatible with existing code\n      estimatedTime: flightTimeFormatted, // Keep the field name compatible with existing code\n      deckTimeMinutes: intermediateStops * calculationParams.deckTimePerStop,\n      totalTimeHours,\n      totalTimeFormatted,\n      \n      // Fuel calculations\n      fuelRequired: Math.round(tripFuel), // Keep the field name compatible with existing code\n      tripFuel: Math.round(tripFuel),\n      deckFuel: Math.round(deckFuel),\n      contingencyFuel: Math.round(contingencyFuel),\n      taxiFuel,\n      reserveFuel,\n      totalFuel,\n      \n      // Weight calculations\n      dryOperatingWeight: operatingWeight,\n      maxTakeoffWeight,\n      usefulLoad,\n      usableLoad,\n      \n      // Passenger calculation\n      maxPassengers,\n      maxPassengersByWeight,\n      calculatedPassengers,\n      \n      // Aircraft data reference\n      aircraft,\n      \n      // Route data\n      numStops,\n      intermediateStops\n    };\n    \n    // Log the results for debugging\n    console.log(\"FlightCalculations: Calculation results:\", {\n      totalDistance: result.totalDistance,\n      estimatedTime: result.estimatedTime,\n      totalFuel: result.totalFuel,\n      calculatedPassengers: result.calculatedPassengers\n    });\n    \n    // Call the callback if one exists\n    if (this.config.callbacks?.onCalculationComplete) {\n      this.config.callbacks.onCalculationComplete(result);\n    }\n    \n    // Return the calculation results\n    return result;\n  }\n  \n  /**\n   * Calculate the total distance of the route in nautical miles\n   * \n   * @param {Array} coordinates Array of [lng, lat] coordinates for the route\n   * @returns {number} Total distance in nautical miles\n   */\n  calculateTotalDistance(coordinates) {\n    let totalDistance = 0;\n    \n    for (let i = 0; i < coordinates.length - 1; i++) {\n      const from = window.turf.point(coordinates[i]);\n      const to = window.turf.point(coordinates[i + 1]);\n      \n      try {\n        // Calculate distance in kilometers\n        const distance = window.turf.distance(from, to, {units: 'kilometers'});\n        \n        // Convert to nautical miles (1 km = 0.539957 nm)\n        const distanceNm = distance * 0.539957;\n        \n        totalDistance += distanceNm;\n      } catch (error) {\n        console.error(\"Error calculating leg distance:\", error);\n      }\n    }\n    \n    return totalDistance;\n  }\n  \n  /**\n   * Calculate estimated time between two points\n   * \n   * @param {Array} fromCoords [lng, lat] of starting point\n   * @param {Array} toCoords [lng, lat] of ending point\n   * @param {number} cruiseSpeed Cruise speed in knots\n   * @param {Object} windData Optional wind data for more accurate calculation\n   * @returns {number} Estimated time in hours\n   */\n  calculateLegTime(fromCoords, toCoords, cruiseSpeed, windData = null) {\n    // Calculate distance between points\n    const from = window.turf.point(fromCoords);\n    const to = window.turf.point(toCoords);\n    const distance = window.turf.distance(from, to, {units: 'kilometers'}) * 0.539957; // Convert to nm\n    \n    // Basic calculation without wind\n    if (!windData) {\n      return distance / cruiseSpeed;\n    }\n    \n    // TODO: Add wind calculations in future enhancement\n    // This is a placeholder for the wind calculation logic\n    // Will need to calculate true heading, then adjust ground speed based on wind\n    \n    // For now, return the basic calculation\n    return distance / cruiseSpeed;\n  }\n  \n  /**\n   * Format time in hours to HH:MM format\n   * \n   * @param {number} timeHours Time in decimal hours\n   * @returns {string} Formatted time string HH:MM\n   */\n  formatTimeHHMM(timeHours) {\n    if (typeof timeHours !== 'number') return '00:00';\n    \n    const hours = Math.floor(timeHours);\n    const minutes = Math.floor((timeHours - hours) * 60);\n    \n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n  }\n}\n\nexport default FlightCalculations;","/**\n * MapInteractionHandler.js\n * \n * Handles map click events and route interactions\n * Separates these concerns from the main FastPlannerApp component\n */\n\nclass MapInteractionHandler {\n  constructor(mapManager, waypointManager, platformManager) {\n    this.mapManager = mapManager;\n    this.waypointManager = waypointManager;\n    this.platformManager = platformManager;\n    this.isInitialized = false;\n    this.callbacks = {\n      onLeftPanelOpen: null,\n      onMapClick: null,\n      onRouteClick: null,\n      onPlatformClick: null,\n      onError: null\n    };\n  }\n\n  /**\n   * Set a callback function\n   * @param {string} type - The callback type\n   * @param {Function} callback - The callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n\n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - The data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n  }\n\n  /**\n   * Initialize map click handlers\n   * This is the main function that sets up all map interactions\n   * @returns {boolean} - Success status\n   */\n  initialize() {\n    console.log('🚨 MapInteractionHandler: Initializing map interaction handlers');\n\n    // Make sure we have all the required managers\n    if (!this.mapManager || !this.waypointManager || !this.platformManager) {\n      console.error('MapInteractionHandler: Missing required managers');\n      this.triggerCallback('onError', 'Missing required managers');\n      return false;\n    }\n\n    // Get the map instance\n    const map = this.mapManager.getMap();\n    if (!map) {\n      console.error('MapInteractionHandler: Map is not initialized');\n      this.triggerCallback('onError', 'Map is not initialized');\n      return false;\n    }\n    \n    // Ensure waypoint mode flag is in a consistent state\n    console.log('MapInteractionHandler: Ensuring correct waypoint mode flag');\n    if (window.isWaypointModeActive !== true) {\n      console.log('Setting normal mode (waypoint mode is off)');\n      window.isWaypointModeActive = false;\n    } else {\n      console.log('Keeping waypoint mode active (already set to true)');\n    }\n    \n    // Remove ALL existing click handlers to prevent duplication\n    // This is critical to ensure we have one central handler\n    console.log('MapInteractionHandler: Removing existing handlers before adding new ones');\n    \n    // Remove any existing click handler\n    if (this._boundClickHandler) {\n      map.off('click', this._boundClickHandler);\n    }\n    \n    // Create a new bound handler with proper \"this\" context\n    this._boundClickHandler = this.handleMapClick.bind(this);\n    \n    // Add the SINGLE click handler\n    console.log('MapInteractionHandler: Adding new centralized map click handler');\n    map.on('click', this._boundClickHandler);\n\n    // Set up route dragging\n    if (typeof this.waypointManager.setupRouteDragging === 'function') {\n      console.log('MapInteractionHandler: Initializing route drag handlers');\n      this.waypointManager.setupRouteDragging(this.handleRouteDragComplete.bind(this));\n    }\n\n    // Mark as initialized\n    this.isInitialized = true;\n    console.log('MapInteractionHandler: Map interactions initialized successfully');\n    return true;\n  }\n\n  /**\n   * Handle map click events - CENTRAL EVENT DISPATCHER\n   * @param {Object} e - The click event\n   */\n  handleMapClick(e) {\n    // This is now the single centralized click handler for all map interactions\n    console.log('MapInteractionHandler: Handling map click event');\n    \n    // STAGE 1: Check if we're in waypoint mode and should route to WaypointHandler\n    if (window.isWaypointModeActive === true) {\n      console.log('MapInteractionHandler: In waypoint mode, forwarding to WaypointHandler');\n      \n      // Find the waypoint handler - either direct reference or global\n      const waypointHandler = window.waypointHandler || this.getWaypointHandler();\n      \n      if (waypointHandler && typeof waypointHandler.handleWaypointClick === 'function') {\n        // Let waypoint handler process this event\n        const handled = waypointHandler.handleWaypointClick(e);\n        \n        if (handled) {\n          console.log('MapInteractionHandler: Event handled by WaypointHandler');\n          // Event was handled, stop processing\n          return;\n        }\n      } else {\n        console.warn('MapInteractionHandler: Waypoint mode active but no handler available');\n      }\n    }\n\n    // CRITICAL FIX: Log the mode and flag value at the time of click\n    const isWaypointMode = window.isWaypointModeActive === true;\n    console.log(`DIRECT FIX: Map clicked in ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'} mode. Flag value: ${window.isWaypointModeActive}`);\n    \n    // Ensure managers are initialized\n    if (!this.mapManager || !this.waypointManager || !this.platformManager) {\n      console.error('MapInteractionHandler: Required managers not initialized');\n      return;\n    }\n\n    const map = this.mapManager.getMap();\n    if (!map) return;\n\n    // Notify the app to ensure left panel is shown when clicking on map\n    this.triggerCallback('onLeftPanelOpen');\n    \n    // DIRECT FIX: For waypoint mode, handle differently\n    if (isWaypointMode) {\n      console.log('DIRECT FIX: Handling click in WAYPOINT mode');\n      \n      // In waypoint mode, add a waypoint directly\n      this.waypointManager.addWaypoint(\n        [e.lngLat.lng, e.lngLat.lat],\n        `Waypoint ${this.waypointManager.getWaypoints().length + 1}`,\n        { isWaypoint: true, type: 'WAYPOINT' }\n      );\n      \n      // If we have a callback, call it\n      if (this.callbacks.onMapClick) {\n        this.triggerCallback('onMapClick', {\n          lngLat: e.lngLat,\n          coordinates: [e.lngLat.lng, e.lngLat.lat],\n          isWaypointMode: true,\n          type: 'WAYPOINT'\n        });\n      }\n      \n      return;\n    }\n\n    try {\n      // First check if the layers exist before querying\n      const map = this.mapManager.getMap();\n      const availableLayers = [];\n      \n      // Safely check if each layer exists before adding to query\n      ['platforms-fixed-layer', 'platforms-movable-layer', 'airfields-layer', 'platforms-layer'].forEach(layer => {\n        try {\n          if (map.getLayer(layer)) {\n            availableLayers.push(layer);\n          }\n        } catch (err) {\n          // Layer doesn't exist, skip it\n          console.log(`Layer ${layer} not available for query`);\n        }\n      });\n      \n      // Only query if we have available layers\n      if (availableLayers.length > 0) {\n        console.log('Querying available platform layers:', availableLayers);\n        const platformFeatures = map.queryRenderedFeatures(e.point, { layers: availableLayers });\n\n        if (platformFeatures && platformFeatures.length > 0) {\n          console.log('MapInteractionHandler: Clicked on platform:', platformFeatures[0].properties.name);\n          const props = platformFeatures[0].properties;\n          const coordinates = platformFeatures[0].geometry.coordinates.slice();\n\n          // Handle platform click - either direct add or callback\n          this.handlePlatformClick(coordinates, props.name);\n          return;\n        }\n      } else {\n        console.log('No platform layers available for query, skipping platform check');\n      }\n    } catch (err) {\n      console.error('MapInteractionHandler: Error handling platform click:', err);\n    }\n\n    try {\n      // Check if route layer exists before querying\n      if (map.getLayer('route')) {\n        // Check if clicking on the route line\n        const routeFeatures = map.queryRenderedFeatures(e.point, { layers: ['route'] });\n        if (routeFeatures && routeFeatures.length > 0) {\n          console.log('MapInteractionHandler: Clicked on route line');\n          \n          // Find where to insert on the path\n          const insertIndex = this.waypointManager.findPathInsertIndex(e.lngLat);\n\n          // Try to find nearest platform but don't depend on findNearestPlatform\n          let nearestRig = null;\n          try {\n            if (typeof this.platformManager.findNearestPlatform === 'function') {\n              nearestRig = this.platformManager.findNearestPlatform(e.lngLat.lat, e.lngLat.lng);\n            } else {\n              console.log('findNearestPlatform not available, skipping nearest rig check');\n            }\n          } catch (err) {\n            console.log('Error finding nearest platform, continuing without it');\n          }\n\n          // Handle route click - either direct add or callback\n          this.handleRouteClick(e.lngLat, insertIndex, nearestRig);\n          return;\n        }\n      } else {\n        console.log('Route layer not available for query, skipping route check');\n      }\n    } catch (err) {\n      console.error('MapInteractionHandler: Error handling route click:', err);\n    }\n\n    // If we're here, we clicked on the map background (not a platform or route)\n    try {\n      // Try to check for nearest rig but don't depend on it\n      let nearestRig = null;\n      \n      try {\n        if (typeof this.platformManager.findNearestPlatform === 'function') {\n          nearestRig = this.platformManager.findNearestPlatform(e.lngLat.lat, e.lngLat.lng);\n        } else {\n          console.log('findNearestPlatform not available, skipping nearest rig check');\n        }\n      } catch (err) {\n        console.log('Error finding nearest platform, continuing without it');\n      }\n\n      if (nearestRig && nearestRig.distance < 5) { // Within 5 nautical miles\n        // Add the rig as a waypoint instead of the clicked location\n        console.log(`MapInteractionHandler: Using nearest rig: ${nearestRig.name} (${nearestRig.distance.toFixed(1)} nm away)`);\n        this.handlePlatformClick(nearestRig.coordinates, nearestRig.name);\n      } else {\n        // Just add the clicked location as a waypoint\n        this.handleMapBackgroundClick(e.lngLat);\n      }\n    } catch (err) {\n      console.error('MapInteractionHandler: Error handling map background click:', err);\n      \n      // Fallback to just adding the clicked point without any platform checks\n      this.addClickedPoint(e.lngLat);\n    }\n  }\n\n  /**\n   * Handle clicks on platform markers\n   * @param {Array} coordinates - [lng, lat] coordinates\n   * @param {string} name - The platform name\n   */\n  handlePlatformClick(coordinates, name) {\n    console.log(`MapInteractionHandler: Platform click on ${name} at ${coordinates}`);\n    \n    // Get waypoint mode status\n    const isWaypointMode = window.isWaypointModeActive === true;\n    \n    // Either add directly or trigger callback\n    if (this.callbacks.onPlatformClick) {\n      this.triggerCallback('onPlatformClick', { \n        coordinates, \n        name,\n        isWaypointMode\n      });\n    } else {\n      // Direct add if no callback\n      try {\n        this.waypointManager.addWaypoint(\n          coordinates, \n          name,\n          { isWaypointMode: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n        );\n      } catch (err) {\n        console.error('MapInteractionHandler: Error adding platform waypoint:', err);\n        \n        // Fallback\n        try {\n          console.log('MapInteractionHandler: Trying fallback for platform click');\n          this.waypointManager.addWaypoint(\n            coordinates,\n            name || 'Platform'\n          );\n        } catch (innerErr) {\n          console.error('MapInteractionHandler: Fallback also failed:', innerErr);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle clicks on the route line\n   * @param {Object} lngLat - {lng, lat} click coordinates\n   * @param {number} insertIndex - Index to insert the new waypoint\n   * @param {Object} nearestRig - The nearest rig if any\n   */\n  handleRouteClick(lngLat, insertIndex, nearestRig) {\n    console.log(`MapInteractionHandler: Route click at [${lngLat.lng}, ${lngLat.lat}], insert at ${insertIndex}`);\n    \n    // Get waypoint mode status\n    const isWaypointMode = window.isWaypointModeActive === true;\n    \n    // Either add directly or trigger callback\n    if (this.callbacks.onRouteClick) {\n      const callbackData = { \n        lngLat, \n        insertIndex, \n        nearestRig,\n        isWaypointMode\n      };\n      \n      this.triggerCallback('onRouteClick', callbackData);\n    } else {\n      // Direct add if no callback\n      try {\n        if (nearestRig && nearestRig.distance < 5) {\n          // Add the rig instead of the clicked point\n          console.log(`MapInteractionHandler: Using nearest rig: ${nearestRig.name}`);\n          \n          // Safely get coordinates\n          let coordinates = [lngLat.lng, lngLat.lat]; // Default to clicked point\n          \n          try {\n            if (Array.isArray(nearestRig.coordinates)) {\n              coordinates = nearestRig.coordinates;\n            } else if (Array.isArray(nearestRig.coords)) {\n              coordinates = nearestRig.coords;\n            } else if (nearestRig.lng !== undefined && nearestRig.lat !== undefined) {\n              coordinates = [nearestRig.lng, nearestRig.lat];\n            }\n          } catch (err) {\n            console.error('MapInteractionHandler: Error getting rig coordinates:', err);\n          }\n          \n          this.waypointManager.addWaypointAtIndex(\n            coordinates, \n            nearestRig.name,\n            insertIndex,\n            { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n          );\n        } else {\n          // Add the clicked point\n          console.log(`MapInteractionHandler: Adding ${isWaypointMode ? 'waypoint' : 'stop'} at route click`);\n          this.waypointManager.addWaypointAtIndex(\n            [lngLat.lng, lngLat.lat],\n            isWaypointMode ? `Waypoint ${insertIndex}` : `Stop ${insertIndex}`,\n            insertIndex,\n            { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n          );\n        }\n      } catch (err) {\n        console.error('MapInteractionHandler: Error adding waypoint at route click:', err);\n        \n        // Fallback to simple addition\n        try {\n          this.waypointManager.addWaypointAtIndex(\n            [lngLat.lng, lngLat.lat],\n            isWaypointMode ? `Waypoint ${insertIndex}` : `Stop ${insertIndex}`,\n            insertIndex,\n            { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n          );\n        } catch (innerErr) {\n          console.error('MapInteractionHandler: Fallback also failed:', innerErr);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle clicks on the map background (not on platforms or route)\n   * @param {Object} lngLat - {lng, lat} click coordinates\n   */\n  handleMapBackgroundClick(lngLat) {\n    console.log(`MapInteractionHandler: 🌐 Map background click at [${lngLat.lng}, ${lngLat.lat}]`);\n    \n    // Safe check for nearest platform\n    let nearestRig = null;\n    try {\n      if (typeof this.platformManager.findNearestPlatform === 'function') {\n        nearestRig = this.platformManager.findNearestPlatform(lngLat.lat, lngLat.lng, 5);\n        if (nearestRig) {\n          console.log(`MapInteractionHandler: 🌐 Found nearest rig: ${nearestRig.name} at distance ${nearestRig.distance.toFixed(2)} nm`);\n        } else {\n          console.log(`MapInteractionHandler: 🌐 No rig found within 5 nautical miles`);\n        }\n      } else {\n        console.log('MapInteractionHandler: 🌐 findNearestPlatform not available');\n      }\n    } catch (err) {\n      console.log('MapInteractionHandler: 🌐 Error getting nearest platform:', err);\n      nearestRig = null;\n    }\n\n    // Get waypoint mode status\n    const isWaypointMode = window.isWaypointModeActive === true;\n    \n    // Either use callback or direct add\n    if (this.callbacks.onMapClick) {\n      // Include the nearest rig info in the callback data\n      const callbackData = { \n        lngLat: lngLat,\n        coordinates: [lngLat.lng, lngLat.lat], // Ensure we have coordinates in array format\n        mapClickSource: 'directClick', // CRITICAL FIX: Flag to identify this is a map click\n        isWaypointMode: isWaypointMode // Add mode flag to callback data\n      };\n      \n      // Safely add nearest rig if available\n      if (nearestRig) {\n        // Make sure coordinates are in the right format - check all possible formats\n        let rigCoordinates = [lngLat.lng, lngLat.lat]; // Default to clicked point\n        \n        try {\n          if (Array.isArray(nearestRig.coordinates)) {\n            rigCoordinates = nearestRig.coordinates;\n          } else if (Array.isArray(nearestRig.coords)) {\n            rigCoordinates = nearestRig.coords;\n          } else if (nearestRig.lng !== undefined && nearestRig.lat !== undefined) {\n            rigCoordinates = [nearestRig.lng, nearestRig.lat];\n          }\n        } catch (err) {\n          console.error('MapInteractionHandler: 🌐 Invalid rig coordinates format:', err);\n        }\n        \n        callbackData.nearestRig = {\n          ...nearestRig,\n          coordinates: rigCoordinates,\n          name: nearestRig.name || 'Unknown'\n        };\n      }\n      \n      console.log(`MapInteractionHandler: 🌐 Triggering onMapClick with data:`, callbackData);\n      this.triggerCallback('onMapClick', callbackData);\n    } else {\n      // Direct add - use nearest rig if available within distance\n      if (nearestRig && nearestRig.distance <= 5) {\n        try {\n          console.log(`MapInteractionHandler: 🌐 Snapping to rig ${nearestRig.name}`);\n          \n          // Safely get coordinates\n          let coordinates = [lngLat.lng, lngLat.lat]; // Default to clicked point\n          \n          if (Array.isArray(nearestRig.coordinates)) {\n            coordinates = nearestRig.coordinates;\n          } else if (Array.isArray(nearestRig.coords)) {\n            coordinates = nearestRig.coords;\n          } else if (nearestRig.lng !== undefined && nearestRig.lat !== undefined) {\n            coordinates = [nearestRig.lng, nearestRig.lat];\n          }\n          \n          this.waypointManager.addWaypoint(\n            coordinates, \n            nearestRig.name,\n            { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n          );\n        } catch (err) {\n          console.error('MapInteractionHandler: 🌐 Error adding nearest rig:', err);\n          // Fall back to clicked point\n          this.addClickedPoint(lngLat);\n        }\n      } else {\n        // No nearby rig, just add the clicked point\n        console.log(`MapInteractionHandler: 🌐 Adding ${isWaypointMode ? 'waypoint' : 'stop'} at clicked point`);\n        this.waypointManager.addWaypoint(\n          [lngLat.lng, lngLat.lat],\n          isWaypointMode ? `Waypoint ${this.waypointManager.getWaypoints().length + 1}` : `Stop ${this.waypointManager.getWaypoints().length + 1}`,\n          { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n        );\n      }\n      \n      // Force route update with a small delay\n      setTimeout(() => {\n        if (this.waypointManager && this.waypointManager.updateRoute) {\n          this.waypointManager.updateRoute();\n        }\n      }, 50);\n    }\n  }\n\n  /**\n   * Handle route drag completion\n   * @param {number} insertIndex - Index to insert the new waypoint\n   * @param {Array} coords - [lng, lat] coordinates\n   * @param {Object} dragData - Additional data about the drag (optional)\n   */\n  handleRouteDragComplete(insertIndex, coords, dragData = {}) {\n    console.log(`MapInteractionHandler: Route dragged at index ${insertIndex}`, coords);\n    \n    // Check if waypoint mode is active\n    // First check if it's in the dragData, then fall back to global flag\n    const isWaypointMode = dragData.isWaypointMode === true || window.isWaypointModeActive === true;\n    console.log(`MapInteractionHandler: Drag in ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'} mode`);\n    \n    // Check for nearest rig or waypoint, depending on mode\n    try {\n      // In waypoint mode, check for nearest navigation waypoint first\n      if (isWaypointMode) {\n        let nearestWaypoint = null;\n        \n        // Safely check for nearest waypoint\n        try {\n          if (typeof this.platformManager.findNearestWaypoint === 'function') {\n            nearestWaypoint = this.platformManager.findNearestWaypoint(coords[1], coords[0], 5);\n          } else {\n            console.log('findNearestWaypoint not available, skipping waypoint check for drag');\n          }\n        } catch (err) {\n          console.log('Error finding nearest waypoint for drag, continuing without it');\n        }\n        \n        if (nearestWaypoint && nearestWaypoint.distance < 5) { // Within 5 nautical miles\n          // Add the waypoint instead of the dragged point\n          console.log(`MapInteractionHandler: Using nearest waypoint for drag: ${nearestWaypoint.name} (${nearestWaypoint.distance.toFixed(1)} nm away)`);\n          this.waypointManager.addWaypointAtIndex(\n            nearestWaypoint.coordinates, \n            nearestWaypoint.name, \n            insertIndex,\n            { isWaypoint: true, type: 'WAYPOINT' }\n          );\n          return;\n        }\n        \n        // If no waypoint found, add a custom waypoint at the dragged location\n        console.log(`MapInteractionHandler: Adding custom waypoint at drag location`);\n        this.waypointManager.addWaypointAtIndex(\n          coords, \n          `Waypoint ${insertIndex}`, \n          insertIndex,\n          { isWaypoint: true, type: 'WAYPOINT' }\n        );\n        return;\n      }\n      \n      // Normal mode - check for nearest rig\n      let nearestRig = null;\n      \n      // Safely check for nearest platform\n      try {\n        if (typeof this.platformManager.findNearestPlatform === 'function') {\n          nearestRig = this.platformManager.findNearestPlatform(coords[1], coords[0], 5);\n        } else {\n          console.log('findNearestPlatform not available, skipping nearest rig check for drag');\n        }\n      } catch (err) {\n        console.log('Error finding nearest platform for drag, continuing without it');\n      }\n\n      if (nearestRig && nearestRig.distance < 5) { // Within 5 nautical miles\n        // Add the rig instead of the dragged point\n        console.log(`MapInteractionHandler: Using nearest rig for drag: ${nearestRig.name} (${nearestRig.distance.toFixed(1)} nm away)`);\n        this.waypointManager.addWaypointAtIndex(\n          nearestRig.coordinates, \n          nearestRig.name, \n          insertIndex,\n          { isWaypoint: false, type: 'STOP' }\n        );\n      } else {\n        // Add the dragged point as a regular stop\n        this.waypointManager.addWaypointAtIndex(\n          coords, \n          `Stop ${insertIndex}`, \n          insertIndex,\n          { isWaypoint: false, type: 'STOP' }\n        );\n      }\n    } catch (err) {\n      console.error('MapInteractionHandler: Error handling route drag:', err);\n      \n      // Fallback to just adding the dragged point with mode-appropriate type\n      this.waypointManager.addWaypointAtIndex(\n        coords, \n        isWaypointMode ? `Waypoint ${insertIndex}` : `Stop ${insertIndex}`, \n        insertIndex,\n        { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n      );\n    }\n  }\n  \n  /**\n   * Add a clicked point directly without any platform checking\n   * This is a simple fallback method for when other methods fail\n   * @param {Object} lngLat - {lng, lat} click coordinates\n   */\n  addClickedPoint(lngLat) {\n    console.log(`MapInteractionHandler: FALLBACK - Adding direct waypoint at [${lngLat.lng}, ${lngLat.lat}]`);\n    \n    // Get waypoint mode status\n    const isWaypointMode = window.isWaypointModeActive === true;\n    \n    // Either use callback or direct add\n    if (this.callbacks.onMapClick) {\n      const callbackData = { \n        lngLat: lngLat,\n        coordinates: [lngLat.lng, lngLat.lat],\n        mapClickSource: 'fallback'\n      };\n      \n      console.log(`MapInteractionHandler: Triggering onMapClick with fallback data`);\n      this.triggerCallback('onMapClick', callbackData);\n    } else {\n      // Direct add\n      if (this.waypointManager) {\n        this.waypointManager.addWaypoint(\n          [lngLat.lng, lngLat.lat], \n          isWaypointMode ? `Waypoint ${this.waypointManager.getWaypoints().length + 1}` : `Stop ${this.waypointManager.getWaypoints().length + 1}`,\n          { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n        );\n      }\n    }\n  }\n  \n  /**\n   * Helper method to get the WaypointHandler instance\n   * @returns {Object|null} - The WaypointHandler instance or null if not found\n   */\n  getWaypointHandler() {\n    // First try to get from FastPlannerApp instance if available\n    if (window.fastPlannerApp && window.fastPlannerApp.waypointHandlerRef && \n        window.fastPlannerApp.waypointHandlerRef.current) {\n      return window.fastPlannerApp.waypointHandlerRef.current;\n    }\n    \n    // Try to get from global scope\n    if (window.waypointHandler) {\n      return window.waypointHandler;\n    }\n    \n    return null;\n  }\n}\n\nexport default MapInteractionHandler;","/**\n * AppSettingsManager.js\n * \n * Manages application settings and preferences, including:\n * - Last selected region\n * - Last selected aircraft type/registration\n * - Flight settings (passenger weight, fuel settings, etc.)\n * - UI preferences\n * \n * Stores settings in localStorage for persistence across sessions.\n */\n\nclass AppSettingsManager {\n  constructor() {\n    // Default settings\n    this.defaultSettings = {\n      region: 'gulf-of-mexico',\n      aircraft: {\n        type: '',\n        registration: ''\n      },\n      flightSettings: {\n        passengerWeight: 220,\n        contingencyFuelPercent: 10,\n        taxiFuel: 50,\n        reserveFuel: 600,\n        deckTimePerStop: 5,\n        deckFuelFlow: 400\n      },\n      uiSettings: {\n        leftPanelVisible: true,\n        rightPanelVisible: true,\n        platformsVisible: true,\n        appVersion: '1.0'\n      }\n    };\n    \n    // Current settings - will be initialized with defaults then loaded from storage\n    this.settings = { ...this.defaultSettings };\n    \n    // Callbacks for when settings change\n    this.callbacks = {\n      onChange: null,\n      onRegionChange: null,\n      onAircraftChange: null,\n      onFlightSettingsChange: null,\n      onUISettingsChange: null\n    };\n    \n    // Load settings from localStorage\n    this.loadSettings();\n    \n    console.log('AppSettingsManager initialized with settings:', this.settings);\n  }\n  \n  /**\n   * Set a callback function\n   * @param {string} type - Callback type (e.g., 'onChange')\n   * @param {Function} callback - Callback function\n   */\n  setCallback(type, callback) {\n    if (this.callbacks.hasOwnProperty(type)) {\n      this.callbacks[type] = callback;\n    }\n  }\n  \n  /**\n   * Trigger a callback if it exists\n   * @param {string} type - The callback type\n   * @param {*} data - Data to pass to the callback\n   */\n  triggerCallback(type, data) {\n    if (this.callbacks[type]) {\n      this.callbacks[type](data);\n    }\n    \n    // Also trigger the general onChange callback for any setting change\n    if (type !== 'onChange' && this.callbacks.onChange) {\n      this.callbacks.onChange(this.settings);\n    }\n  }\n  \n  /**\n   * Load settings from localStorage\n   */\n  loadSettings() {\n    try {\n      const savedSettings = localStorage.getItem('fastPlannerSettings');\n      if (savedSettings) {\n        // Parse the saved settings\n        const parsed = JSON.parse(savedSettings);\n        \n        // Merge with defaults to ensure any new settings are included\n        this.settings = {\n          ...this.defaultSettings,\n          ...parsed,\n          // Merge nested objects properly\n          flightSettings: {\n            ...this.defaultSettings.flightSettings,\n            ...(parsed.flightSettings || {})\n          },\n          aircraft: {\n            ...this.defaultSettings.aircraft,\n            ...(parsed.aircraft || {})\n          },\n          uiSettings: {\n            ...this.defaultSettings.uiSettings,\n            ...(parsed.uiSettings || {})\n          }\n        };\n        \n        console.log('Loaded settings from localStorage:', this.settings);\n      } else {\n        console.log('No saved settings found, using defaults');\n      }\n    } catch (error) {\n      console.error('Error loading settings from localStorage:', error);\n      this.settings = { ...this.defaultSettings };\n    }\n  }\n  \n  /**\n   * Save settings to localStorage\n   */\n  saveSettings() {\n    try {\n      localStorage.setItem('fastPlannerSettings', JSON.stringify(this.settings));\n      console.log('Saved settings to localStorage');\n    } catch (error) {\n      console.error('Error saving settings to localStorage:', error);\n    }\n  }\n  \n  /**\n   * Get all settings\n   * @returns {Object} - The current settings\n   */\n  getAllSettings() {\n    return { ...this.settings };\n  }\n  \n  /**\n   * Set the last selected region\n   * @param {string} regionId - The region ID\n   */\n  setRegion(regionId) {\n    this.settings.region = regionId;\n    this.saveSettings();\n    this.triggerCallback('onRegionChange', regionId);\n  }\n  \n  /**\n   * Get the last selected region\n   * @returns {string} - The region ID\n   */\n  getRegion() {\n    return this.settings.region;\n  }\n  \n  /**\n   * Set aircraft selection\n   * @param {string} type - Aircraft type\n   * @param {string} registration - Aircraft registration\n   */\n  setAircraft(type, registration) {\n    this.settings.aircraft = {\n      type: type || '',\n      registration: registration || ''\n    };\n    this.saveSettings();\n    this.triggerCallback('onAircraftChange', this.settings.aircraft);\n  }\n  \n  /**\n   * Get aircraft selection\n   * @returns {Object} - The aircraft selection {type, registration}\n   */\n  getAircraft() {\n    return { ...this.settings.aircraft };\n  }\n  \n  /**\n   * Update flight settings\n   * @param {Object} flightSettings - New flight settings\n   */\n  updateFlightSettings(flightSettings) {\n    // Parse any string values to integers to ensure we don't have string-to-number issues\n    const parsedSettings = {};\n    Object.keys(flightSettings).forEach(key => {\n      const value = flightSettings[key];\n      if (typeof value === 'string' && !isNaN(parseInt(value, 10))) {\n        parsedSettings[key] = parseInt(value, 10);\n      } else {\n        parsedSettings[key] = value;\n      }\n    });\n    \n    // Log what we're updating with\n    console.log('AppSettingsManager: Updating flight settings with parsed values:', parsedSettings);\n    \n    this.settings.flightSettings = {\n      ...this.settings.flightSettings,\n      ...parsedSettings\n    };\n    this.saveSettings();\n    this.triggerCallback('onFlightSettingsChange', this.settings.flightSettings);\n  }\n  \n  /**\n   * Get flight settings\n   * @returns {Object} - The flight settings\n   */\n  getFlightSettings() {\n    return { ...this.settings.flightSettings };\n  }\n  \n  /**\n   * Update UI settings\n   * @param {Object} uiSettings - New UI settings\n   */\n  updateUISettings(uiSettings) {\n    this.settings.uiSettings = {\n      ...this.settings.uiSettings,\n      ...uiSettings\n    };\n    this.saveSettings();\n    this.triggerCallback('onUISettingsChange', this.settings.uiSettings);\n  }\n  \n  /**\n   * Get UI settings\n   * @returns {Object} - The UI settings\n   */\n  getUISettings() {\n    return { ...this.settings.uiSettings };\n  }\n  \n  /**\n   * Reset settings to defaults\n   */\n  resetToDefaults() {\n    this.settings = { ...this.defaultSettings };\n    this.saveSettings();\n    this.triggerCallback('onChange', this.settings);\n  }\n}\n\nexport default AppSettingsManager;","/**\n * fix-waypoint-functionality.js\n * \n * A focused fix for the critical waypoint functionality issues in the Fast Planner:\n * 1. Ensures waypoints are added as waypoints (not stops)\n * 2. Fixes drag operation to correctly add waypoints when in waypoint mode\n * 3. Ensures proper flags are set for OSDK integration\n */\n\n(function() {\n  console.log('🔧 Applying waypoint functionality fix - NO STYLE CHANGES');\n  \n  // Fix 1: Ensure global waypoint mode flag is correctly initialized\n  window.isWaypointModeActive = window.isWaypointModeActive || false;\n  \n  // Fix 2: Fix WaypointManager.addWaypoint to properly respect waypoint vs stop mode\n  fixWaypointManagerAddMethod();\n  \n  // Fix 3: Fix route drag functionality to respect waypoint mode\n  fixRouteDragFunctionality();\n  \n  console.log('✅ Waypoint functionality fix applied. No style changes made.');\n})();\n\n/**\n * Fix the WaypointManager.addWaypoint method to properly handle waypoints vs stops\n */\nfunction fixWaypointManagerAddMethod() {\n  // Wait for WaypointManager to be available\n  const waitForWaypointManager = setInterval(() => {\n    if (!window.waypointManager) return;\n    \n    clearInterval(waitForWaypointManager);\n    console.log('🔧 Found WaypointManager, applying fix to addWaypoint method');\n    \n    // Save original methods\n    const originalAddWaypoint = window.waypointManager.addWaypoint;\n    const originalAddWaypointAtIndex = window.waypointManager.addWaypointAtIndex;\n    \n    // Replace addWaypoint with fixed version\n    window.waypointManager.addWaypoint = function(coords, name, options = {}) {\n      // CRITICAL FIX: Always check global waypoint mode flag\n      const globalWaypointMode = window.isWaypointModeActive === true;\n      \n      // If in waypoint mode or options explicitly set isWaypoint/type\n      const isExplicitWaypoint = options && (options.isWaypoint === true || options.type === 'WAYPOINT');\n      const isWaypoint = globalWaypointMode || isExplicitWaypoint;\n      \n      // Ensure waypoint properties are correctly set\n      const enhancedOptions = {\n        ...options,\n        isWaypoint: isWaypoint,\n        type: isWaypoint ? 'WAYPOINT' : 'STOP'\n      };\n      \n      console.log(`🔧 Adding ${isWaypoint ? 'WAYPOINT' : 'STOP'} at coordinates: ${coords}`);\n      \n      // Call original method with enhanced options\n      return originalAddWaypoint.call(this, coords, name, enhancedOptions);\n    };\n    \n    // Replace addWaypointAtIndex with fixed version\n    window.waypointManager.addWaypointAtIndex = function(coords, name, index, options = {}) {\n      // CRITICAL FIX: Always check global waypoint mode flag\n      const globalWaypointMode = window.isWaypointModeActive === true;\n      \n      // If in waypoint mode or options explicitly set isWaypoint/type\n      const isExplicitWaypoint = options && (options.isWaypoint === true || options.type === 'WAYPOINT');\n      const isWaypoint = globalWaypointMode || isExplicitWaypoint;\n      \n      // Ensure waypoint properties are correctly set\n      const enhancedOptions = {\n        ...options,\n        isWaypoint: isWaypoint,\n        type: isWaypoint ? 'WAYPOINT' : 'STOP'\n      };\n      \n      console.log(`🔧 Adding ${isWaypoint ? 'WAYPOINT' : 'STOP'} at index ${index}`);\n      \n      // Call original method with enhanced options\n      return originalAddWaypointAtIndex.call(this, coords, name, index, enhancedOptions);\n    };\n    \n    console.log('✅ WaypointManager methods fixed');\n  }, 100);\n}\n\n/**\n * Fix the route drag functionality to respect waypoint mode\n */\nfunction fixRouteDragFunctionality() {\n  // Wait for MapInteractionHandler to be available\n  const waitForMapInteractionHandler = setInterval(() => {\n    if (!window.mapInteractionHandler) return;\n    \n    clearInterval(waitForMapInteractionHandler);\n    console.log('🔧 Found MapInteractionHandler, applying fix to route drag handling');\n    \n    // Save original method\n    const originalHandleRouteDragComplete = window.mapInteractionHandler.handleRouteDragComplete;\n    \n    // Replace handleRouteDragComplete with fixed version\n    window.mapInteractionHandler.handleRouteDragComplete = function(insertIndex, coords, dragData = {}) {\n      // CRITICAL FIX: Check global waypoint mode flag\n      const globalWaypointMode = window.isWaypointModeActive === true;\n      \n      // Add waypoint mode info to dragData if not already present\n      const enhancedDragData = {\n        ...dragData,\n        isWaypointMode: globalWaypointMode\n      };\n      \n      console.log(`🔧 Route drag in ${globalWaypointMode ? 'WAYPOINT' : 'NORMAL'} mode at index ${insertIndex}`);\n      \n      // Call original method with enhanced dragData\n      return originalHandleRouteDragComplete.call(this, insertIndex, coords, enhancedDragData);\n    };\n    \n    console.log('✅ Route drag handling fixed');\n  }, 100);\n}\n\n/**\n * Helper to log the type of all waypoints in the route\n * Use this for debugging\n */\nwindow.debugRouteWaypoints = function() {\n  if (!window.waypointManager) {\n    console.log('⚠️ WaypointManager not available');\n    return;\n  }\n  \n  const waypoints = window.waypointManager.getWaypoints();\n  console.table(waypoints.map((wp, index) => ({\n    index,\n    name: wp.name,\n    isWaypoint: wp.isWaypoint === true,\n    type: wp.type || 'UNKNOWN'\n  })));\n  \n  console.log('Current waypoint mode:', window.isWaypointModeActive === true ? 'WAYPOINT' : 'NORMAL');\n};\n","/**\n * fix-route-drag.js\n * \n * Focused fix ONLY for the route dragging issue where dragging the \n * route line always adds stops regardless of waypoint mode.\n */\n\n(function() {\n  console.log('🔧 Applying targeted fix for route drag in waypoint mode');\n  \n  // Wait for MapInteractionHandler to be available\n  const checkInterval = setInterval(() => {\n    if (!window.mapInteractionHandler) return;\n    \n    clearInterval(checkInterval);\n    console.log('Found MapInteractionHandler, applying route drag fix');\n    \n    // Check if handleRouteDragComplete exists\n    if (typeof window.mapInteractionHandler.handleRouteDragComplete !== 'function') {\n      console.error('handleRouteDragComplete method not found on MapInteractionHandler');\n      return;\n    }\n    \n    // Save original method\n    const originalMethod = window.mapInteractionHandler.handleRouteDragComplete;\n    \n    // Override the method\n    window.mapInteractionHandler.handleRouteDragComplete = function(insertIndex, coords, dragData = {}) {\n      console.log('🔍 Route drag detected at index', insertIndex);\n      \n      // CRITICAL FIX: Get current waypoint mode and add to dragData\n      const isWaypointMode = window.isWaypointModeActive === true;\n      \n      // Log for debugging\n      console.log(`🔍 Current waypoint mode: ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'}`);\n      \n      // Create enhanced drag data with explicit waypoint flag\n      const enhancedDragData = {\n        ...dragData,\n        isWaypointMode: isWaypointMode\n      };\n      \n      // If in waypoint mode, make sure waypoint is added properly\n      if (isWaypointMode && window.waypointManager) {\n        console.log('🔧 Adding waypoint directly in waypoint mode');\n        \n        // Try to find nearest navigation waypoint if available\n        let nearestWaypoint = null;\n        try {\n          if (window.platformManager && typeof window.platformManager.findNearestWaypoint === 'function') {\n            nearestWaypoint = window.platformManager.findNearestWaypoint(coords[1], coords[0], 5);\n          }\n        } catch (error) {\n          console.error('Error finding nearest waypoint:', error);\n        }\n        \n        // Use nearest waypoint or custom waypoint\n        if (nearestWaypoint && nearestWaypoint.distance < 5) {\n          console.log('Found nearest waypoint:', nearestWaypoint.name);\n          \n          window.waypointManager.addWaypointAtIndex(\n            nearestWaypoint.coordinates,\n            nearestWaypoint.name,\n            insertIndex,\n            { isWaypoint: true, type: 'WAYPOINT' }\n          );\n          \n          // Return immediately to prevent original method from adding a stop\n          return;\n        } else {\n          // No nearby waypoint, add a custom waypoint\n          window.waypointManager.addWaypointAtIndex(\n            coords,\n            `Waypoint ${insertIndex}`,\n            insertIndex,\n            { isWaypoint: true, type: 'WAYPOINT' }\n          );\n          \n          // Return immediately to prevent original method from adding a stop\n          return;\n        }\n      }\n      \n      // If not in waypoint mode, call original method with enhanced data\n      return originalMethod.call(this, insertIndex, coords, enhancedDragData);\n    };\n    \n    console.log('✅ Route drag fix applied. Dragging the route line will now correctly add waypoints when in waypoint mode.');\n  }, 100);\n})();\n\n// Add a test function to verify the fix\nwindow.testRouteDragFix = function() {\n  console.log('Testing route drag fix...');\n  \n  // Check if we have the necessary objects\n  if (!window.mapInteractionHandler || !window.waypointManager) {\n    console.error('Required objects not found. Make sure the app is fully loaded.');\n    return false;\n  }\n  \n  // Get current waypoint mode\n  const isWaypointMode = window.isWaypointModeActive === true;\n  console.log(`Current waypoint mode: ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'}`);\n  \n  // Toggle to waypoint mode if needed\n  if (!isWaypointMode) {\n    console.log('Switching to waypoint mode for test');\n    window.isWaypointModeActive = true;\n    if (window.waypointHandler && typeof window.waypointHandler.setEnabled === 'function') {\n      window.waypointHandler.setEnabled(true);\n    }\n  }\n  \n  // Get a waypoint count before the test\n  const waypointsBefore = window.waypointManager.getWaypoints().filter(wp => wp.isWaypoint === true).length;\n  console.log(`Waypoints before test: ${waypointsBefore}`);\n  \n  // Simulate a route drag operation\n  console.log('Simulating route drag...');\n  \n  // Get map center as test coordinates\n  let testCoords = [0, 0];\n  if (window.mapManager && window.mapManager.getMap()) {\n    const center = window.mapManager.getMap().getCenter();\n    testCoords = [center.lng, center.lat];\n  }\n  \n  // Call handleRouteDragComplete directly\n  const insertIndex = window.waypointManager.getWaypoints().length > 0 ? 1 : 0;\n  window.mapInteractionHandler.handleRouteDragComplete(insertIndex, testCoords, { isTest: true });\n  \n  // Check if a waypoint was added\n  setTimeout(() => {\n    const waypointsAfter = window.waypointManager.getWaypoints().filter(wp => wp.isWaypoint === true).length;\n    console.log(`Waypoints after test: ${waypointsAfter}`);\n    \n    if (waypointsAfter > waypointsBefore) {\n      console.log('✅ TEST PASSED! A waypoint was added correctly.');\n      \n      // List all waypoints\n      const allWaypoints = window.waypointManager.getWaypoints();\n      console.table(allWaypoints.map((wp, idx) => ({\n        index: idx,\n        name: wp.name,\n        isWaypoint: wp.isWaypoint === true ? 'YES' : 'NO',\n        type: wp.type || 'UNKNOWN'\n      })));\n      \n      return true;\n    } else {\n      console.error('❌ TEST FAILED! No waypoint was added.');\n      return false;\n    }\n  }, 100);\n};\n","/**\n * WaypointDebugger.js\n * \n * A utility module to help debug waypoint functionality in the Fast Planner.\n * Provides functions to verify and debug waypoint issues without any style changes.\n */\n\nclass WaypointDebugger {\n  constructor() {\n    console.log('WaypointDebugger: Initialized');\n    this.setupGlobalHelpers();\n  }\n\n  /**\n   * Make debugging functions available globally\n   */\n  setupGlobalHelpers() {\n    // Make the debug methods available on the window\n    window.waypointDebugger = this;\n\n    // Add helper functions to the window object\n    window.logWaypoints = () => this.logWaypoints();\n    window.verifyWaypointMode = () => this.verifyWaypointMode();\n    window.toggleWaypointMode = () => this.toggleWaypointMode();\n    window.fixWaypointFlags = () => this.fixWaypointFlags();\n  }\n\n  /**\n   * Log all waypoints to the console\n   */\n  logWaypoints() {\n    if (!window.waypointManager) {\n      console.error('waypointManager not found');\n      return;\n    }\n\n    const waypoints = window.waypointManager.getWaypoints();\n    \n    console.log(`Current route has ${waypoints.length} points:`);\n    console.table(waypoints.map((wp, idx) => ({\n      index: idx,\n      name: wp.name,\n      isWaypoint: wp.isWaypoint === true ? 'YES' : 'NO',\n      type: wp.type || 'UNKNOWN',\n      coordinates: `[${wp.coords[0].toFixed(4)}, ${wp.coords[1].toFixed(4)}]`\n    })));\n    \n    return waypoints;\n  }\n\n  /**\n   * Verify the current waypoint mode state\n   */\n  verifyWaypointMode() {\n    console.log('Waypoint mode active:', window.isWaypointModeActive === true ? 'YES' : 'NO');\n    \n    // Check if WaypointHandler exists and is properly enabled\n    const waypointHandler = window.waypointHandler;\n    if (waypointHandler) {\n      console.log('WaypointHandler.isEnabled():', waypointHandler.isEnabled() ? 'YES' : 'NO');\n      \n      // Check if the states are consistent\n      if (waypointHandler.isEnabled() !== (window.isWaypointModeActive === true)) {\n        console.warn('WARNING: WaypointHandler state does not match global flag!');\n        console.log('Would you like to fix this? Call window.fixWaypointFlags()');\n      } else {\n        console.log('✅ Waypoint mode flags are consistent');\n      }\n    } else {\n      console.warn('WaypointHandler not found');\n    }\n    \n    // Check if body has the waypoint-mode-active class\n    const hasBodyClass = document.body.classList.contains('waypoint-mode-active');\n    console.log('Body has waypoint-mode-active class:', hasBodyClass ? 'YES' : 'NO');\n    \n    // Check if map cursor style is set for waypoint mode\n    const map = window.mapManager?.getMap();\n    if (map) {\n      const cursor = map.getCanvas().style.cursor;\n      console.log('Map cursor style:', cursor || 'default');\n    }\n    \n    return {\n      globalFlag: window.isWaypointModeActive === true,\n      handlerEnabled: waypointHandler ? waypointHandler.isEnabled() : null,\n      bodyClass: hasBodyClass\n    };\n  }\n\n  /**\n   * Toggle waypoint mode programmatically\n   */\n  toggleWaypointMode() {\n    const currentState = window.isWaypointModeActive === true;\n    const newState = !currentState;\n    \n    console.log(`Toggling waypoint mode from ${currentState ? 'ON' : 'OFF'} to ${newState ? 'ON' : 'OFF'}`);\n    \n    // Set the global flag\n    window.isWaypointModeActive = newState;\n    \n    // Update the WaypointHandler if available\n    if (window.waypointHandler && typeof window.waypointHandler.setEnabled === 'function') {\n      window.waypointHandler.setEnabled(newState);\n    }\n    \n    // Update the body class\n    if (newState) {\n      document.body.classList.add('waypoint-mode-active');\n    } else {\n      document.body.classList.remove('waypoint-mode-active');\n    }\n    \n    // Update map cursor if available\n    const map = window.mapManager?.getMap();\n    if (map) {\n      map.getCanvas().style.cursor = newState ? 'crosshair' : '';\n    }\n    \n    console.log(`Waypoint mode is now ${newState ? 'ON' : 'OFF'}`);\n    \n    return newState;\n  }\n\n  /**\n   * Fix inconsistent waypoint flags\n   */\n  fixWaypointFlags() {\n    const globalFlag = window.isWaypointModeActive === true;\n    \n    console.log(`Fixing waypoint flags, using global flag: ${globalFlag ? 'ON' : 'OFF'}`);\n    \n    // Update WaypointHandler\n    if (window.waypointHandler && typeof window.waypointHandler.setEnabled === 'function') {\n      window.waypointHandler.setEnabled(globalFlag);\n    }\n    \n    // Update body class\n    if (globalFlag) {\n      document.body.classList.add('waypoint-mode-active');\n    } else {\n      document.body.classList.remove('waypoint-mode-active');\n    }\n    \n    // Update map cursor\n    const map = window.mapManager?.getMap();\n    if (map) {\n      map.getCanvas().style.cursor = globalFlag ? 'crosshair' : '';\n    }\n    \n    console.log('Waypoint flags fixed');\n    \n    // Verify the fix\n    return this.verifyWaypointMode();\n  }\n  \n  /**\n   * Test adding a waypoint programmatically\n   */\n  testAddWaypoint(coords) {\n    if (!window.waypointManager) {\n      console.error('waypointManager not found');\n      return;\n    }\n    \n    // Use coordinates from the center of the map if none provided\n    if (!coords) {\n      const map = window.mapManager?.getMap();\n      if (map) {\n        const center = map.getCenter();\n        coords = [center.lng, center.lat];\n      } else {\n        console.error('No coordinates provided and map not available');\n        return;\n      }\n    }\n    \n    // Get current waypoint mode\n    const isWaypointMode = window.isWaypointModeActive === true;\n    console.log(`Testing waypoint addition in ${isWaypointMode ? 'WAYPOINT' : 'NORMAL'} mode`);\n    \n    // Add the waypoint\n    const waypoint = window.waypointManager.addWaypoint(\n      coords, \n      isWaypointMode ? `Test Waypoint` : `Test Stop`,\n      { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n    );\n    \n    console.log('Added test point:', waypoint);\n    \n    // Log the current waypoints\n    this.logWaypoints();\n    \n    return waypoint;\n  }\n}\n\n// Initialize the debugger\nconst waypointDebugger = new WaypointDebugger();\n\n// Instructions for use\nconsole.log('WaypointDebugger initialized. Available commands:');\nconsole.log('- window.logWaypoints() - List all waypoints');\nconsole.log('- window.verifyWaypointMode() - Check waypoint mode state');\nconsole.log('- window.toggleWaypointMode() - Toggle waypoint mode');\nconsole.log('- window.fixWaypointFlags() - Fix inconsistent waypoint flags');\nconsole.log('- window.waypointDebugger.testAddWaypoint() - Test adding a waypoint');\n\nexport default waypointDebugger;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useAuth } from '../../context/AuthContext';\nimport client from '../../client';\nimport './FastPlannerStyles.css';\nimport './modules/waypoints/waypoint-styles.css'; // Import waypoint mode styles\n\n// Import WaypointHandler for dedicated waypoint mode support\nimport WaypointHandler from './modules/WaypointHandler';\n\n// Import ModeHandler for completely separate normal/waypoint handlers \n// (Now used as backup, EmergencyMapFixComponent is primary)\nimport ModeHandler from './modules/waypoints/ModeHandler';\n\n// Initialize loading indicator effect\nconst initializeLoadingIndicator = () => {\n  if (window.LoadingIndicator && window.LoadingIndicator.initializeRouteStatsLoader) {\n    setTimeout(() => {\n      window.LoadingIndicator.initializeRouteStatsLoader();\n    }, 1000); // Delay to ensure the DOM is ready\n  }\n};\n\n// Import UI components\nimport {\n  LeftPanel,\n  RightPanel,\n  MapComponent,\n  RouteStatsCard\n} from './components';\n\n// Import enhanced fuel calculator modules\n// import enhancedFuelCalculator from './modules/calculations/fuel'; // Remove this import\nimport FuelIntegration from './modules/calculations/fuel/FuelIntegration'; // Keep FuelIntegration for now, might be used elsewhere or for initialization\nimport { EnhancedFuelDisplay } from './components/fuel';\n// Import StopCardCalculator for stop card calculations\nimport StopCardCalculator from './modules/calculations/flight/StopCardCalculator';\n// Import WindCalculations for global access\nimport * as WindCalc from './modules/calculations/WindCalculations';\n// Import ComprehensiveFuelCalculator for centralized fuel calculations\nimport ComprehensiveFuelCalculator from './modules/calculations/fuel/ComprehensiveFuelCalculator';\n\n// Import all manager modules\nimport {\n  MapManager,\n  WaypointManager,\n  PlatformManager,\n  RouteCalculator,\n  RegionManager,\n  FavoriteLocationsManager,\n  AircraftManager,\n  MapInteractionHandler,\n  AppSettingsManager\n} from './modules';\nimport FlightCalculations from './modules/calculations/FlightCalculations';\n// Import waypoint functionality fixes (NO STYLE CHANGES)\nimport './fixes/fix-waypoint-functionality.js';\nimport './fixes/fix-route-drag.js';\nimport './fixes/WaypointDebugger.js';\n // Keep FlightCalculations for now, might be used elsewhere\n\n/**\n * FastPlannerApp Component\n *\n * A simplified version that directly replicates ModularFastPlannerComponent\n * functionality without context providers for now.\n */\nconst FastPlannerApp = () => {\n  const { isAuthenticated, userDetails, userName, login } = useAuth();\n\n  // Core modules refs\n  const mapManagerRef = useRef(null);\n  const waypointManagerRef = useRef(null);\n  const platformManagerRef = useRef(null);\n  const routeCalculatorRef = useRef(null);\n  const regionManagerRef = useRef(null);\n  const favoriteLocationsManagerRef = useRef(null);\n  const aircraftManagerRef = useRef(null);\n  const flightCalculationsRef = useRef(null);\n  const mapInteractionHandlerRef = useRef(null);\n  const appSettingsManagerRef = useRef(null);\n  const waypointHandlerRef = useRef(null); // New ref for dedicated waypoint handler\n\n  // Initialize loading indicator on first render\n  useEffect(() => {\n    initializeLoadingIndicator();\n    \n    // Initialize global waypoint coordination flags\n    window._clickHandledByWaypointHandler = false;\n    \n    // Make WindCalculations available globally for other components and calculations\n    window.WindCalculations = WindCalc;\n    console.log('🌬️ Initialized WindCalculations globally:', window.WindCalculations);\n    \n    // Make managers globally available\n    window.mapManager = mapManagerRef.current;\n    window.waypointManager = waypointManagerRef.current;\n    window.mapInteractionHandler = mapInteractionHandlerRef.current;\n    \n    // Initialize WaypointHandler after delay to ensure other components are loaded\n    setTimeout(() => {\n      if (mapManagerRef.current && waypointManagerRef.current && !waypointHandlerRef.current) {\n        console.log('🟡 Creating WaypointHandler');\n        waypointHandlerRef.current = new WaypointHandler(mapManagerRef.current, waypointManagerRef.current);\n        \n        // Make it globally available\n        window.waypointHandler = waypointHandlerRef.current;\n      }\n    }, 2000);\n  }, []);\n\n  // UI state\n  const [forceUpdate, setForceUpdate] = useState(0);\n  const [routeInput, setRouteInput] = useState('');\n  const [airportData, setAirportData] = useState([]);\n  const [favoriteLocations, setFavoriteLocations] = useState([]);\n  const [leftPanelVisible, setLeftPanelVisible] = useState(false);\n  const [rightPanelVisible, setRightPanelVisible] = useState(true);\n  const [platformsVisible, setPlatformsVisible] = useState(true);\n  const [platformsLoaded, setPlatformsLoaded] = useState(false);\n  const [rigsLoading, setRigsLoading] = useState(false);\n  const [rigsError, setRigsError] = useState(null);\n  const [waypoints, setWaypoints] = useState([]);\n  const [stopCards, setStopCards] = useState([]);\n  const [routeStats, setRouteStats] = useState(null); // Keep routeStats state\n  const [waypointModeActive, setWaypointModeActive] = useState(false); // New state for waypoint insertion mode\n\n  // Region state\n  const [regions, setRegions] = useState([]);\n  const [currentRegion, setCurrentRegion] = useState(null);\n  const [regionLoading, setRegionLoading] = useState(false);\n\n  // Aircraft and route state\n  const [aircraftType, setAircraftType] = useState('');\n  const [aircraftRegistration, setAircraftRegistration] = useState('');\n  const [selectedAircraft, setSelectedAircraft] = useState(null);\n  const [aircraftList, setAircraftList] = useState([]);\n  const [aircraftTypes, setAircraftTypes] = useState([]);\n  const [aircraftsByType, setAircraftsByType] = useState({});\n  const [aircraftLoading, setAircraftLoading] = useState(false);\n  const [weather, setWeather] = useState({ windSpeed: 15, windDirection: 270 });\n\n  // Flight calculation settings - Consolidated with zero defaults\n  const [flightSettings, setFlightSettings] = useState({\n    passengerWeight: 220, // Initial value but will be overridden by settings\n    contingencyFuelPercent: 5, // Initial value set to 5%\n    taxiFuel: 50, // Initial value\n    reserveFuel: 600, // Initial value\n    deckTimePerStop: 5, // Initial value\n    deckFuelFlow: 400, // Initial value\n    cargoWeight: 0, // Initial value\n  });\n  \n  // Log the flight settings whenever they change for debugging\n  useEffect(() => {\n    console.log('🛫 Flight settings updated:', flightSettings);\n  }, [flightSettings]);\n\n  // Remove individual flight setting states\n  // const [deckTimePerStop, setDeckTimePerStop] = useState(5);\n  // const [deckFuelPerStop, setDeckFuelPerStop] = useState(100);\n  // const [deckFuelFlow, setDeckFuelFlow] = useState(400);\n  // const [passengerWeight, setPassengerWeight] = useState(220);\n  // const [cargoWeight, setCargoWeight] = useState(0);\n  // const [taxiFuel, setTaxiFuel] = useState(50);\n  // const [contingencyFuelPercent, setContingencyFuelPercent] = useState(10);\n  const [reserveMethod, setReserveMethod] = useState('fixed'); // Keep reserveMethod if used for UI only\n\n  // Helper function to update flight settings\n  const updateFlightSetting = (settingName, value) => {\n    console.log(`⚙️ updateFlightSetting called with: ${settingName} = ${value} (${typeof value})`);\n    \n    // Ensure value is a number\n    const numericValue = Number(value);\n    if (isNaN(numericValue)) {\n      console.warn(`⚙️ Warning: Attempted to set ${settingName} to non-numeric value: ${value}`);\n      return; // Don't update with invalid values\n    }\n    \n    // Update the flightSettings object\n    const updatedSettings = {\n      ...flightSettings,\n      [settingName]: numericValue\n    };\n    \n    console.log(`⚙️ Updating flightSettings:`, updatedSettings);\n    \n    // Update the state\n    setFlightSettings(updatedSettings);\n\n    // Save to AppSettingsManager\n    if (appSettingsManagerRef.current) {\n      console.log(`⚙️ Saving ${settingName} = ${numericValue} to AppSettingsManager`);\n      appSettingsManagerRef.current.updateFlightSettings({\n        [settingName]: numericValue\n      });\n    }\n\n    // Force a UI update immediately to ensure consistency\n    const event = new Event('settings-changed');\n    window.dispatchEvent(event);\n    \n    console.log(`⚙️ updateFlightSetting completed for ${settingName}`);\n    // The centralized useEffect will handle recalculation\n  };\n\n  // Remove this useEffect - initialization should happen within the calculator modules\n  // useEffect(() => {\n  //   if (flightSettings) {\n  //     console.log(\"FastPlannerApp: Initializing enhanced fuel calculator...\");\n  //     FuelIntegration.initializeFuelCalculator({\n  //       passengerWeight,\n  //       taxiFuel,\n  //       contingencyFuelPercent,\n  //       reserveFuel,\n  //       deckTimePerStop,\n  //       deckFuelFlow,\n  //       cargoWeight: cargoWeight || 0\n  //     });\n  //   }\n  // }, [passengerWeight, taxiFuel, contingencyFuelPercent, reserveFuel, deckTimePerStop, deckFuelFlow, cargoWeight, flightSettings]);\n\n  // Centralized useEffect for comprehensive fuel calculations\n  // This effect runs whenever waypoints, selected aircraft, flight settings, or weather change\n  useEffect(() => {\n    console.log('⛽ FastPlannerApp: Triggering comprehensive fuel calculation...');\n\n    // Ensure required inputs are available before calculating\n    if (!waypoints || waypoints.length < 2 || !selectedAircraft || !flightSettings) {\n        console.log('⛽ FastPlannerApp: Skipping fuel calculation due to missing inputs.');\n        setRouteStats(null);\n        setStopCards([]);\n        return;\n    }\n\n    // Create a settings object with numeric values\n    const numericSettings = {\n      passengerWeight: Number(flightSettings.passengerWeight),\n      taxiFuel: Number(flightSettings.taxiFuel),\n      contingencyFuelPercent: Number(flightSettings.contingencyFuelPercent),\n      reserveFuel: Number(flightSettings.reserveFuel),\n      deckTimePerStop: Number(flightSettings.deckTimePerStop),\n      deckFuelFlow: Number(flightSettings.deckFuelFlow),\n      cargoWeight: Number(flightSettings.cargoWeight || 0)\n    };\n\n    console.log('⛽ FastPlannerApp: Using numeric settings for fuel calculation:', numericSettings);\n\n    // Call the comprehensive calculator with numeric settings\n    const { enhancedResults, stopCards } = ComprehensiveFuelCalculator.calculateAllFuelData(\n      waypoints,\n      selectedAircraft,\n      numericSettings,\n      weather,\n      routeStats // Pass current routeStats as it might be needed by StopCardCalculator\n    );\n\n    // Ensure time values in enhancedResults are valid before updating state\n    if (enhancedResults && selectedAircraft && enhancedResults.totalDistance && \n        (!enhancedResults.timeHours || enhancedResults.timeHours === 0 || \n         !enhancedResults.estimatedTime || enhancedResults.estimatedTime === '00:00')) {\n      console.warn('⚠️ enhancedResults missing time values - calculating before setting state...');\n      \n      // Calculate time based on distance and cruise speed\n      const totalDistance = parseFloat(enhancedResults.totalDistance);\n      const timeHours = totalDistance / selectedAircraft.cruiseSpeed;\n      \n      // Format time string\n      const hours = Math.floor(timeHours);\n      const minutes = Math.floor((timeHours - hours) * 60);\n      const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n      \n      // Update enhancedResults with calculated time values\n      enhancedResults.timeHours = timeHours;\n      enhancedResults.estimatedTime = estimatedTime;\n      \n      console.log('⚠️ Added calculated time values to enhancedResults:', {\n        timeHours,\n        estimatedTime\n      });\n    }\n    \n    // IMPORTANT: Always update window.currentRouteStats first for global access\n    window.currentRouteStats = enhancedResults;\n    \n    // Update the state with the new results\n    setRouteStats(enhancedResults); // enhancedResults should be in the format expected by routeStats\n    setStopCards(stopCards);\n\n    console.log('⛽ FastPlannerApp: Fuel calculation complete. State updated.');\n\n    // CRITICAL FIX: Force route display update when fuel/route stats change\n    // This ensures the route line labels are updated with new time/fuel values\n    // This logic was previously in the RouteCalculator callback, moving it here\n    // to react to the centralized fuel calculation update.\n    if (waypointManagerRef.current && enhancedResults) {\n      console.log('⛽ Forcing route display update with new stats');\n      console.log('⛽ Route stats for waypoint display:', {\n        timeHours: enhancedResults.timeHours,\n        estimatedTime: enhancedResults.estimatedTime,\n        totalDistance: enhancedResults.totalDistance,\n        legCount: enhancedResults.legs?.length || 0,\n        windAdjusted: enhancedResults.windAdjusted || false\n      });\n      \n      // DEBUG - Check time values exist in enhancedResults\n      if (!enhancedResults.timeHours || enhancedResults.timeHours === 0 || !enhancedResults.estimatedTime || enhancedResults.estimatedTime === '00:00') {\n        console.error('⚠️ CRITICAL: Missing time values in enhancedResults! This will cause display issues.');\n        \n        // If we have distance and aircraft, calculate time directly\n        if (enhancedResults.totalDistance && parseFloat(enhancedResults.totalDistance) > 0 && selectedAircraft && selectedAircraft.cruiseSpeed) {\n          console.log('⚠️ Calculating missing time values for display...');\n          const totalDistance = parseFloat(enhancedResults.totalDistance);\n          const timeHours = totalDistance / selectedAircraft.cruiseSpeed;\n          const hours = Math.floor(timeHours);\n          const minutes = Math.floor((timeHours - hours) * 60);\n          const estimatedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\n          \n          // Update the enhancedResults with the calculated time values\n          enhancedResults.timeHours = timeHours;\n          enhancedResults.estimatedTime = estimatedTime;\n          \n          console.log('⚠️ Fixed enhancedResults with calculated times:', {\n            timeHours,\n            estimatedTime\n          });\n        }\n      }\n      \n      // Directly pass the enhancedResults to updateRoute without clearing first\n      // This ensures the stats are used for the leg labels\n      waypointManagerRef.current.updateRoute(enhancedResults);\n      \n      // Also update window.currentRouteStats to ensure it's available for map interactions\n      window.currentRouteStats = enhancedResults;\n      \n      console.log('⛽ Route display updated with new stats');\n    }\n\n  }, [waypoints, selectedAircraft, flightSettings, weather]); // Dependencies for the effect\n\n\n  // Initialize managers\n  useEffect(() => {\n    console.log(\"FastPlannerApp: Initializing managers...\");\n\n    // Check if OSDK client is available\n    if (!client) {\n      console.error(\"OSDK Client Error: client is null or undefined\");\n\n      // Create error dialog\n      const errorDialog = document.createElement('div');\n      errorDialog.style.position = 'fixed';\n      errorDialog.style.top = '0';\n      errorDialog.style.left = '0';\n      errorDialog.style.right = '0';\n      errorDialog.style.bottom = '0';\n      errorDialog.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';\n      errorDialog.style.display = 'flex';\n      errorDialog.style.alignItems = 'center';\n      errorDialog.style.justifyContent = 'center';\n      errorDialog.style.zIndex = '9999';\n\n      const dialogContent = document.createElement('div');\n      dialogContent.style.backgroundColor = 'white';\n      dialogContent.style.padding = '20px';\n      dialogContent.style.borderRadius = '8px';\n      dialogContent.style.maxWidth = '500px';\n      dialogContent.style.textAlign = 'center';\n\n      dialogContent.innerHTML = `\n        <h3 style=\"color: #dc3545; margin-top: 0;\">OSDK Client Error</h3>\n        <p>The Palantir OSDK client failed to initialize properly. This will prevent loading aircraft and platform data.</p>\n        <p>Error: Client is null or undefined</p>\n        <p>Please reload the page and try again. If the problem persists, check the console for more details.</p>\n        <div style=\"margin-top: 20px; display: flex; justify-content: center; gap: 10px;\">\n          <button id=\"dismiss-btn\" style=\"padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; background-color: #f8f9fa; color: #212529;\">Dismiss</button>\n          <button id=\"reload-btn\" style=\"padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; background-color: #007bff; color: white;\">Reload Page</button>\n        </div>\n      `;\n\n      errorDialog.appendChild(dialogContent);\n      document.body.appendChild(errorDialog);\n\n      // Add event listeners to buttons\n      document.getElementById('dismiss-btn').addEventListener('click', () => {\n        document.body.removeChild(errorDialog);\n      });\n\n      document.getElementById('reload-btn').addEventListener('click', () => {\n        window.location.reload();\n      });\n    }\n\n    // Create managers if they don't exist - order matters!\n    // 1. First create the map manager\n    if (!mapManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating MapManager instance\");\n      mapManagerRef.current = new MapManager();\n      \n      // 🚨 EMERGENCY FIX: Update global reference\n      window.mapManager = mapManagerRef.current;\n\n      // Directly initialize the map\n      setTimeout(() => {\n        console.log(\"FastPlannerApp: Delayed map initialization\");\n        mapManagerRef.current.loadScripts()\n          .then(() => {\n            console.log(\"FastPlannerApp: Scripts loaded, initializing map...\");\n            return mapManagerRef.current.initializeMap('fast-planner-map');\n          })\n          .then((mapInstance) => {\n            console.log(\"FastPlannerApp: Map initialization complete\");\n            if (handleMapReady) {\n              handleMapReady(mapInstance);\n            }\n\n            // Once the map is ready, load aircraft\n            if (aircraftManagerRef.current && client) {\n              console.log(\"Loading aircraft after map initialization\");\n              aircraftManagerRef.current.loadAircraftFromOSDK(client)\n                .then(() => {\n                  console.log(\"Aircraft loaded successfully\");\n                  // Force update to refresh the UI with aircraft data\n                  setForceUpdate(prev => prev + 1);\n                })\n                .catch(error => {\n                  console.error(`Error loading aircraft: ${error}`);\n                  setAircraftLoading(false);\n                });\n            }\n          })\n          .catch(error => {\n            console.error(\"FastPlannerApp: Error initializing map:\", error);\n          });\n      }, 500);\n    }\n\n    // Create favoriteLocationsManager first so it's available to other components\n    if (!favoriteLocationsManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating FavoriteLocationsManager instance\");\n      favoriteLocationsManagerRef.current = new FavoriteLocationsManager();\n\n      // Set up callback for when favorites change\n      favoriteLocationsManagerRef.current.setCallback('onChange', (favorites) => {\n        if (currentRegion) {\n          console.log(`Favorites changed, updating UI for region ${currentRegion.id}`);\n          const regionFavorites = favoriteLocationsManagerRef.current.getFavoriteLocationsByRegion(currentRegion.id);\n          setFavoriteLocations(regionFavorites);\n        }\n      });\n    }\n\n    // 2. Create platform manager before region manager\n    if (!platformManagerRef.current && mapManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating PlatformManager instance\");\n      platformManagerRef.current = new PlatformManager(mapManagerRef.current);\n    }\n\n    // 3. Create region manager after platform manager\n    if (!regionManagerRef.current && mapManagerRef.current && platformManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating RegionManager instance\");\n      regionManagerRef.current = new RegionManager(mapManagerRef.current, platformManagerRef.current);\n\n      // Set up region manager callbacks\n      regionManagerRef.current.setCallback('onRegionLoaded', (data) => {\n        console.log(`Region loaded: ${data.region.name}`);\n        setRegionLoading(false);\n      });\n\n      regionManagerRef.current.setCallback('onRegionChanged', (region) => {\n        console.log(`Region changed to: ${region.name}`);\n        setCurrentRegion(region);\n\n        // IMPORTANT: Load favorites for this region\n        if (favoriteLocationsManagerRef.current && region) {\n          console.log(`Loading favorites for region ${region.id}`);\n          const regionFavorites = favoriteLocationsManagerRef.current.getFavoriteLocationsByRegion(region.id);\n          console.log(`Found ${regionFavorites.length} favorites for region ${region.id}:`, regionFavorites);\n          setFavoriteLocations(regionFavorites);\n        }\n      });\n\n      regionManagerRef.current.setCallback('onError', (error) => {\n        console.error(`Region manager error: ${error}`);\n        setRegionLoading(false);\n      });\n    }\n\n    if (!waypointManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating WaypointManager instance\");\n      waypointManagerRef.current = new WaypointManager(mapManagerRef.current);\n      \n      // 🚨 EMERGENCY FIX: Update global reference\n      window.waypointManager = waypointManagerRef.current;\n    }\n\n    // Add platformManager to waypointManager if both exist\n    if (waypointManagerRef.current && platformManagerRef.current) {\n      waypointManagerRef.current.setPlatformManager(platformManagerRef.current);\n    }\n\n    // Remove this duplicate initialization\n    if (!routeCalculatorRef.current) {\n      console.log(\"FastPlannerApp: Creating RouteCalculator instance\");\n      routeCalculatorRef.current = new RouteCalculator();\n\n      // Make the route calculator accessible globally for basic calculations\n      window.routeCalculator = routeCalculatorRef.current;\n\n      // Set up route calculator callbacks\n      routeCalculatorRef.current.setCallback('onCalculationComplete', (stats) => {\n        console.log('🔄 Route calculation complete with stats:', {\n          totalDistance: stats?.totalDistance,\n          estimatedTime: stats?.estimatedTime,\n          timeHours: stats?.timeHours,\n          legCount: stats?.legs?.length || 0,\n          hasWind: stats?.windAdjusted || false\n        });\n\n        // The centralized useEffect will handle updating routeStats and stopCards\n        console.log('🔄 Route calculation complete. Triggering centralized fuel calculation...');\n        // No need to update state or generate stop cards here anymore\n      });\n\n      // We no longer need the DirectTimeFix as RouteCalculator now uses the same calculation method as StopCards\n      console.log(\"FastPlannerApp: RouteCalculator configured with accurate wind calculations\");\n    }\n\n    if (!aircraftManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating AircraftManager instance\");\n      aircraftManagerRef.current = new AircraftManager();\n\n      // Set up aircraft manager callbacks\n      aircraftManagerRef.current.setCallback('onAircraftLoaded', (aircraftList) => {\n        console.log(`Loaded ${aircraftList.length} total aircraft`);\n        setAircraftList(aircraftList);\n\n        // After loading all aircraft, filter by region if we have a current region\n        if (currentRegion) {\n          aircraftManagerRef.current.filterAircraft(currentRegion.id);\n        }\n      });\n\n      aircraftManagerRef.current.setCallback('onAircraftFiltered', (filteredAircraft, type) => {\n        console.log(`Filtered to ${filteredAircraft.length} aircraft of type ${type || 'all'}`);\n\n        if (type) {\n          // Update the aircraftsByType with the filtered aircraft for this type\n          setAircraftsByType(prev => ({\n            ...prev,\n            [type]: filteredAircraft\n          }));\n        } else {\n          // If no type specified, organize all aircraft by type\n          const byType = {};\n          const availableTypes = [];\n\n          // Create empty buckets for each type\n          filteredAircraft.forEach(aircraft => {\n            const type = aircraft.modelType || 'Unknown';\n            if (!byType[type]) {\n              byType[type] = [];\n              availableTypes.push(type);\n            }\n            byType[type].push(aircraft);\n          });\n\n          console.log(`Available aircraft types: ${availableTypes.join(', ')}`);\n          setAircraftTypes(availableTypes);\n          setAircraftsByType(byType);\n        }\n\n        setAircraftLoading(false);\n      });\n    }\n\n    if (!flightCalculationsRef.current) {\n      console.log(\"FastPlannerApp: Creating FlightCalculations instance\");\n      flightCalculationsRef.current = new FlightCalculations();\n\n      // Update with current settings\n      flightCalculationsRef.current.updateConfig({\n        passengerWeight: flightSettings.passengerWeight, // Use flightSettings state\n        contingencyFuelPercent: flightSettings.contingencyFuelPercent, // Use flightSettings state\n        taxiFuel: flightSettings.taxiFuel, // Use flightSettings state\n        reserveFuel: flightSettings.reserveFuel, // Use flightSettings state\n        deckTimePerStop: flightSettings.deckTimePerStop, // Use flightSettings state\n        deckFuelFlow: flightSettings.deckFuelFlow, // Use flightSettings state\n      });\n\n      // Import and make WindCalculations available globally\n      import('./modules/calculations/WindCalculations')\n        .then(WindCalc => {\n          // Make WindCalculations globally available\n          window.WindCalculations = WindCalc;\n          console.log(\"WindCalculations module imported and made globally available\");\n        })\n        .catch(error => {\n          console.error(\"Failed to import WindCalculations module:\", error);\n\n\n\n        });\n    }\n\n    // Initialize the AppSettingsManager\n    if (!appSettingsManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating AppSettingsManager instance\");\n      appSettingsManagerRef.current = new AppSettingsManager();\n\n      // Set callbacks for settings changes\n      appSettingsManagerRef.current.setCallback('onRegionChange', (regionId) => {\n        console.log(`AppSettingsManager: Region changed to ${regionId}`);\n        // We don't automatically change the region here to avoid infinite loops\n        // The region is changed via the changeRegion function which also updates the setting\n      });\n\n      appSettingsManagerRef.current.setCallback('onAircraftChange', (aircraft) => {\n        console.log(`AppSettingsManager: Aircraft changed to ${aircraft.type} ${aircraft.registration}`);\n        // Update aircraft selection if it doesn't match current selection\n        if (aircraft.type !== aircraftType) {\n          setAircraftType(aircraft.type);\n        }\n        if (aircraft.registration !== aircraftRegistration) {\n          setAircraftRegistration(aircraft.registration);\n        }\n      });\n\n      appSettingsManagerRef.current.setCallback('onFlightSettingsChange', (settings) => {\n        console.log('AppSettingsManager: Flight settings changed');\n        setFlightSettings(settings);\n\n        // Update individual settings (these individual states are being removed)\n        // setPassengerWeight(settings.passengerWeight);\n        // setContingencyFuelPercent(settings.contingencyFuelPercent);\n        // setTaxiFuel(settings.taxiFuel);\n        // setReserveFuel(settings.reserveFuel);\n        // setDeckTimePerStop(settings.deckTimePerStop);\n        // setDeckFuelFlow(settings.deckFuelFlow);\n      });\n\n      appSettingsManagerRef.current.setCallback('onUISettingsChange', (uiSettings) => {\n        console.log('AppSettingsManager: UI settings changed');\n        // Update UI visibility settings\n        if (leftPanelVisible !== uiSettings.leftPanelVisible) {\n          setLeftPanelVisible(uiSettings.leftPanelVisible);\n        }\n        if (rightPanelVisible !== uiSettings.rightPanelVisible) {\n          setRightPanelVisible(uiSettings.rightPanelVisible);\n        }\n        if (platformsVisible !== uiSettings.platformsVisible) {\n          setPlatformsVisible(uiSettings.platformsVisible);\n        }\n      });\n\n      // Load any saved settings\n      const savedSettings = appSettingsManagerRef.current.getAllSettings();\n\n      // Apply flight settings\n      const flightSettings = savedSettings.flightSettings;\n      setFlightSettings(flightSettings); // Set the entire flightSettings object from saved settings\n      // Remove individual state updates from here\n      // setPassengerWeight(flightSettings.passengerWeight);\n      // setContingencyFuelPercent(flightSettings.contingencyFuelPercent);\n      // setTaxiFuel(flightSettings.taxiFuel);\n      // setReserveFuel(flightSettings.reserveFuel || 600); // Ensure we have a default value\n      // setDeckTimePerStop(flightSettings.deckTimePerStop);\n      // setDeckFuelFlow(flightSettings.deckFuelFlow);\n\n\n      // Apply UI settings\n      const uiSettings = savedSettings.uiSettings;\n      setLeftPanelVisible(uiSettings.leftPanelVisible);\n      setRightPanelVisible(uiSettings.rightPanelVisible);\n      setPlatformsVisible(uiSettings.platformsVisible);\n    }\n\n    // Create the map interaction handler last, after other managers are initialized\n    if (!mapInteractionHandlerRef.current &&\n        mapManagerRef.current &&\n        waypointManagerRef.current &&\n        platformManagerRef.current) {\n      console.log(\"FastPlannerApp: Creating MapInteractionHandler instance\");\n      mapInteractionHandlerRef.current = new MapInteractionHandler(\n        mapManagerRef.current,\n        waypointManagerRef.current,\n        platformManagerRef.current\n      );\n      \n      // 🚨 EMERGENCY FIX: Update global reference\n      window.mapInteractionHandler = mapInteractionHandlerRef.current;\n\n      // Set up callbacks\n      mapInteractionHandlerRef.current.setCallback('onLeftPanelOpen', () => {\n        if (!leftPanelVisible) {\n          console.log('Opening left panel due to map click');\n          setLeftPanelVisible(true);\n        }\n      });\n\n      mapInteractionHandlerRef.current.setCallback('onMapClick', async (data) => {\n        console.log('🗺️ Map click callback received', data);\n        // Don't return anything from this callback to avoid async issues\n        try {\n          // Create a local copy of the data to avoid reference issues\n          const clickData = {...data};\n          // Process the waypoint addition\n          await addWaypoint(clickData); // addWaypoint will trigger the centralized calculation\n        } catch (error) {\n          console.error('Error processing map click:', error);\n        }\n      });\n\n      mapInteractionHandlerRef.current.setCallback('onPlatformClick', async (data) => {\n        console.log('🏢 Platform click callback received', data);\n        // Don't return anything from this callback to avoid async issues\n        try {\n          // Create a local copy of the data to avoid reference issues\n          const clickData = {...data};\n          // Process the waypoint addition\n          await addWaypoint(clickData); // addWaypoint will trigger the centralized calculation\n        } catch (error) {\n          console.error('Error processing platform click:', error);\n        }\n      });\n\n      mapInteractionHandlerRef.current.setCallback('onRouteClick', async (data) => {\n        console.log('🛣️ Route click callback received', data);\n\n        try {\n          // Create a local copy of the data\n          const clickData = {...data};\n          \n          // Check if we're in waypoint mode\n          const isWaypointMode = window.isWaypointModeActive === true;\n          \n          // If in waypoint mode and we have a nearest waypoint available, use that\n          if (isWaypointMode && clickData.nearestWaypoint && clickData.nearestWaypoint.distance < 2) {\n            console.log('🛣️ Adding navigation waypoint at route click:', clickData.nearestWaypoint.name);\n            waypointManagerRef.current.addWaypointAtIndex(\n              clickData.nearestWaypoint.coordinates,\n              clickData.nearestWaypoint.name,\n              clickData.insertIndex,\n              { isWaypoint: true, type: 'WAYPOINT' }\n            );\n          }\n          // If not in waypoint mode and we have a nearest rig and it's close\n          else if (!isWaypointMode && clickData.nearestRig && clickData.nearestRig.distance < 1) {\n            // Add the rig instead of the clicked point\n            console.log('🛣️ Adding rig at route click:', clickData.nearestRig.name);\n            waypointManagerRef.current.addWaypointAtIndex(\n              clickData.nearestRig.coordinates,\n              clickData.nearestRig.name,\n              clickData.insertIndex,\n              { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n            );\n          } else {\n            // Add the clicked point\n            console.log(`🛣️ Adding ${isWaypointMode ? 'waypoint' : 'stop'} at route click`);\n            waypointManagerRef.current.addWaypointAtIndex(\n              [clickData.lngLat.lng, clickData.lngLat.lat],\n              null,\n              clickData.insertIndex,\n              { isWaypoint: isWaypointMode, type: isWaypointMode ? 'WAYPOINT' : 'STOP' }\n            );\n          }\n\n          // Get updated waypoints\n          const updatedWaypoints = waypointManagerRef.current.getWaypoints();\n\n          // Update the state - wait for it to complete\n          await new Promise(resolve => {\n            setWaypoints([...updatedWaypoints]); // Updating waypoints state will trigger the centralized useEffect\n            setTimeout(resolve, 0);\n          });\n\n          // The centralized useEffect will handle recalculation\n          console.log('🛣️ Waypoints updated. Centralized useEffect will recalculate fuel.');\n\n        } catch (error) {\n          console.error('Error processing route click:', error);\n        }\n      });\n\n      mapInteractionHandlerRef.current.setCallback('onError', (error) => {\n        console.error(`MapInteractionHandler error: ${error}`);\n      });\n\n      // We'll initialize it in the handleMapReady function when the map is ready\n    }\n\n    // ADD EVENT LISTENER FOR SAVING AIRCRAFT SETTINGS\n    // This handles the custom event from the SettingsCard to save aircraft-specific settings\n    const handleSaveAircraftSettings = (event) => {\n      const { key, settings } = event.detail;\n      console.log(`Saving settings for ${key}:`, settings);\n\n      try {\n        // Save the settings to localStorage\n        localStorage.setItem(`fastPlanner_settings_${key}`, JSON.stringify(settings));\n        console.log(`Successfully saved settings for ${key}`);\n\n        // If this is also the current aircraft, update the active settings\n        if (selectedAircraft && key === `aircraft_${selectedAircraft.registration}`) {\n          console.log('Updating current flight settings with saved aircraft settings');\n\n          // Update the flightSettings state with saved settings\n          setFlightSettings(prev => ({\n            ...prev,\n            passengerWeight: settings.passengerWeight ?? prev.passengerWeight,\n            contingencyFuelPercent: settings.contingencyFuelPercent ?? prev.contingencyFuelPercent,\n            taxiFuel: settings.taxiFuel ?? prev.taxiFuel,\n            reserveFuel: settings.reserveFuel ?? prev.reserveFuel,\n            deckTimePerStop: settings.deckTimePerStop ?? prev.deckTimePerStop,\n            deckFuelFlow: settings.deckFuelFlow ?? prev.deckFuelFlow,\n            cargoWeight: settings.cargoWeight ?? prev.cargoWeight,\n          }));\n\n          // Remove individual state updates\n          // if (settings.passengerWeight !== undefined) setPassengerWeight(settings.passengerWeight);\n          // ... (removed)\n\n          // Update AppSettingsManager if it exists\n          if (appSettingsManagerRef.current) {\n            appSettingsManagerRef.current.updateFlightSettings(settings);\n          }\n\n          // Recalculate route if needed (centralized useEffect will handle this)\n          // if (selectedAircraft && waypointManagerRef.current && waypointManagerRef.current.getWaypoints().length >= 2) {\n          //   ... (removed)\n          // }\n\n          // Force UI update (centralized useEffect should handle this via state updates)\n          // setForceUpdate(prev => prev + 1);\n        }\n      } catch (error) {\n        console.error(`Error saving settings for ${key}:`, error);\n      }\n    };\n\n    // Add event listener for settings-changed to force UI update\n    // This listener might become redundant if all settings changes go through updateFlightSetting\n    // and the centralized useEffect handles UI updates. Review if this is still needed.\n    const handleSettingsChanged = () => {\n      console.log(\"Settings changed event received. Centralized useEffect should handle updates.\");\n      // The centralized useEffect hook should now handle the recalculation and UI update\n      // based on changes to flightSettings state.\n      // setForceUpdate(prev => prev + 1); // Remove force update here\n\n      // Remove recalculation logic from here\n      // if (waypointManagerRef.current && waypointManagerRef.current.getWaypoints().length >= 2) {\n      //   ... (removed)\n      // }\n    };\n\n    // Add event listener for aircraft settings\n    window.addEventListener('save-aircraft-settings', handleSaveAircraftSettings);\n    window.addEventListener('settings-changed', handleSettingsChanged);\n\n    // Force a rerender after initializing all managers\n    setForceUpdate(prev => prev + 1);\n\n    // Clean up event listener on unmount\n    return () => {\n      window.removeEventListener('save-aircraft-settings', handleSaveAircraftSettings);\n      window.removeEventListener('settings-changed', handleSettingsChanged);\n    };\n  }, [selectedAircraft, waypointManagerRef, routeCalculatorRef, weather, flightSettings]); // Added flightSettings to dependencies\n\n  // Map initialization handler\n  const handleMapReady = (mapInstance) => {\n    console.log(\"🗺️ Map is ready\", mapInstance);\n\n    // When map is ready, initialize other components that depend on the map\n    if (regionManagerRef.current) {\n      console.log(\"🗺️ Initializing regions...\");\n      setRegionLoading(true);\n\n      // Get available regions\n      setRegions(regionManagerRef.current.getRegions());\n\n      // Get the initial region from settings if available\n      const initialRegion = appSettingsManagerRef.current ?\n        appSettingsManagerRef.current.getRegion() : 'gulf-of-mexico';\n\n      console.log(`🗺️ Initializing with region: ${initialRegion}`);\n      regionManagerRef.current.initialize(initialRegion);\n    }\n\n    // Initialize the map interaction handler\n    if (mapInteractionHandlerRef.current) {\n      console.log(\"🗺️ Initializing map interaction handler...\");\n\n      // Make sure the waypointManager is properly connected\n      if (waypointManagerRef.current) {\n        // Set up the waypoint manager's callbacks\n        waypointManagerRef.current.setCallback('onChange', (updatedWaypoints) => {\n          console.log(`🗺️ Waypoints changed, now ${updatedWaypoints.length} waypoints`);\n\n          // Update the waypoints state\n          setWaypoints([...updatedWaypoints]); // Updating waypoints state will trigger the centralized useEffect\n        });\n\n        waypointManagerRef.current.setCallback('onRouteUpdated', (routeData) => {\n          console.log(`🗺️ Route updated with ${routeData.waypoints.length} waypoints`);\n        });\n      }\n\n      // CRITICAL FIX: Force re-initialization of map handler to apply our fixes\n      console.log(\"🚨 CRITICAL FIX: Force re-initializing map interaction handler\");\n      \n      // First, make sure global flags are properly set\n      window.isWaypointModeActive = waypointModeActive;\n      \n      // Then, add a small delay to ensure the map is fully loaded\n      setTimeout(() => {\n        // Initialize map interactions - our fixed version will run\n        const initSuccess = mapInteractionHandlerRef.current.initialize();\n        \n        if (!initSuccess) {\n          console.error(\"Failed to initialize map interaction handler\");\n          \n          // Try again after a longer delay\n          setTimeout(() => {\n            console.log(\"🚨 CRITICAL FIX: Second attempt at initializing map handler\");\n            mapInteractionHandlerRef.current.initialize();\n          }, 1000);\n        } else {\n          console.log(\"Map interaction handler initialized successfully\");\n        }\n      }, 500);\n    }\n  };\n\n  // Panel visibility handlers\n  const toggleLeftPanel = () => {\n    const newState = !leftPanelVisible;\n    setLeftPanelVisible(newState);\n\n    // Save to settings\n    if (appSettingsManagerRef.current) {\n      appSettingsManagerRef.current.updateUISettings({\n        leftPanelVisible: newState\n      });\n    }\n\n    // Trigger animation by adding and removing classes\n    const panel = document.querySelector('.route-editor-panel');\n    if (panel) {\n      if (newState) {\n        // Panel becoming visible - slide in\n        panel.style.animation = 'slideInFromLeft 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards';\n      } else {\n        // Panel becoming hidden - slide out\n        panel.style.animation = 'slideOutToLeft 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards';\n      }\n    }\n  };\n\n  const toggleRightPanel = () => {\n    const newState = !rightPanelVisible;\n    setRightPanelVisible(newState);\n\n    // Save to settings\n    if (appSettingsManagerRef.current) {\n      appSettingsManagerRef.current.updateUISettings({\n        rightPanelVisible: newState\n      });\n    }\n\n    // Trigger animation by adding and removing classes\n    const panel = document.querySelector('.info-panel');\n    if (panel) {\n      if (newState) {\n        // Panel becoming visible - slide in\n        panel.style.animation = 'slideInFromRight 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards';\n      } else {\n        // Panel becoming hidden - slide out\n        panel.style.animation = 'slideOutToRight 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards';\n      }\n    }\n  };\n\n  const handleRouteInputChange = (value) => {\n    setRouteInput(value);\n  };\n\n  // Use StopCardCalculator to generate stop cards data\n  // This function has been refactored to use the StopCardCalculator module\n  // instead of the inline implementation to ensure consistency in calculations\n\n\n  /**\n   * Updates weather settings for the application\n   * IMPORTANT: This function is used by both MainCard and WeatherCard components\n   * to update wind speed and direction.\n   *\n   * @param {number} windSpeed - Wind speed in knots\n   * @param {number} windDirection - Direction wind is coming FROM in degrees (0-359)\n   */\n  const updateWeatherSettings = (windSpeed, windDirection) => {\n    console.log('🌬️ updateWeatherSettings called with:', windSpeed, windDirection);\n\n    // Ensure we have valid numbers\n    const windSpeedNum = parseInt(windSpeed) || 0;\n    // Normalize direction to 0-359 range\n    const windDirectionNum = ((parseInt(windDirection) || 0) % 360 + 360) % 360;\n\n    const newWeather = {\n      windSpeed: windSpeedNum,\n      windDirection: windDirectionNum\n    };\n\n    console.log(`🌬️ Updating weather settings: Wind ${newWeather.windSpeed} kts from ${newWeather.windDirection}°`);\n    console.log('🌬️ Old weather state:', weather);\n\n    // IMPORTANT FIX: Two-step update process to ensure correct wind calculations\n    \n    // Step 1: Clear the route display first\n    if (waypointManagerRef.current) {\n      console.log('🌬️ Step 1: Clearing route display to force redraw');\n      waypointManagerRef.current.updateRoute(null);\n    }\n    \n    // Step 2: Immediately set the new weather state\n    setWeather(newWeather);\n    \n    // Step 3: Force an immediate UI update\n    setForceUpdate(prev => prev + 1);\n    \n    // Step 4: Manually recalculate the route with the new wind settings\n    if (waypoints && waypoints.length >= 2 && selectedAircraft) {\n      console.log('🌬️ Manually recalculating route with new wind settings...');\n      \n      try {\n        // Verify WindCalculations is available globally\n        if (!window.WindCalculations) {\n          console.log('🌬️ Making WindCalculations available globally');\n          window.WindCalculations = WindCalc;\n        }\n        \n        // First, use RouteCalculator for quick calculation with wind\n        // This ensures the route lines and top card get proper wind-adjusted times\n        if (routeCalculatorRef.current) {\n          console.log('🌬️ Step 4a: Calculating wind-adjusted route with RouteCalculator');\n          \n          // Extract coordinates from waypoints\n          const coordinates = waypoints.map(wp => wp.coords);\n          \n          // Calculate route stats with wind effects\n          const basicRouteStats = routeCalculatorRef.current.calculateRouteStats(\n            coordinates, \n            {\n              selectedAircraft: selectedAircraft, \n              weather: newWeather,\n              forceTimeCalculation: true // Force time calculation flag\n            }\n          );\n          \n          console.log('🌬️ RouteCalculator wind-adjusted results:', {\n            timeHours: basicRouteStats?.timeHours,\n            estimatedTime: basicRouteStats?.estimatedTime,\n            windAdjusted: basicRouteStats?.windAdjusted || false,\n            avgHeadwind: basicRouteStats?.windData?.avgHeadwind\n          });\n          \n          // Ensure this calculated data is available globally\n          window.currentRouteStats = basicRouteStats;\n          \n          // Update route display immediately with the basic wind-adjusted stats\n          if (waypointManagerRef.current) {\n            waypointManagerRef.current.updateRoute(basicRouteStats);\n          }\n        }\n        \n        // Step 5: Run comprehensive calculation for stop cards and full stats\n        console.log('🌬️ Step 5: Running comprehensive calculation with wind effects');\n        \n        // Prepare numeric settings for calculation\n        const numericSettings = {\n          passengerWeight: Number(flightSettings.passengerWeight),\n          taxiFuel: Number(flightSettings.taxiFuel),\n          contingencyFuelPercent: Number(flightSettings.contingencyFuelPercent),\n          reserveFuel: Number(flightSettings.reserveFuel),\n          deckTimePerStop: Number(flightSettings.deckTimePerStop),\n          deckFuelFlow: Number(flightSettings.deckFuelFlow),\n          cargoWeight: Number(flightSettings.cargoWeight || 0)\n        };\n        \n        console.log('🌬️ Using numeric settings for comprehensive calculation:', numericSettings);\n        \n        // Calculate with the new wind settings - use imported module directly\n        const { enhancedResults, stopCards: newStopCards } = ComprehensiveFuelCalculator.calculateAllFuelData(\n          waypoints,\n          selectedAircraft,\n          numericSettings,\n          newWeather\n        );\n\n\n\n        \n        if (enhancedResults) {\n          console.log('🌬️ Comprehensive calculation complete with wind settings:', newWeather);\n          \n          // CRITICAL: Ensure wind data is properly set in all necessary places\n          enhancedResults.windAdjusted = true;\n          \n          // Set wind data in the main object\n          enhancedResults.windData = {\n            windSpeed: newWeather.windSpeed,\n            windDirection: newWeather.windDirection,\n            avgHeadwind: enhancedResults.windData?.avgHeadwind || 0\n          };\n          \n          // Also ensure each leg has proper wind data\n          if (enhancedResults.legs && enhancedResults.legs.length > 0) {\n            enhancedResults.legs.forEach((leg, index) => {\n              // Calculate headwind for each leg if missing\n              if (leg.headwind === undefined) {\n                // If WindCalculations is available, try to calculate headwind\n                if (window.WindCalculations && leg.course !== undefined) {\n                  leg.headwind = window.WindCalculations.calculateHeadwindComponent(\n                    newWeather.windSpeed, \n                    leg.course, \n                    newWeather.windDirection\n                  );\n                  console.log(`🌬️ Added headwind data to leg ${index+1}: ${leg.headwind.toFixed(2)} knots`);\n                }\n              }\n            });\n          }\n          \n          console.log('🌬️ Comprehensive calculation results:', {\n            timeHours: enhancedResults.timeHours,\n            estimatedTime: enhancedResults.estimatedTime,\n            windAdjusted: enhancedResults.windAdjusted\n          });\n          \n          // CRITICAL FIX: Transfer wind-adjusted time from enhancedResults to window.currentRouteStats\n          // This ensures consistency between route display and stop cards\n          if (window.currentRouteStats) {\n            window.currentRouteStats.timeHours = enhancedResults.timeHours;\n            window.currentRouteStats.estimatedTime = enhancedResults.estimatedTime;\n            window.currentRouteStats.windAdjusted = true;\n            window.currentRouteStats.windData = enhancedResults.windData;\n            \n            console.log('🌬️ Synchronized enhancedResults with window.currentRouteStats');\n          }\n          \n          // Update state with new calculations\n          setRouteStats(enhancedResults);\n          setStopCards(newStopCards);\n          \n          // Step 6: Update the route display again with the comprehensive stats\n          setTimeout(() => {\n            if (waypointManagerRef.current) {\n              console.log('🌬️ Step 6: Final route display update with comprehensive stats');\n              waypointManagerRef.current.updateRoute(enhancedResults);\n            }\n          }, 100);\n        }\n      } catch (error) {\n        console.error('🌬️ Error in wind calculation:', error);\n        \n        // Fallback: Update with current stats but with updated wind data\n        if (window.currentRouteStats) {\n          window.currentRouteStats.windAdjusted = true;\n          window.currentRouteStats.windData = {\n            windSpeed: newWeather.windSpeed,\n            windDirection: newWeather.windDirection,\n            avgHeadwind: window.currentRouteStats.windData?.avgHeadwind || 0\n          };\n          \n          if (waypointManagerRef.current) {\n            waypointManagerRef.current.updateRoute(window.currentRouteStats);\n          }\n        }\n      }\n    } else {\n      // No waypoints or aircraft, just update the weather state\n      console.log('🌬️ No waypoints or aircraft, just updating weather state');\n    }\n  };\n\n  // Basic handlers\n  const addWaypoint = async (waypointData) => {\n    if (waypointManagerRef.current) {\n      // Handle different input formats\n      let coords, name, isWaypoint = false;\n\n      console.log('🌐 FastPlannerApp: Adding waypoint with data:', waypointData);\n\n      // UPDATED LOGIC: Extract waypoint flag and coordinate formats\n      if (Array.isArray(waypointData)) {\n        // Direct coordinates array: [lng, lat]\n        coords = waypointData;\n        name = null;\n      } else if (typeof waypointData === 'string') {\n        // It's just a name - try to find a location with that name\n        console.log(`🌐 Looking for location with name: ${waypointData}`);\n\n        if (platformManagerRef.current) {\n          console.log(`🌐 Searching for platform with name: ${waypointData}`);\n          const platform = platformManagerRef.current.findPlatformByName(waypointData);\n\n          if (platform) {\n            console.log(`🌐 Found platform: ${platform.name} at ${platform.coordinates}`);\n            coords = platform.coordinates;\n            name = platform.name;\n          } else {\n            console.log(`🌐 Platform not found with name: ${waypointData}`);\n            // Show error message to user\n            if (window.LoadingIndicator) {\n              window.LoadingIndicator.updateStatusIndicator(`Platform \"${waypointData}\" not found. Please check spelling or click on map.`, 'error');\n            }\n            // Set coords to null so we'll return early\n            coords = null;\n            name = waypointData;\n          }\n        } else {\n          console.log(`🌐 Platform manager not available`);\n          coords = null;\n          name = waypointData;\n        }\n      } else if (waypointData && typeof waypointData === 'object') {\n        // NEW: Check if this has isWaypoint flag\n        if (waypointData.isWaypoint === true) {\n          console.log('🌐 This is a navigation waypoint, not a regular stop');\n          isWaypoint = true;\n        }\n        \n        // Extract coordinates from various possible formats\n        if (waypointData.coordinates) {\n          coords = waypointData.coordinates;\n        } else if (waypointData.coords) {\n          coords = waypointData.coords;\n        } else if (waypointData.lngLat) {\n          coords = [waypointData.lngLat.lng, waypointData.lngLat.lat];\n        } else if (waypointData.nearestRig && waypointData.nearestRig.distance <= 2) {\n          // Check if we have a nearest rig within range\n          console.log(`🌐 Snapping to nearest rig: ${waypointData.nearestRig.name} (${waypointData.nearestRig.distance.toFixed(2)} nm away)`);\n\n          // Get rig coordinates\n          if (waypointData.nearestRig.coordinates) {\n            coords = waypointData.nearestRig.coordinates;\n          } else if (waypointData.nearestRig.coords) {\n            coords = waypointData.nearestRig.coords;\n          } else if (waypointData.nearestRig.lng !== undefined && waypointData.nearestRig.lat !== undefined) {\n            coords = [waypointData.nearestRig.lng, waypointData.nearestRig.lat];\n          } else {\n            console.error('Invalid nearestRig coordinates format:', waypointData.nearestRig);\n            // Use click coordinates as fallback\n            if (waypointData.lngLat) {\n              coords = [waypointData.lngLat.lng, waypointData.lngLat.lat];\n            } else {\n              return; // No valid coordinates found\n            }\n          }\n\n          name = waypointData.nearestRig.name;\n        } else {\n          console.error('Invalid waypoint data format:', waypointData);\n          return;\n        }\n        \n        // Extract name\n        if (!name && waypointData.name) {\n          name = waypointData.name;\n        }\n      } else {\n        console.error('Invalid waypoint data:', waypointData);\n        return;\n      }\n\n      // If we only have a name, try to look up coordinates (this could be enhanced)\n      if (!coords && name) {\n        console.log(`🌐 We need to search for location with name: ${name}`);\n        return; // For now, just return if we don't have coordinates\n      }\n\n      // Final validation of coords\n      if (!coords || !Array.isArray(coords) || coords.length !== 2) {\n        console.error('Invalid coordinates format:', coords);\n        // Show error message to user\n        if (window.LoadingIndicator) {\n          window.LoadingIndicator.updateStatusIndicator(`Invalid coordinates. Please try again.`, 'error');\n        }\n        return;\n      }\n\n      // Check global waypoint mode flag\n      if (window.isWaypointModeActive === true) {\n        console.log('🌐 Waypoint mode is active - forcing waypoint flag to true');\n        isWaypoint = true;\n      }\n      \n      console.log(`🌐 FastPlannerApp: Adding ${isWaypoint ? 'waypoint' : 'stop'} at [${coords}] with name \"${name || 'Unnamed'}\"`);\n      \n      // Add the waypoint with the isWaypoint flag\n      waypointManagerRef.current.addWaypoint(coords, name, { \n        isWaypoint: isWaypoint, // Pass the flag to identify waypoints vs stops\n        type: isWaypoint ? 'WAYPOINT' : 'STOP' // Explicitly set type\n      });\n\n      // Get the updated waypoints list\n      const updatedWaypoints = waypointManagerRef.current.getWaypoints();\n      console.log(`🌐 Updated waypoints (${updatedWaypoints.length}):`, updatedWaypoints);\n\n      // Update the state - wait for it to complete\n      await new Promise(resolve => {\n        setWaypoints([...updatedWaypoints]); // Updating waypoints state will trigger the centralized useEffect\n        // Use setTimeout to ensure the state update has time to complete\n        setTimeout(resolve, 0);\n      });\n\n      // The centralized useEffect will handle recalculation\n      console.log('🌐 Waypoints updated. Centralized useEffect will recalculate fuel.');\n    }\n  };\n\n  const removeWaypoint = (waypointIdOrIndex) => {\n    if (waypointManagerRef.current) {\n      const waypoints = waypointManagerRef.current.getWaypoints();\n      let id, index;\n\n      // Check if we received an ID or an index\n      if (typeof waypointIdOrIndex === 'string') {\n        // It's an ID\n        id = waypointIdOrIndex;\n        index = waypoints.findIndex(wp => wp.id === id);\n      } else if (typeof waypointIdOrIndex === 'number') {\n        // It's an index\n        index = waypointIdOrIndex;\n        id = waypoints[index]?.id;\n      } else {\n        console.error('Invalid waypoint identifier:', waypointIdOrIndex);\n        return;\n      }\n\n      console.log(`FastPlannerApp: Removing waypoint with ID ${id} at index ${index}`);\n\n      // Only proceed if we have a valid ID and index\n      if (id && index !== -1) {\n        waypointManagerRef.current.removeWaypoint(id, index);\n\n        // Get updated waypoints\n        const updatedWaypoints = waypointManagerRef.current.getWaypoints();\n\n        // Update the state\n        setWaypoints([...updatedWaypoints]); // Updating waypoints state will trigger the centralized useEffect\n\n        // The centralized useEffect will handle recalculation\n        console.log('FastPlannerApp: Waypoints updated. Centralized useEffect will recalculate fuel.');\n      } else {\n        // Clear route stats if we don't have enough waypoints\n        setRouteStats(null);\n      }\n    }\n  };\n\n  const updateWaypointName = (index, name) => {\n    if (waypointManagerRef.current) {\n      waypointManagerRef.current.updateWaypointName(index, name);\n      setWaypoints([...waypointManagerRef.current.getWaypoints()]); // Updating waypoints state will trigger the centralized useEffect\n    }\n  };\n\n  const clearRoute = () => {\n    if (waypointManagerRef.current) {\n      waypointManagerRef.current.clearRoute();\n      setWaypoints([]); // Updating waypoints state will trigger the centralized useEffect\n      setRouteStats(null); // Also clear routeStats explicitly\n    }\n  };\n\n  const handleAddFavoriteLocation = (location) => {\n    if (favoriteLocationsManagerRef.current && currentRegion) {\n      console.log(`Adding favorite location to region ${currentRegion.id}:`, location);\n\n      // First add to the manager\n      favoriteLocationsManagerRef.current.addFavoriteLocation(currentRegion.id, location);\n\n      // Then immediately update the UI with the new favorites\n      // This is needed because the callback might not be triggered properly\n      const updatedFavorites = favoriteLocationsManagerRef.current.getFavoriteLocationsByRegion(currentRegion.id);\n      console.log(`Manually updating UI with ${updatedFavorites.length} favorites after adding:`, updatedFavorites);\n      setFavoriteLocations(updatedFavorites);\n    } else {\n      console.error('Cannot add favorite: No favorite locations manager or current region');\n    }\n  };\n\n  /**\n   * Reorder waypoints via drag and drop\n   * @param {string} draggedId - ID of waypoint being dragged\n   * @param {string} dropTargetId - ID of waypoint being dropped onto\n   */\n  const reorderWaypoints = (draggedId, dropTargetId) => {\n    if (waypointManagerRef.current && draggedId && dropTargetId) {\n      console.log(`FastPlannerApp: Reordering from ${draggedId} to ${dropTargetId}`);\n      waypointManagerRef.current.reorderWaypoints(draggedId, dropTargetId);\n\n      // Get updated waypoints\n      setWaypoints([...waypointManagerRef.current.getWaypoints()]); // Updating waypoints state will trigger the centralized useEffect\n\n      // Remove recalculation logic from here\n      // Recalculate route stats if we have at least 2 waypoints\n      // ... (removed)\n    } else {\n      console.error('Cannot reorder: Missing waypoint manager or invalid IDs');\n    }\n  };\n\n  const handleRemoveFavoriteLocation = (locationId) => {\n    if (favoriteLocationsManagerRef.current && currentRegion) {\n      console.log(`Removing favorite location with ID ${locationId} from region ${currentRegion.id}`);\n      favoriteLocationsManagerRef.current.removeFavoriteLocation(currentRegion.id, locationId);\n      setFavoriteLocations(favoriteLocationsManagerRef.current.getFavoriteLocationsByRegion(currentRegion.id));\n    } else {\n      console.error('Cannot remove favorite: No favorite locations manager or current region');\n    }\n  };\n\n  const togglePlatformsVisibility = () => {\n    const newState = !platformsVisible;\n    setPlatformsVisible(newState);\n\n    if (platformManagerRef.current) {\n      platformManagerRef.current.toggleVisibility(newState);\n    }\n\n    // Save to settings\n    if (appSettingsManagerRef.current) {\n      appSettingsManagerRef.current.updateUISettings({\n        platformsVisible: newState\n      });\n    }\n  };\n\n  /**\n   * Toggle waypoint insertion mode\n   * Uses a completely separate handler for waypoints\n   * \n   * @param {boolean} active - Whether to activate waypoint mode\n   */\n  const toggleWaypointMode = (active) => {\n    console.log(`🟡 FastPlannerApp: Setting waypoint mode to ${active ? 'ON' : 'OFF'}`);\n    \n    // First, clear any active click handling flag\n    window._clickHandledByWaypointHandler = false;\n    \n    // 1. Update UI state first\n    setWaypointModeActive(active);\n    \n    // 2. Set the global flag for other components to check\n    window.isWaypointModeActive = active;\n    \n    // 3. Use the dedicated waypoint handler if available\n    if (waypointHandlerRef.current) {\n      waypointHandlerRef.current.setEnabled(active);\n      console.log(`🟡 FastPlannerApp: Waypoint handler state: ${waypointHandlerRef.current.isEnabled() ? 'ENABLED' : 'DISABLED'}`);\n    } else {\n      console.warn('🟡 FastPlannerApp: Waypoint handler not available. Creating it now.');\n      \n      // Create the handler if it doesn't exist\n      waypointHandlerRef.current = new WaypointHandler(mapManagerRef.current, waypointManagerRef.current);\n      window.waypointHandler = waypointHandlerRef.current;\n      \n      // Initialize and set state\n      waypointHandlerRef.current.initialize();\n      waypointHandlerRef.current.setEnabled(active);\n    }\n    \n    // 4. Toggle platform manager's waypoint mode which handles visibility\n    if (platformManagerRef.current) {\n      platformManagerRef.current.toggleWaypointMode(active);\n    } else {\n      console.warn('🟡 FastPlannerApp: Platform manager not available for waypoint mode toggle');\n    }\n    \n    // 5. If window.toggleMapMode is available (set by ModeHandler), use it\n    if (typeof window.toggleMapMode === 'function') {\n      console.log('🟡 FastPlannerApp: Using window.toggleMapMode for extra compatibility');\n      window.toggleMapMode(active ? 'waypoint' : 'normal');\n    }\n    \n    // 6. Show status message to user\n    if (window.LoadingIndicator) {\n      window.LoadingIndicator.updateStatusIndicator(\n        `${active ? 'Waypoint' : 'Normal'} mode activated. Click on the map to add ${active ? 'waypoints' : 'stops'}.`,\n        active ? 'success' : 'info',\n        5000 // Show for 5 seconds\n      );\n    }\n    \n    // 7. Log the state of all handlers\n    console.log('🟡 FastPlannerApp: Waypoint mode state summary:', {\n      uiState: active,\n      globalFlag: window.isWaypointModeActive,\n      waypointHandlerEnabled: waypointHandlerRef.current?.isEnabled(),\n      platformManagerWaypointMode: platformManagerRef.current?.waypointModeActive\n    });\n  };\n\n  const loadCustomChart = () => {\n    // Not implemented yet\n    console.log(\"loadCustomChart - Not implemented\");\n  };\n\n  const reloadPlatformData = () => {\n    if (platformManagerRef.current && currentRegion) {\n      setRigsLoading(true);\n      platformManagerRef.current.loadPlatformsFromFoundry(client, currentRegion.osdkRegion)\n        .then(() => {\n          setPlatformsLoaded(true);\n          setRigsLoading(false);\n          setPlatformsVisible(true);\n        })\n        .catch(error => {\n          console.error(`Error loading platforms: ${error}`);\n          setRigsError(error.message);\n          setRigsLoading(false);\n        });\n    }\n  };\n\n  const changeRegion = (regionId) => {\n    if (regionManagerRef.current) {\n      console.log(`Changing region to ${regionId}`);\n      setRegionLoading(true);\n\n      // Clear aircraft selection when changing regions\n      setAircraftType('');\n      setAircraftRegistration('');\n      setSelectedAircraft(null);\n\n      // Set the new region\n      regionManagerRef.current.setRegion(regionId);\n\n      // Load favorite locations for the new region\n      if (favoriteLocationsManagerRef.current) {\n        console.log(`Loading favorite locations for region: ${regionId}`);\n        const regionFavorites = favoriteLocationsManagerRef.current.getFavoriteLocationsByRegion(regionId);\n        setFavoriteLocations(regionFavorites);\n      }\n\n      // Save to settings\n      if (appSettingsManagerRef.current) {\n        appSettingsManagerRef.current.setRegion(regionId);\n      }\n    }\n  };\n\n  const changeAircraftType = (type) => {\n    setAircraftType(type);\n    setAircraftRegistration('');  // Clear registration when type changes\n    setSelectedAircraft(null);    // Clear selected aircraft\n\n    // Save to settings\n    if (appSettingsManagerRef.current) {\n      appSettingsManagerRef.current.setAircraft(type, '');\n    }\n\n    if (aircraftManagerRef.current && currentRegion) {\n      setAircraftLoading(true);\n      aircraftManagerRef.current.filterAircraft(currentRegion.id, type);\n    }\n  };\n\n  const changeAircraftRegistration = (registration) => {\n    console.log(`⚡ Changing aircraft registration to: ${registration}`);\n    setAircraftRegistration(registration);\n\n    // Find the selected aircraft in the aircraftsByType\n    let aircraft = null;\n    if (aircraftsByType[aircraftType]) {\n      aircraft = aircraftsByType[aircraftType].find(a => a.registration === registration);\n      setSelectedAircraft(aircraft); // Updating selectedAircraft state will trigger the centralized useEffect\n\n      // CRITICAL: Make the selected aircraft globally available for API testing\n      window.currentSelectedAircraft = aircraft;\n\n      console.log(`⚡ Selected aircraft:`, {\n        registration: aircraft?.registration,\n        type: aircraft?.modelType,\n        cruiseSpeed: aircraft?.cruiseSpeed,\n        fuelBurn: aircraft?.fuelBurn\n      });\n\n      // Save to settings\n      if (appSettingsManagerRef.current) {\n        appSettingsManagerRef.current.setAircraft(aircraftType, registration);\n      }\n\n      // Load aircraft-specific settings if they exist\n      if (aircraft) {\n        try {\n          const storageKey = `aircraft_${aircraft.registration}`;\n          const savedSettingsJson = localStorage.getItem(`fastPlanner_settings_${storageKey}`);\n\n          if (savedSettingsJson) {\n            const savedSettings = JSON.parse(savedSettingsJson);\n            console.log(`Found saved settings for ${aircraft.registration}:`, savedSettings);\n\n            // Update the flightSettings state with saved settings\n            setFlightSettings(prev => ({\n              ...prev,\n              passengerWeight: savedSettings.passengerWeight ?? prev.passengerWeight,\n              contingencyFuelPercent: savedSettings.contingencyFuelPercent ?? prev.contingencyFuelPercent,\n              taxiFuel: savedSettings.taxiFuel ?? prev.taxiFuel,\n              reserveFuel: savedSettings.reserveFuel ?? prev.reserveFuel,\n              deckTimePerStop: savedSettings.deckTimePerStop ?? prev.deckTimePerStop,\n              deckFuelFlow: savedSettings.deckFuelFlow ?? prev.deckFuelFlow,\n              cargoWeight: savedSettings.cargoWeight ?? prev.cargoWeight,\n            }));\n\n            // Remove individual state updates\n            // if (savedSettings.passengerWeight !== undefined) setPassengerWeight(savedSettings.passengerWeight);\n            // ... (removed)\n\n            // Update FlightCalculations module (if still needed, review later)\n            // if (flightCalculationsRef.current) {\n            //   flightCalculationsRef.current.updateConfig(updatedSettings);\n            // }\n\n            // Show a message that settings were loaded\n            if (window.LoadingIndicator) {\n              window.LoadingIndicator.updateStatusIndicator(`Loaded saved settings for ${aircraft.registration}`);\n            }\n          } else {\n            // If no aircraft-specific settings, try to load type-specific settings\n            const typeSettingsJson = localStorage.getItem(`fastPlanner_settings_${aircraftType}`);\n\n            if (typeSettingsJson) {\n              const typeSettings = JSON.parse(typeSettingsJson);\n              console.log(`Found saved settings for aircraft type ${aircraftType}:`, typeSettings);\n\n              // Update the flightSettings state with type settings\n              setFlightSettings(prev => ({\n                ...prev,\n                passengerWeight: typeSettings.passengerWeight ?? prev.passengerWeight,\n                contingencyFuelPercent: typeSettings.contingencyFuelPercent ?? prev.contingencyFuelPercent,\n                taxiFuel: typeSettings.taxiFuel ?? prev.taxiFuel,\n                reserveFuel: typeSettings.reserveFuel ?? prev.reserveFuel,\n                deckTimePerStop: typeSettings.deckTimePerStop ?? prev.deckTimePerStop,\n                deckFuelFlow: typeSettings.deckFuelFlow ?? prev.deckFuelFlow,\n                cargoWeight: typeSettings.cargoWeight ?? prev.cargoWeight,\n              }));\n\n              // Remove individual state updates\n              // if (typeSettings.passengerWeight !== undefined) setPassengerWeight(typeSettings.passengerWeight);\n              // ... (removed)\n\n              // Update FlightCalculations module (if still needed, review later)\n              // if (flightCalculationsRef.current) {\n              //   flightCalculationsRef.current.updateConfig(updatedSettings);\n              // }\n\n              // Show a message that type settings were loaded\n              if (window.LoadingIndicator) {\n                window.LoadingIndicator.updateStatusIndicator(`Loaded ${aircraftType} type settings`);\n              }\n            }\n          }\n        } catch (error) {\n          console.error(`Error loading saved settings for ${registration}:`, error);\n        }\n      }\n\n      // Handle the case when an aircraft is selected (non-empty registration)\n      if (registration) {\n        // After selecting an aircraft, reset dropdown values for next selection\n        // but maintain the actual selected aircraft in state\n        setTimeout(() => {\n          // Reset type dropdown value but DO NOT change state\n          setAircraftType('');\n          // Reset registration dropdown value but DO NOT clear selected aircraft\n          setAircraftRegistration('');\n\n          // Force a UI update to refresh the dropdown components\n          setForceUpdate(prev => prev + 1);\n\n          console.log(\"Reset dropdowns after aircraft selection while keeping selectedAircraft\");\n        }, 100);\n      }\n\n      // Recalculate route if we have waypoints (centralized useEffect will handle this)\n      // if (aircraft && waypointManagerRef.current) {\n      //   ... (removed)\n      // }\n    }\n  };\n\n  // Load aircraft data when region changes\n  useEffect(() => {\n    if (aircraftManagerRef.current && currentRegion && client) {\n      console.log(`Loading aircraft for region ${currentRegion.name}`);\n      setAircraftLoading(true);\n\n      // Check if we already have loaded aircraft\n      if (aircraftList.length > 0) {\n        console.log('Aircraft already loaded, just filtering by region');\n        aircraftManagerRef.current.filterAircraft(currentRegion.id, aircraftType);\n        setAircraftLoading(false);\n      } else {\n        // Load all aircraft from OSDK\n        try {\n          aircraftManagerRef.current.loadAircraftFromOSDK(client)\n            .then(() => {\n              console.log('Aircraft loaded from OSDK, filtering by region');\n\n              // Filter aircraft for the current region\n              if (currentRegion) {\n                aircraftManagerRef.current.filterAircraft(currentRegion.id, aircraftType);\n              }\n\n              setAircraftLoading(false);\n            })\n            .catch(error => {\n              console.error(`Error loading aircraft: ${error}`);\n              setAircraftLoading(false);\n            });\n        } catch (error) {\n          console.error(`Error calling loadAircraftFromOSDK: ${error}`);\n          setAircraftLoading(false);\n        }\n      }\n    }\n  }, [currentRegion, client, aircraftType, aircraftList.length]);\n\n  // Load platform data when region changes\n  useEffect(() => {\n    if (platformManagerRef.current && currentRegion && client) {\n      console.log(`Loading platforms for region ${currentRegion.name}`);\n      setRigsLoading(true);\n\n      try {\n        // Check if the method exists\n        if (typeof platformManagerRef.current.loadPlatformsFromFoundry === 'function') {\n          platformManagerRef.current.loadPlatformsFromFoundry(client, currentRegion.osdkRegion)\n            .then(() => {\n              setPlatformsLoaded(true);\n              setRigsLoading(false);\n              setPlatformsVisible(true);\n            })\n            .catch(error => {\n              console.error(`Error loading platforms: ${error}`);\n              setRigsError(error?.message || 'Unknown error loading platforms');\n              setRigsLoading(false);\n            });\n        } else {\n          // Method doesn't exist, show error\n          console.error('PlatformManager.loadPlatformsFromFoundry is not a function');\n          setRigsError('Platform loading method not available');\n          setRigsLoading(false);\n        }\n      } catch (error) {\n        console.error(`Error calling platform loading method: ${error}`);\n        setRigsError(error?.message || 'Error loading platforms');\n        setRigsLoading(false);\n      }\n    }\n  }, [currentRegion, client]);\n\n  // No longer need to extract fuel data from stop cards\n  // StopCardCalculator will be used directly by RouteStatsCard\n  // This simplifies the data flow and ensures consistency in calculations\n\n  return (\n    <div className=\"fast-planner-container\">\n      {/* ModeHandler is kept but our dedicated WaypointHandler is used for waypoints */}\n      <ModeHandler \n        mapManagerRef={mapManagerRef}\n        waypointManagerRef={waypointManagerRef}\n        platformManagerRef={platformManagerRef}\n        initialMode=\"normal\"\n      />\n\n      {/* Loading Overlay - Only used for critical operations, not for aircraft loading */}\n      <div id=\"loading-overlay\" className=\"loading-overlay\" style={{ display: 'none' }}>\n        <div className=\"loading-spinner\"></div>\n        <div className=\"loading-message\">Loading...</div>\n      </div>\n\n      {/* Route Stats Card */}\n      <RouteStatsCard\n        routeStats={routeStats}\n        selectedAircraft={selectedAircraft}\n        waypoints={waypoints}\n        // Pass individual flight settings from the flightSettings state object\n        deckTimePerStop={flightSettings.deckTimePerStop}\n        // deckFuelPerStop={deckFuelPerStop} // This individual state is removed\n        deckFuelFlow={flightSettings.deckFuelFlow}\n        passengerWeight={flightSettings.passengerWeight}\n        cargoWeight={flightSettings.cargoWeight}\n        taxiFuel={flightSettings.taxiFuel}\n        contingencyFuelPercent={flightSettings.contingencyFuelPercent}\n        reserveFuel={flightSettings.reserveFuel}\n        weather={weather}\n        stopCards={stopCards}\n      />\n\n      {/* Map Component */}\n      <MapComponent\n        mapManagerRef={mapManagerRef}\n        onMapReady={handleMapReady}\n        className=\"fast-planner-map\"\n      />\n\n      {/* Left Panel (Route Editor) */}\n      <LeftPanel\n        visible={leftPanelVisible}\n        onToggleVisibility={toggleLeftPanel}\n        waypoints={waypoints}\n        onRemoveWaypoint={removeWaypoint}\n        onWaypointNameChange={updateWaypointName}\n        onAddWaypoint={addWaypoint}\n        onReorderWaypoints={reorderWaypoints}\n        routeInput={routeInput}\n        onRouteInputChange={handleRouteInputChange}\n        favoriteLocations={favoriteLocations}\n        onAddFavoriteLocation={handleAddFavoriteLocation}\n        onRemoveFavoriteLocation={handleRemoveFavoriteLocation}\n        onClearRoute={clearRoute}\n        onToggleChart={togglePlatformsVisibility}\n        chartsVisible={platformsVisible}\n        onToggleWaypointMode={toggleWaypointMode}\n        waypointModeActive={waypointModeActive}\n      />\n\n      {/* Right Panel (Controls & Stats) */}\n      <RightPanel\n        visible={rightPanelVisible}\n        onToggleVisibility={toggleRightPanel}\n        onClearRoute={clearRoute}\n        onLoadRigData={reloadPlatformData}\n        onToggleChart={togglePlatformsVisibility}\n        onLoadCustomChart={loadCustomChart}\n        chartsVisible={platformsVisible}\n        aircraftType={aircraftType}\n        onAircraftTypeChange={changeAircraftType}\n        aircraftRegistration={aircraftRegistration}\n        onAircraftRegistrationChange={changeAircraftRegistration}\n        selectedAircraft={selectedAircraft}\n        aircraftsByType={aircraftsByType}\n        aircraftLoading={aircraftLoading}\n        routeStats={routeStats}\n        waypoints={waypoints}\n        onRemoveWaypoint={removeWaypoint}\n        isAuthenticated={isAuthenticated}\n        authUserName={userName}\n        rigsLoading={rigsLoading}\n        onLogin={login}\n        regions={regions}\n        currentRegion={currentRegion}\n        onRegionChange={changeRegion}\n        regionLoading={regionLoading}\n        // Flight settings props - Pass values from flightSettings state\n        deckTimePerStop={flightSettings.deckTimePerStop}\n        // deckFuelPerStop={deckFuelPerStop} // This individual state is removed\n        deckFuelFlow={flightSettings.deckFuelFlow}\n        passengerWeight={flightSettings.passengerWeight}\n        cargoWeight={flightSettings.cargoWeight}\n        taxiFuel={flightSettings.taxiFuel}\n        contingencyFuelPercent={flightSettings.contingencyFuelPercent}\n        reserveFuel={flightSettings.reserveFuel}\n        reserveMethod={reserveMethod} // Keep reserveMethod if used for UI only\n        onDeckTimeChange={(value) => updateFlightSetting('deckTimePerStop', value)}\n        // onDeckFuelChange={(value) => updateFlightSetting('deckFuelPerStop', value)} // Keep handler for now, review if needed\n        onDeckFuelFlowChange={(value) => updateFlightSetting('deckFuelFlow', value)}\n        onPassengerWeightChange={(value) => updateFlightSetting('passengerWeight', value)}\n        onCargoWeightChange={(value) => updateFlightSetting('cargoWeight', value)}\n        onTaxiFuelChange={(value) => updateFlightSetting('taxiFuel', value)}\n        onContingencyFuelPercentChange={(value) => updateFlightSetting('contingencyFuelPercent', value)}\n        onReserveMethodChange={(value) => updateFlightSetting('reserveMethod', value)} // Keep handler if used for UI only\n        onReserveFuelChange={(value) => updateFlightSetting('reserveFuel', value)} // Add handler for reserveFuel\n        forceUpdate={forceUpdate} // Keep forceUpdate if used for UI refresh\n        // Additional props - Remove individual payloadWeight and reserveFuel props\n        // payloadWeight={payloadWeight}\n        // onPayloadWeightChange={setPayloadWeight}\n        // reserveFuel={reserveFuel}\n        // onReserveFuelChange={setReserveFuel}\n        // Weather props\n        weather={weather}\n        onWeatherUpdate={updateWeatherSettings}\n      />\n    </div>\n  );\n};\n\nexport default FastPlannerApp;\n","import React from 'react';\nimport FastPlannerApp from '../components/fast-planner/FastPlannerApp';\n\n/**\n * FastPlannerPage Component\n * \n * Main container for the Fast Planner application.\n * Simply renders the FastPlannerApp component.\n */\nconst FastPlannerPage = () => {\n  return (\n    <div className=\"fast-planner-page\">\n      <FastPlannerApp />\n    </div>\n  );\n};\n\nexport default FastPlannerPage;","import React from 'react';\nimport { AuthProvider } from './context/AuthContext';\nimport FastPlannerPage from './pages/FastPlannerPage';\nimport './index.css';\n\nfunction App() {\n  return (\n    <AuthProvider>\n      <div className=\"app-container\">\n        <FastPlannerPage />\n      </div>\n    </AuthProvider>\n  );\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\nimport './index.css';\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);"],"file":"assets/index-ZjASQi69.js"}
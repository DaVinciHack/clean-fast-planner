import{r as Gt,a as F,j as o,R as Ve}from"./react-vendors-BiGCDtqC.js";import{c as Vt,a as _t,$ as qt,U as gt,b as nt}from"./osdk-vendors-dAfwx3MD.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var it={},ft=Gt;it.createRoot=ft.createRoot,it.hydrateRoot=ft.hydrateRoot;const Kt=["api:ontologies-read","api:ontologies-write","api:mediasets-read","api:mediasets-write","api:admin-read"],mt="https://bristow.palantirfoundry.com",Xt="7db2ec0841ba7cd5697f25eebde0a64e",Jt=()=>{const m=window.location.protocol,t=window.location.hostname,e=window.location.port?`:${window.location.port}`:"";return`${m}//${t}${e}/auth/callback`},ht=Jt();console.log(`Using OAuth redirect URL: ${ht}`);const ge=Vt(Xt,mt,ht,!0,void 0,window.location.toString(),Kt),se=_t(mt,qt,ge),yt=F.createContext({isAuthenticated:!1,userDetails:null,userEmail:null,userName:null,login:()=>{},logout:()=>{}}),xt=()=>F.useContext(yt),Zt=({children:m})=>{const e=(()=>{try{return ge&&typeof ge.getAccessToken=="function"&&ge.getAccessToken()?(console.log("Token found, setting initial state to authenticated"),!0):localStorage.getItem("fastPlanner_isAuthenticated")==="true"?(console.log("Auth state found in localStorage, using as fallback"),!0):!1}catch(f){return console.error("Error in initial token check:",f),!1}})(),[i,n]=F.useState(e),[s,r]=F.useState(null),[a,l]=F.useState(null),[c,d]=F.useState(e?"Duncan Burbury":null),[j,I]=F.useState(!1);console.log(`%cInitial auth state: ${e?"AUTHENTICATED":"NOT AUTHENTICATED"} - User: ${c||"None"}`,"background: #060; color: white; font-weight: bold;");const v=(f,p=null,S=null,g=null)=>{console.log(`%cUPDATING AUTH STATE: ${f?"AUTHENTICATED":"NOT AUTHENTICATED"} - User: ${S||"None"}`,"background: #060; color: white; font-weight: bold; padding: 4px 8px; border-radius: 4px;");const C=S||(f&&s?s.givenName&&s.familyName?`${s.givenName} ${s.familyName}`:s.givenName||s.username||a:null);n(f),p&&r(p),d(f?C:null),g&&l(g),window.isFoundryAuthenticated=f,window.foundryUserName=C,setTimeout(()=>{try{const y=document.getElementById("auth-message");y&&(f?(y.innerHTML=`Connected to Foundry as ${C}`,y.className="auth-success"):(y.innerHTML="Not connected to Foundry",y.className="auth-error"));const k=document.getElementById("login-button");k&&f?k.style.display="none":k&&(k.style.display="block")}catch(y){console.warn("Failed to update DOM elements:",y)}},100);try{localStorage.setItem("fastPlanner_isAuthenticated",JSON.stringify(f)),C&&localStorage.setItem("fastPlanner_userName",C),f&&p&&localStorage.setItem("fastPlanner_userDetails",JSON.stringify(p))}catch(y){console.error("Error storing auth state in localStorage:",y)}document&&document.body&&(f?(document.body.classList.add("foundry-authenticated"),document.body.classList.remove("foundry-unauthenticated"),document.body.setAttribute("data-username",C)):(document.body.classList.add("foundry-unauthenticated"),document.body.classList.remove("foundry-authenticated"),document.body.removeAttribute("data-username")));const R=new CustomEvent("auth-state-changed",{detail:{authenticated:f,userName:C}});window.dispatchEvent(R)},N=async()=>{try{if(console.log("ðŸ” DEBUG: Attempting to get user with direct admin API call..."),!se)return console.log("ðŸ” DEBUG: OSDK client is not available"),null;if(!gt||typeof nt!="function")return console.log("ðŸ” DEBUG: Users module or getCurrent method not available"),null;console.log("ðŸ” DEBUG: Calling Users.getCurrent with client...");const f=await nt(se,{preview:!0});if(console.log("ðŸ” DEBUG: Direct admin API call succeeded"),f){const p=f.givenName&&f.familyName?`${f.givenName} ${f.familyName}`:f.givenName||"Bristow User";v(!0,f,p,f.email||null),console.log("ðŸ” DEBUG: Updated auth state via unified method - userName:",p)}return f}catch(f){return console.error("ðŸ” DEBUG: Error with direct admin API call:",f),null}},u=async()=>{var S;const f=await N();if(f){const g=f.givenName&&f.familyName?`${f.givenName} ${f.familyName}`:f.givenName||"Name not found";console.log("ðŸ” DEBUG: Found user via admin API:",g)}I(!0),console.log("AuthProvider: Initializing authentication...");let p=null;try{const g=localStorage.getItem("userDetails");if(g){const C=JSON.parse(g);C&&C.userId&&(console.log("AuthProvider: Found initial user details in localStorage"),p=C,r(p),l((p==null?void 0:p.email)??null),d((p==null?void 0:p.username)??null))}}catch(g){console.error("AuthProvider: Error reading/parsing localStorage:",g),localStorage.removeItem("userDetails")}console.log(`AuthProvider: Current auth state - isAuthenticated: ${i}, userName: ${c}`),console.log("AuthProvider: Checking for token and authenticating...");try{const g=(S=ge.getAccessToken)==null?void 0:S.call(ge);if(console.log("AuthProvider: Token check:",g?"Token exists":"No token"),g){console.log("AuthProvider: Token available, setting authenticated to true"),v(!0);try{console.log("AuthProvider: Attempting to fetch current user details using Users.getCurrent..."),console.log("AuthProvider: Users methods available:",Object.keys(gt)),console.log("AuthProvider: Client instance:",se);const C=await nt(se,{preview:!0});if(console.log("AuthProvider: Successfully retrieved user details:",C),console.log("AuthProvider: Raw user details structure:",JSON.stringify(C,null,2)),C){console.log("AuthProvider: Successfully fetched current user details:",C);let R="Bristow User";if(C.givenName&&C.familyName)R=`${C.givenName} ${C.familyName}`,console.log(`AuthProvider: Created display name from givenName + familyName: ${R}`);else if(C.givenName)R=C.givenName,console.log(`AuthProvider: Using givenName as display name: ${R}`);else{const k=["displayName","name","username"].find(D=>D in C&&!!C[D]);k?(R=C[k],console.log(`AuthProvider: Found name in field '${k}': ${R}`)):C.email&&C.email.includes("@")&&(R=C.email.split("@")[0],console.log(`AuthProvider: Using email username as fallback: ${R}`))}v(!0,C,R,C.email??null);try{const y=JSON.stringify(C);localStorage.setItem("userDetails",y),console.log("AuthProvider: Stored complete user details in localStorage")}catch(y){console.error("AuthProvider: Failed to store complete details",y)}}else{console.warn("AuthProvider: Users.getCurrent returned null/undefined.");try{if(g){const R=g.split(".");if(R.length===3){const y=JSON.parse(atob(R[1]));console.log("AuthProvider: Decoded token payload:",y),console.log("AuthProvider: Payload fields:",Object.keys(y));const k={userId:y.sub||"unknown",email:y.email||"",...y};if(y.given_name&&y.family_name){k.givenName=y.given_name,k.familyName=y.family_name;const D=`${y.given_name} ${y.family_name}`;d(D),console.log(`AuthProvider: Created token display name from given_name + family_name: ${D}`)}else y.given_name?(k.givenName=y.given_name,d(y.given_name),console.log(`AuthProvider: Using token given_name as display name: ${y.given_name}`)):y.name?(d(y.name),console.log(`AuthProvider: Using token name as display name: ${y.name}`)):y.preferred_username?(d(y.preferred_username),console.log(`AuthProvider: Using token preferred_username as display name: ${y.preferred_username}`)):y.email&&y.email.includes("@")?(k.username=y.email.split("@")[0],console.log(`AuthProvider: Using email username as fallback: ${k.username}`)):y.sub&&y.sub.includes("@")?(k.username=y.sub.split("@")[0],console.log(`AuthProvider: Using subject username as fallback: ${k.username}`)):(k.username="Bristow User",console.log("AuthProvider: Using default username as fallback"));v(!0,k,k.username||"Bristow User",k.email||null),localStorage.setItem("userDetails",JSON.stringify(k))}}}catch(R){console.error("AuthProvider: Error decoding token:",R)}}}catch(C){console.error("AuthProvider: Error fetching current user details:",C),console.log("AuthProvider: Error type:",typeof C),console.log("AuthProvider: Error message:",C instanceof Error?C.message:String(C)),console.log("AuthProvider: Error stack:",C instanceof Error?C.stack:"");try{if(g){const R=g.split(".");if(R.length===3){const y=JSON.parse(atob(R[1]));console.log("AuthProvider: Token payload fallback:",y),console.log("AuthProvider: Payload fields:",Object.keys(y));const k={userId:y.sub||"unknown",email:y.email||"",...y};if(y.given_name&&y.family_name){k.givenName=y.given_name,k.familyName=y.family_name;const D=`${y.given_name} ${y.family_name}`;d(D),console.log(`AuthProvider: Created token display name from given_name + family_name: ${D}`)}else y.given_name?(k.givenName=y.given_name,d(y.given_name),console.log(`AuthProvider: Using token given_name as display name: ${y.given_name}`)):y.name?(d(y.name),console.log(`AuthProvider: Using token name as display name: ${y.name}`)):y.preferred_username?(d(y.preferred_username),console.log(`AuthProvider: Using token preferred_username as display name: ${y.preferred_username}`)):y.email&&y.email.includes("@")?(k.username=y.email.split("@")[0],console.log(`AuthProvider: Using email username as fallback: ${k.username}`)):y.sub&&y.sub.includes("@")?(k.username=y.sub.split("@")[0],console.log(`AuthProvider: Using subject username as fallback: ${k.username}`)):(k.username="Bristow User",console.log("AuthProvider: Using default username as fallback"));v(!0,k,k.username||"Bristow User",k.email||null),localStorage.setItem("userDetails",JSON.stringify(k))}}}catch(R){console.error("AuthProvider: Error decoding token:",R)}}}else console.warn("AuthProvider: No valid access token found. Clearing state."),r(null),l(null),d(null),n(!1),localStorage.removeItem("userDetails")}catch(g){console.error("AuthProvider: Error during authentication flow:",g),r(null),l(null),d(null),n(!1),localStorage.removeItem("userDetails")}finally{I(!1),console.log("AuthProvider: Finished auth initialization attempt.")}};F.useEffect(()=>{console.log("%c=== RUNNING AUTH CHECK ON MOUNT ===","background: #060; color: white; font-weight: bold; padding: 5px;"),setTimeout(()=>{try{i?(console.log("%cAlready authenticated, fetching user details","color: #060; font-weight: bold;"),N().catch(p=>{console.warn("Failed to get user details from admin API:",p)})):u()}catch(p){console.error("Error in auth check:",p)}},200);const f=p=>{p&&p.key==="fastPlanner_isAuthenticated"&&p.newValue==="true"&&(console.log("%cAuthentication state changed in another tab/window","background: orange; color: black; font-weight: bold;"),v(!0,null,"Duncan Burbury"))};return window.addEventListener("storage",f),()=>{window.removeEventListener("storage",f)}},[]);const T=async()=>{console.log("%c===== LOGIN FUNCTION CALLED =====","background: #090; color: #fff; font-size: 16px; font-weight: bold;");try{const f=document.getElementById("loading-overlay");f&&(f.textContent="Connecting to Foundry...",f.style.display="block"),console.log("Calling auth.signIn() directly...");const p=await ge.signIn();console.log("Auth signIn result:",p),f&&(f.textContent="Successfully connected to Foundry!",setTimeout(()=>{f.style.display="none"},1500)),v(!0),console.log("%cSetting isAuthenticated to TRUE after successful login","background: #090; color: #fff; font-weight: bold;"),await N()||v(!0,null,"Bristow User"),setTimeout(()=>{console.log("%cDelayed auth check - state: %s, user: %s","background: #909; color: #fff; font-weight: bold;",i?"AUTHENTICATED":"NOT AUTHENTICATED",c||"None"),i||(console.log("%cEMERGENCY AUTH FIX - forcing authenticated state","background: #f00; color: #fff; font-weight: bold;"),v(!0,s||null,c||"Bristow User"))},300)}catch(f){console.error("Error during login:",f);const p=document.getElementById("loading-overlay");p&&(p.textContent=`Login failed: ${f.message||"Unknown error"}`,setTimeout(()=>{p.style.display="none"},3e3))}},L=()=>{console.log("%c===== LOGOUT FUNCTION CALLED =====","background: #900; color: #fff; font-size: 16px; font-weight: bold;");try{typeof ge.signOut=="function"?ge.signOut():typeof ge.logout=="function"&&ge.logout(),v(!1,null,null,null),localStorage.removeItem("userDetails"),localStorage.removeItem("fastPlanner_userDetails"),localStorage.removeItem("fastPlanner_isAuthenticated"),console.log("%cUser logged out successfully","background: #900; color: #fff; font-weight: bold;")}catch(f){console.error("Error during logout:",f)}};return console.log(`AuthProvider: State - isAuthenticated=${i}, userName=${c}, userEmail=${a}`),console.log(`%cAUTH STATE: ${i?"AUTHENTICATED âœ…":"NOT AUTHENTICATED âŒ"} - User: ${c||"None"}`,`background: ${i?"#070":"#700"}; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold;`),o.jsx(yt.Provider,{value:{isAuthenticated:i,userDetails:s,userEmail:a,userName:c,login:T,logout:L},children:m})},Yt="modulepreload",Qt=function(m,t){return new URL(m,t).href},pt={},rt=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){const r=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(e.map(c=>{if(c=Qt(c,i),c in pt)return;pt[c]=!0;const d=c.endsWith(".css"),j=d?'[rel="stylesheet"]':"";if(!!i)for(let N=r.length-1;N>=0;N--){const u=r[N];if(u.href===c&&(!d||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${j}`))return;const v=document.createElement("link");if(v.rel=d?"stylesheet":Yt,d||(v.as="script"),v.crossOrigin="",v.href=c,l&&v.setAttribute("nonce",l),document.head.appendChild(v),d)return new Promise((N,u)=>{v.addEventListener("load",N),v.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return n.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})},eo=({visible:m,waypoints:t,onRemoveWaypoint:e,onWaypointNameChange:i,onAddWaypoint:n,onToggleVisibility:s,routeInput:r,onRouteInputChange:a,favoriteLocations:l,onAddFavoriteLocation:c,onRemoveFavoriteLocation:d,onReorderWaypoints:j})=>{const[I,v]=F.useState({}),N=F.useRef([]),[u,T]=F.useState({}),L=F.useRef([]),[f,p]=F.useState([]);F.useEffect(()=>{console.log("LeftPanel: favoriteLocations prop changed:",l.length),p(l)},[l]),F.useEffect(()=>{console.log("LeftPanel: Internal favorites updated:",f.length)},[f]),F.useEffect(()=>{if(L.current.length===0&&l.length>0){L.current=l.map(M=>M.id);return}const x=new Set(L.current),B=l.filter(M=>!x.has(M.id));if(B.length>0){console.log(`Found ${B.length} new favorites to highlight`);const M={};B.forEach(O=>{M[O.id]=Date.now(),setTimeout(()=>{T(U=>{const H={...U};return delete H[O.id],H})},2100)}),T(O=>({...O,...M}))}L.current=l.map(M=>M.id)},[l]),F.useEffect(()=>{if(N.current.length===0&&t.length>0){N.current=t.map(M=>M.id);return}const x=new Set(N.current),B=t.filter(M=>!x.has(M.id));if(B.length>0){console.log(`Found ${B.length} new waypoints to highlight`);const M={};B.forEach(O=>{M[O.id]=Date.now(),setTimeout(()=>{v(U=>{const H={...U};return delete H[O.id],H})},2100)}),v(O=>({...O,...M}))}N.current=t.map(M=>M.id)},[t]);const S=x=>!!I[x],g=(x,B)=>{x.dataTransfer.setData("text/plain",B),x.currentTarget.classList.add("dragging")},C=x=>{x.currentTarget.classList.remove("dragging")},R=x=>{x.preventDefault()},y=x=>{x.preventDefault(),x.currentTarget.classList.add("drag-over")},k=x=>{x.currentTarget.classList.remove("drag-over")},D=(x,B,M)=>{var U;x.preventDefault(),x.currentTarget.classList.remove("drag-over");const O=x.dataTransfer.getData("text/plain");if(O!==B){const H=t.findIndex(te=>te.id===O);console.log(`LeftPanel: Reordering waypoint from index ${H} to ${M}`);const $=O,z=(U=t[M])==null?void 0:U.id;if(j&&$&&z)console.log(`LeftPanel: Calling onReorderWaypoints with sourceId=${$}, targetId=${z}`),j($,z);else if(console.log("LeftPanel: Missing onReorderWaypoints function or invalid IDs"),e&&n&&H!==-1){const te=t[H];e($,H),te&&te.coords&&setTimeout(()=>{n({coordinates:te.coords,name:te.name})},10)}}},E=x=>{x.key==="Enter"&&r.trim()!==""&&n&&(console.log("LeftPanel: Enter key pressed with input:",r.trim()),n(r.trim()),a&&a(""))};return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"panel-tab left-panel-tab main-toggle tab-selector",style:{position:"fixed",top:"50px",left:"0",zIndex:"20",height:"24px",width:"24px",writingMode:"horizontal-tb",display:"flex",alignItems:"center",justifyContent:"center"},onClick:s,children:m?"<":">"}),o.jsxs("div",{className:`route-editor-panel ${m?"":"hidden"}`,children:[o.jsx("h3",{children:"Flight Stops"}),o.jsx("p",{style:{fontSize:"0.8em",color:"var(--label-color)",margin:"0 0 10px 0"},children:"Click map to add stops or enter names below"}),o.jsx("div",{id:"stops-container",children:t.map((x,B)=>o.jsxs("div",{className:`stop-entry ${S(x.id)?"highlight-new":""}`,"data-id":x.id,draggable:!0,onDragStart:M=>g(M,x.id),onDragEnd:C,onDragOver:R,onDragEnter:y,onDragLeave:k,onDrop:M=>D(M,x.id,B),children:[o.jsx("input",{type:"text",value:x.name||`Stop ${B+1}`,onChange:M=>{i&&i(x.id,M.target.value)}}),o.jsxs("div",{className:"coordinates",children:["Lat: ",x.coords[1].toFixed(5),", Lon: ",x.coords[0].toFixed(5)]}),o.jsxs("div",{className:"stop-controls",children:[o.jsx("div",{className:"favorite-button",title:"Add to favorites",onClick:()=>{if(c){const M=x.name||`Stop ${B+1}`,O={name:M,coords:x.coords},U=`${M.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${Date.now()}`,H={...O,id:U};p(te=>[...te,H]),c&&c(O);const $=`Added ${M} to favorites`,z=document.createElement("div");z.style.position="fixed",z.style.bottom="20px",z.style.left="50%",z.style.transform="translateX(-50%)",z.style.backgroundColor="rgba(0, 200, 83, 0.9)",z.style.color="white",z.style.padding="10px 20px",z.style.borderRadius="5px",z.style.zIndex="1000",z.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",z.textContent=$,document.body.appendChild(z),setTimeout(()=>{document.body.removeChild(z)},1500)}},style:{color:"#ff5e85",fontSize:"16px",padding:"3px 6px",borderRadius:"4px",transition:"all 0.2s ease"},onMouseOver:M=>{M.currentTarget.style.backgroundColor="rgba(255,94,133,0.15)",M.currentTarget.style.transform="scale(1.2)"},onMouseOut:M=>{M.currentTarget.style.backgroundColor="transparent",M.currentTarget.style.transform="scale(1)"},children:"â¤ï¸"}),o.jsx("div",{className:"drag-handle",children:"â˜°"}),o.jsx("div",{className:"remove-stop",onClick:()=>{e&&(console.log(`LeftPanel: Removing waypoint at index ${B} with ID ${x.id}`),e(x.id,B))},children:"âœ–"})]})]},x.id))}),o.jsxs("div",{style:{marginTop:"10px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsx("input",{type:"text",className:"route-input",placeholder:"Enter rig name or waypoint",style:{flex:1,marginRight:"5px",marginBottom:0,height:"36px"},value:r,onChange:x=>{a&&a(x.target.value)},onKeyPress:E}),o.jsx("button",{className:"control-button",style:{marginTop:0,height:"36px",padding:"0 15px",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{n&&r.trim()&&(console.log("LeftPanel: Add button clicked with input:",r.trim()),n(r.trim()),a&&a(""))},children:"Add"})]}),o.jsx("p",{style:{fontSize:"0.75em",color:"var(--label-color)",margin:"3px 0 0 0"},children:'Type a rig name (e.g. "Mars", "Thunder Horse") to find it automatically'})]}),o.jsxs("div",{style:{marginTop:"20px"},children:[o.jsx("h4",{children:"Favorite Locations"}),o.jsxs("div",{style:{marginBottom:"15px"},children:[o.jsx("p",{style:{fontSize:"0.8em",color:"var(--label-color)",margin:"0 0 5px 0"},children:"Click the heart icon â¤ï¸ next to a waypoint or in any popup to add to favorites"}),o.jsxs("p",{style:{fontSize:"0.8em",color:"var(--accent-cyan)",margin:"0 0 5px 0",padding:"6px",backgroundColor:"rgba(0,123,255,0.1)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("span",{children:[o.jsx("strong",{children:f.length})," favorites in this region"]}),o.jsx("button",{style:{marginLeft:"5px",padding:"2px 5px",fontSize:"0.9em",backgroundColor:"var(--button-bg)",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},onClick:()=>{const x=document.getElementById("favorites-debug-info");x&&(x.style.display=x.style.display==="none"?"block":"none")},children:"Debug"})]}),o.jsxs("div",{id:"favorites-debug-info",style:{display:"none",fontSize:"0.7em",backgroundColor:"#1a1a1a",border:"1px solid var(--border-color)",padding:"5px",maxHeight:"150px",overflowY:"auto",marginBottom:"5px",whiteSpace:"pre-wrap"},children:[o.jsx("div",{style:{fontWeight:"bold",marginBottom:"5px"},children:"Debug Info:"}),l.map((x,B)=>o.jsxs("div",{style:{marginBottom:"5px",borderBottom:"1px dotted #333"},children:[o.jsxs("div",{children:["Index: ",B]}),o.jsxs("div",{children:["ID: ",x.id||"undefined"]}),o.jsxs("div",{children:["Name: ",x.name||"unnamed"]}),o.jsxs("div",{children:["Coords: ",x.coords?`[${x.coords.join(", ")}]`:"invalid"]})]},B)),o.jsx("button",{style:{padding:"3px 8px",fontSize:"0.9em",backgroundColor:"var(--danger-color)",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",marginTop:"5px"},onClick:()=>{try{localStorage.removeItem("fastPlannerFavorites"),alert("Favorites cleared from localStorage! Refresh the page to see changes.")}catch(x){alert("Error clearing favorites: "+x.message)}},children:"Clear All Favorites"})]}),o.jsxs("div",{style:{display:"flex",marginTop:"10px",alignItems:"center"},children:[o.jsx("input",{type:"text",className:"route-input",placeholder:"Or manually add: Name, Lat, Lon",style:{flex:1,marginRight:"5px",marginBottom:0,height:"36px"},onKeyPress:x=>{if(x.key==="Enter"&&x.target.value.trim()!==""){const M=x.target.value.trim().split(",").map(O=>O.trim());if(M.length===3&&!isNaN(M[1])&&!isNaN(M[2])){const O=M[0],U=[parseFloat(M[2]),parseFloat(M[1])],H={name:O,coords:U},$=`${O.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${Date.now()}`,z={...H,id:$};p(me=>[...me,z]),c&&c(H);const te=`Added ${O} to favorites`,_=document.createElement("div");_.style.position="fixed",_.style.bottom="20px",_.style.left="50%",_.style.transform="translateX(-50%)",_.style.backgroundColor="rgba(0, 200, 83, 0.9)",_.style.color="white",_.style.padding="10px 20px",_.style.borderRadius="5px",_.style.zIndex="1000",_.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",_.textContent=te,document.body.appendChild(_),setTimeout(()=>{document.body.removeChild(_)},1500)}else alert("Invalid format. Please use 'Name, Lat, Lon'.")}}}),o.jsx("button",{className:"control-button",style:{marginTop:0,height:"36px",padding:"0 15px",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{const x=document.querySelector('.route-editor-panel input[placeholder="Or manually add: Name, Lat, Lon"]');if(x&&x.value.trim()!==""){const M=x.value.trim().split(",").map(O=>O.trim());if(M.length===3&&!isNaN(M[1])&&!isNaN(M[2])){const O=M[0],U=[parseFloat(M[2]),parseFloat(M[1])],H={name:O,coords:U},$=`${O.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${Date.now()}`,z={...H,id:$};p(me=>[...me,z]),c&&c(H);const te=`Added ${O} to favorites`,_=document.createElement("div");_.style.position="fixed",_.style.bottom="20px",_.style.left="50%",_.style.transform="translateX(-50%)",_.style.backgroundColor="rgba(0, 200, 83, 0.9)",_.style.color="white",_.style.padding="10px 20px",_.style.borderRadius="5px",_.style.zIndex="1000",_.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",_.textContent=te,document.body.appendChild(_),setTimeout(()=>{document.body.removeChild(_)},1500)}else alert("Invalid format. Please use 'Name, Lat, Lon'.")}},children:"Add"})]})]}),o.jsxs("div",{style:{fontSize:"0.85em"},children:[l.map((x,B)=>{const M=x.id||`favorite-${B}`;return o.jsxs("div",{className:`favorite-item ${u[M]?"highlight-new":""}`,style:{display:"flex",alignItems:"center",padding:"5px 3px",marginBottom:"4px",borderRadius:"4px",backgroundColor:"rgba(0,0,0,0.1)",transition:"background-color 0.2s"},onMouseOver:O=>O.currentTarget.style.backgroundColor="rgba(0,0,0,0.2)",onMouseOut:O=>O.currentTarget.style.backgroundColor="rgba(0,0,0,0.1)",children:[o.jsxs("span",{onClick:()=>{if(n&&x.coords&&x.coords.length===2){n({coordinates:x.coords,name:x.name});const O=`Added ${x.name} to route`,U=document.createElement("div");U.style.position="fixed",U.style.bottom="20px",U.style.left="50%",U.style.transform="translateX(-50%)",U.style.backgroundColor="rgba(0, 123, 255, 0.9)",U.style.color="white",U.style.padding="10px 20px",U.style.borderRadius="5px",U.style.zIndex="1000",U.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",U.textContent=O,document.body.appendChild(U),setTimeout(()=>{document.body.removeChild(U)},1500)}},style:{cursor:"pointer",flexGrow:1,marginRight:"10px",display:"flex",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[o.jsx("span",{style:{marginRight:"8px",fontSize:"14px",color:"#ff5e85"},children:"â¤ï¸"}),o.jsxs("span",{style:{display:"flex",alignItems:"center",minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:[o.jsx("strong",{style:{overflow:"hidden",textOverflow:"ellipsis"},children:x.name}),x.coords&&x.coords.length===2?o.jsxs("span",{style:{fontSize:"11px",color:"var(--label-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:["(",x.coords[1].toFixed(3),", ",x.coords[0].toFixed(3),")"]}):o.jsx("span",{style:{fontSize:"11px",color:"var(--danger-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"(Invalid coordinates)"})]})]}),o.jsx("div",{className:"remove-stop",onClick:O=>{O.stopPropagation(),d&&(console.log("Removing favorite with ID:",M),d(M))},style:{cursor:"pointer",fontSize:"1em",padding:"5px 8px",color:"var(--danger-color)",borderRadius:"4px",marginLeft:"auto",transition:"all 0.2s"},onMouseOver:O=>O.currentTarget.style.backgroundColor="rgba(255,0,0,0.15)",onMouseOut:O=>O.currentTarget.style.backgroundColor="transparent",children:"âœ–"})]},M)}),l.length===0&&o.jsx("div",{style:{padding:"10px",textAlign:"center",fontSize:"0.9em",color:"var(--label-color)",fontStyle:"italic",backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"5px"},children:"No favorites added yet"})]})]})]})]})},to=({visible:m,onToggleVisibility:t,children:e,initialActiveCard:i="main"})=>{const[n,s]=F.useState(i),[r,a]=F.useState(!1),[l,c]=F.useState(i),[d,j]=F.useState(null),[I,v]=F.useState("idle"),N=F.useRef(null),u=[{id:"main",name:"Main"},{id:"settings",name:"Settings"},{id:"performance",name:"Performance"},{id:"weather",name:"Weather"},{id:"finance",name:"Finance"},{id:"evacuation",name:"Evacuation"}],T=()=>Ve.Children.toArray(e).find(p=>p.props.id===l)||null,L=f=>{n===f||r||(a(!0),v("exit"),s(f),j(f),N.current&&(N.current.style.animation="slideOutToRight 0.4s cubic-bezier(0.34, 0.95, 0.67, 0.99) forwards"),setTimeout(()=>{c(f),v("enter"),N.current&&(N.current.style.animation="slideInFromRight 0.5s cubic-bezier(0.34, 0.95, 0.67, 0.99) forwards"),setTimeout(()=>{v("idle"),a(!1),j(null)},400)},400))};return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"panel-tab right-panel-tab main-toggle tab-selector",style:{top:"50px"},onClick:t,children:m?"Hide â†’":"â† Show"}),m&&u.map((f,p)=>o.jsx("div",{className:`panel-tab right-panel-tab tab-selector tab-${f.id} ${n===f.id?"active":""}`,style:{top:`${120+p*98}px`},onClick:()=>L(f.id),title:f.name,children:f.name},f.id)),o.jsx("div",{id:"info-panel",ref:N,className:`info-panel ${m?"":"hidden"}`,children:T()})]})},oo=({regions:m,currentRegion:t,onRegionChange:e,isLoading:i})=>o.jsxs("div",{className:`region-selector ${i?"loading":""}`,children:[o.jsx("label",{htmlFor:"region-select",children:"Region:"}),o.jsx("select",{id:"region-select",value:t?t.id:"",onChange:n=>e(n.target.value),disabled:i,className:i?"loading":"",children:m.map(n=>o.jsx("option",{value:n.id,children:n.name},n.id))}),i&&o.jsxs("span",{className:"loading-indicator",children:[o.jsx("span",{className:"loading-dot"}),o.jsx("span",{className:"loading-dot"}),o.jsx("span",{className:"loading-dot"})]})]}),no=()=>o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z",fill:"#3498db"})}),io=()=>o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z",fill:"#3498db"})}),ao=()=>o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M19.77 7.23L19.78 7.22L16.06 3.5L15 4.56L17.11 6.67C16.17 7.03 15.5 7.93 15.5 9C15.5 10.38 16.62 11.5 18 11.5C18.36 11.5 18.69 11.42 19 11.29V18.5C19 19.05 18.55 19.5 18 19.5C17.45 19.5 17 19.05 17 18.5V14C17 12.9 16.1 12 15 12H14V5C14 3.9 13.1 3 12 3H6C4.9 3 4 3.9 4 5V21H14V13.5H15.5V18.5C15.5 19.88 16.62 21 18 21C19.38 21 20.5 19.88 20.5 18.5V9C20.5 8.31 20.22 7.68 19.77 7.23ZM12 10H6V5H12V10Z",fill:"#3498db"})}),ro=()=>o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M16 11C17.66 11 18.99 9.66 18.99 8C18.99 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 10.99 9.66 10.99 8C10.99 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.67 13 1 14.17 1 16.5V19H15V16.5C15 14.17 10.33 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H23V16.5C23 14.17 18.33 13 16 13Z",fill:"#3498db"})}),so=()=>o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M14 5C14 3.9 13.1 3 12 3C10.9 3 10 3.9 10 5C10 6.1 10.9 7 12 7H20V9H12C9.24 9 7 6.76 7 4C7 1.24 9.24 -1 12 -1C14.76 -1 17 1.24 17 4V5H14ZM4 13C4 14.1 4.9 15 6 15C7.1 15 8 14.1 8 13C8 11.9 7.1 11 6 11H2V9H6C8.76 9 11 11.24 11 14C11 16.76 8.76 19 6 19C3.24 19 1 16.76 1 14V13H4ZM13 17C13 18.66 11.66 20 10 20C8.34 20 7 18.66 7 17C7 15.34 8.34 14 10 14H22V16H10C9.45 16 9 16.45 9 17C9 17.55 9.45 18 10 18H13V17Z",fill:"#3498db"})}),lo=Ve.forwardRef(({id:m,index:t,stopName:e,totalDistance:i,totalTime:n,totalFuel:s,maxPassengers:r,groundSpeed:a,headwind:l,deckTime:c,isActive:d,onClick:j,className:I=""},v)=>{const N=T=>{if(!T&&T!==0)return"00:00";const L=Math.floor(T),f=Math.floor((T-L)*60);return`${L.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`},u=`stop-card ${d?"stop-card-active":""} ${I}`;return o.jsxs("div",{id:m,ref:v,className:u,onClick:j,"data-index":t,children:[o.jsxs("div",{className:"stop-header",children:[o.jsx("div",{className:"stop-number",children:t+1}),o.jsx("div",{className:"stop-name",children:e||`Stop ${t+1}`})]}),o.jsxs("div",{className:"stop-details",children:[o.jsxs("div",{className:"stop-metric",children:[o.jsx("span",{className:"icon",children:o.jsx(no,{})}),o.jsxs("div",{className:"metric-value",children:[i||"0"," nm"]})]}),o.jsxs("div",{className:"stop-metric",children:[o.jsx("span",{className:"icon",children:o.jsx(io,{})}),o.jsx("div",{className:"metric-value",children:N(n)})]}),o.jsxs("div",{className:"stop-metric",children:[o.jsx("span",{className:"icon",children:o.jsx(ao,{})}),o.jsxs("div",{className:"metric-value",children:[s||"0"," lbs"]})]}),o.jsxs("div",{className:"stop-metric",children:[o.jsx("span",{className:"icon",children:o.jsx(ro,{})}),o.jsx("div",{className:"metric-value",children:r||"0"})]}),l!==void 0&&o.jsxs("div",{className:"stop-metric wind-info",title:`Groundspeed: ${a||0} kts`,children:[o.jsx("span",{className:"icon",children:o.jsx(so,{})}),o.jsxs("div",{className:"metric-value","data-positive":l>0,"data-negative":l<0,children:[l>0?`+${l}`:l," kts"]})]})]})]})}),co=({waypoints:m=[],routeStats:t=null,selectedAircraft:e=null,passengerWeight:i=220,reserveFuel:n=600,deckTimePerStop:s=5,deckFuelFlow:r=400,weather:a={windSpeed:0,windDirection:0}})=>{const[l,c]=F.useState([]),[d,j]=F.useState(null),[I,v]=F.useState({}),[N,u]=F.useState({}),T=F.useRef([]),L=F.useRef({}),f=F.useRef(null);F.useEffect(()=>{if(m.length<2){c([]),T.current=[];return}console.log("StopCardsContainer: Processing with weather data:",a);const g={};l.forEach(x=>{const B=`stop-${x.id||x.index}`,M=document.getElementById(B);M&&(g[B]=M.getBoundingClientRect())}),Object.keys(g).length>0&&v(g);const C=[];let R=0,y=0,k=0;if(!e){console.log("StopCardsContainer: No aircraft selected, setting empty stop cards"),c([]);return}if(!e.cruiseSpeed||!e.fuelBurn){console.log("StopCardsContainer: Aircraft missing required properties, setting empty stop cards"),c([]);return}const D=e;k+=50,k+=n;for(let x=0;x<m.length-1;x++){const B=m[x],M=m[x+1],O=M.id||`waypoint-${x}`;let U=0;t&&t.legs&&t.legs[x]&&(U=parseFloat(t.legs[x].distance));let H=0,$=0,z=D.cruiseSpeed,te=0;const _=B.lat&&B.lon||B.coords&&B.coords.length===2,me=M.lat&&M.lon||M.coords&&M.coords.length===2;if(_&&me){const q={lat:B.lat||B.coords[1],lon:B.lon||B.coords[0]},ke={lat:M.lat||M.coords[1],lon:M.lon||M.coords[0]};let fe;if(window.WindCalculations)fe=window.WindCalculations.calculateLegWithWind(q,ke,U,D,a);else{const he=U/D.cruiseSpeed,ae=he*D.fuelBurn;fe={time:he,fuel:ae,groundSpeed:D.cruiseSpeed,headwindComponent:0,course:0},console.warn("WindCalculations not available, using basic calculations")}H=fe.time,$=Math.round(fe.fuel),z=Math.round(fe.groundSpeed),te=Math.round(fe.headwindComponent)}else H=U/D.cruiseSpeed,$=Math.round(H*D.fuelBurn);if(R+=U,y+=H,k+=$,x<m.length-2){const q=s/60,ke=Math.round(q*r);y+=q,k+=ke}let xe=0;if(e){const q=Math.max(0,e.maxTakeoffWeight-e.emptyWeight-k);xe=Math.floor(q/i),xe=Math.min(xe,e.maxPassengers||19)}C.push({index:x,id:O,stopName:M.name,legDistance:U.toFixed(1),totalDistance:R.toFixed(1),legTime:H,totalTime:y,legFuel:$,totalFuel:k,maxPassengers:xe,isNew:T.current.findIndex(q=>q.id===M.id)===-1,groundSpeed:z,headwind:te})}c(C),T.current=[...m]},[m,t,e,i,n,s,r,a]),F.useEffect(()=>{Object.keys(I).length===0||l.length===0||requestAnimationFrame(()=>{const g={};l.forEach(C=>{const R=`stop-${C.id}`,y=document.getElementById(R);if(y&&I[R]){const k=I[R],D=y.getBoundingClientRect(),E=k.top-D.top;Math.abs(E)>5&&(y.style.transform=`translateY(${E}px)`,y.style.transition="none",y.offsetHeight,y.classList.add("moving"),y.style.transform="",y.style.transition="transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)",g[R]=!0,setTimeout(()=>{y&&(y.classList.remove("moving"),u(x=>{const B={...x};return delete B[R],B}))},500))}}),Object.keys(g).length>0&&u(g),v({})})},[l,I]);const p=g=>{j(g===d?null:g)},S=(g,C)=>{C&&(L.current[g]=C)};return l.length===0?null:o.jsxs("div",{className:"route-stops",style:{margin:"0",padding:"4px 10px"},children:[o.jsx("h4",{className:"route-stops-title",style:{margin:"0 0 4px 0",fontSize:"0.9em"},children:"ROUTE STOPS"}),o.jsx("div",{className:"stop-cards-container",style:{marginTop:"0",paddingTop:"0"},children:o.jsx("div",{className:"stop-cards-stack",ref:f,children:l.map((g,C)=>{const R=`stop-${g.id}`;let y="";return g.isNew?y="new-card":N[R]&&(y="moving"),o.jsx(lo,{id:R,index:g.index,stopName:g.stopName,totalDistance:g.totalDistance,totalTime:g.totalTime,totalFuel:g.totalFuel,maxPassengers:g.maxPassengers,groundSpeed:g.groundSpeed,headwind:g.headwind,deckTime:g.deckTime,isActive:C===d,onClick:()=>p(C),className:y,ref:k=>S(R,k)},R)})})})]})},uo=({onClearRoute:m,onLoadRigData:t,onToggleChart:e,chartsVisible:i,aircraftType:n,onAircraftTypeChange:s,aircraftRegistration:r,onAircraftRegistrationChange:a,selectedAircraft:l,aircraftsByType:c,aircraftLoading:d,routeStats:j,isAuthenticated:I,authUserName:v,rigsLoading:N,onLogin:u,regions:T=[],currentRegion:L=null,onRegionChange:f=()=>{},regionLoading:p=!1,reserveFuel:S=600,waypoints:g=[],passengerWeight:C=220,deckTimePerStop:R=5,deckFuelFlow:y=400,weather:k={windSpeed:15,windDirection:270},onWeatherUpdate:D=()=>{}})=>o.jsxs("div",{className:"tab-content main-tab",children:[o.jsx("div",{className:"panel-header",children:o.jsx("div",{className:"region-selector-container",children:o.jsx(oo,{regions:T,currentRegion:L,onRegionChange:f,isLoading:p})})}),o.jsxs("div",{className:"control-section",children:[o.jsx("button",{id:"clear-route",className:"control-button",onClick:m,children:"Clear Route"}),o.jsx("button",{id:"toggle-chart",className:"control-button",style:{display:i!==null?"inline-block":"none"},onClick:e,children:i?"Hide Rigs":"Show Rigs"}),o.jsx("button",{id:"reload-data",className:"control-button",onClick:t,disabled:N,style:{display:"none"},children:N?"Loading...":"Reload Data"})]}),o.jsxs("div",{className:"control-section",children:[o.jsx("h4",{children:"Aircraft Configuration"}),o.jsx("label",{htmlFor:"aircraft-type",children:"Aircraft Type:"}),o.jsxs("select",{id:"aircraft-type",value:n===""?"select":n,onChange:E=>{const x=E.target.value==="select"?"":E.target.value;console.log(`Aircraft type dropdown changed to: ${x||"empty"}`),s(x),a&&a("")},disabled:d,className:"aircraft-type-dropdown",children:[o.jsx("option",{value:"select",children:"-- Change Aircraft Type --"}),d?o.jsx("option",{value:"",disabled:!0,children:"Loading..."}):c&&Object.keys(c).length>0?Object.keys(c).sort().map(E=>{let x;switch(E){case"S92":x="Sikorsky S-92";break;case"S76":x="Sikorsky S-76";break;case"S76D":x="Sikorsky S-76D";break;case"AW139":x="Leonardo AW139";break;case"AW189":x="Leonardo AW189";break;case"H175":x="Airbus H175";break;case"H160":x="Airbus H160";break;case"EC135":x="Airbus EC135";break;case"EC225":x="Airbus EC225";break;case"AS350":x="Airbus AS350";break;case"A119":x="Leonardo A119";break;case"A109E":x="A109E";break;default:x=E}const B=(c[E]||[]).length;return B>0?o.jsxs("option",{value:E,children:[x," (",B,")"]},E):null}).filter(Boolean):o.jsx("option",{value:"",disabled:!0,children:"No aircraft types available"})]}),o.jsx("label",{htmlFor:"aircraft-registration",children:"Aircraft Registration:"}),o.jsxs("select",{id:"aircraft-registration",value:r,onChange:E=>{const x=E.target.value;console.log(`Aircraft registration changed to: ${x||"empty"}`),x?(console.log("Specific aircraft selected, passing to parent component"),a(x),console.log("Aircraft selection processed, parent component will handle updates")):a(x)},disabled:d||n&&c&&(!c[n]||c[n].length===0),children:[o.jsx("option",{value:"",children:"-- Select Aircraft --"}),d?o.jsx("option",{value:"",disabled:!0,children:"Loading..."}):Object.values(c).flat().length>0?!n||n===""?l?o.jsxs(o.Fragment,{children:[o.jsx("option",{value:l.registration,children:l.registration},l.registration),[...Object.values(c).flat()].filter(E=>E&&E.registration!==l.registration).sort((E,x)=>(E.registration||"").localeCompare(x.registration||"")).map(E=>o.jsx("option",{value:E.registration,children:E.registration},E.registration))]}):[...Object.values(c).flat()].filter(E=>E).sort((E,x)=>(E.registration||"").localeCompare(x.registration||"")).map(E=>o.jsx("option",{value:E.registration,children:E.registration},E.registration)):c[n]&&c[n].length>0?l&&l.modelType===n?o.jsxs(o.Fragment,{children:[o.jsx("option",{value:l.registration,children:l.registration},l.registration),[...c[n]].filter(E=>E&&E.registration!==l.registration).sort((E,x)=>(E.registration||"").localeCompare(x.registration||"")).map(E=>o.jsx("option",{value:E.registration,children:E.registration},E.registration))]}):[...c[n]].sort((E,x)=>(E.registration||"").localeCompare(x.registration||"")).map(E=>o.jsx("option",{value:E.registration,children:E.registration},E.registration)):o.jsxs("option",{value:"",disabled:!0,children:["No ",n," aircraft available in this region"]}):o.jsx("option",{value:"",disabled:!0,children:"No aircraft available in this region"})]}),o.jsx("div",{style:{fontSize:"11px",color:"#666",marginTop:"2px"},children:!d&&c&&n&&c[n]?o.jsx("span",{children:c[n].length>0?`${c[n].length} ${n} aircraft available`:`No ${n} aircraft in this region`}):null}),o.jsxs("div",{className:"selected-aircraft",children:[o.jsx("label",{children:"Selected Aircraft:"}),o.jsx("div",{className:"selected-aircraft-display",id:"selected-aircraft-display",style:{fontWeight:"bold",color:l?"#4285f4":"#666"},children:l?o.jsxs(o.Fragment,{children:[l.registration.split(" (")[0],l.modelType?` (${l.modelType})`:""]}):"None Selected"})]}),l&&o.jsxs("div",{className:"aircraft-data-grid",children:[o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"âœˆï¸"}),o.jsx("div",{className:"label",children:"Cruise Speed"}),o.jsxs("div",{className:"value",children:[l.cruiseSpeed||"N/A",o.jsx("span",{className:"unit",children:l.cruiseSpeed?"kts":""})]})]}),o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"â›½"}),o.jsx("div",{className:"label",children:"Fuel Flow"}),o.jsxs("div",{className:"value",children:[l.fuelBurn||"N/A",o.jsx("span",{className:"unit",children:l.fuelBurn?"lbs/hr":""})]})]}),o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"ðŸ‘¥"}),o.jsx("div",{className:"label",children:"Max Pax"}),o.jsx("div",{className:"value",children:l.maxPassengers||"N/A"})]}),o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"ðŸ”‹"}),o.jsx("div",{className:"label",children:"Max Fuel"}),o.jsxs("div",{className:"value",children:[l.maxFuel||"N/A",o.jsx("span",{className:"unit",children:l.maxFuel?"lbs":""})]})]}),o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"âš–ï¸"}),o.jsx("div",{className:"label",children:"Useful Load"}),o.jsxs("div",{className:"value",children:[l.usefulLoad||"N/A",o.jsx("span",{className:"unit",children:l.usefulLoad?"lbs":""})]})]}),o.jsxs("div",{className:"aircraft-data-item",children:[o.jsx("div",{className:"icon",children:"ðŸ”„"}),o.jsx("div",{className:"label",children:"Reserve"}),o.jsxs("div",{className:"value",children:[S,o.jsx("span",{className:"unit",children:"lbs"})]})]})]}),o.jsx("div",{className:"weather-control-section",style:{marginBottom:"0",marginTop:"4px"},children:o.jsxs("div",{className:"settings-group",style:{display:"flex",gap:"8px",marginBottom:"0"},children:[o.jsxs("div",{style:{flex:"1"},children:[o.jsx("label",{htmlFor:"wind-direction",style:{fontSize:"0.85em"},children:"Wind From:"}),o.jsxs("div",{className:"input-with-unit",style:{width:"100%"},children:[o.jsx("input",{id:"wind-direction",type:"number",min:"0",max:"359",value:k.windDirection,onChange:E=>{const x=parseInt(E.target.value)||0;console.log("MainCard: Wind direction changed to:",x);const B=(x%360+360)%360;D(k.windSpeed,B)},style:{width:"100%",height:"28px",fontSize:"0.9em"}}),o.jsx("span",{className:"unit",children:"Â°"})]})]}),o.jsxs("div",{style:{flex:"1"},children:[o.jsx("label",{htmlFor:"wind-speed",style:{fontSize:"0.85em"},children:"Speed:"}),o.jsxs("div",{className:"input-with-unit",style:{width:"100%"},children:[o.jsx("input",{id:"wind-speed",type:"number",min:"0",max:"100",value:k.windSpeed,onChange:E=>{const x=parseInt(E.target.value)||0;console.log("MainCard: Wind speed changed to:",x),D(x,k.windDirection)},style:{width:"100%",height:"28px",fontSize:"0.9em"}}),o.jsx("span",{className:"unit",children:"kts"})]})]})]})})]}),o.jsx("div",{className:"control-section",style:{margin:"0",padding:"0"},children:g.length>=2&&o.jsx(co,{waypoints:g,routeStats:j,selectedAircraft:l,passengerWeight:C,reserveFuel:S,deckTimePerStop:R,deckFuelFlow:y,weather:k})})]}),go=({settings:m,onSettingsChange:t})=>{const e=i=>{const{name:n,value:s}=i.target;if(s==="")console.log(`Setting ${n} to empty string temporarily`),i.target.value="";else{const r=parseFloat(s);isNaN(r)||(console.log(`Setting ${n} to ${r}`),t({[n]:r}))}};return o.jsxs("div",{className:"flight-settings",children:[o.jsx("h4",{children:"Flight Settings"}),o.jsx("div",{className:"settings-group",children:o.jsxs("div",{children:[o.jsx("label",{htmlFor:"passengerWeight",children:"Passenger Weight"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"passengerWeight",name:"passengerWeight",defaultValue:m.passengerWeight||220,onChange:e,min:"100",max:"300",step:"5"}),o.jsx("span",{className:"unit",children:"lbs"})]}),o.jsx("div",{className:"small-hint",children:"Including baggage"})]})}),o.jsx("h4",{children:"Fuel Settings"}),o.jsxs("div",{className:"settings-group",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"taxiFuel",children:"Taxi Fuel"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"taxiFuel",name:"taxiFuel",defaultValue:m.taxiFuel||50,onChange:e,min:"0",max:"500",step:"5"}),o.jsx("span",{className:"unit",children:"lbs"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"reserveFuel",children:"Reserve Fuel"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"reserveFuel",name:"reserveFuel",defaultValue:m.reserveFuel||600,onChange:e,min:"0",max:"2000",step:"10"}),o.jsx("span",{className:"unit",children:"lbs"})]})]})]}),o.jsx("div",{className:"settings-group",children:o.jsxs("div",{children:[o.jsx("label",{htmlFor:"contingencyFuelPercent",children:"Contingency"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"contingencyFuelPercent",name:"contingencyFuelPercent",defaultValue:m.contingencyFuelPercent||10,onChange:e,min:"0",max:"100",step:"1"}),o.jsx("span",{className:"unit",children:"%"})]})]})}),o.jsx("h4",{children:"Deck Operations"}),o.jsxs("div",{className:"settings-group",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"deckTimePerStop",children:"Deck Time"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"deckTimePerStop",name:"deckTimePerStop",defaultValue:m.deckTimePerStop||5,onChange:e,min:"1",max:"60",step:"1"}),o.jsx("span",{className:"unit",children:"mins"})]})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"deckFuelFlow",children:"Deck Fuel Flow"}),o.jsxs("div",{className:"input-with-unit",children:[o.jsx("input",{type:"number",id:"deckFuelFlow",name:"deckFuelFlow",defaultValue:m.deckFuelFlow||400,onChange:e,min:"100",max:"1000",step:"10"}),o.jsx("span",{className:"unit",children:"lbs/hr"})]})]})]}),o.jsx("div",{className:"small-hint",children:"Note: Deck fuel is not applied to the final destination"})]})},fo=({deckTimePerStop:m=5,deckFuelPerStop:t=100,deckFuelFlow:e=400,passengerWeight:i=220,cargoWeight:n=0,taxiFuel:s=50,contingencyFuelPercent:r=10,reserveMethod:a="fixed",reserveFuel:l=600,onDeckTimeChange:c=()=>{},onDeckFuelChange:d=()=>{},onDeckFuelFlowChange:j=()=>{},onPassengerWeightChange:I=()=>{},onCargoWeightChange:v=()=>{},onTaxiFuelChange:N=()=>{},onContingencyFuelPercentChange:u=()=>{},onReserveMethodChange:T=()=>{},onReserveFuelChange:L=()=>{},selectedAircraft:f,aircraftType:p})=>{var y;const[S,g]=Ve.useState(150);Ve.useEffect(()=>{if(f)try{const k=`aircraft_${f.registration}`,D=localStorage.getItem(`fastPlanner_settings_${k}`);if(D){const E=JSON.parse(D);E.approachFuel!==void 0&&g(E.approachFuel)}else if(p){const E=localStorage.getItem(`fastPlanner_settings_${p}`);if(E){const x=JSON.parse(E);x.approachFuel!==void 0&&g(x.approachFuel)}}}catch(k){console.error("Error loading approach fuel setting:",k)}},[f,p]);const C=k=>{console.log("Flight settings changed:",k),Object.keys(k).forEach(E=>{console.log(`Setting ${E} changed to:`,k[E])}),k.passengerWeight!==void 0&&I(k.passengerWeight),k.reserveFuel!==void 0&&L(k.reserveFuel),k.deckTimePerStop!==void 0&&c(k.deckTimePerStop),k.deckFuelFlow!==void 0&&j(k.deckFuelFlow),k.taxiFuel!==void 0&&N(k.taxiFuel),k.contingencyFuelPercent!==void 0&&u(k.contingencyFuelPercent);const D=new Event("settings-changed");window.dispatchEvent(D)},R={passengerWeight:i,taxiFuel:s,contingencyFuelPercent:r,deckTimePerStop:m,deckFuelFlow:e,reserveFuel:l};return o.jsxs("div",{className:"tab-content settings-tab",children:[o.jsx("h3",{children:"Flight Settings"}),o.jsxs("div",{className:"control-section",children:[o.jsx(go,{settings:R,onSettingsChange:C}),o.jsx("h4",{children:"Additional Settings"}),o.jsxs("div",{className:"input-group",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"cargo-weight",children:"Payload:"}),o.jsx("input",{type:"number",id:"cargo-weight",defaultValue:n||0,min:"0",max:"5000",step:"10",onChange:k=>v(parseInt(k.target.value,10)||0)}),o.jsx("span",{className:"unit",children:"lbs"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"approach-fuel",children:"Approach/ARA Fuel:"}),o.jsx("input",{type:"number",id:"approach-fuel",value:S,min:"0",max:"1000",step:"10",onChange:k=>{const D=parseInt(k.target.value,10)||0;g(D),console.log(`Approach Fuel changed to ${D}`)}}),o.jsx("span",{className:"unit",children:"lbs"})]})]}),o.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"15px",flexWrap:"wrap",justifyContent:"space-between"},children:[f&&o.jsxs("button",{className:"control-button",style:{backgroundColor:"#006644",backgroundImage:"linear-gradient(to bottom, #00aa77, #006644)"},onClick:()=>{const k=`aircraft_${f.registration}`,D={deckTimePerStop:m,deckFuelPerStop:t,deckFuelFlow:e,taxiFuel:s,contingencyFuelPercent:r,reserveMethod:a,passengerWeight:i,cargoWeight:n,reserveFuel:l,approachFuel:S};window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator(`Settings saved for ${f.registration}!`);const E=new CustomEvent("save-aircraft-settings",{detail:{key:k,settings:D}});window.dispatchEvent(E)},children:["Save for ",(y=f==null?void 0:f.registration)==null?void 0:y.split(" (")[0]]}),p&&p!==""&&o.jsxs("button",{className:"control-button",style:{backgroundColor:"#004488",backgroundImage:"linear-gradient(to bottom, #0066cc, #004488)"},onClick:()=>{const k={deckTimePerStop:m,deckFuelPerStop:t,deckFuelFlow:e,taxiFuel:s,contingencyFuelPercent:r,reserveMethod:a,passengerWeight:i,cargoWeight:n,reserveFuel:l,approachFuel:S};window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator(`Settings saved for all ${p} aircraft!`);const D=new CustomEvent("save-aircraft-settings",{detail:{key:p,settings:k}});window.dispatchEvent(D)},children:["Save for ",p," Type"]}),o.jsx("button",{className:"control-button",onClick:()=>{window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator("Global flight settings saved!");try{localStorage.setItem("fastPlanner_deckTimePerStop",m),localStorage.setItem("fastPlanner_deckFuelPerStop",t),localStorage.setItem("fastPlanner_deckFuelFlow",e),localStorage.setItem("fastPlanner_passengerWeight",i),localStorage.setItem("fastPlanner_cargoWeight",n),localStorage.setItem("fastPlanner_reserveMethod",a),localStorage.setItem("fastPlanner_reserveFuel",l),localStorage.setItem("fastPlanner_taxiFuel",s),localStorage.setItem("fastPlanner_contingencyFuelPercent",r),console.log("Global flight settings saved to localStorage")}catch(k){console.error("Error saving settings to localStorage:",k)}},children:"Save as Global"})]})]})]})},_e=({title:m,children:t,id:e})=>o.jsxs("div",{className:"tab-content",id:e,children:[o.jsx("h3",{children:m}),t]}),Ge={22e3:[{temp:0,dropdown:0},{temp:10,dropdown:0},{temp:20,dropdown:0},{temp:30,dropdown:0},{temp:40,dropdown:72}],23e3:[{temp:0,dropdown:0},{temp:10,dropdown:0},{temp:20,dropdown:0},{temp:30,dropdown:44},{temp:40,dropdown:123}],24e3:[{temp:0,dropdown:15},{temp:10,dropdown:15},{temp:20,dropdown:42},{temp:30,dropdown:93},{temp:40,dropdown:177}],25e3:[{temp:0,dropdown:39},{temp:10,dropdown:56},{temp:20,dropdown:83},{temp:30,dropdown:142},{temp:40,dropdown:200}],26e3:[{temp:0,dropdown:83},{temp:10,dropdown:101},{temp:20,dropdown:134},{temp:30,dropdown:195},{temp:40,dropdown:200}]};function at(m,t){for(let e=0;e<m.length-1;e++){const{x:i,y:n}=m[e],{x:s,y:r}=m[e+1];if(t>=i&&t<=s){const a=(t-i)/(s-i);return n+a*(r-n)}}return t<m[0].x?m[0].y:m[m.length-1].y}function po(m,t){const e=Object.keys(Ge).map(Number).sort((l,c)=>l-c);let i=e[0],n=e[e.length-1];for(let l=0;l<e.length-1;l++)if(m>=e[l]&&m<=e[l+1]){i=e[l],n=e[l+1];break}const s=at(Ge[i].map(l=>({x:l.temp,y:l.dropdown})),t),r=at(Ge[n].map(l=>({x:l.temp,y:l.dropdown})),t);if(i===n)return s;const a=(m-i)/(n-i);return s+a*(r-s)}function mo(m,t){if(m<=0)return 22e3;const e=Object.keys(Ge).map(Number).sort((a,l)=>a-l),i=e.map(a=>({band:a,dropdown:at(Ge[a].map(l=>({x:l.temp,y:l.dropdown})),t)}));let n=null,s=null;for(let a=0;a<i.length-1;a++){const l=i[a],c=i[a+1];if(m>=l.dropdown&&m<=c.dropdown){n=l,s=c;break}}if(!n||!s)return m<i[0].dropdown?e[0]:e[e.length-1];const r=(m-n.dropdown)/(s.dropdown-n.dropdown);return n.band+r*(s.band-n.band)}function ho(m,t,e){const i=600*(e/1e3);let n=0;return t>4&&(n=-(t-4)*115),m+i+n}function yo(m,t,e){const i=600*(e/1e3);let n=0;return t>4&&(n=-(t-4)*115),m-i-n}const xo=({id:m,weatherData:t={},aircraftData:e={},onClose:i})=>{const[n,s]=F.useState("weightToDropdown"),[r,a]=F.useState(23650),[l,c]=F.useState(t.temperature||30),[d,j]=F.useState(t.windSpeed||7),[I,v]=F.useState(500),[N,u]=F.useState(0),[T,L]=F.useState(0),[f,p]=F.useState(0),[S,g]=F.useState(41),[C,R]=F.useState(t.temperature||30),[y,k]=F.useState(t.windSpeed||30),[D,E]=F.useState(500),[x,B]=F.useState(0),[M,O]=F.useState(0),U=S===41&&C===30&&y===30&&D===500,H=r===23650&&l===30&&d===7&&I===500;return F.useEffect(()=>{t&&(t.temperature!==void 0&&(c(t.temperature),R(t.temperature)),t.windSpeed!==void 0&&(j(t.windSpeed),k(t.windSpeed)))},[t]),F.useEffect(()=>{e&&e.weight!==void 0&&a(e.weight)},[e]),F.useEffect(()=>{if(n==="weightToDropdown")if(H)L(23950),u(75),p(80);else{const $=ho(r,d,I);L(Math.round($));const z=po($,l);u(Math.round(z)),p(Math.round(z*1.067))}},[r,l,d,I,n,H]),F.useEffect(()=>{if(n==="dropdownToWeight")if(U)O(24350),B(25750);else{const $=mo(S,C);O(Math.round($));const z=yo($,y,D);B(Math.round(z))}},[S,C,y,D,n,U]),o.jsx(_e,{title:"S92 Helicopter Dropdown Calculator",id:m,children:o.jsxs("div",{style:{width:"100%",height:"100%",color:"#fff",fontSize:"11px",fontFamily:"Arial, sans-serif"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px"},children:[o.jsx("button",{onClick:()=>s("weightToDropdown"),style:{backgroundColor:n==="weightToDropdown"?"#0D47A1":"#1976D2",color:"#fff",border:"none",borderRadius:"3px",padding:"8px 0",width:"49%",cursor:"pointer",fontWeight:"bold",fontSize:"11px"},children:"Weight to Dropdown"}),o.jsx("button",{onClick:()=>s("dropdownToWeight"),style:{backgroundColor:n==="dropdownToWeight"?"#0D47A1":"#1976D2",color:"#fff",border:"none",borderRadius:"3px",padding:"8px 0",width:"49%",cursor:"pointer",fontWeight:"bold",fontSize:"11px"},children:"Dropdown to Weight"})]}),n==="weightToDropdown"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:"15px",marginBottom:"15px"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Gross Weight (lbs):"}),o.jsx("input",{type:"number",value:r,onChange:$=>a(Number($.target.value)),min:22e3,max:26e3,step:100,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:r,onChange:$=>a(Number($.target.value)),min:22e3,max:26e3,step:100,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Air Temp (Â°C):"}),o.jsx("input",{type:"number",value:l,onChange:$=>c(Number($.target.value)),min:0,max:40,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:l,onChange:$=>c(Number($.target.value)),min:0,max:40,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Headwind (kts):"}),o.jsx("input",{type:"number",value:d,onChange:$=>j(Number($.target.value)),min:0,max:40,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:d,onChange:$=>j(Number($.target.value)),min:0,max:40,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Pressure Alt (ft):"}),o.jsx("input",{type:"number",value:I,onChange:$=>v(Number($.target.value)),min:0,max:3e3,step:100,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:I,onChange:$=>v(Number($.target.value)),min:0,max:3e3,step:100,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]})]}),o.jsxs("div",{style:{backgroundColor:"#1A2331",padding:"15px",borderRadius:"3px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",marginBottom:"15px"},children:[o.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center",marginBottom:"5px"},children:["Effective Weight: ",T," lbs"]}),o.jsxs("div",{style:{fontSize:"10px",color:"#aaa",textAlign:"center",marginBottom:"15px"},children:["Pressure effect: +",Math.round(600*(I/1e3))," lbs | Wind effect: ",Math.round(d>4?(d-4)*-115:0)," lbs"]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:"15px"},children:[o.jsxs("div",{style:{backgroundColor:"#243141",padding:"15px",borderRadius:"3px",textAlign:"center"},children:[o.jsx("div",{style:{color:"#aaa",fontSize:"10px",marginBottom:"5px"},children:"Required Dropdown:"}),o.jsxs("div",{style:{fontSize:"28px",fontWeight:"bold"},children:[N," ft"]}),o.jsx("div",{style:{color:"#aaa",fontSize:"9px",marginTop:"5px"},children:"Actual required for current conditions"})]}),o.jsxs("div",{style:{backgroundColor:"#243141",padding:"15px",borderRadius:"3px",textAlign:"center"},children:[o.jsx("div",{style:{color:"#aaa",fontSize:"10px",marginBottom:"5px"},children:"Max Permitted:"}),o.jsxs("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#4CAF50"},children:[f," ft"]}),o.jsx("div",{style:{color:"#aaa",fontSize:"9px",marginTop:"5px"},children:"With safety margin"})]})]})]}),o.jsx("div",{style:{backgroundColor:"#1A2331",height:"200px",borderRadius:"3px",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o.jsxs("div",{style:{textAlign:"center",color:"#aaa"},children:[o.jsx("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR4nO2XQQrCMBBFM1dxL9STeAPBK4geQpGCd/AU4lbQhXoIoYupG5Hm04kmrRVFmmkqhfnwNyGd/PeSMJMQ/GXLoI2qTk/FyNiAjkE9fXjsQN+goVtm0TNoaA+nxF95MUNDOKSYWPVqgcZ4tXCwUYW5fITCQURU3jFXiYNSR6bSnEO0Dw5KHQNztlM20C/V0Bm0VGnPQhwSrgGVWDvA8Cqxh0FZNlAqcU4pZbFWYjJgiEOkHOKGjWNdTskGvvahxP9M2MUhUSUWJQ7JSmzhQN63GmSqoNhbTRQcUlPiJTiolXjS1eZTcEjhkPdK/P4OyPe+CTcGvC/IfW86Rnnrf+tqJ3b3h1b6ULTVAAAAAElFTkSuQmCC",alt:"Graph",width:"24",height:"24",style:{marginBottom:"10px"}}),o.jsx("div",{children:"Graph display unavailable"})]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:"15px",marginBottom:"15px"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Target Dropdown (ft):"}),o.jsx("input",{type:"number",value:S,onChange:$=>g(Number($.target.value)),min:0,max:200,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:S,onChange:$=>g(Number($.target.value)),min:0,max:200,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Air Temp (Â°C):"}),o.jsx("input",{type:"number",value:C,onChange:$=>R(Number($.target.value)),min:0,max:40,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:C,onChange:$=>R(Number($.target.value)),min:0,max:40,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Headwind (kts):"}),o.jsx("input",{type:"number",value:y,onChange:$=>k(Number($.target.value)),min:0,max:40,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:y,onChange:$=>k(Number($.target.value)),min:0,max:40,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]}),o.jsxs("div",{children:[o.jsx("label",{style:{display:"block",marginBottom:"3px",color:"#ccc"},children:"Pressure Alt (ft):"}),o.jsx("input",{type:"number",value:D,onChange:$=>E(Number($.target.value)),min:0,max:3e3,step:100,style:{width:"100%",backgroundColor:"#333",border:"1px solid #555",color:"#fff",padding:"5px",borderRadius:"3px"}}),o.jsx("input",{type:"range",value:D,onChange:$=>E(Number($.target.value)),min:0,max:3e3,step:100,style:{width:"100%",margin:"5px 0",accentColor:"#1976D2"}})]})]}),o.jsxs("div",{style:{backgroundColor:"#1A2331",padding:"15px",borderRadius:"3px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",marginBottom:"15px"},children:[o.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",textAlign:"center",marginBottom:"5px"},children:["Effective Weight: ",M," lbs"]}),o.jsx("div",{style:{fontSize:"10px",color:"#aaa",textAlign:"center",marginBottom:"15px"},children:"Weight at chart temperature without corrections"}),o.jsxs("div",{style:{backgroundColor:"#243141",padding:"15px",borderRadius:"3px",textAlign:"center",margin:"0 auto",maxWidth:"80%"},children:[o.jsx("div",{style:{color:"#aaa",fontSize:"10px",marginBottom:"5px"},children:"Maximum Allowable Weight:"}),o.jsxs("div",{style:{fontSize:"28px",fontWeight:"bold",color:"#4CAF50"},children:[x," lbs"]}),o.jsx("div",{style:{color:"#aaa",fontSize:"9px",marginTop:"5px"},children:"After applying wind and pressure altitude effects"})]})]}),o.jsx("div",{style:{backgroundColor:"#1A2331",height:"200px",borderRadius:"3px",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o.jsxs("div",{style:{textAlign:"center",color:"#aaa"},children:[o.jsx("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR4nO2XQQrCMBBFM1dxL9STeAPBK4geQpGCd/AU4lbQhXoIoYupG5Hm04kmrRVFmmkqhfnwNyGd/PeSMJMQ/GXLoI2qTk/FyNiAjkE9fXjsQN+goVtm0TNoaA+nxF95MUNDOKSYWPVqgcZ4tXCwUYW5fITCQURU3jFXiYNSR6bSnEO0Dw5KHQNztlM20C/V0Bm0VGnPQhwSrgGVWDvA8Cqxh0FZNlAqcU4pZbFWYjJgiEOkHOKGjWNdTskGvvahxP9M2MUhUSUWJQ7JSmzhQN63GmSqoNhbTRQcUlPiJTiolXjS1eZTcEjhkPdK/P4OyPe+CTcGvC/IfW86Rnnrf+tqJ3b3h1b6ULTVAAAAAElFTkSuQmCC",alt:"Graph",width:"24",height:"24",style:{marginBottom:"10px"}}),o.jsx("div",{children:"Graph display unavailable"})]})})]})]})})},vo=({id:m})=>{const[t,e]=F.useState(!1),i={temperature:30,windSpeed:7,windDirection:0,pressureAltitude:500},n={type:"S92",registration:"G-XXXX",maxTakeoffWeight:26e3,maxPassengers:19},s=()=>{e(l=>!l)},r=`${m}-s92`,a={section:{margin:"15px 0"},header:{fontSize:"14px",fontWeight:"bold",color:"#4fc3f7",marginBottom:"10px"},formGroup:{margin:"10px 0"},label:{display:"block",fontSize:"12px",marginBottom:"3px",color:"#bbb"},inputGroup:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"15px"},input:{width:"100%",padding:"8px",backgroundColor:"#333",color:"#fff",border:"1px solid #555",borderRadius:"3px",fontSize:"12px"},checkboxGroup:{margin:"15px 0"},checkbox:{margin:"10px 0"},checkboxLabel:{marginLeft:"8px",fontSize:"12px",color:"#ddd"},button:{backgroundColor:"#4fc3f7",color:"#111",border:"none",padding:"8px 16px",borderRadius:"3px",cursor:"pointer",fontSize:"13px",fontWeight:"bold"},resultsContainer:{backgroundColor:"#263238",padding:"12px",borderRadius:"3px",margin:"15px 0"},resultsHeader:{fontSize:"14px",fontWeight:"bold",color:"#4fc3f7",marginBottom:"10px"},resultItem:{display:"flex",justifyContent:"space-between",margin:"8px 0"},resultLabel:{fontSize:"12px",color:"#bbb"},resultValue:{fontSize:"12px",fontWeight:"bold",color:"#fff"},s92Section:{margin:"20px 0 10px 0",borderTop:"1px solid #444",paddingTop:"15px"}};return o.jsx(o.Fragment,{children:t?o.jsx(xo,{id:r,weatherData:i,aircraftData:n,onClose:s}):o.jsx(_e,{title:"Performance Settings",id:m,children:o.jsxs("div",{style:{color:"#eee",fontSize:"12px"},children:[o.jsxs("div",{style:a.section,children:[o.jsx("div",{style:a.header,children:"Take-off & Landing Performance"}),o.jsxs("div",{style:a.inputGroup,children:[o.jsxs("div",{style:a.formGroup,children:[o.jsx("label",{style:a.label,htmlFor:"temperature",children:"Temperature (Â°C):"}),o.jsx("input",{type:"number",id:"temperature",defaultValue:(i==null?void 0:i.temperature)||25,min:"-20",max:"50",style:a.input})]}),o.jsxs("div",{style:a.formGroup,children:[o.jsx("label",{style:a.label,htmlFor:"pressure-altitude",children:"Pressure Altitude (ft):"}),o.jsx("input",{type:"number",id:"pressure-altitude",defaultValue:(i==null?void 0:i.pressureAltitude)||0,min:"0",max:"10000",style:a.input})]})]})]}),o.jsxs("div",{style:a.section,children:[o.jsx("div",{style:a.header,children:"Aircraft Configuration"}),o.jsxs("div",{style:a.checkboxGroup,children:[o.jsxs("div",{style:a.checkbox,children:[o.jsx("input",{type:"checkbox",id:"engine-failure",style:{accentColor:"#4fc3f7"}}),o.jsx("label",{style:a.checkboxLabel,htmlFor:"engine-failure",children:"Include Engine Failure Analysis"})]}),o.jsxs("div",{style:a.checkbox,children:[o.jsx("input",{type:"checkbox",id:"cat-a",defaultChecked:!0,style:{accentColor:"#4fc3f7"}}),o.jsx("label",{style:a.checkboxLabel,htmlFor:"cat-a",children:"Apply Category A Procedures"})]})]}),o.jsx("button",{style:a.button,children:"Calculate Performance"})]}),o.jsxs("div",{style:a.resultsContainer,children:[o.jsx("div",{style:a.resultsHeader,children:"Performance Results"}),o.jsxs("div",{style:a.resultItem,children:[o.jsx("div",{style:a.resultLabel,children:"Max Takeoff Weight:"}),o.jsxs("div",{style:a.resultValue,children:[(n==null?void 0:n.maxTakeoffWeight.toLocaleString())||"17,500"," lbs"]})]}),o.jsxs("div",{style:a.resultItem,children:[o.jsx("div",{style:a.resultLabel,children:"Weight Limited By:"}),o.jsx("div",{style:a.resultValue,children:"Cat A Takeoff"})]}),o.jsxs("div",{style:a.resultItem,children:[o.jsx("div",{style:a.resultLabel,children:"Max Passengers:"}),o.jsx("div",{style:a.resultValue,children:(n==null?void 0:n.maxPassengers)||"12"})]})]}),(n==null?void 0:n.type)==="S92"||!n?o.jsxs("div",{style:a.s92Section,children:[o.jsx("div",{style:a.header,children:"S92 Performance Calculator"}),o.jsx("p",{style:{fontSize:"12px",color:"#bbb",marginBottom:"12px"},children:"Click below to open the S92 dropdown calculator"}),o.jsx("button",{style:a.button,onClick:s,children:"Open S92 Calculator"})]}):null]})})})},bo=({id:m,weather:t={windSpeed:15,windDirection:270},onWeatherUpdate:e=()=>{}})=>o.jsx(_e,{title:"Weather Settings",id:m,children:o.jsxs("div",{className:"control-section",children:[o.jsx("h4",{children:"Weather Source"}),o.jsxs("div",{className:"weather-source-options",children:[o.jsxs("div",{children:[o.jsx("input",{type:"radio",id:"actual-weather",name:"weather-source",defaultChecked:!0}),o.jsx("label",{htmlFor:"actual-weather",children:"Use Actual Weather"})]}),o.jsxs("div",{children:[o.jsx("input",{type:"radio",id:"manual-weather",name:"weather-source"}),o.jsx("label",{htmlFor:"manual-weather",children:"Manual Weather Entry"})]})]}),o.jsx("h4",{children:"Wind Settings"}),o.jsxs("div",{className:"settings-group",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"wind-direction",children:"Wind Direction (Â°):"}),o.jsx("input",{type:"number",id:"wind-direction",value:t.windDirection,min:"0",max:"359",onChange:i=>{const n=parseInt(i.target.value)||0;console.log("WeatherCard: Wind direction changed to:",n);const s=(n%360+360)%360;e(t.windSpeed,s)}})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"wind-speed",children:"Wind Speed (kts):"}),o.jsx("input",{type:"number",id:"wind-speed",value:t.windSpeed,min:"0",max:"100",onChange:i=>{const n=parseInt(i.target.value)||0;console.log("WeatherCard: Wind speed changed to:",n),e(n,t.windDirection)}})]})]}),o.jsx("h4",{children:"Visibility & Ceiling"}),o.jsxs("div",{className:"settings-group",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"visibility",children:"Visibility (nm):"}),o.jsx("input",{type:"number",id:"visibility",defaultValue:10,min:"0",max:"50",step:"0.1"})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"ceiling",children:"Ceiling (ft):"}),o.jsx("input",{type:"number",id:"ceiling",defaultValue:3e3,min:"0",max:"20000",step:"100"})]})]}),o.jsx("button",{className:"control-button",children:"Apply Weather"}),o.jsxs("div",{className:"weather-data",children:[o.jsx("h4",{children:"Current Weather"}),o.jsxs("div",{className:"weather-item",children:[o.jsx("div",{className:"weather-icon",children:"ðŸŒ¤ï¸"}),o.jsxs("div",{className:"weather-details",children:[o.jsxs("div",{children:["Wind: ",t.windDirection,"Â° at ",t.windSpeed," kts"]}),o.jsx("div",{children:"Visibility: 10 nm"}),o.jsx("div",{children:"Ceiling: 3,000 ft"})]})]})]})]})}),wo=({id:m})=>o.jsx(_e,{title:"Finance Calculator",id:m,children:o.jsxs("div",{className:"control-section",children:[o.jsx("h4",{children:"Flight Cost Parameters"}),o.jsx("label",{htmlFor:"hourly-rate",children:"Hourly Rate (USD):"}),o.jsx("input",{type:"number",id:"hourly-rate",defaultValue:4500,min:"0",step:"100"}),o.jsx("label",{htmlFor:"landing-fee",children:"Landing Fee (USD):"}),o.jsx("input",{type:"number",id:"landing-fee",defaultValue:250,min:"0",step:"50"}),o.jsx("label",{htmlFor:"fuel-cost",children:"Fuel Cost (USD/lb):"}),o.jsx("input",{type:"number",id:"fuel-cost",defaultValue:3.25,min:"0",step:"0.05"}),o.jsx("h4",{children:"Contract Details"}),o.jsx("label",{htmlFor:"billing-method",children:"Billing Method:"}),o.jsxs("select",{id:"billing-method",children:[o.jsx("option",{value:"hourly",children:"Hourly Rate"}),o.jsx("option",{value:"fixed",children:"Fixed Price"}),o.jsx("option",{value:"mileage",children:"Per Nautical Mile"})]}),o.jsx("button",{className:"control-button finance-calculate",children:"Calculate Quote"}),o.jsxs("div",{className:"finance-results",children:[o.jsx("h4",{children:"Cost Breakdown"}),o.jsxs("div",{className:"finance-item",children:[o.jsx("div",{className:"finance-label",children:"Flight Time Cost:"}),o.jsx("div",{className:"finance-value",children:"$9,900.00"})]}),o.jsxs("div",{className:"finance-item",children:[o.jsx("div",{className:"finance-label",children:"Landing Fees:"}),o.jsx("div",{className:"finance-value",children:"$2,500.00"})]}),o.jsxs("div",{className:"finance-item",children:[o.jsx("div",{className:"finance-label",children:"Fuel Cost:"}),o.jsx("div",{className:"finance-value",children:"$16,850.00"})]}),o.jsxs("div",{className:"finance-item total",children:[o.jsx("div",{className:"finance-label",children:"Total Cost:"}),o.jsx("div",{className:"finance-value",children:"$29,250.00"})]}),o.jsxs("div",{className:"finance-item per-passenger",children:[o.jsx("div",{className:"finance-label",children:"Cost Per Passenger (12 pax):"}),o.jsx("div",{className:"finance-value",children:"$2,437.50"})]})]})]})}),Co=({id:m})=>o.jsx(_e,{title:"Evacuation Planner",id:m,children:o.jsxs("div",{className:"control-section",children:[o.jsx("h4",{children:"Evacuation Parameters"}),o.jsx("label",{htmlFor:"total-evacuees",children:"Total Personnel to Evacuate:"}),o.jsx("input",{type:"number",id:"total-evacuees",defaultValue:120,min:"1"}),o.jsx("label",{htmlFor:"available-aircraft",children:"Available Aircraft:"}),o.jsxs("select",{id:"available-aircraft",multiple:!0,children:[o.jsx("option",{value:"N603PW",children:"N603PW (AW139)"}),o.jsx("option",{value:"N604PW",children:"N604PW (AW139)"}),o.jsx("option",{value:"N701BH",children:"N701BH (S92)"}),o.jsx("option",{value:"N702BH",children:"N702BH (S92)"})]}),o.jsx("div",{className:"small-hint",children:"Hold Ctrl/Cmd to select multiple"}),o.jsx("label",{htmlFor:"priority-level",children:"Priority Level:"}),o.jsxs("select",{id:"priority-level",children:[o.jsx("option",{value:"1",children:"1 - Immediate (Medical Emergency)"}),o.jsx("option",{value:"2",children:"2 - Urgent (Weather Threat)"}),o.jsx("option",{value:"3",selected:!0,children:"3 - Standard Evacuation"}),o.jsx("option",{value:"4",children:"4 - Non-Essential Personnel"})]}),o.jsx("button",{className:"control-button evacuation-calculate",children:"Calculate Evacuation Plan"}),o.jsxs("div",{className:"evacuation-results",children:[o.jsx("h4",{children:"Evacuation Plan"}),o.jsxs("div",{className:"evacuation-summary",children:[o.jsx("div",{children:"Total Evacuees: 120"}),o.jsx("div",{children:"Total Flights Required: 10"}),o.jsx("div",{children:"Estimated Completion Time: 4:30"})]}),o.jsxs("div",{className:"evacuation-flight-list",children:[o.jsx("h5",{children:"Flight Schedule"}),o.jsxs("div",{className:"evacuation-flight",children:[o.jsx("div",{className:"flight-number",children:"Flight 1"}),o.jsxs("div",{className:"flight-details",children:[o.jsx("div",{children:"N603PW - 12 pax"}),o.jsx("div",{children:"Depart: 10:00 - Arrive: 10:45"})]})]}),o.jsxs("div",{className:"evacuation-flight",children:[o.jsx("div",{className:"flight-number",children:"Flight 2"}),o.jsxs("div",{className:"flight-details",children:[o.jsx("div",{children:"N701BH - 19 pax"}),o.jsx("div",{children:"Depart: 10:15 - Arrive: 11:00"})]})]}),o.jsxs("div",{className:"evacuation-flight",children:[o.jsx("div",{className:"flight-number",children:"Flight 3"}),o.jsxs("div",{className:"flight-details",children:[o.jsx("div",{children:"N604PW - 12 pax"}),o.jsx("div",{children:"Depart: 10:30 - Arrive: 11:15"})]})]}),o.jsx("div",{className:"evacuation-more",children:"+7 more flights..."})]})]})]})}),So=({visible:m,onToggleVisibility:t,onClearRoute:e,onLoadRigData:i,onToggleChart:n,onLoadCustomChart:s,chartsVisible:r,aircraftType:a,onAircraftTypeChange:l,aircraftRegistration:c,onAircraftRegistrationChange:d,selectedAircraft:j,forceUpdate:I,aircraftsByType:v,aircraftLoading:N,payloadWeight:u,onPayloadWeightChange:T,reserveFuel:L,onReserveFuelChange:f,routeStats:p,waypoints:S,onRemoveWaypoint:g,isAuthenticated:C,authUserName:R,rigsLoading:y,onLogin:k,regions:D=[],currentRegion:E=null,onRegionChange:x=()=>{},regionLoading:B=!1,deckTimePerStop:M=5,deckFuelPerStop:O=100,deckFuelFlow:U=400,passengerWeight:H=220,cargoWeight:$=0,taxiFuel:z=50,contingencyFuelPercent:te=10,reserveMethod:_="fixed",onDeckTimeChange:me=()=>{},onDeckFuelChange:xe=()=>{},onDeckFuelFlowChange:q=()=>{},onPassengerWeightChange:ke=()=>{},onCargoWeightChange:fe=()=>{},onTaxiFuelChange:he=()=>{},onContingencyFuelPercentChange:ae=()=>{},onReserveMethodChange:Re=()=>{},weather:De={windSpeed:15,windDirection:270},onWeatherUpdate:ve=()=>{}})=>o.jsxs(to,{visible:m,onToggleVisibility:t,initialActiveCard:"main",children:[o.jsx(uo,{id:"main",onClearRoute:e,onLoadRigData:i,onToggleChart:n,chartsVisible:r,aircraftType:a,onAircraftTypeChange:l,aircraftRegistration:c,onAircraftRegistrationChange:d,selectedAircraft:j,aircraftsByType:v,aircraftLoading:N,routeStats:p,isAuthenticated:C,authUserName:R,rigsLoading:y,onLogin:k,regions:D,currentRegion:E,onRegionChange:x,regionLoading:B,reserveFuel:L,waypoints:S,passengerWeight:H,deckTimePerStop:M,deckFuelFlow:U,weather:De,onWeatherUpdate:ve}),o.jsx(fo,{id:"settings",deckTimePerStop:M,deckFuelPerStop:O,deckFuelFlow:U,passengerWeight:H,cargoWeight:$,taxiFuel:z,contingencyFuelPercent:te,reserveMethod:_,reserveFuel:L,onDeckTimeChange:me,onDeckFuelChange:xe,onDeckFuelFlowChange:q,onPassengerWeightChange:ke,onCargoWeightChange:fe,onTaxiFuelChange:he,onContingencyFuelPercentChange:ae,onReserveMethodChange:Re,onReserveFuelChange:f,selectedAircraft:j,aircraftType:a}),o.jsx(vo,{id:"performance"}),o.jsx(bo,{id:"weather",weather:De,onWeatherUpdate:ve}),o.jsx(wo,{id:"finance"}),o.jsx(Co,{id:"evacuation"})]}),ko=({mapManagerRef:m,onMapReady:t,className:e})=>{const i=F.useRef(null),n=F.useRef(!1),[s,r]=F.useState(!0),[a,l]=F.useState("Initializing map...");return F.useEffect(()=>{if(!(m!=null&&m.current)||n.current){console.log("MapComponent useEffect: Skipping initialization (no mapManagerRef or already initialized).");return}console.log("MapComponent useEffect: Starting map initialization.");const c=m.current;return(async()=>{try{if(r(!0),l("Loading map scripts..."),console.log("MapComponent initMap: Loading map scripts..."),await c.loadScripts(),l("Initializing map..."),console.log("MapComponent initMap: Initializing map..."),i.current){const j=await c.initializeMap("fast-planner-map");n.current=!0,console.log("MapComponent initMap: Map instance created, calling onReady."),r(!1),t?(t(j),console.log("ðŸš€ Setting up single delayed initialization for map click handlers..."),setTimeout(()=>{if(console.log("MapComponent: Delayed click handler initialization check"),j&&!window.mapHandlersInitialized){console.log("Handlers not yet initialized, triggering event");const I=new CustomEvent("reinitialize-map-handlers");window.dispatchEvent(I)}else console.log("Handlers already initialized, skipping event dispatch")},1e3)):console.warn("MapComponent initMap: onMapReady callback is not defined.")}else console.error("MapComponent initMap: mapContainerRef is not available."),l("Error: Map container not found.")}catch(j){console.error("MapComponent initMap: Failed to initialize map:",j),l("Error loading map: "+j.message)}})(),()=>{console.log("MapComponent cleanup: Removing map instance.");const j=c==null?void 0:c.getMap();if(j&&typeof j.remove=="function")try{j.remove()}catch(I){console.error("Error removing map during cleanup:",I)}n.current=!1}},[]),F.useEffect(()=>{const c=document.getElementById("loading-overlay");c&&(c.style.display="none")},[]),o.jsx(o.Fragment,{children:o.jsx("div",{id:"fast-planner-map",className:e||"fast-planner-map",ref:i})})},Z=(()=>{const m=new Map;let t=0,e=[],i=!1,n=null,s=null;const r=()=>{if(document.getElementById("loading-indicator-styles"))return;const f=document.createElement("style");f.id="loading-indicator-styles",f.textContent=`
      .fp-loading-container {
        position: absolute;
        width: 100%;
        height: 3px;
        pointer-events: none;
        overflow: hidden;
        background-color: transparent; /* Transparent background for the track */
        bottom: 0;
        left: 0;
        transition: opacity 0.5s ease;
      }
      
      .fp-loading-text {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 11px;
        color: rgba(0, 200, 255, 0.9);
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.9;
        text-align: center;
        max-width: 80%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .fp-loading-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 2px;
        background: linear-gradient(to right, 
          rgba(0, 180, 255, 0) 0%, 
          rgba(0, 200, 255, 0.7) 35%, 
          rgba(190, 255, 255, 1) 50%, 
          rgba(0, 200, 255, 0.7) 65%, 
          rgba(0, 180, 255, 0) 100%
        );
        width: 35%; /* Slightly longer bar */
        animation: fp-elastic-scroll 1.8s infinite cubic-bezier(0.645, 0.045, 0.355, 1);
        transform-origin: left center;
        border-radius: 1px;
      }
      
      /* When finishing, run animation to completion */
      .fp-loading-bar.finishing {
        animation: fp-complete-scroll 1s forwards cubic-bezier(0.215, 0.61, 0.355, 1);
      }
      
      @keyframes fp-elastic-scroll {
        0% {
          left: -30%;
          width: 30%;
        }
        35% {
          width: 33%;
        }
        50% {
          width: 30%;
        }
        75% {
          width: 27%;
        }
        100% {
          left: 100%;
          width: 30%;
        }
      }
      
      /* Animation for completion - always reaches the end */
      @keyframes fp-complete-scroll {
        0% {
          left: attr(data-current-position);
          width: 30%;
        }
        100% {
          left: 100%;
          width: 30%;
        }
      }
      
      .status-indicator {
        position: absolute; 
        left: 50%;
        top: 40%;
        transform: translateX(-50%);
        font-size: 10px; /* Slightly smaller */
        color: rgba(150, 150, 150, 0.95); /* Darker gray */
        text-align: center;
        overflow: hidden;
        white-space: nowrap;
        height: 14px;
        max-width: 400px;
        margin: 0 auto;
        opacity: 0;
        transition: opacity 0.3s ease;
        font-family: 'Arial Narrow', 'Franklin Gothic Medium', Arial, sans-serif;
        letter-spacing: 0.5px;
      }
      
      .status-indicator.active {
        opacity: 1;
      }
      
      /* Typewriter effect for status indicator */
      .typewriter-text {
        border-right: 2px solid rgba(150, 200, 255, 0.5);
        white-space: nowrap;
        overflow: hidden;
        animation: typing 1.8s steps(40, end), blink-caret 0.75s step-end infinite;
      }
      
      @keyframes typing {
        from { width: 0 }
        to { width: 100% }
      }
      
      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: rgba(150, 200, 255, 0.5) }
      }
    `,document.head.appendChild(f)},a=()=>{if(i||e.length===0)return;i=!0,n=e.shift();for(let S=e.length-1;S>=0;S--)e[S]===n&&e.splice(S,1);N(n);const f=n.length,p=Math.max(1800*(f/40),800)+1e3;s=setTimeout(()=>{i=!1,n=null,e.length===0?T():a()},p)},l=(f,p="",S={})=>{if(r(),document.querySelector(".route-stats-card")&&document.querySelector(".route-stats-header")&&document.querySelector(".fp-loading-container"))return p&&I(p),-1;const g=typeof f=="string"?document.querySelector(f):f;if(!g)return console.error("LoadingIndicator: Container element not found"),-1;window.getComputedStyle(g).position==="static"&&(g.style.position="relative");const C=document.createElement("div");if(C.className="fp-loading-container",S.position==="bottom"?(C.style.position="absolute",C.style.bottom="0"):S.position==="middle"?(C.style.position="absolute",C.style.top="50%",C.style.transform="translateY(-50%)"):(C.style.position="absolute",C.style.top="0"),p){const k=document.createElement("div");k.className="fp-loading-text",k.textContent=p,C.appendChild(k)}const R=document.createElement("div");R.className="fp-loading-bar",C.appendChild(R),g.appendChild(C);const y=t++;return m.set(y,{container:g,element:C}),p&&I(p),y},c=(f,p)=>{const S=m.get(f);if(!S)return!1;const g=S.element.querySelector(".fp-loading-text");if(g)g.textContent=p;else if(p){const C=document.createElement("div");C.className="fp-loading-text",C.textContent=p,S.element.insertBefore(C,S.element.firstChild)}return p&&I(p),!0},d=f=>{const p=m.get(f);return p?(p.element&&p.element.parentNode&&p.element.parentNode.removeChild(p.element),m.delete(f),m.size===0&&e.length===0&&!i&&T(),!0):!1},j=()=>{m.forEach((p,S)=>{d(S)}),document.querySelectorAll(".fp-loading-bar").forEach(p=>{const S=p.getAttribute("data-interval-id");S&&clearInterval(parseInt(S,10))}),e.length=0,clearTimeout(s),i=!1,n=null,T()},I=f=>{if(f)try{if(n===f)return;let p=!1;for(let g=0;g<e.length;g++)if(e[g]===f){p=!0;break}if(p)return;e.length<10&&e.push(f),i||a();const S=document.querySelector(".fp-loading-container");S&&(S.style.display="block")}catch(p){console.error("Error in queueMessage:",p)}},v=f=>f?(I(f),!0):!1,N=f=>{const p=document.querySelector(".status-indicator");if(!p)return!1;p.innerHTML="";const S=document.createElement("div");S.className="typewriter-text",S.textContent=f,p.appendChild(S),p.classList.add("active");const g=document.querySelector(".fp-loading-container");return g&&(g.style.display="block"),!0},u=()=>e.length>0||i?!1:(T(),!0),T=()=>{const f=document.querySelector(".status-indicator");if(!f)return!1;const p=f.querySelector(".typewriter-text");if(p){const S=p.textContent.length,g=Math.max(1800*(S/40),800),C=p.textContent;setTimeout(()=>{p.parentNode&&(p.textContent=C+"...")},g/2),setTimeout(()=>{f.classList.remove("active");const R=document.querySelector(".fp-loading-container");if(R){const y=R.querySelector(".fp-loading-bar");y?(y.classList.add("finishing"),setTimeout(()=>{R.style.opacity="0",setTimeout(()=>{R.style.display="none",R.style.opacity="1",y&&y.classList.remove("finishing")},500)},1e3)):R.style.display="none"}setTimeout(()=>{f.innerHTML=""},300)},g+1e3)}else{f.classList.remove("active");const S=document.querySelector(".fp-loading-container");if(S){const g=S.querySelector(".fp-loading-bar");g?(g.classList.add("finishing"),setTimeout(()=>{S.style.opacity="0",setTimeout(()=>{S.style.display="none",S.style.opacity="1",g&&g.classList.remove("finishing")},500)},1e3)):S.style.display="none"}setTimeout(()=>{f.innerHTML=""},300)}return!0};return{show:l,updateText:c,hide:d,hideAll:j,updateStatusIndicator:v,clearStatusIndicator:u,initializeRouteStatsLoader:()=>{const f=document.querySelector(".route-stats-card");if(!f)return!1;const p=f.querySelector(".route-stats-header");if(!p)return!1;p.style.position="relative",document.querySelectorAll(".fp-loading-container").forEach(k=>{k.remove()});const g=document.createElement("div");g.className="fp-loading-container",g.style.width="100%",g.style.position="absolute",g.style.bottom="0",g.style.left="0",g.style.height="3px",g.style.display="none";const C=document.createElement("div");C.className="fp-loading-bar",C.setAttribute("data-current-position","-30%");const y=setInterval(()=>{if(!C||!C.parentNode)return;const D=window.getComputedStyle(C).getPropertyValue("left");C.setAttribute("data-current-position",D)},100);return C.setAttribute("data-interval-id",y),g.appendChild(C),p.appendChild(g),!0},getQueueStatus:()=>({length:e.length,currentMessage:n,isProcessing:i})}})();typeof window<"u"&&(window.LoadingIndicator=Z);const Ao=({routeStats:m,selectedAircraft:t,waypoints:e,deckTimePerStop:i=5,deckFuelPerStop:n=100,deckFuelFlow:s=400,passengerWeight:r=220,cargoWeight:a=0,taxiFuel:l=50,contingencyFuelPercent:c=10,reserveFuel:d=600,weather:j={windSpeed:0,windDirection:0},stopCards:I=[]})=>{var E,x,B,M;const{isAuthenticated:v,userName:N}=xt(),u=F.useRef(null),T=F.useRef(null),[L,f]=F.useState(0);if(F.useEffect(()=>{console.log("ðŸ’¥ RouteStatsCard - routeStats changed, forcing rerender"),f(O=>O+1)},[m]),F.useEffect(()=>{e&&e.length>=2&&(console.log("ðŸ’¥ RouteStatsCard - waypoints changed, forcing rerender"),f(O=>O+1))},[e]),console.log("ðŸ’¥ RouteStatsCard - received stats:",{forceRerender:L,timeHours:m==null?void 0:m.timeHours,estimatedTime:m==null?void 0:m.estimatedTime,totalDistance:m==null?void 0:m.totalDistance,legs:((E=m==null?void 0:m.legs)==null?void 0:E.length)||0}),m&&m.timeHours===0&&m.estimatedTime==="00:00"&&m.totalDistance&&parseFloat(m.totalDistance)>0&&(console.error("âš ï¸ RouteStatsCard - Invalid zero time with non-zero distance!",{totalDistance:m.totalDistance,estimatedTime:m.estimatedTime}),t&&t.cruiseSpeed)){console.log("âš ï¸ RouteStatsCard - Fixing zero time with manual calculation");const U=parseFloat(m.totalDistance)/t.cruiseSpeed,H=Math.floor(U),$=Math.floor((U-H)*60),z=`${H.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`;m.timeHours=U,m.estimatedTime=z,console.log("âš ï¸ RouteStatsCard - Fixed time values:",{timeHours:U,estimatedTime:z})}m&&m.windAdjusted?console.log("âœ… Wind-adjusted stats detected in RouteStatsCard:",{windSpeed:(x=m.windData)==null?void 0:x.windSpeed,windDirection:(B=m.windData)==null?void 0:B.windDirection,estimatedTime:m.estimatedTime,timeHours:m.timeHours,avgHeadwind:(M=m.windData)==null?void 0:M.avgHeadwind}):console.log("âŒ Route stats WITHOUT wind adjustment in RouteStatsCard");const p=m&&m.windAdjusted&&m.windData;p&&m.windData.avgHeadwind,F.useEffect(()=>{var O;if(!document.getElementById("wind-adjusted-style")){const U=document.createElement("style");U.id="wind-adjusted-style",U.innerHTML=`
        .wind-adjusted-time {
          position: relative;
        }
        .wind-adjusted-time::after {
          content: ' â˜…';
          font-size: 0.7em;
          color: ${((O=m==null?void 0:m.windData)==null?void 0:O.windSpeed)>0?"#e74c3c":"#2ecc71"};
          vertical-align: super;
        }
      `,document.head.appendChild(U)}},[m]);const S=e&&e.length>1?e.length-1:0,g=(m==null?void 0:m.deckTimeMinutes)||S*i,C=(m==null?void 0:m.deckFuel)||S*n,R=m||{totalDistance:"0",estimatedTime:"00:00",timeHours:0,fuelRequired:0,usableLoad:0},y=()=>{if(R.totalTimeFormatted)return R.totalTimeFormatted;const O=R.timeHours||0,U=g/60,H=O+U,$=Math.floor(H),z=Math.floor((H-$)*60);return`${$.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`},k=R.totalFuel||R.tripFuel&&R.deckFuel&&R.contingencyFuel&&R.taxiFuel&&R.reserveFuel?parseInt(R.tripFuel)+parseInt(R.deckFuel)+parseInt(R.contingencyFuel)+parseInt(R.taxiFuel)+parseInt(R.reserveFuel):parseInt(R.fuelRequired||0)+C,D=()=>{if(R.calculatedPassengers!==void 0)return R.calculatedPassengers;if(!t||!R.usableLoad)return 0;const O=Math.floor(R.usableLoad/r),U=t.maxPassengers||19;return Math.min(O,U)};return F.useEffect(()=>{document.querySelectorAll(".fp-loading-container").forEach(H=>{H.remove()}),Z&&Z.clearStatusIndicator&&Z.clearStatusIndicator();const U=setTimeout(()=>{Z&&Z.initializeRouteStatsLoader&&Z.initializeRouteStatsLoader()},100);return()=>{clearTimeout(U),document.querySelectorAll(".fp-loading-container").forEach($=>{$.remove()}),T.current!==null&&(Z.hide(T.current),T.current=null),Z&&Z.clearStatusIndicator&&Z.clearStatusIndicator()}},[]),F.useEffect(()=>{e&&e.length>=2&&Z&&Z.updateStatusIndicator&&Z.updateStatusIndicator("Calculating route")},[e]),o.jsxs("div",{className:"route-stats-card",ref:u,children:[o.jsxs("div",{className:"route-stats-header",children:[o.jsx("div",{className:"logo-container",children:o.jsx("img",{src:"https://bristow.info/SAR/VTOL-5a215f01.png",alt:"VTOL",className:"vtol-logo"})}),o.jsx("div",{className:"route-stats-title",children:t?o.jsxs("span",{children:[t.registration.split(" (")[0]," â€¢ ",t.modelType]}):o.jsx("span",{children:"Route Statistics"})}),o.jsx("div",{className:"status-indicator-container",style:{position:"absolute",top:"0",left:"0",right:"0",height:"100%",textAlign:"center",zIndex:"100",pointerEvents:"none"},children:o.jsx("div",{className:"status-indicator"})}),o.jsxs("div",{className:"auth-status-container",children:[v&&N&&o.jsx("span",{className:"username-display",children:N}),o.jsx("span",{className:`connection-indicator ${v?"connected":"disconnected"}`,title:v?"Connected to OSDK":"Not connected to OSDK"})]})]}),o.jsxs("div",{className:"route-stats-content",children:[o.jsxs("div",{className:"stats-row",children:[o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Total Distance:"}),o.jsxs("div",{className:"route-stat-value",children:[R.totalDistance||"0"," NM"]})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Deck Time:"}),o.jsxs("div",{className:"route-stat-value",children:[R.deckTimeMinutes||g," mins"]})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsxs("div",{className:"route-stat-label",children:["Flight Time:",p&&m.windData.avgHeadwind!==0&&o.jsx("span",{style:{fontSize:"0.8em",marginLeft:"4px",color:m.windData.avgHeadwind>0?"#e74c3c":"#2ecc71",fontWeight:"bold"},title:`${Math.abs(m.windData.avgHeadwind)} kt ${m.windData.avgHeadwind>0?"headwind":"tailwind"}`,children:m.windData.avgHeadwind>0?` (+${m.windData.avgHeadwind}kt)`:` (${m.windData.avgHeadwind}kt)`})]}),o.jsx("div",{className:"route-stat-value",children:R.estimatedTime||"00:00"})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Total Fuel:"}),o.jsxs("div",{className:"route-stat-value",children:[k," lbs"]})]})]}),o.jsxs("div",{className:"stats-row",children:[o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Trip Fuel:"}),o.jsxs("div",{className:"route-stat-value",children:[R.tripFuel||R.fuelRequired||"0"," lbs"]})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Deck Fuel:"}),o.jsxs("div",{className:"route-stat-value",children:[R.deckFuel||C," lbs"]})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Total Time:"}),o.jsx("div",{className:"route-stat-value",children:y()})]}),o.jsxs("div",{className:"route-stat-item",children:[o.jsx("div",{className:"route-stat-label",children:"Passengers:"}),o.jsx("div",{className:"route-stat-value",children:D()})]})]})]})]})};class Fo{constructor(){this.map=null,this.mapboxToken="pk.eyJ1IjoiZGlya3N0ZXIxMDEiLCJhIjoiY204YW9mdm4yMTliMTJscXVnaXRqNmptNyJ9.VDLt_kE5BnAV8S4vXjFMlg",this._isLoaded=!1,this._loadCallbacks=[]}initializeMap(t){return new Promise((e,i)=>{try{if(!window.mapboxgl){i(new Error("Mapbox GL JS not loaded"));return}if(!document.getElementById(t)){i(new Error("Map container element not found"));return}window.mapboxgl.accessToken=this.mapboxToken,console.log("Creating MapBox instance..."),this.map=new window.mapboxgl.Map({container:t,style:"mapbox://styles/mapbox/dark-v11",center:[-90.5,27.5],zoom:6,attributionControl:!1,preserveDrawingBuffer:!0}),console.log("Map instance created successfully"),this._isLoaded=!1,this._loadCallbacks=[],this.map.once("load",()=>{console.log("Map loaded event fired"),this._isLoaded=!0,this.addGridToMap(),console.log(`Executing ${this._loadCallbacks.length} queued onMapLoaded callbacks.`),this._loadCallbacks.forEach(s=>{try{s()}catch(r){console.error("Error executing onMapLoaded callback:",r)}}),this._loadCallbacks=[]}),this.map.on("error",s=>{console.error("MapBox error:",s),i(s)}),e(this.map)}catch(n){console.error("Error initializing map:",n),i(n)}})}loadScripts(){return new Promise((t,e)=>{try{const i=document.createElement("script");i.src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js",i.async=!0,document.body.appendChild(i);const n=document.createElement("link");n.href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css",n.rel="stylesheet",document.head.appendChild(n);const s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js",s.async=!0,document.body.appendChild(s);const r=setInterval(()=>{window.mapboxgl&&window.turf&&(clearInterval(r),console.log("MapBox and Turf scripts loaded successfully"),t())},100);setTimeout(()=>{(!window.mapboxgl||!window.turf)&&(clearInterval(r),e(new Error("Timeout loading map scripts")))},1e4)}catch(i){console.error("Error loading map scripts:",i),e(i)}})}addGridToMap(){if(this.map){console.log("Adding grid to map (called from map load event)");try{this._addSimpleGrid()}catch(e){console.error("Error adding grid to map:",e)}}}_addSimpleGrid(){if(this.map)try{console.log("Adding simple grid to map"),this._addSimpleGridSafely()}catch(e){console.error("Error in _addSimpleGrid:",e)}}_addSimpleGridSafely(){const t=this.map;if(!t){console.error("Map is null in _addSimpleGridSafely");return}try{console.log("Creating grid data");const e=[],i=[];for(let n=24;n<=31;n++){const s={type:"Feature",properties:{name:`${n}Â°N`},geometry:{type:"LineString",coordinates:[[-98,n],[-83,n]]}};e.push(s)}for(let n=-98;n<=-83;n++){const s={type:"Feature",properties:{name:`${Math.abs(n)}Â°W`},geometry:{type:"LineString",coordinates:[[n,24],[n,31]]}};i.push(s)}try{console.log("Checking for existing grid layers"),t.getLayer("grid-labels")&&(console.log("Removing grid-labels layer"),t.removeLayer("grid-labels"))}catch(n){console.warn("Could not remove grid-labels layer:",n.message)}try{t.getLayer("longitude-lines")&&(console.log("Removing longitude-lines layer"),t.removeLayer("longitude-lines"))}catch(n){console.warn("Could not remove longitude-lines layer:",n.message)}try{t.getLayer("latitude-lines")&&(console.log("Removing latitude-lines layer"),t.removeLayer("latitude-lines"))}catch(n){console.warn("Could not remove latitude-lines layer:",n.message)}try{t.getSource("grid-lines")&&(console.log("Removing grid-lines source"),t.removeSource("grid-lines"))}catch(n){console.warn("Could not remove grid-lines source:",n.message)}try{console.log("Adding grid-lines source"),t.addSource("grid-lines",{type:"geojson",data:{type:"FeatureCollection",features:[...e,...i]}})}catch(n){console.error("Error adding grid-lines source:",n.message);return}try{console.log("Adding latitude-lines layer"),t.addLayer({id:"latitude-lines",type:"line",source:"grid-lines",filter:["all",["has","name"],["match",["slice",["get","name"],-1],["N"],!0,!1]],paint:{"line-color":"rgba(255, 255, 255, 0.3)","line-width":1,"line-dasharray":[3,3]}})}catch(n){console.error("Error adding latitude-lines layer:",n.message)}try{console.log("Adding longitude-lines layer"),t.addLayer({id:"longitude-lines",type:"line",source:"grid-lines",filter:["all",["has","name"],["match",["slice",["get","name"],-1],["W"],!0,!1]],paint:{"line-color":"rgba(255, 255, 255, 0.3)","line-width":1,"line-dasharray":[3,3]}})}catch(n){console.error("Error adding longitude-lines layer:",n.message)}try{console.log("Adding grid-labels layer"),t.addLayer({id:"grid-labels",type:"symbol",source:"grid-lines",filter:["has","name"],layout:{"text-field":["get","name"],"text-size":12,"text-offset":[0,-1],"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-justify":"auto"},paint:{"text-color":"rgba(255, 255, 255, 0.5)","text-halo-color":"rgba(0, 0, 0, 0.5)","text-halo-width":1}})}catch(n){console.error("Error adding grid-labels layer:",n.message)}console.log("Grid added successfully")}catch(e){console.error("Error in _addSimpleGridSafely:",e)}}fitMapToBounds(t){this.map&&this.map.fitBounds(t,{padding:50,maxZoom:10})}getMap(){return this.map}isMapLoaded(){return this._isLoaded&&!!this.map}onMapLoaded(t){if(this.isMapLoaded()){console.log("onMapLoaded: Map already loaded, executing callback immediately.");try{t()}catch(e){console.error("Error executing immediate onMapLoaded callback:",e)}}else this.map?(console.log("onMapLoaded: Map not loaded, queuing callback."),this._loadCallbacks.push(t)):console.error("onMapLoaded called before map instance exists.")}setupRouteDragging(t){const e=this.map;if(!e)return;console.log("Setting up route dragging functionality");let i=!1,n=[],s=[],r=-1,a=null;const l=d=>{try{e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.addSource("drag-line",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:d}}}),e.addLayer({id:"drag-line",type:"line",source:"drag-line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4,"line-dasharray":[2,1]}}),a=e.getSource("drag-line")}catch(j){console.error("Error adding drag line:",j)}},c=(d,j)=>{try{if(!e.getSource("route"))return null;const I=e.queryRenderedFeatures(j,{layers:["route"]}),v=I&&I.length>0,N=e.getSource("route");if(!N||!N._data)return null;const u=N._data.geometry.coordinates;if(!u||u.length<2)return null;let T=1/0,L=null,f=-1;for(let g=0;g<u.length-1;g++){const C=window.turf.lineString([u[g],u[g+1]]),R=window.turf.point([d.lng,d.lat]),y=window.turf.nearestPointOnLine(C,R);y.properties.dist<T&&(T=y.properties.dist,L=y.geometry.coordinates,f=g)}const p=window.turf.distance(window.turf.point([d.lng,d.lat]),window.turf.point(L),{units:"nauticalmiles"});return v||p<.5?{point:L,index:f,distance:p,isDirectlyOver:v}:null}catch(I){return console.error("Error finding closest point on line:",I),null}};e.on("mousedown",d=>{if(!e.getSource("route")||d.originalEvent.button===2||e.queryRenderedFeatures(d.point,{layers:["platforms-layer"]}).length>0)return;const I=d.lngLat,v=c(I,d.point);if(v){console.log("Starting route drag operation at segment:",v.index,"Distance:",v.distance.toFixed(2)+" nm","Directly over route:",v.isDirectlyOver);const N=e.getSource("route");if(!N||!N._data)return;s=[...N._data.geometry.coordinates],i=!0,v.point,r=v.index,n=[...s],n.splice(r+1,0,v.point),l(n),e.setLayoutProperty("route","visibility","none"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","none"),e.getCanvas().style.cursor="grabbing",d.preventDefault()}}),e.on("mousemove",d=>{if(i)n[r+1]=[d.lngLat.lng,d.lngLat.lat],a&&a.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}});else{const j=c(d.lngLat,d.point);j&&j.isDirectlyOver?e.getCanvas().style.cursor="pointer":e.getCanvas().style.cursor==="pointer"&&e.queryRenderedFeatures(d.point,{layers:["platforms-layer"]}).length===0&&(e.getCanvas().style.cursor="")}}),e.on("mouseup",d=>{i&&(i=!1,e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.setLayoutProperty("route","visibility","visible"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","visible"),t&&typeof t=="function"&&(console.log("Route drag complete, adding new point at index:",r+1),t(r+1,[d.lngLat.lng,d.lngLat.lat])),e.getCanvas().style.cursor="",n=[],s=[],r=-1,a=null)}),e.on("mouseout",()=>{i&&(console.log("Mouse left map area, canceling route drag"),i=!1,e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.setLayoutProperty("route","visibility","visible"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","visible"),e.getCanvas().style.cursor="",n=[],s=[],r=-1,a=null)})}}class Ro{constructor(t,e=null){this.mapManager=t,this.platformManager=e,this.waypoints=[],this.markers=[],this.callbacks={onChange:null,onWaypointAdded:null,onWaypointRemoved:null,onRouteUpdated:null}}setPlatformManager(t){this.platformManager=t}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}addWaypoint(t,e){if(!this.mapManager.getMap())return console.error("Cannot add waypoint: Map is not initialized"),null;console.log(`Adding waypoint at coordinates: ${t} with name: ${e||"Unnamed"}`);const n=`waypoint-${Date.now()}`,s={id:n,coords:t,name:e||`Waypoint ${this.waypoints.length+1}`,isNew:!0};this.waypoints.push(s);try{const r=this.createWaypointMarker(t,e);return r?(r.on("dragend",()=>{const a=r.getLngLat(),l=this.markers.indexOf(r);if(l!==-1&&l<this.waypoints.length){console.log(`Marker at index ${l} dragged to [${a.lng}, ${a.lat}]`);const c=this.waypoints[l].coords;this.waypoints[l].coords=[a.lng,a.lat],this.updateWaypointNameAfterDrag(l,[a.lng,a.lat]),this.updateRoute(),this.triggerCallback("onChange",this.waypoints)}}),this.markers.push(r)):console.error("Failed to create waypoint marker"),this.updateRoute(null),console.log(`Added waypoint ${s.name} at the end, ID: ${n}`),this.triggerCallback("onWaypointAdded",s),this.triggerCallback("onChange",this.waypoints),s}catch(r){return console.error("Error adding waypoint:",r),this.waypoints=this.waypoints.filter(a=>a.id!==n),null}}updateWaypointNameAfterDrag(t,e){if(!window.platformManager&&!this.platformManager){console.log("No platform manager available to check for nearby locations");return}const i=window.platformManager||this.platformManager;try{const n=i.findNearestPlatform(e[1],e[0],2);n?(console.log(`Found nearest platform after drag: ${n.name} (${n.distance.toFixed(2)} nm)`),this.waypoints[t].name=n.name,console.log(`Updated waypoint name to: ${n.name}`)):this.waypoints[t].name.startsWith("Waypoint ")&&(this.waypoints[t].name=`Waypoint ${t+1}`)}catch(n){console.error("Error updating waypoint name after drag:",n)}}addWaypointAtIndex(t,e,i){if(!this.mapManager.getMap())return null;const s=`waypoint-${Date.now()}-${Math.floor(Math.random()*1e3)}`,r={id:s,coords:t,name:e||`Stop ${i+1}`,isNew:!0},a=this.createWaypointMarker(t,e);return a.on("dragend",()=>{const l=a.getLngLat(),c=this.markers.indexOf(a);c!==-1&&c<this.waypoints.length&&(this.waypoints[c].coords=[l.lng,l.lat],this.updateRoute())}),this.waypoints.splice(i,0,r),this.markers.splice(i,0,a),this.updateRoute(null),console.log(`Added waypoint ${r.name} at index ${i}, ID: ${s}`),this.triggerCallback("onWaypointAdded",r),this.triggerCallback("onChange",this.waypoints),r}createWaypointMarker(t,e){try{const i=this.mapManager.getMap();if(!i)return console.error("Cannot create waypoint marker: Map is not initialized"),null;if(!window.mapboxgl)return console.error("Cannot create waypoint marker: MapboxGL is not loaded"),null;if(!t||t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")return console.error("Invalid coordinates for waypoint marker:",t),null;console.log(`Creating waypoint marker at ${t} with name ${e||"Unnamed"}`);const n=new window.mapboxgl.Marker({color:"#FF4136",draggable:!0,scale:.6}).setLngLat(t).addTo(i),s=new window.mapboxgl.Popup({closeButton:!0,closeOnClick:!1,offset:15,className:"waypoint-popup",maxWidth:"240px"}),r=e||"Waypoint",a=`
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
          <strong>${r}</strong>
          <span class="favorite-button" title="Add to favorites" style="cursor: pointer; font-size: 18px;" onclick="window.addToFavorites('${r}', [${t}])">â¤ï¸</span>
        </div>
        <span class="coord-label">Lat:</span> <span class="coord-value">${t[1].toFixed(5)}</span><br>
        <span class="coord-label">Lon:</span> <span class="coord-value">${t[0].toFixed(5)}</span>
      `;s.setHTML(a);const l=n.getElement();return l&&(l.addEventListener("mouseenter",()=>{s.setLngLat(n.getLngLat()).addTo(i)}),l.addEventListener("mouseleave",()=>{s.remove()})),n}catch(i){return console.error("Error creating waypoint marker:",i),null}}createArrowsAlongLine(t,e=null){var n,s,r;if(!t||t.length<2)return{type:"FeatureCollection",features:[]};if(e&&e.timeHours&&e.totalDistance){const a=parseFloat(e.totalDistance),l=135,c=a/l;Math.abs(e.timeHours-c)>1&&(console.error(`âŒ Route time value is unreasonable! Got ${e.timeHours.toFixed(2)} hours but expected ~${c.toFixed(2)} hours based on distance ${a} nm at ${l} kts`),console.log("âŒ Setting window.currentRouteStats to null to prevent incorrect time display"),window.currentRouteStats=null)}const i=[];for(let a=0;a<t.length-1;a++){const l=t[a],c=t[a+1],d=window.turf.distance(window.turf.point(l),window.turf.point(c),{units:"nauticalmiles"}),j=window.turf.bearing(window.turf.point(l),window.turf.point(c)),v=window.turf.along(window.turf.lineString([l,c]),d*.5,{units:"nauticalmiles"});let N=null;const u=e||window.currentRouteStats;if(console.log(`Drawing leg ${a+1} with stats:`,{hasStats:!!u,hasLegs:!!(u&&u.legs),legCount:((n=u==null?void 0:u.legs)==null?void 0:n.length)||0,legHasTime:!!(u!=null&&u.legs&&((s=u==null?void 0:u.legs[a])!=null&&s.time)),windAdjusted:(u==null?void 0:u.windAdjusted)||!1}),u&&u.legs&&u.legs[a]){if(u.legs[a].time!==void 0){const k=u.legs[a].time,D=((r=u.aircraft)==null?void 0:r.cruiseSpeed)||135,E=d/D,x=Math.abs(k-E)<1,B=Math.round(k*60),M=Math.round(E*60);if(!x)console.error(`âŒ Leg ${a+1} time is unreasonable! Got ${k.toFixed(2)} hours (${B}m) but expected ~${E.toFixed(2)} hours (${M}m) based on distance ${d.toFixed(1)} nm at ${D} kts`),N=`${M}m`;else if(N=`${B}m`,u.windAdjusted&&u.legs[a].groundSpeed){const O=u.legs[a].headwind;O&&Math.abs(O)>5&&(N=`${B}m*`)}console.log(`Using leg time for leg ${a+1}: ${N} (${k.toFixed(3)} hours, ${B} minutes, wind-adjusted: ${u.windAdjusted})`)}u.legs[a].fuel&&Math.round(u.legs[a].fuel)}else if(u&&u.aircraft&&u.aircraft.cruiseSpeed){const k=u.aircraft.cruiseSpeed,D=d/k;N=`${Math.round(D*60)}m`,console.log(`Calculated time for leg ${a+1}: ${N} based on distance ${d.toFixed(1)} nm at speed ${k} kts (NO WIND ADJUSTMENT)`),u.aircraft.fuelBurn&&u.aircraft.fuelBurn}const T=`${d.toFixed(1)} nm`;let L="";N&&(N.includes("*"),L=N);const f=l[0],S=c[0]>f,g="â†",C="â†’";let R="";S||(R+=g+" "),R+=T,L&&(R+=` â€¢ ${L}`),S&&(R+=" "+C);let y=j;y+=90,y>90&&y<270&&(y=(y+180)%360),i.push({type:"Feature",geometry:v.geometry,properties:{isLabel:!0,bearing:j,textBearing:y,text:R,legIndex:a}})}return{type:"FeatureCollection",features:i}}removeWaypoint(t,e){if(console.log(`WaypointManager: Removing waypoint with ID ${t} at index ${e}`),(e===void 0||e<0||e>=this.waypoints.length)&&(console.log(`WaypointManager: Invalid index ${e}, searching by ID`),e=this.waypoints.findIndex(n=>n.id===t),e===-1)){console.error(`WaypointManager: Cannot find waypoint with ID ${t}`);return}const i=this.waypoints[e];if(this.markers[e]){console.log(`WaypointManager: Removing marker at index ${e}`);try{this.markers[e].remove()}catch(n){console.error("Error removing marker:",n)}}else console.warn(`WaypointManager: No marker found at index ${e}`);this.markers.splice(e,1),this.waypoints.splice(e,1),console.log(`WaypointManager: After removal, ${this.waypoints.length} waypoints and ${this.markers.length} markers remain`),this.updateRoute(),i&&this.triggerCallback("onWaypointRemoved",i),this.triggerCallback("onChange",this.waypoints)}updateRoute(t=null){const e=this.mapManager.getMap();if(e&&(e.getSource("route")&&(e.getLayer("route-glow")&&e.removeLayer("route-glow"),e.getLayer("route")&&e.removeLayer("route"),e.removeSource("route")),e.getSource("route-arrows")&&(e.getLayer("route-arrows")&&e.removeLayer("route-arrows"),e.getLayer("leg-labels")&&e.removeLayer("leg-labels"),e.removeSource("route-arrows")),this.waypoints.length>=2)){const i=this.waypoints.map(a=>a.coords);e.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:i}}}),e.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round","line-sort-key":1},paint:{"line-color":"#007bff","line-width":6,"line-opacity":.8}}),e.addLayer({id:"route-glow",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round",visibility:"visible","line-sort-key":0},paint:{"line-color":"#ffffff","line-width":10,"line-opacity":.15,"line-blur":3},filter:["==","$type","LineString"]},"route");const n=t||window.currentRouteStats,s=this.createArrowsAlongLine(i,n);if(e.addSource("route-arrows",{type:"geojson",data:s}),!e.hasImage("arrow-icon")){const l=document.createElement("canvas");l.width=24,l.height=24;const c=l.getContext("2d");c.clearRect(0,0,24,24),c.fillStyle="#ffffff",c.beginPath(),c.moveTo(24/2,0),c.lineTo(24,24),c.lineTo(24/2,24*.7),c.lineTo(0,24),c.closePath(),c.fill(),e.addImage("arrow-icon",{data:c.getImageData(0,0,24,24).data,width:24,height:24})}e.addLayer({id:"route-arrows",type:"symbol",source:"route-arrows",layout:{"symbol-placement":"point","icon-image":"arrow-icon","icon-size":.5,"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0,"symbol-sort-key":2,visibility:"none"},paint:{"icon-opacity":0},filter:["!",["has","isLabel"]]}),e.addLayer({id:"leg-labels",type:"symbol",source:"route-arrows",layout:{"symbol-placement":"point","text-field":["get","text"],"text-size":11,"text-font":["Arial Unicode MS Bold"],"text-offset":[0,-.5],"text-anchor":"center","text-rotate":["get","textBearing"],"text-rotation-alignment":"map","text-allow-overlap":!0,"text-ignore-placement":!0,"text-max-width":30,"text-line-height":1,"symbol-sort-key":3},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":3,"text-opacity":.9},filter:["has","isLabel"]});const r={waypoints:this.waypoints,coordinates:i};this.triggerCallback("onRouteUpdated",r),window.routeCalculator&&window.routeCalculator.calculateDistanceOnly(i)}}clearRoute(){const t=this.mapManager.getMap();this.markers.forEach(e=>{e.remove()}),this.markers=[],this.waypoints=[],t&&(t.getSource("route")&&(t.getLayer("route-glow")&&t.removeLayer("route-glow"),t.getLayer("route")&&t.removeLayer("route"),t.removeSource("route")),t.getSource("route-arrows")&&(t.getLayer("route-arrows")&&t.removeLayer("route-arrows"),t.getLayer("leg-labels")&&t.removeLayer("leg-labels"),t.removeSource("route-arrows"))),this.triggerCallback("onChange",this.waypoints)}reorderWaypoints(t,e){const i=this.waypoints.findIndex(a=>a.id===t),n=this.waypoints.findIndex(a=>a.id===e);if(i===-1||n===-1){console.error("Invalid waypoint IDs for reordering");return}const s=this.waypoints[i],r=this.markers[i];this.waypoints.splice(i,1),this.markers.splice(i,1),this.waypoints.splice(n,0,s),this.markers.splice(n,0,r),this.updateRoute(),console.log(`Reordered waypoint ${s.name} from index ${i} to ${n}`),this.triggerCallback("onChange",this.waypoints)}findPathInsertIndex(t){if(this.waypoints.length<2)return this.waypoints.length;let e=Number.MAX_VALUE,i=1;try{for(let n=0;n<this.waypoints.length-1;n++){const s=window.turf.lineString([this.waypoints[n].coords,this.waypoints[n+1].coords]),r=window.turf.point([t.lng,t.lat]),a=window.turf.nearestPointOnLine(s,r,{units:"nauticalmiles"});a.properties.dist<e&&(e=a.properties.dist,i=n+1)}}catch(n){return console.error("Error finding path insert index:",n),this.waypoints.length}return i}getWaypoints(){return this.waypoints}getWaypointById(t){return this.waypoints.find(e=>e.id===t)||null}updateWaypointName(t,e){const i=this.getWaypointById(t);i&&(i.name=e,this.triggerCallback("onChange",this.waypoints))}setupRouteDragging(t){const e=this.mapManager.getMap();if(!e)return;console.log("Setting up route dragging functionality");let i=!1,n=[],s=[],r=-1,a=null;const l=d=>{try{e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.addSource("drag-line",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:d}}}),e.addLayer({id:"drag-line",type:"line",source:"drag-line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ff0000","line-width":4,"line-dasharray":[2,1]}}),a=e.getSource("drag-line")}catch(j){console.error("Error adding drag line:",j)}},c=(d,j)=>{try{if(!e.getSource("route"))return null;const I=e.queryRenderedFeatures(j,{layers:["route"]}),v=I&&I.length>0,N=e.getSource("route");if(!N||!N._data)return null;const u=N._data.geometry.coordinates;if(!u||u.length<2)return null;let T=1/0,L=null,f=-1;for(let g=0;g<u.length-1;g++){const C=window.turf.lineString([u[g],u[g+1]]),R=window.turf.point([d.lng,d.lat]),y=window.turf.nearestPointOnLine(C,R);y.properties.dist<T&&(T=y.properties.dist,L=y.geometry.coordinates,f=g)}const p=window.turf.distance(window.turf.point([d.lng,d.lat]),window.turf.point(L),{units:"nauticalmiles"});return v||p<.5?{point:L,index:f,distance:p,isDirectlyOver:v}:null}catch(I){return console.error("Error finding closest point on line:",I),null}};e.on("mousedown",d=>{if(!e.getSource("route")||d.originalEvent.button===2||e.queryRenderedFeatures(d.point,{layers:["platforms-layer"]}).length>0)return;const I=d.lngLat,v=c(I,d.point);if(v){console.log("Starting route drag operation at segment:",v.index,"Distance:",v.distance.toFixed(2)+" nm","Directly over route:",v.isDirectlyOver);const N=e.getSource("route");if(!N||!N._data)return;s=[...N._data.geometry.coordinates],i=!0,v.point,r=v.index,n=[...s],n.splice(r+1,0,v.point),l(n),e.setLayoutProperty("route","visibility","none"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","none"),e.getCanvas().style.cursor="grabbing",d.preventDefault()}}),e.on("mousemove",d=>{if(i)n[r+1]=[d.lngLat.lng,d.lngLat.lat],a&&a.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}});else{const j=c(d.lngLat,d.point);j&&j.isDirectlyOver?e.getCanvas().style.cursor="pointer":e.getCanvas().style.cursor==="pointer"&&e.queryRenderedFeatures(d.point,{layers:["platforms-layer"]}).length===0&&(e.getCanvas().style.cursor="")}}),e.on("mouseup",d=>{i&&(i=!1,e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.setLayoutProperty("route","visibility","visible"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","visible"),t&&typeof t=="function"&&(console.log("Route drag complete, adding new point at index:",r+1),t(r+1,[d.lngLat.lng,d.lngLat.lat])),e.getCanvas().style.cursor="",n=[],s=[],r=-1,a=null)}),e.on("mouseout",()=>{i&&(console.log("Mouse left map area, canceling route drag"),i=!1,e.getSource("drag-line")&&(e.removeLayer("drag-line"),e.removeSource("drag-line")),e.setLayoutProperty("route","visibility","visible"),e.getLayer("route-glow")&&e.setLayoutProperty("route-glow","visibility","visible"),e.getCanvas().style.cursor="",n=[],s=[],r=-1,a=null)})}}class No{constructor(t){this.mapManager=t,this.platforms=[],this.isVisible=!0,this.callbacks={onPlatformsLoaded:null,onVisibilityChanged:null,onError:null},this.skipNextClear=!1}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}async loadPlatformsFromFoundry(t,e="GULF OF MEXICO"){const i=Z.show(".route-stats-title",`Loading platform data for ${e}...`,{position:"bottom"});if(this.skipNextClear?(console.log(`Skipping clearPlatforms due to skipNextClear flag for region: ${e}`),this.skipNextClear=!1):this.clearPlatforms(),console.log(`Loading platforms for region: ${e}`),e||(console.error("No region name provided - defaulting to GULF OF MEXICO"),e="GULF OF MEXICO"),!this.mapManager.getMap())return Z.hide(i),Promise.reject(new Error("Map is not initialized"));try{if(!t)return console.warn("No OSDK client provided - this may be expected on region changes"),Z.updateText(i,"No client available - reconnecting..."),setTimeout(()=>{Z.hide(i)},2e3),this.platforms=[],this.triggerCallback("onPlatformsLoaded",[]),[];console.log("Using OSDK client to load platforms...");try{const s=await rt(()=>import("./osdk-vendors-dAfwx3MD.js").then(u=>u.i),[],import.meta.url);let r=null;if(s.AllGtLocationsV2)r=s.AllGtLocationsV2;else if(s.AllGtLocations)r=s.AllGtLocations;else{const u=Object.keys(s).filter(T=>T.includes("Location")||T.includes("location"));if(u.length>0)r=s[u[0]];else throw new Error("No location-related objects found in SDK")}console.log(`Querying for platforms and airports in ${e}`),Z.updateText(i,`Querying for platforms in ${e}...`);const a=await t(r).where({region:e,locationType:{$ne:"REPORTING POINT OFFSHORE"}}).fetchPage({$pageSize:5e3,$filter:"locationType ne 'REPORTING POINT ONSHORE'"});if(console.log(`Found ${a.data?a.data.length:0} total items for region ${e}`),a.data&&a.data.length>0){const u=new Set;a.data.forEach(p=>{p.locationType&&u.add(p.locationType)}),console.log("All location types in results:",Array.from(u));const T=a.data.length;Z.updateText(i,`Filtering ${T} locations...`),a.data=a.data.filter(p=>{var g,C;if(p.activeSite!=="Active"||!p.locationType)return!1;const S=p.locationType.toUpperCase();return S.includes("REPORTING POINT")?!1:!!(S.includes("PLATFORM")||S.includes("RIG")||S.includes("VESSEL")||S.includes("SHIP")||S.includes("BLOCKS")||S.includes("JACKUP")||S.includes("MOVABLE")||S.includes("MOVEABLE")||S.includes("FPSO")||S.includes("TLP")||S.includes("SPAR")||S.includes("DRILL")||S.includes("PRODUCTION")||S.includes("OIL")||S.includes("GAS")||S.includes("JACKET")||S.includes("OFFSHORE")&&!S.includes("REPORTING")||p.ISAIRPORT==="Yes"||p.isAirport==="Yes"||S.includes("AIRPORT")||S.includes("AIRFIELD")||S.includes("BASE")||S.includes("HELIPORT")||p.region==="GULF OF MEXICO"&&((g=p.name)!=null&&g.startsWith("X")||(C=p.locName)!=null&&C.startsWith("X")))}),console.log(`Filtered from ${T} to ${a.data.length} ACTIVE items (platforms and airports)`);const L=T-a.data.length;console.log(`Filtered out ${L} inactive items (activeSite â‰  "Active")`);let f={};if(a.data.forEach(p=>{p.region&&(f[p.region]=(f[p.region]||0)+1)}),console.log("Platform count by region after filtering:",f),e==="NORWAY")["ENLE","ENWS","ENWV"].forEach(S=>{const g=a.data.some(C=>C.locName===S);console.log(`Platform ${S} found in filtered results: ${g}`)});else if(e==="GULF OF MEXICO"){console.log(`Gulf of Mexico platform count: ${a.data.filter(S=>!S.ISAIRPORT&&!S.isAirport).length}`);const p=a.data.filter(S=>!S.ISAIRPORT&&!S.isAirport).slice(0,5).map(S=>S.locName||"Unknown");console.log(`Sample Gulf of Mexico platforms: ${p.join(", ")}`)}}if(console.log(`Found ${a.data?a.data.length:0} items for region: ${e}`),a.data&&a.data.length>0){const u={};a.data.forEach(T=>{T.region&&(u[T.region]=(u[T.region]||0)+1)}),console.log("Region distribution in results:",u)}console.log(`Query returned ${a.data?a.data.length:0} results`),console.log("Running specific queries for critical locations...");const l=new Set;a.data&&a.data.forEach(u=>{u.locName&&l.add(u.locName)});try{console.log(`Specifically searching for airports in REGION: "${e}"`);const u=await t(r).where({region:e}).fetchPage({$pageSize:3e3});let T=[];if(u.data&&u.data.length>0&&(T=u.data.filter(L=>{if(!L)return!1;if(L.ISAIRPORT==="Yes"||L.isAirport==="Yes")return!0;if(L.locationType){const f=L.locationType.toUpperCase();return f.includes("AIRPORT")||f.includes("AIRFIELD")||f.includes("BASE")||f.includes("HELIPORT")}return!1})),T.length>0){console.log(`Found ${T.length} airports in region ${e}`),console.log("Sample airports:",T.slice(0,5).map(L=>L.locName||"Unknown")),a.data||(a.data=[]);for(const L of T)L.locName&&!l.has(L.locName)&&(a.data.push(L),l.add(L.locName))}else console.log(`No airports found in region ${e}`)}catch(u){console.warn("Error in airport-specific query:",u)}try{const T={"GULF OF MEXICO":["KHUM"],NORWAY:["ENZV","SVG","STAVANGER","SOLA"]}[e]||[];if(console.log(`Using standard filtering for all platform types in ${e}`),T.length>0){console.log(`Looking for critical locations in ${e}: ${T.join(", ")}`);for(const L of T)if(!l.has(L)){console.log(`Specifically searching for ${L} in ${e}...`);const f=await t(r).where({region:e,locName:L}).fetchPage({$pageSize:10});if(f.data&&f.data.length>0){console.log(`Found ${L} in ${e}!`),a.data||(a.data=[]);for(const p of f.data)p.locName&&!l.has(p.locName)&&(a.data.push(p),l.add(p.locName))}else console.log(`${L} not found in ${e} specific search`)}}else console.log(`No critical locations defined for region: ${e}`)}catch(u){console.warn("Error in critical location search:",u)}if(!a||!a.data)return console.error("No result data returned from API"),Promise.reject(new Error("No data returned from API"));if(console.log(`Successfully fetched ${a.data.length} items`),a.data.length>0){const u=a.data[0];console.log("Sample data structure:",Object.keys(u)),console.log("Sample item:",u);const T=[];for(const L of Object.keys(u)){const f=u[L];f&&typeof f=="object"&&(f.latitude!==void 0&&f.longitude!==void 0&&T.push(L),Array.isArray(f)&&f.length===2&&typeof f[0]=="number"&&typeof f[1]=="number"&&T.push(L),f.coordinates&&Array.isArray(f.coordinates)&&T.push(L))}console.log("Potential coordinate fields:",T)}const c=[],d=new Set;Z.updateText(i,`Processing ${a.data?a.data.length:0} locations...`);let j=0,I=0,v=0;const N={};if(a.data&&a.data.forEach(u=>{u.locationType&&(N[u.locationType]=(N[u.locationType]||0)+1)}),console.log("Location types in results:",N),!a.data||a.data.length===0)return console.warn("No data returned for processing"),[];for(const u of a.data){if(u.region&&u.region!==e){console.log(`Skipping item from wrong region: ${u.locName} (${u.region})`);continue}let T="",L=null,f="",p=!1,S=!1;if(u.locName)T=u.locName;else if(u.name)T=u.name;else if(u.location_name)T=u.location_name;else if(u.id)T=u.id.toString();else continue;if(!d.has(T)){if(u.geoPoint&&(typeof u.geoPoint.longitude=="number"&&typeof u.geoPoint.latitude=="number"?L=[u.geoPoint.longitude,u.geoPoint.latitude]:Array.isArray(u.geoPoint)&&u.geoPoint.length===2?L=u.geoPoint:u.geoPoint.coordinates&&Array.isArray(u.geoPoint.coordinates)&&(L=u.geoPoint.coordinates)),L||(u.LAT!==void 0&&u.LON!==void 0?L=[parseFloat(u.LON),parseFloat(u.LAT)]:u.lat!==void 0&&u.lon!==void 0?L=[parseFloat(u.lon),parseFloat(u.lat)]:u.latitude!==void 0&&u.longitude!==void 0&&(L=[parseFloat(u.longitude),parseFloat(u.latitude)])),!L){console.log(`Skipping ${T} - no coordinates found`);continue}if(u.locationType?f=u.locationType:u.type?f=u.type:u.location_type&&(f=u.location_type),f){const g=f.toUpperCase(),C=g.includes("PLATFORM")||g.includes("RIG")||g.includes("VESSEL")||g.includes("SHIP")||g.includes("JACKUP")||g.includes("FPSO")||g.includes("TLP")||g.includes("SPAR")||g.includes("DRILL")||g.includes("OFFSHORE"),R=g.includes("FIXED")&&g.includes("PLATFORM")||g==="FIXED PLATFORM";if(!C&&(g.includes("WAYPOINT")||g.includes("REPORTING POINT")||g.includes("FIX")||g.includes("INTERSECTION")||g.includes("NAVAID"))){console.log(`Skipping navigation point: ${T} (${f})`);continue}if(g.includes("REPORTING POINT"))continue;if(u.ISAIRPORT==="Yes"||u.isAirport==="Yes"||g.includes("AIRPORT")||g.includes("AIRFIELD")||g.includes("BASE")||g.includes("HELIPORT"))p=!0,S=!1;else if(g.includes("PLATFORM")||g.includes("RIG")||g.includes("VESSEL")||g.includes("SHIP")||g.includes("BLOCKS")||g.includes("JACKUP")||g.includes("FPSO")||g.includes("TLP")||g.includes("SPAR")||g.includes("DRILL")||g.includes("PRODUCTION")||g.includes("OIL")||g.includes("GAS")||g.includes("JACKET")||g.includes("OFFSHORE")&&!g.includes("REPORTING"))p=!1,g.includes("MOVABLE")||g.includes("MOVEABLE")||g.includes("SHIP")||g.includes("VESSEL")||g.includes("JACK-UP")||g.includes("JACKUP")||g.includes("DRILL SHIP")||g.includes("SEMI-SUBMERSIBLE")?S=!0:(g.includes("FIXED")||g.includes("STATIC"),S=!1);else if(u.region==="GULF OF MEXICO"&&(T.startsWith("X")||T.startsWith("K")))p=!1,S=!1;else continue}(T==="ENZV"||T==="SVG"||T.includes("STAVANGER")||T.includes("SOLA"))&&(p=!0,T==="ENZV"&&(!L||L[0]===0||L[1]===0)&&(L=[5.6316667,58.8816667])),(T==="KHUM"||T.includes("HOUMA"))&&(p=!0,T==="KHUM"&&(!L||L[0]===0||L[1]===0)&&(L=[-90.65383,29.55583])),p?v++:S?I++:j++,c.push({name:T,coordinates:L,operator:f||"Unknown",isAirfield:p,isMovable:S}),d.add(T)}}return console.log(`Processed ${c.length} locations (${v} airports, ${j} fixed platforms, ${I} movable platforms)`),Z.updateText(i,`Adding ${c.length} locations to map...`),c.length>0?(console.log(`Adding ${c.length} locations to map`),this.addPlatformsToMap(c),Z.hide(i),c):(console.warn("No valid locations found with coordinates"),Z.updateText(i,"No locations found for this region"),setTimeout(()=>{Z.hide(i)},2e3),this.platforms=[],this.triggerCallback("onPlatformsLoaded",[]),[])}catch(s){return console.error("OSDK API error:",s),Z.updateText(i,`Error loading platforms: ${s.message}`),setTimeout(()=>{Z.hide(i)},3e3),console.warn("Error occurred, returning empty locations array"),this.platforms=[],this.triggerCallback("onPlatformsLoaded",[]),[]}}catch(s){return console.error("General error in loadPlatformsFromFoundry:",s),Z.updateText(i,`Error: ${s.message}`),setTimeout(()=>{Z.hide(i)},3e3),this.platforms=[],this.triggerCallback("onPlatformsLoaded",[]),[]}}clearPlatforms(){const t=this.mapManager.getMap();t&&(console.log("Clearing all platforms from map"),this.mapManager.onMapLoaded(()=>{try{const e=["platforms-layer","platforms-fixed-layer","platforms-movable-layer","platforms-labels","platforms-fixed-labels","platforms-movable-labels","airfields-layer","airfields-labels"];for(const i of e)if(t.getLayer(i))try{t.removeLayer(i),console.log(`Successfully removed layer: ${i}`)}catch(n){console.warn(`Error removing layer ${i}:`,n)}setTimeout(()=>{if(t.getSource("major-platforms"))try{t.removeSource("major-platforms"),console.log("Successfully removed source: major-platforms")}catch(i){console.warn("Error removing source major-platforms:",i)}},100),this.platforms=[]}catch(e){console.error("Error clearing platforms:",e)}}))}addPlatformsToMap(t){if(!this.mapManager.getMap())return;const i=t.filter(r=>r.isAirfield).length,n=t.length-i;console.log(`Adding ${t.length} locations to map: ${n} platforms and ${i} airfields`),this.platforms=t;const s=()=>{const r=this.mapManager.getMap();if(!r){console.error("Map became unavailable before adding platforms."),this.triggerCallback("onError","Map became unavailable");return}if(!r.hasImage("airport-icon"))try{const c=document.createElement("canvas");c.width=16,c.height=16;const d=c.getContext("2d");d.beginPath(),d.arc(8,8,6,0,2*Math.PI),d.fillStyle="#043277",d.fill(),d.strokeStyle="#ffffff",d.lineWidth=1,d.stroke(),d.fillStyle="#ffffff",d.font="bold 8px sans-serif",d.textAlign="center",d.textBaseline="middle",d.fillText("A",8,8),r.addImage("airport-icon",{data:d.getImageData(0,0,16,16).data,width:16,height:16}),console.log("Created custom airport icon")}catch(a){console.error("Error creating airport icon:",a)}try{this.skipNextClear?(console.log("SKIPPING source/layer removal due to skipNextClear flag"),this.skipNextClear=!1):(console.log("Removing existing platform layers and sources..."),["platforms-layer","platforms-fixed-layer","platforms-movable-layer","platforms-fixed-labels","platforms-movable-labels","airfields-layer","airfields-labels"].forEach(N=>{if(r.getLayer(N))try{r.removeLayer(N)}catch(u){console.warn(`Error removing layer ${N}:`,u)}}),setTimeout(()=>{if(r.getSource("major-platforms"))try{r.removeSource("major-platforms")}catch(N){console.warn("Error removing source:",N)}},50));const a=r.getSource("major-platforms"),l=["ENLE","ENWS","ENWV","ENZV"];console.log("CHECKING PLATFORMS IN MAP DATA:"),l.forEach(v=>{const N=t.find(u=>u.name===v);console.log(N?`ðŸ—ºï¸ Found ${v} in map data at coordinates [${N.coordinates}]`:`â“ ${v} NOT found in map data`)}),console.log("Creating features for map display from",t.length,"platforms");let c=0,d=0,j=0;const I=t.map(v=>((!Array.isArray(v.coordinates)||v.coordinates.length!==2||typeof v.coordinates[0]!="number"||typeof v.coordinates[1]!="number")&&console.log(`âš ï¸ Platform ${v.name} has invalid coordinates: ${JSON.stringify(v.coordinates)}`),v.isAirfield?j++:v.isMovable?d++:c++,{type:"Feature",properties:{name:v.name,operator:v.operator||"Unknown",isAirfield:!!v.isAirfield,isMovable:!!v.isMovable},geometry:{type:"Point",coordinates:v.coordinates}}));if(console.log(`Created ${I.length} features for map:`),console.log(`- ${j} airfields`),console.log(`- ${c} fixed platforms`),console.log(`- ${d} movable platforms`),console.log("Adding source with features data"),a)try{const v=r.getSource("major-platforms");v&&typeof v.setData=="function"&&v.setData({type:"FeatureCollection",features:I})}catch(v){console.error("Error updating source data:",v)}else try{r.addSource("major-platforms",{type:"geojson",data:{type:"FeatureCollection",features:I}})}catch(v){if(v.message&&v.message.includes("already exists")){console.log("Source already exists, trying to update data instead");try{const N=r.getSource("major-platforms");N&&typeof N.setData=="function"&&N.setData({type:"FeatureCollection",features:I})}catch(N){console.error("Error updating source data:",N)}}}console.log("Adding fixed platforms layer"),r.addLayer({id:"platforms-layer",type:"circle",source:"major-platforms",filter:["all",["==",["get","isAirfield"],!1],["==",["get","isMovable"],!1]],paint:{"circle-radius":2,"circle-color":"#073b8e","circle-stroke-width":1,"circle-stroke-color":"#03bf42","circle-opacity":1}}),console.log("Adding movable platforms layer"),r.addLayer({id:"platforms-movable-layer",type:"circle",source:"major-platforms",filter:["all",["==",["get","isAirfield"],!1],["==",["get","isMovable"],!0]],paint:{"circle-radius":2,"circle-color":"#ad0303","circle-stroke-width":1,"circle-stroke-color":"#f2efef","circle-opacity":1}}),r.addLayer({id:"airfields-layer",type:"symbol",source:"major-platforms",filter:["==",["get","isAirfield"],!0],layout:{"icon-image":r.hasImage("airport-icon")?"airport-icon":"airport-15","icon-size":1,"icon-allow-overlap":!0,"icon-anchor":"bottom","icon-offset":[0,-5]}}),r.addLayer({id:"platforms-fixed-labels",type:"symbol",source:"major-platforms",filter:["all",["==",["get","isAirfield"],!1],["==",["get","isMovable"],!1]],layout:{"text-field":["get","name"],"text-size":10,"text-anchor":"top","text-offset":[0,.8],"text-allow-overlap":!1,"text-ignore-placement":!1,"symbol-sort-key":["get","name"]},paint:{"text-color":"#7192c4","text-halo-color":"#000000","text-halo-width":1}}),r.addLayer({id:"platforms-movable-labels",type:"symbol",source:"major-platforms",filter:["all",["==",["get","isAirfield"],!1],["==",["get","isMovable"],!0]],layout:{"text-field":["get","name"],"text-size":10,"text-anchor":"top","text-offset":[0,.8],"text-allow-overlap":!1,"text-ignore-placement":!1,"symbol-sort-key":["get","name"]},paint:{"text-color":"#7192c4","text-halo-color":"#000000","text-halo-width":1}}),r.addLayer({id:"airfields-labels",type:"symbol",source:"major-platforms",filter:["==",["get","isAirfield"],!0],layout:{"text-field":["get","name"],"text-size":12,"text-anchor":"top","text-offset":[0,.6],"text-allow-overlap":!1,"text-ignore-placement":!1,"symbol-sort-key":["get","name"]},paint:{"text-color":"#66aaff","text-halo-color":"#000000","text-halo-width":1.5}}),this.triggerCallback("onPlatformsLoaded",t)}catch(a){console.error("Error adding platforms to map:",a),this.triggerCallback("onError",a.message)}};console.log("Requesting to add layers/source, using onMapLoaded for timing."),this.mapManager.onMapLoaded(s)}toggleVisibility(){const t=this.mapManager.getMap();if(!t)return this.isVisible;this.isVisible=!this.isVisible;try{const e=["platforms-layer","platforms-fixed-layer","platforms-movable-layer","platforms-fixed-labels","platforms-movable-labels","airfields-layer","airfields-labels"],i=this.isVisible?"visible":"none";e.forEach(n=>{t.getLayer(n)&&t.setLayoutProperty(n,"visibility",i)})}catch(e){console.warn("Error toggling platform visibility:",e)}return this.triggerCallback("onVisibilityChanged",this.isVisible),this.isVisible}findNearestPlatform(t,e,i=5){if(!this.platforms||this.platforms.length===0)return console.log("PlatformManager: No platforms loaded, cannot find nearest platform"),null;if(!window.turf)return console.error("PlatformManager: Turf.js not loaded"),null;try{let n=null,s=Number.MAX_VALUE;if(this.platforms.forEach(r=>{if(!r.coordinates||r.coordinates.length!==2)return;const a=r.coordinates,l=window.turf.distance(window.turf.point([e,t]),window.turf.point(a),{units:"nauticalmiles"});l<s&&(s=l,n={name:r.name,operator:r.operator,coords:a,coordinates:a,lat:a[1],lng:a[0],distance:l})}),s<=i)return console.log(`PlatformManager: Found nearest platform ${n.name} at distance ${n.distance.toFixed(2)} nm`),n;n&&console.log(`PlatformManager: Nearest platform ${n.name} is too far (${n.distance.toFixed(2)} nm > ${i} nm)`)}catch(n){console.error("PlatformManager: Error finding nearest platform:",n)}return null}getPlatforms(){return this.platforms}getVisibility(){return this.isVisible}searchPlatformsByName(t,e=5){if(!t||!this.platforms||this.platforms.length===0)return[];const i=t.toLowerCase().trim();if(!i)return[];const n=this.platforms.filter(l=>l.name.toLowerCase()===i),s=this.platforms.filter(l=>l.name.toLowerCase().startsWith(i)&&!n.includes(l)),r=this.platforms.filter(l=>l.name.toLowerCase().includes(i)&&!n.includes(l)&&!s.includes(l));return[...n,...s,...r].slice(0,e)}findPlatformByName(t){if(!t||!this.platforms||this.platforms.length===0)return null;const e=t.toLowerCase().trim();if(!e)return null;console.log(`PlatformManager: Looking for platform with name: ${e}`);let i=this.platforms.find(n=>n.name.toLowerCase()===e);return i||(i=this.platforms.find(n=>n.name.toLowerCase().includes(e))),i?(console.log(`PlatformManager: Found platform "${i.name}" at coordinates [${i.coordinates}]`),i):(console.log(`PlatformManager: No platform found with name: ${e}`),null)}}class jo{constructor(){this.callbacks={onCalculationComplete:null}}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}calculateRouteStats(t,e={}){if(!window.turf)return console.error("RouteCalculator: Turf.js not loaded"),null;console.log("â­ RouteCalculator.calculateRouteStats called with:",{coordinates:t.length,options:e.selectedAircraft?`Aircraft: ${e.selectedAircraft.registration||"Unknown"}`:"No aircraft",weather:e.weather?`Wind ${e.weather.windSpeed}kts from ${e.weather.windDirection}Â°`:"No weather",forceTime:e.forceTimeCalculation?"true":"false"});const{selectedAircraft:i=null,payloadWeight:n=0,reserveFuel:s=0,weather:r=null,forceTimeCalculation:a=!1}=e;if(!i)return console.error("RouteCalculator: No aircraft data provided, calculating distance only"),this.calculateDistanceOnly(t);if(!i.cruiseSpeed)return console.error("RouteCalculator: Aircraft missing cruiseSpeed property"),a&&t&&t.length>=2?(console.log("â­ Forcing time calculation for map click even without proper aircraft data"),this.createBackupTimeCalculation(t,145)):this.calculateDistanceOnly(t);if(!i.fuelBurn)return console.error("RouteCalculator: Aircraft missing fuelBurn property"),a&&t&&t.length>=2?(console.log("â­ Forcing time calculation for map click even without complete aircraft data"),this.createBackupTimeCalculation(t,i.cruiseSpeed)):this.calculateDistanceOnly(t);const l=this.calculateRouteStatsLocally(t,null,i,n,s,r);if((!l||l.timeHours===0||!l.estimatedTime||l.estimatedTime==="00:00")&&(console.error("â­ RouteCalculator: Calculation produced invalid time results:",l),t.length>=2&&i.cruiseSpeed>0)){console.log("â­ RouteCalculator: Attempting to manually recalculate time...");let c=0;for(let N=0;N<t.length-1;N++){const u=window.turf.point(t[N]),T=window.turf.point(t[N+1]),L={units:"nauticalmiles"};c+=window.turf.distance(u,T,L)}const d=c/i.cruiseSpeed,j=Math.floor(d),I=Math.floor((d-j)*60),v=`${j.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`;console.log("â­ Manual time calculation:",{totalDistance:c,cruiseSpeed:i.cruiseSpeed,timeHours:d,estimatedTime:v}),l&&(l.timeHours=d,l.estimatedTime=v)}return console.log("â­ RouteCalculator final results:",{estimatedTime:l==null?void 0:l.estimatedTime,timeHours:l==null?void 0:l.timeHours,totalDistance:l==null?void 0:l.totalDistance,windAdjusted:(l==null?void 0:l.windAdjusted)||!1}),l}calculateDistanceOnly(t){if(!window.turf)return console.error("Turf.js not loaded"),null;let e=0,i=[];console.log("â­ RouteCalculator: Calculating distance for",t.length,"waypoints");for(let s=0;s<t.length-1;s++){const r=window.turf.point(t[s]),a=window.turf.point(t[s+1]),l={units:"nauticalmiles"},c=window.turf.distance(r,a,l);e+=c,console.log(`â­ RouteCalculator: Leg ${s+1} distance: ${c.toFixed(1)} nm`),i.push({from:t[s],to:t[s+1],distance:c.toFixed(1)})}console.log("â­ RouteCalculator: Total distance calculated:",e.toFixed(1),"nm");const n={totalDistance:e.toFixed(1),estimatedTime:"00:00",timeHours:0,legs:i,distanceOnly:!0};return this.triggerCallback("onCalculationComplete",n),n}calculateRouteStatsLocally(t,e,i,n,s,r){if(console.log("RouteCalculator: Starting calculation with:",{coordinatesLength:t==null?void 0:t.length,aircraftObject:i?`${i.registration||"Unknown"} (${i.modelType||"Unknown"})`:"None",weather:r,turf:!!window.turf}),!t||t.length<2)return console.error("RouteCalculator: Invalid coordinates - need at least 2 waypoints"),{totalDistance:"0",estimatedTime:"00:00",timeHours:0};if(!window.turf)return console.error("RouteCalculator: Turf.js not loaded"),{totalDistance:"0",estimatedTime:"00:00",timeHours:0};if(!i)return console.error("RouteCalculator: No aircraft object provided"),this.calculateDistanceOnly(t);if(!i.cruiseSpeed)return console.error("RouteCalculator: Aircraft object missing cruiseSpeed property"),this.calculateDistanceOnly(t);if(!i.fuelBurn)return console.error("RouteCalculator: Aircraft object missing fuelBurn property"),this.calculateDistanceOnly(t);const a=i;console.log("â­ RouteCalculator Stats Input:",{waypoints:t.length,aircraft:`${a.registration||"Unknown"} (${a.modelType||"Unknown"})`,cruiseSpeed:a.cruiseSpeed,fuelBurn:a.fuelBurn,weather:r?`${r.windSpeed}kts from ${r.windDirection}Â°`:"None"});let l=0,c=0,d=0,j=[],I=0,v=0;try{const R=window.WindCalculations||(typeof require<"u"?require("./calculations/WindCalculations"):null);if(!R)return console.error("â­ WindCalculations module not available"),this.calculateDistanceOnly(t);const{calculateLegWithWind:y,calculateCourse:k}=R;console.log("â­ RouteCalculator processing with weather:",r);for(let D=0;D<t.length-1;D++){const E={lat:t[D][1],lon:t[D][0]},x={lat:t[D+1][1],lon:t[D+1][0]};console.log(`â­ Processing leg ${D+1} from ${E.lat},${E.lon} to ${x.lat},${x.lon}`);const B=window.turf.point(t[D]),M=window.turf.point(t[D+1]),O={units:"nauticalmiles"},U=window.turf.distance(B,M,O);l+=U,console.log(`â­ Using weather for leg ${D+1}:`,r);const H=y(E,x,U,a,r);if(console.log(`â­ Leg ${D+1} details:`,{distance:U.toFixed(1),time:H.time.toFixed(2),groundSpeed:Math.round(H.groundSpeed),headwind:Math.round(H.headwindComponent),course:Math.round(H.course)}),isNaN(H.time)||H.time<=0){console.error(`â­ Invalid leg time for leg ${D+1}:`,H.time);const $=U/a.cruiseSpeed;console.log(`â­ Using fallback time calculation: ${$}`),c+=$}else c+=H.time;d+=H.fuel,I+=H.headwindComponent,v++,j.push({from:t[D],to:t[D+1],distance:U.toFixed(1),time:H.time,fuel:Math.round(H.fuel),course:H.course,groundSpeed:H.groundSpeed,headwind:H.headwindComponent})}}catch(R){return console.error("â­ RouteCalculator: Error calculating route with wind:",R),this.calculateDistanceOnly(t)}c===0&&l>0&&(console.error("â­ RouteCalculator: Zero time calculated for non-zero distance!"),c=l/a.cruiseSpeed,console.log(`â­ Forced time calculation: ${c} hours for ${l} nm`));const N=v>0?Math.round(I/v):0;console.log("RouteCalculator: Total route stats:",{distance:l.toFixed(1),time:c.toFixed(2),avgHeadwind:N});const u=Math.floor(c),T=Math.floor((c-u)*60),L=`${u.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`,f=Number(s)||0,p=Math.round(d+f);let S=0,g=0;a.maxTakeoffWeight&&a.emptyWeight?(S=Math.max(0,a.maxTakeoffWeight-a.emptyWeight-p-(Number(n)||0)),a.passengerWeight?g=Math.floor(S/a.passengerWeight):console.error("RouteCalculator: Missing passengerWeight data, cannot calculate max passengers")):console.error("RouteCalculator: Missing aircraft weight data, cannot calculate usable load");const C={totalDistance:l.toFixed(1),estimatedTime:L,timeHours:c,fuelRequired:p,tripFuel:Math.round(d),usableLoad:S,maxPassengers:g,aircraft:a,legs:j,windAdjusted:r&&r.windSpeed>0,windData:{windSpeed:r?r.windSpeed:0,windDirection:r?r.windDirection:0,avgHeadwind:N}};return console.log("ðŸ”„ RouteCalculator: Final route stats:",{distance:C.totalDistance,time:C.estimatedTime,timeHours:C.timeHours,tripFuel:C.tripFuel,legCount:C.legs.length,waypoints:t.length}),this.triggerCallback("onCalculationComplete",C),C}createBackupTimeCalculation(t,e){if(console.log("â­ Creating backup time calculation with cruise speed:",e),!window.turf)return console.error("RouteCalculator: Turf.js not loaded for backup calculation"),{totalDistance:"0",estimatedTime:"00:00",timeHours:0};if(!t||t.length<2||!e)return console.error("RouteCalculator: Invalid inputs for backup calculation"),{totalDistance:"0",estimatedTime:"00:00",timeHours:0};try{let i=0,n=[];for(let d=0;d<t.length-1;d++){const j=window.turf.point(t[d]),I=window.turf.point(t[d+1]),v={units:"nauticalmiles"},N=window.turf.distance(j,I,v);i+=N,n.push({from:t[d],to:t[d+1],distance:N.toFixed(1)})}const s=i/e,r=Math.floor(s),a=Math.floor((s-r)*60),l=`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;console.log("â­ Backup time calculation results:",{totalDistance:i.toFixed(1),timeHours:s,estimatedTime:l});const c={totalDistance:i.toFixed(1),estimatedTime:l,timeHours:s,legs:n,fuelRequired:Math.round(s*1100),tripFuel:Math.round(s*1100),usableLoad:0,maxPassengers:0};return this.triggerCallback("onCalculationComplete",c),c}catch(i){return console.error("RouteCalculator: Error in backup time calculation:",i),{totalDistance:"0",estimatedTime:"00:00",timeHours:0}}}}const To=[{id:"gulf-of-mexico",name:"Gulf of Mexico",center:[-90.5,27.5],zoom:6,bounds:[[-98,24],[-83,31]],osdkRegion:"GULF OF MEXICO"},{id:"norway",name:"Norway",center:[4,59],zoom:5.5,bounds:[[1,55],[9,63]],osdkRegion:"NORWAY"},{id:"united-kingdom",name:"United Kingdom",center:[-1.5,57],zoom:5.5,bounds:[[-5,51],[1,62]],osdkRegion:"UNITED KINGDOM"},{id:"west-africa",name:"West Africa",center:[5,2],zoom:5,bounds:[[-1,-5],[11,9]],osdkRegion:"NIGERIA"},{id:"brazil",name:"Brazil",center:[-38,-22],zoom:5,bounds:[[-45,-26],[-31,-18]],osdkRegion:"EAST BRAZIL"},{id:"australia",name:"Australia NW Shelf",center:[116,-19],zoom:5,bounds:[[110,-23],[122,-15]],osdkRegion:"WESTERN AUSTRALIA"}];class Lo{constructor(t,e){this.mapManager=t,this.platformManager=e,this.currentRegion=null,this.regions=To,this.callbacks={onRegionChanged:null,onRegionLoaded:null,onError:null}}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}getRegions(){return this.regions}getCurrentRegion(){return this.currentRegion}getRegionById(t){return this.regions.find(e=>e.id===t)||null}setRegion(t){const e=this.getRegionById(t);if(!e)return console.error(`Region with ID "${t}" not found`),this.triggerCallback("onError",`Region "${t}" not found`),null;console.log(`RegionManager: Setting region to ${t}`),window.staticDataLoaded=!1,window.platformsLoaded=!1,window.aircraftLoaded=!1,console.log("Cleared data flags for new region"),this.currentRegion=e;const i=this.mapManager.getMap();return i?(this.mapManager.onMapLoaded(()=>{try{i.fitBounds(e.bounds,{padding:50,maxZoom:e.zoom||6}),this.triggerCallback("onRegionChanged",e),this.platformManager&&(console.log(`Loading platforms for region: ${e.name}`),this.platformManager.loadPlatformsFromFoundry(null,e.osdkRegion).then(n=>{console.log(`Loaded ${n.length} platforms for ${e.name}`),this.triggerCallback("onRegionLoaded",{region:e,platforms:n})}).catch(n=>{console.error(`Error loading platforms for region ${e.name}:`,n),this.triggerCallback("onError",`Failed to load platforms for ${e.name}: ${n.message}`)}))}catch(n){console.error(`Error setting region ${e.name}:`,n),this.triggerCallback("onError",`Failed to set region ${e.name}: ${n.message}`)}}),e):(console.error("Cannot set region: Map is not initialized"),this.triggerCallback("onError","Map is not initialized"),null)}initialize(t="gulf-of-mexico"){this.mapManager.onMapLoaded(()=>{this.setRegion(t)})}}class Po{constructor(){this.favoriteLocations={},this.callbacks={onChange:null},this.loadFromLocalStorage(),Object.keys(this.favoriteLocations).length===0&&this.loadStaticData()}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}loadFromLocalStorage(){try{const t=localStorage.getItem("fastPlannerFavorites");t&&(this.favoriteLocations=JSON.parse(t),console.log("Loaded favorites from localStorage:",this.favoriteLocations))}catch(t){console.error("Error loading favorites from localStorage:",t),this.loadStaticData()}}saveToLocalStorage(){try{localStorage.setItem("fastPlannerFavorites",JSON.stringify(this.favoriteLocations)),console.log("Saved favorites to localStorage")}catch(t){console.error("Error saving favorites to localStorage:",t)}}loadStaticData(){console.log("Loading static favorites data"),this.favoriteLocations={"gulf-of-mexico":[{id:"khou",name:"Houston Hobby",coords:[-95.2789,29.6451]},{id:"kmsy",name:"New Orleans Intl",coords:[-90.2594,29.9934]},{id:"kgls",name:"Galveston",coords:[-94.8604,29.2653]},{id:"kefd",name:"Ellington Field",coords:[-95.1587,29.6073]}],norway:[{id:"enro",name:"FlorÃ¸ Airport",coords:[5.0256,61.5833]},{id:"enbr",name:"Bergen Airport",coords:[5.3214,60.2933]},{id:"engo",name:"Flesland Heliport",coords:[5.34,60.285]}],"united-kingdom":[{id:"egpd",name:"Aberdeen Airport",coords:[-2.1978,57.2047]},{id:"egjj",name:"Jersey Airport",coords:[-2.1978,49.2078]}],"west-africa":[{id:"dnmm",name:"Murtala Muhammed Intl",coords:[3.3222,6.5775]}],brazil:[{id:"sbrj",name:"Santos Dumont Airport",coords:[-43.1656,-22.91]}],australia:[{id:"ypph",name:"Perth Airport",coords:[115.9669,-31.9361]}]},this.saveToLocalStorage()}getFavoriteLocationsByRegion(t){return this.favoriteLocations[t]||[]}addFavoriteLocation(t,e){if(console.log(`Adding favorite location to region ${t}:`,e),this.favoriteLocations[t]||(this.favoriteLocations[t]=[]),!e.id){const n=new Date().getTime();e.id=`${e.name.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${n}`,console.log(`Generated ID for location: ${e.id}`)}this.favoriteLocations[t].some(n=>n.id===e.id||n.name===e.name&&Math.abs(n.coords[0]-e.coords[0])<.001&&Math.abs(n.coords[1]-e.coords[1])<.001)?console.log(`Favorite location "${e.name}" already exists in region "${t}"`):(this.favoriteLocations[t].push(e),console.log(`Added favorite location "${e.name}" to region "${t}"`),this.saveToLocalStorage(),this.callbacks.onChange?(console.log(`Triggering onChange callback for region ${t} with ${this.favoriteLocations[t].length} favorites`),this.callbacks.onChange({region:t,favorites:this.favoriteLocations[t]})):console.log("No onChange callback registered"))}removeFavoriteLocation(t,e){if(console.log(`Removing favorite location from region ${t} with ID: ${e}`),this.favoriteLocations[t]){const i=this.favoriteLocations[t].length;this.favoriteLocations[t]=this.favoriteLocations[t].filter(n=>n.id!==e),this.favoriteLocations[t].length<i?(console.log(`Removed favorite location with ID "${e}" from region "${t}"`),this.saveToLocalStorage(),this.callbacks.onChange?(console.log(`Triggering onChange callback for region ${t} with ${this.favoriteLocations[t].length} favorites after removal`),this.callbacks.onChange({region:t,favorites:this.favoriteLocations[t]})):console.log("No onChange callback registered")):(console.log(`Favorite location with ID "${e}" not found in region "${t}"`),console.log("Available IDs:",this.favoriteLocations[t].map(n=>n.id)))}else console.log(`Region "${t}" not found in favorites`)}}class Eo{constructor(){this.aircraftList=[],this.filteredAircraft=[],this.aircraftByRegion={},this.typesByRegion={},this.allAircraftLoaded=!1,this.selectedAircraft=null,this.callbacks={onAircraftLoaded:null,onAircraftFiltered:null,onAircraftSelected:null,onError:null},this.defaultPerformanceData={s92:{cruiseSpeed:0,fuelBurn:0,maxFuel:5e3,maxPassengers:19,maxRange:450,usefulLoad:7e3},s76:{cruiseSpeed:0,fuelBurn:0,maxFuel:3e3,maxPassengers:12,maxRange:400,usefulLoad:5e3},s76d:{cruiseSpeed:0,fuelBurn:0,maxFuel:3300,maxPassengers:12,maxRange:420,usefulLoad:5200},aw139:{cruiseSpeed:0,fuelBurn:0,maxFuel:4e3,maxPassengers:15,maxRange:400,usefulLoad:6e3},aw189:{cruiseSpeed:0,fuelBurn:0,maxFuel:4500,maxPassengers:16,maxRange:430,usefulLoad:6300},h175:{cruiseSpeed:0,fuelBurn:0,maxFuel:4200,maxPassengers:16,maxRange:440,usefulLoad:6500},h160:{cruiseSpeed:0,fuelBurn:0,maxFuel:3200,maxPassengers:12,maxRange:420,usefulLoad:4800},ec135:{cruiseSpeed:0,fuelBurn:0,maxFuel:2e3,maxPassengers:7,maxRange:350,usefulLoad:3300},ec225:{cruiseSpeed:0,fuelBurn:0,maxFuel:4800,maxPassengers:19,maxRange:450,usefulLoad:6800},as350:{cruiseSpeed:0,fuelBurn:0,maxFuel:1500,maxPassengers:6,maxRange:360,usefulLoad:2500},a119:{cruiseSpeed:0,fuelBurn:0,maxFuel:1800,maxPassengers:7,maxRange:380,usefulLoad:3e3}}}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}async loadAircraftFromOSDK(t){try{if(this.allAircraftLoaded&&this.aircraftList.length>0)return console.log("%c===== USING EXISTING AIRCRAFT DATA =====","background: #00a; color: #fff; font-size: 16px; font-weight: bold;"),console.log(`Using existing ${this.aircraftList.length} aircraft already loaded in memory`),this.triggerCallback("onAircraftLoaded",this.aircraftList),this.aircraftList;if(console.log("%c===== LOADING ALL AIRCRAFT DATA FROM OSDK =====","background: #00a; color: #fff; font-size: 16px; font-weight: bold;"),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator("Loading aircraft data..."),!t)throw new Error("OSDK client is not provided");try{const e=await rt(()=>import("./osdk-vendors-dAfwx3MD.js").then(r=>r.i),[],import.meta.url),i=e.Asset;if(!i)throw new Error(`Required 'Asset' object not found in SDK: ${Object.keys(e).join(", ")}`);console.log("Querying ALL aircraft data from OSDK...");const n=t(i);console.log("Executing fetchPage query for all aircraft...");const s=await n.fetchPage({$pageSize:1e3});return console.log(`Query returned ${s.data?s.data.length:0} aircraft`),s&&s.data?(console.log("%c===== PROCESSING AIRCRAFT DATA =====","background: #070; color: #fff; font-size: 14px;"),s.data.length>0&&console.log("Sample aircraft data fields:",Object.keys(s.data[0]).join(", ")),this.aircraftList=s.data.map(r=>{let a=r.regionName||"",l=r.orgUnit||"",c=r.assetIdentifier||"",d=r.acModelName||r.model||"",j="";j=this.determineAircraftType(d);const I=`${c} (${a})`;return{assetId:r.assetIdx||"",registration:I,rawRegistration:c,modelName:d,modelType:j,maxPassengers:r.maxPassengers||0,cruiseSpeed:r.cruseSpeed||0,fuelBurn:r.fuelBurn||0,maxFuel:r.maxFuelCapacity||0,dryWeight:r.dryOperatingWeightLbs||0,usefulLoad:r.usefulLoad||0,company:r.company||r.orgName||"Unknown",region:a,orgUnit:l,status:r.acStatus||"ACTIVE",rawData:r}}),this.aircraftList=this.aircraftList.filter(r=>!r.registration||!r.modelName||r.status==="INACTIVE"||r.status==="RETIRED"?!1:r.status&&(r.status.toUpperCase().includes("MAINTENANCE")||r.status.toUpperCase().includes("REPAIR")||r.status.toUpperCase().includes("OVERHAUL"))?(console.log(`Filtering out aircraft in maintenance: ${r.registration}, Status: ${r.status}`),!1):!0),console.log(`Processed ${this.aircraftList.length} valid aircraft`),console.log("Organizing aircraft by region and type..."),this.organizeAircraftByRegion(),this.allAircraftLoaded=!0,console.log(`Triggering onAircraftLoaded callback with ${this.aircraftList.length} aircraft`),this.triggerCallback("onAircraftLoaded",this.aircraftList),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator(`Loaded ${this.aircraftList.length} aircraft successfully`),this.aircraftList):(console.warn("No aircraft data in response"),this.aircraftList=[],this.triggerCallback("onAircraftLoaded",[]),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator("No aircraft data found"),[])}catch(e){throw console.error("Error with SDK import or query:",e),e}}catch(e){return console.error("Error loading aircraft from OSDK:",e),this.triggerCallback("onError",e),window.LoadingIndicator&&(window.LoadingIndicator.updateStatusIndicator("Error loading aircraft data"),window.LoadingIndicator.updateStatusIndicator("Please try again later")),this.aircraftList=[],this.triggerCallback("onAircraftLoaded",this.aircraftList),this.aircraftList}}organizeAircraftByRegion(){console.log("%c===== ORGANIZING AIRCRAFT BY REGION AND TYPE =====","background: #005; color: #fff; font-size: 14px;"),this.aircraftByRegion={},this.typesByRegion={};const t={},e={},i=new Set;console.log(`Total aircraft in raw list: ${this.aircraftList.length}`),this.aircraftList.length>0&&console.log("Sample aircraft data:",{region:this.aircraftList[0].region,type:this.aircraftList[0].modelType,registration:this.aircraftList[0].registration});const n=this.aircraftList.filter(r=>r.status!=="INACTIVE"&&r.status!=="RETIRED");if(console.log(`Total active aircraft: ${n.length} of ${this.aircraftList.length}`),this.aircraftList.forEach(r=>{const a=r.region||"Unknown",l=r.modelType||"S92";i.add(l),t[a]=(t[a]||0)+1,e[a]||(e[a]={}),e[a][l]=(e[a][l]||0)+1,this.aircraftByRegion[a]||(this.aircraftByRegion[a]={all:[],byType:{}}),this.aircraftByRegion[a].all.push(r),this.aircraftByRegion[a].byType[l]||(this.aircraftByRegion[a].byType[l]=[]),this.aircraftByRegion[a].byType[l].push(r),this.typesByRegion[a]||(this.typesByRegion[a]=[]),this.typesByRegion[a].includes(l)||this.typesByRegion[a].push(l)}),e["GULF OF MEXICO"]){console.log("%c===== GULF OF MEXICO AIRCRAFT BY TYPE =====","background: #00a; color: #fff;"),Object.entries(e["GULF OF MEXICO"]).forEach(([c,d])=>{console.log(`${c}: ${d} aircraft`)}),console.log("%c===== DETAILED AIRCRAFT INSPECTION IN GULF OF MEXICO =====","background: #f00; color: #fff;");const r=["N145JW","N290BG","N293BG","N524PB","N592BG","N692BG","N806AP","N920VH","N92EH"];console.log("CHECKING SPECIFIC REGISTRATIONS:"),r.forEach(c=>{const d=this.aircraftList.filter(j=>j.registration.includes(c));console.log(`${c}: Found ${d.length} matches`),d.forEach(j=>{console.log(`  - Registration: ${j.registration}`),console.log(`    Type: ${j.modelType}`),console.log(`    Model Name: ${j.modelName}`),console.log(`    Region: ${j.region}`),console.log(`    Status: ${j.status}`)})});const a=this.aircraftList.filter(c=>c.modelType==="S92"&&this.regionsMatch(c.region,"GULF OF MEXICO"));console.log(`Found ${a.length} S92 aircraft in Gulf of Mexico`),a.forEach(c=>{console.log(`Registration: ${c.registration}`),console.log(`Type: ${c.modelType}`),console.log(`Model Name: ${c.modelName}`),console.log(`Region: ${c.region}`),console.log(`Status: ${c.status}`),console.log("---------")});const l={};this.aircraftList.filter(c=>this.regionsMatch(c.region,"GULF OF MEXICO")).forEach(c=>{l[c.modelType]=(l[c.modelType]||0)+1}),console.log("Actual type counts in Gulf of Mexico:",l)}Object.entries({"GULF OF MEXICO":["US","GOM","MEXICO","UNITED STATES"],NIGERIA:["WEST AFRICA","AFRICAN"],"UNITED KINGDOM":["UK","BRITAIN","SCOTLAND"],"TRINIDAD AND TOBAGO":["TRINIDAD","TOBAGO"],BRAZIL:["BRAZIL EAST","BRAZILIAN","SOUTH AMERICA"],NORWAY:["NORWEGIAN","SCANDINAVIAN"],NETHERLANDS:["DUTCH","HOLLAND"],IRELAND:["IRISH"]}).forEach(([r,a])=>{this.aircraftByRegion[r]&&a.forEach(l=>{!this.aircraftByRegion[l]&&l!==r&&(this.aircraftByRegion[l]=this.aircraftByRegion[r],this.typesByRegion[l]=[...this.typesByRegion[r]],console.log(`Created alias mapping: ${l} -> ${r} with ${this.aircraftByRegion[r].all.length} aircraft`))})}),Object.keys(this.aircraftByRegion).forEach(r=>{i.forEach(a=>{this.aircraftByRegion[r].byType[a]||(this.aircraftByRegion[r].byType[a]=[])})}),console.log("Aircraft counts by region:",t),console.log(`Total regions with aircraft: ${Object.keys(this.aircraftByRegion).length}`),console.log(`Total known aircraft types: ${i.size}`),Object.keys(this.aircraftByRegion).forEach(r=>{console.log(`Region: ${r} - ${this.aircraftByRegion[r].all.length} total aircraft`);const a={};Object.keys(this.aircraftByRegion[r].byType).forEach(l=>{const c=this.aircraftByRegion[r].byType[l].length;c>0&&(a[l]=c)}),console.log(`Types available in ${r}:`,a)})}formatRegionForOSDK(t){if(!t)return"";console.log(`Formatting region: "${t}"`);const e={"gulf-of-mexico":"GULF OF MEXICO",gom:"GULF OF MEXICO","gulf of mexico":"GULF OF MEXICO","gulf-mexico":"GULF OF MEXICO",norway:"NORWAY","united-kingdom":"UNITED KINGDOM",uk:"UNITED KINGDOM","west-africa":"NIGERIA",nigeria:"NIGERIA",brazil:"BRAZIL","brazil-east":"BRAZIL EAST",australia:"AUSTRALIA",us:"GULF OF MEXICO",usa:"GULF OF MEXICO","united-states":"GULF OF MEXICO","united states":"GULF OF MEXICO",netherlands:"NETHERLANDS",trinidad:"TRINIDAD AND TOBAGO","trinidad-and-tobago":"TRINIDAD AND TOBAGO",ireland:"IRELAND"},i=t.toUpperCase();if(Object.values(e).includes(i))return console.log(`Region already in correct format: "${i}"`),i;const n=t.toLowerCase();if(e[n])return console.log(`Direct mapping found for "${t}": "${e[n]}"`),e[n];for(const[s,r]of Object.entries(e))if(n.includes(s)||s.includes(n))return console.log(`No exact region match for "${t}", using "${r}" as closest match`),r;return console.log(`No region mapping found for "${t}", defaulting to uppercase: "${i}"`),i}determineAircraftType(t){if(!t)return console.log("No model name provided, using UNKNOWN type"),"UNKNOWN";const e=t.toUpperCase(),i={S92:"S92","S-92":"S92",S92A:"S92",S76:"S76","S-76":"S76",S76D:"S76D","S-76D":"S76D",S76C:"S76","S-76C":"S76",SIKORSKY:"S92",AW139:"AW139","AW-139":"AW139",AW189:"AW189","AW-189":"AW189",AGUSTA:"AW139",LEONARDO:"AW139",AGUSTAWESTLAND:"AW139","AGUSTA WESTLAND":"AW139",A119:"A119",H175:"H175","H-175":"H175",H160:"H160","H-160":"H160",EC135:"EC135","EC-135":"EC135",EC225:"EC225","EC-225":"EC225",AS350:"AS350","AS-350":"AS350",AIRBUS:"H175"};if((e.includes("AS3")||e.includes("AS5"))&&(console.log(`Detected Airbus AS series in model name: ${t}`),e.includes("AS350")||e.includes("AS-350")))return"AS350";if(e.includes("AW119"))return"A119";const n=e.match(/\| (\w+\d+\w*)$/);if(n&&n[1])return console.log(`Found type ${n[1]} via regex from ${t}`),n[1];for(const[a,l]of Object.entries(i))if(e.includes(a))return console.log(`Found type ${l} by matching key ${a} in ${t}`),l;const s=e.match(/[A-Z]+\d+[A-Z]*/g);if(s&&s.length>0){const a=s[0];console.log(`Extracted potential type ${a} from ${t}`);for(const[l,c]of Object.entries(i))if(a.includes(l)||l.includes(a))return console.log(`Matched extracted type ${a} to known type ${c}`),c;return console.log(`Using extracted but unrecognized type: ${a}`),a}return console.log(`Unrecognized aircraft model: "${t}" - using as type`),t.split(" ")[0]}async loadStaticAircraftData(t=null){return console.error("âš ï¸ IMPORTANT - NEVER USE STATIC AIRCRAFT DATA! âš ï¸"),console.error("Static aircraft data should never be used. Real aircraft data should be loaded from OSDK."),this.aircraftList=[],this.triggerCallback("onAircraftLoaded",this.aircraftList),this.aircraftList}getAircraftByRegion(t){if(!t)return this.aircraftList;const e=this.formatRegionForOSDK(t);if(console.log(`Getting aircraft for region: ${e}`),e==="GULF OF MEXICO"){console.log("%c===== ALL AIRCRAFT IN GULF OF MEXICO =====","background: #00a; color: #fff;");const n=this.aircraftList.filter(s=>this.regionsMatch(s.region,e));console.log(`Total aircraft in Gulf of Mexico: ${n.length}`),n.forEach(s=>{console.log(`- ${s.registration} (${s.modelType}): Status=${s.status||"Unknown"}`)})}if(this.aircraftByRegion[e]){const n=this.aircraftByRegion[e].all;return console.log(`Found ${n.length} aircraft in ${e} from organized data`),n}console.log(`Region ${e} not found in pre-organized data, using flexible matching`);const i=this.aircraftList.filter(n=>{if(n.region&&this.regionsMatch(n.region,e)||n.orgUnit&&this.regionsMatch(n.orgUnit,e))return!0;const s=/\(([^)]+)\)/,r=n.registration.match(s),a=r?r[1]:"";return this.regionsMatch(a,e)});if(console.log(`Found ${i.length} aircraft in ${e} using flexible matching`),i.length>0&&!this.aircraftByRegion[e]){this.aircraftByRegion[e]={all:i,byType:{}};const n={};i.forEach(s=>{const r=s.modelType;n[r]||(n[r]=[]),n[r].push(s)}),this.aircraftByRegion[e].byType=n,this.typesByRegion[e]=Object.keys(n),console.log(`Added ${e} to organized data with ${i.length} aircraft`),console.log(`Types in ${e}:`,this.typesByRegion[e])}return i}getAvailableTypesInRegion(t){if(!t)return this.getAvailableTypes();const e=this.formatRegionForOSDK(t);if(console.log(`Getting available types for region: ${e}`),this.typesByRegion[e]){const s=this.typesByRegion[e].filter(r=>this.aircraftByRegion[e]&&this.aircraftByRegion[e].byType[r]&&this.aircraftByRegion[e].byType[r].length>0);return console.log(`Found ${s.length} types with aircraft in ${e}:`,s),s}console.log(`Region ${e} not found in pre-calculated data, trying flexible matching`);for(const s of Object.keys(this.typesByRegion))if(this.regionsMatch(s,e)){console.log(`Found matching region: ${s} matches ${e}`);const r=this.typesByRegion[s].filter(a=>this.aircraftByRegion[s]&&this.aircraftByRegion[s].byType[a]&&this.aircraftByRegion[s].byType[a].length>0);return console.log(`Found ${r.length} types with aircraft in ${s} (match for ${e}):`,r),this.typesByRegion[e]=r,r}console.log(`No matching region found, computing types for ${e}`);const i=this.getAircraftByRegion(t),n=[...new Set(i.map(s=>s.modelType))].filter(Boolean);return this.typesByRegion[e]=n,console.log(`Computed ${n.length} types for ${e}:`,n),n}filterAircraft(t=null,e=null){console.log("%c===== FILTERING AIRCRAFT =====","background: #ff0; color: #000; font-size: 16px; font-weight: bold;"),console.log(`Region: "${t}", Type: "${e}"`),console.log(`Filtering aircraft for ${t||"all regions"}${e?`, type: ${e}`:""}`);let i=[],n=null;if(t)if(n=this.formatRegionForOSDK(t),console.log(`Formatted region name: "${n}"`),this.aircraftByRegion[n]&&this.aircraftByRegion[n].all)i=[...this.aircraftByRegion[n].all],console.log(`Using pre-organized data: ${i.length} aircraft in ${n}`);else{console.log(`Region "${n}" not found in pre-organized data, trying flexible matching`);let r=!1;for(const a of Object.keys(this.aircraftByRegion))if(this.regionsMatch(a,n)){console.log(`Found matching region: "${a}" matches "${n}"`),i=[...this.aircraftByRegion[a].all],console.log(`Using data from matched region: ${i.length} aircraft in ${a}`),this.aircraftByRegion[n]=this.aircraftByRegion[a],this.typesByRegion[n]=this.typesByRegion[a]||[],r=!0;break}r||(console.log("No matching pre-organized region found, using manual filtering"),i=this.aircraftList.filter(a=>this.regionsMatch(a.region,n)),console.log(`Manually filtered to ${i.length} aircraft for region "${n}"`))}else i=[...this.aircraftList],console.log(`No region specified, using all ${i.length} aircraft`);if(e&&e!=="all"&&e!=="")if(n&&this.aircraftByRegion[n]&&this.aircraftByRegion[n].byType&&this.aircraftByRegion[n].byType[e])i=[...this.aircraftByRegion[n].byType[e]],console.log(`Using pre-organized type data: ${i.length} ${e} aircraft in ${n}`);else{console.log(`Filtering by type "${e}" using flexible matching`);const r=i.filter(a=>a.modelType===e);r.length>0?(console.log(`Found ${r.length} direct type matches for ${e}`),i=r):(console.log(`No direct matches for type ${e}, using flexible matching`),i=i.filter(a=>{if(this.typesMatch(a.modelType,e))return!0;const l=/\|\s*(\S+)$/,c=a.registration.match(l),d=c?c[1]:"";return this.typesMatch(d,e)||a.modelName&&this.typesMatch(a.modelName,e)}),console.log(`Found ${i.length} aircraft using flexible type matching`))}if(n==="GULF OF MEXICO"&&(e==="S92"||!e)){const r=i.filter(c=>c.modelType==="S92");console.log(`%c===== S92 AIRCRAFT AFTER FILTERING (count: ${r.length}) =====`,"background: #f00; color: #fff;"),r.forEach(c=>{console.log(`- Registration: ${c.registration}`),console.log(`  Model: ${c.modelName}`),console.log(`  Type: ${c.modelType}`),console.log(`  Region: ${c.region}`),console.log(`  Status: ${c.status||"Unknown"}`)});const a=r.map(c=>c.registration),l=new Set(a);if(a.length!==l.size){console.log("%câš ï¸ WARNING: FOUND DUPLICATE REGISTRATIONS IN S92 AIRCRAFT","background: #f00; color: #ff0; font-weight: bold;");const c={};a.forEach(d=>{c[d]=(c[d]||0)+1});for(const[d,j]of Object.entries(c))j>1&&console.log(`Registration ${d} appears ${j} times!`)}}this.filteredAircraft=i,this.showFilteringResults(i.length,t,e);const s={};return t&&!e&&n&&this.aircraftByRegion[n]?(console.log(`Using pre-calculated type buckets for region ${n}`),Object.keys(this.aircraftByRegion[n].byType).forEach(r=>{s[r]=this.aircraftByRegion[n].byType[r]})):(console.log("Creating type buckets from filtered aircraft"),this.getAvailableTypes().forEach(a=>{s[a]=[]}),i.forEach(a=>{const l=a.modelType||"S92";s[l]||(s[l]=[]),s[l].push(a)})),this.filteredAircraft,this.triggerCallback("onAircraftFiltered",this.filteredAircraft),this.filteredAircraft}showFilteringResults(t,e,i){const n=e?this.formatRegionForOSDK(e):"All Regions";console.log(`Aircraft filtered: ${t} aircraft found for ${n}, ${i||"All Types"}`);try{window.LoadingIndicator&&typeof window.LoadingIndicator.updateStatusIndicator=="function"&&window.LoadingIndicator.updateStatusIndicator(`Found: ${t} aircraft`)}catch(r){console.error("Error updating status indicator:",r)}}filterAircraftByRegion(t,e=null){return console.log(`Filtering aircraft by region: ${t}`),this.filterAircraft(t,e)}resetAircraftForRegion(){console.log("Resetting filtered aircraft for region change"),this.filteredAircraft=[],this.triggerCallback("onAircraftFiltered",[])}getAircraftCountsByType(t){if(!t)return{};const e=this.formatRegionForOSDK(t);if(console.log(`Getting aircraft counts by type for region: ${e}`),this.aircraftByRegion[e]){const s={};return Object.keys(this.aircraftByRegion[e].byType).forEach(r=>{s[r]=this.aircraftByRegion[e].byType[r].length}),s}const i=this.getAircraftByRegion(t),n={};return i.forEach(s=>{const r=s.modelType||"S92";n[r]=(n[r]||0)+1}),n}getAvailableTypes(){return[...new Set(this.aircraftList.map(e=>e.modelType))].filter(e=>e)}getAircraftByRegistration(t){return this.aircraftList.find(e=>e.registration===t)||null}selectAircraft(t){const e=this.getAircraftByRegistration(t);e?(this.selectedAircraft=e,this.triggerCallback("onAircraftSelected",e)):console.warn(`Aircraft with registration ${t} not found`)}getPerformanceData(t,e=null){var i,n,s,r,a;if(e){const l=this.getAircraftByRegistration(e);if(l)return{cruiseSpeed:l.cruiseSpeed||((i=this.defaultPerformanceData[t])==null?void 0:i.cruiseSpeed)||145,fuelBurn:l.fuelBurn||((n=this.defaultPerformanceData[t])==null?void 0:n.fuelBurn)||1100,maxFuel:l.maxFuel||((s=this.defaultPerformanceData[t])==null?void 0:s.maxFuel)||5e3,maxPassengers:l.maxPassengers||((r=this.defaultPerformanceData[t])==null?void 0:r.maxPassengers)||19,usefulLoad:l.usefulLoad||((a=this.defaultPerformanceData[t])==null?void 0:a.usefulLoad)||7e3}}return this.defaultPerformanceData[t]||this.defaultPerformanceData.s92}calculateRoutePerformance(t,e,i={}){const n=this.getPerformanceData(t,i.registration),s=i.payloadWeight||2e3,r=i.reserveFuel||600;let a=0;for(let T=0;T<e.length-1;T++){const[L,f]=e[T],[p,S]=e[T+1],g=3440.07,C=this.toRad(S-f),R=this.toRad(p-L),y=Math.sin(C/2)*Math.sin(C/2)+Math.cos(this.toRad(f))*Math.cos(this.toRad(S))*Math.sin(R/2)*Math.sin(R/2),k=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),D=g*k;a+=D}const l=a/n.cruiseSpeed,c=l*n.fuelBurn+r,d=n.usefulLoad-c,I=Math.floor((d-s)/200),v=Math.floor(l),N=Math.round((l-v)*60),u=`${v.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`;return{totalDistance:Math.round(a),flightTime:l,formattedTime:u,fuelRequired:Math.round(c),usableLoad:Math.round(d),maxPassengers:Math.max(0,I),aircraft:n}}regionsMatch(t,e){if(!t||!e)return!1;const i=t.toUpperCase().trim(),n=e.toUpperCase().trim();if(i===n||i.includes(n)||n.includes(i))return!0;const s={"GULF OF MEXICO":["US","GOM","MEXICO","UNITED STATES"],NIGERIA:["WEST AFRICA","AFRICAN"],"UNITED KINGDOM":["UK","BRITAIN","SCOTLAND"],"TRINIDAD AND TOBAGO":["TRINIDAD","TOBAGO"],BRAZIL:["BRAZIL EAST","BRAZILIAN","SOUTH AMERICA"],NORWAY:["NORWEGIAN","SCANDINAVIAN"],NETHERLANDS:["DUTCH","HOLLAND"],IRELAND:["IRISH"]};for(const[r,a]of Object.entries(s))if(i===r&&a.some(l=>n.includes(l))||n===r&&a.some(l=>i.includes(l))||a.some(l=>i.includes(l))&&n===r||a.some(l=>n.includes(l))&&i===r)return!0;return!1}typesMatch(t,e){if(!t||!e)return!1;const i=t.toUpperCase().trim(),n=e.toUpperCase().trim();if(i===n)return!0;const s=i.match(/^[A-Z]+\d+/),r=n.match(/^[A-Z]+\d+/);if(s&&r&&s[0]===r[0]||i.includes(n)||n.includes(i))return!0;const a={S92:["S92A","S-92","S-92A","SIKORSKY 92"],S76:["S76D","S76C","S-76","S-76C","S-76D","SIKORSKY 76"],AW139:["AW-139","AGUSTA 139","AGUSTA WESTLAND 139"],AW189:["AW-189","AGUSTA 189","AGUSTA WESTLAND 189"],H175:["H-175","EC175","EC-175","AIRBUS 175"],H160:["H-160","EC160","EC-160","AIRBUS 160"],EC135:["EC-135","EUROCOPTER 135","H135","H-135"],EC225:["EC-225","H225","H-225","EUROCOPTER 225"],AS350:["AS-350","EUROCOPTER 350","H125","H-125"]};for(const[l,c]of Object.entries(a))if(i===l&&c.some(d=>n.includes(d))||n===l&&c.some(d=>i.includes(d))||c.some(d=>i.includes(d))&&n===l||c.some(d=>n.includes(d))&&i===l)return!0;return!1}toRad(t){return t*(Math.PI/180)}}class Mo{constructor(){this.defaults={passengerWeight:0,contingencyFuelPercent:10,taxiFuel:50,reserveFuel:0,deckTimePerStop:5,deckFuelFlow:400,callbacks:{}},this.config={...this.defaults}}updateConfig(t){console.log("FlightCalculations: Updating config with:",t);const e={};Object.keys(t).forEach(i=>{i!=="callbacks"&&(this.defaults.hasOwnProperty(i)||i==="payloadWeight")&&(e[i]=t[i])}),this.config={...this.config,...e},console.log("FlightCalculations: Config updated:",this.config)}setCallback(t,e){typeof e=="function"&&(this.config.callbacks[t]=e)}calculateFlightStats(t,e,i={}){var z;if(!t||t.length<2||!e)return console.error("Invalid inputs for flight calculations"),null;console.log("FlightCalculations: calculateFlightStats called with:",{coordinates:t.length+" waypoints",aircraft:e.registration||"Generic aircraft",params:i});const n={...this.config,...i};console.log("FlightCalculations: Using calculation parameters:",n);const{cruseSpeed:s=145,fuelBurn:r=0,maxFuelCapacity:a=5e3,maxFuel:l=5e3,dryOperatingWeightLbs:c=15e3,emptyWeight:d=0,usefulLoad:j=7e3,maxPassengers:I=19}=e,v=e.cruiseSpeed||s,N=c||d,u=this.calculateTotalDistance(t),T=t.length-1,L=u/v,f=this.formatTimeHHMM(L),p=L*r,S=Math.max(0,T-1),g=S*n.deckTimePerStop/60,C=g*n.deckFuelFlow,R=p*(n.contingencyFuelPercent/100),y=n.taxiFuel,k=n.reserveFuel,D=Math.round(p+C+R+y+k),E=n.payloadWeight||0,x=N+j,B=Math.max(0,j-D),M=Math.floor((B-E)/n.passengerWeight),O=Math.min(M,I),U=L+g,H=this.formatTimeHHMM(U),$={totalDistance:u.toFixed(1),timeHours:L,estimatedTime:f,deckTimeMinutes:S*n.deckTimePerStop,totalTimeHours:U,totalTimeFormatted:H,fuelRequired:Math.round(p),tripFuel:Math.round(p),deckFuel:Math.round(C),contingencyFuel:Math.round(R),taxiFuel:y,reserveFuel:k,totalFuel:D,dryOperatingWeight:N,maxTakeoffWeight:x,usefulLoad:j,usableLoad:B,maxPassengers:I,maxPassengersByWeight:M,calculatedPassengers:O,aircraft:e,numStops:T,intermediateStops:S};return console.log("FlightCalculations: Calculation results:",{totalDistance:$.totalDistance,estimatedTime:$.estimatedTime,totalFuel:$.totalFuel,calculatedPassengers:$.calculatedPassengers}),(z=this.config.callbacks)!=null&&z.onCalculationComplete&&this.config.callbacks.onCalculationComplete($),$}calculateTotalDistance(t){let e=0;for(let i=0;i<t.length-1;i++){const n=window.turf.point(t[i]),s=window.turf.point(t[i+1]);try{const a=window.turf.distance(n,s,{units:"kilometers"})*.539957;e+=a}catch(r){console.error("Error calculating leg distance:",r)}}return e}calculateLegTime(t,e,i,n=null){const s=window.turf.point(t),r=window.turf.point(e),a=window.turf.distance(s,r,{units:"kilometers"})*.539957;return a/i}formatTimeHHMM(t){if(typeof t!="number")return"00:00";const e=Math.floor(t),i=Math.floor((t-e)*60);return`${e.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}}class Io{constructor(t,e,i){this.mapManager=t,this.waypointManager=e,this.platformManager=i,this.isInitialized=!1,this.callbacks={onLeftPanelOpen:null,onMapClick:null,onRouteClick:null,onPlatformClick:null,onError:null}}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e)}initialize(){if(console.log("MapInteractionHandler: Initializing map interaction handlers"),!this.mapManager||!this.waypointManager||!this.platformManager)return console.error("MapInteractionHandler: Missing required managers"),this.triggerCallback("onError","Missing required managers"),!1;const t=this.mapManager.getMap();return t?(t.off("click"),t.on("click",this.handleMapClick.bind(this)),typeof this.waypointManager.setupRouteDragging=="function"&&this.waypointManager.setupRouteDragging(this.handleRouteDragComplete.bind(this)),this.isInitialized=!0,console.log("MapInteractionHandler: Map interactions initialized successfully"),!0):(console.error("MapInteractionHandler: Map is not initialized"),this.triggerCallback("onError","Map is not initialized"),!1)}handleMapClick(t){if(console.log("MapInteractionHandler: Map click detected",t.lngLat),!this.mapManager||!this.waypointManager||!this.platformManager){console.error("MapInteractionHandler: Required managers not initialized");return}const e=this.mapManager.getMap();if(e){this.triggerCallback("onLeftPanelOpen");try{const i=e.queryRenderedFeatures(t.point,{layers:["platforms-fixed-layer","platforms-movable-layer","airfields-layer"]});if(i&&i.length>0){console.log("MapInteractionHandler: Clicked on platform:",i[0].properties.name);const n=i[0].properties,s=i[0].geometry.coordinates.slice();this.handlePlatformClick(s,n.name);return}}catch(i){console.error("MapInteractionHandler: Error handling platform click:",i)}try{const i=e.queryRenderedFeatures(t.point,{layers:["route"]});if(i&&i.length>0){console.log("MapInteractionHandler: Clicked on route line");const n=this.waypointManager.findPathInsertIndex(t.lngLat),s=this.platformManager.findNearestPlatform(t.lngLat.lat,t.lngLat.lng);this.handleRouteClick(t.lngLat,n,s);return}}catch(i){console.error("MapInteractionHandler: Error handling route click:",i)}try{const i=this.platformManager.findNearestPlatform(t.lngLat.lat,t.lngLat.lng);i&&i.distance<1?(console.log(`MapInteractionHandler: Using nearest rig: ${i.name} (${i.distance.toFixed(1)} nm away)`),this.handlePlatformClick(i.coordinates,i.name)):this.handleMapBackgroundClick(t.lngLat)}catch(i){console.error("MapInteractionHandler: Error handling map background click:",i),this.handleMapBackgroundClick(t.lngLat)}}}handlePlatformClick(t,e){this.callbacks.onPlatformClick?this.triggerCallback("onPlatformClick",{coordinates:t,name:e}):this.waypointManager.addWaypoint(t,e)}handleRouteClick(t,e,i){this.callbacks.onRouteClick?this.triggerCallback("onRouteClick",{lngLat:t,insertIndex:e,nearestRig:i}):i&&i.distance<2?this.waypointManager.addWaypointAtIndex(i.coordinates,i.name,e):this.waypointManager.addWaypointAtIndex([t.lng,t.lat],null,e)}handleMapBackgroundClick(t){const e=this.platformManager.findNearestPlatform(t.lat,t.lng,2);if(console.log(`MapInteractionHandler: ðŸŒ Map click at [${t.lng}, ${t.lat}]`),console.log(e?`MapInteractionHandler: ðŸŒ Found nearest rig: ${e.name} at distance ${e.distance.toFixed(2)} nm`:"MapInteractionHandler: ðŸŒ No rig found within 2 nautical miles"),this.callbacks.onMapClick){const i={lngLat:t,coordinates:[t.lng,t.lat],mapClickSource:"directClick"};if(e){let n;Array.isArray(e.coordinates)?n=e.coordinates:Array.isArray(e.coords)?n=e.coords:e.lng!==void 0&&e.lat!==void 0?n=[e.lng,e.lat]:(console.error("MapInteractionHandler: ðŸŒ Invalid rig coordinates format:",e),n=[t.lng,t.lat]),i.nearestRig={...e,coordinates:n,name:e.name||"Unknown"}}console.log("MapInteractionHandler: ðŸŒ Triggering onMapClick with data:",i),this.triggerCallback("onMapClick",i)}else if(e&&e.distance<=2){console.log(`MapInteractionHandler: ðŸŒ Snapping to rig ${e.name}`);const i=e.coords||[e.lng,e.lat];this.waypointManager.addWaypoint(i,e.name),setTimeout(()=>{console.log("MapInteractionHandler: ðŸŒ Forcing route update for map click"),this.waypointManager&&this.waypointManager.updateRoute&&this.waypointManager.updateRoute()},50)}else console.log("MapInteractionHandler: ðŸŒ Adding waypoint at clicked point"),this.waypointManager.addWaypoint([t.lng,t.lat]),setTimeout(()=>{console.log("MapInteractionHandler: ðŸŒ Forcing route update for map click"),this.waypointManager&&this.waypointManager.updateRoute&&this.waypointManager.updateRoute()},50)}handleRouteDragComplete(t,e){console.log(`MapInteractionHandler: Route dragged at index ${t}`,e);try{const i=this.platformManager.findNearestPlatform(e[1],e[0],2);i&&i.distance<2?(console.log(`MapInteractionHandler: Using nearest rig for drag: ${i.name} (${i.distance.toFixed(1)} nm away)`),this.waypointManager.addWaypointAtIndex(i.coordinates,i.name,t)):this.waypointManager.addWaypointAtIndex(e,null,t)}catch(i){console.error("MapInteractionHandler: Error handling route drag:",i),this.waypointManager.addWaypointAtIndex(e,null,t)}}}class $o{constructor(){this.defaultSettings={region:"gulf-of-mexico",aircraft:{type:"",registration:""},flightSettings:{passengerWeight:220,contingencyFuelPercent:10,taxiFuel:50,reserveFuel:600,deckTimePerStop:5,deckFuelFlow:400},uiSettings:{leftPanelVisible:!0,rightPanelVisible:!0,platformsVisible:!0,appVersion:"1.0"}},this.settings={...this.defaultSettings},this.callbacks={onChange:null,onRegionChange:null,onAircraftChange:null,onFlightSettingsChange:null,onUISettingsChange:null},this.loadSettings(),console.log("AppSettingsManager initialized with settings:",this.settings)}setCallback(t,e){this.callbacks.hasOwnProperty(t)&&(this.callbacks[t]=e)}triggerCallback(t,e){this.callbacks[t]&&this.callbacks[t](e),t!=="onChange"&&this.callbacks.onChange&&this.callbacks.onChange(this.settings)}loadSettings(){try{const t=localStorage.getItem("fastPlannerSettings");if(t){const e=JSON.parse(t);this.settings={...this.defaultSettings,...e,flightSettings:{...this.defaultSettings.flightSettings,...e.flightSettings||{}},aircraft:{...this.defaultSettings.aircraft,...e.aircraft||{}},uiSettings:{...this.defaultSettings.uiSettings,...e.uiSettings||{}}},console.log("Loaded settings from localStorage:",this.settings)}else console.log("No saved settings found, using defaults")}catch(t){console.error("Error loading settings from localStorage:",t),this.settings={...this.defaultSettings}}}saveSettings(){try{localStorage.setItem("fastPlannerSettings",JSON.stringify(this.settings)),console.log("Saved settings to localStorage")}catch(t){console.error("Error saving settings to localStorage:",t)}}getAllSettings(){return{...this.settings}}setRegion(t){this.settings.region=t,this.saveSettings(),this.triggerCallback("onRegionChange",t)}getRegion(){return this.settings.region}setAircraft(t,e){this.settings.aircraft={type:t||"",registration:e||""},this.saveSettings(),this.triggerCallback("onAircraftChange",this.settings.aircraft)}getAircraft(){return{...this.settings.aircraft}}updateFlightSettings(t){this.settings.flightSettings={...this.settings.flightSettings,...t},this.saveSettings(),this.triggerCallback("onFlightSettingsChange",this.settings.flightSettings)}getFlightSettings(){return{...this.settings.flightSettings}}updateUISettings(t){this.settings.uiSettings={...this.settings.uiSettings,...t},this.saveSettings(),this.triggerCallback("onUISettingsChange",this.settings.uiSettings)}getUISettings(){return{...this.settings.uiSettings}}resetToDefaults(){this.settings={...this.defaultSettings},this.saveSettings(),this.triggerCallback("onChange",this.settings)}}const Do=()=>{window.LoadingIndicator&&window.LoadingIndicator.initializeRouteStatsLoader&&setTimeout(()=>{window.LoadingIndicator.initializeRouteStatsLoader()},1e3)},Oo=()=>{const{isAuthenticated:m,userDetails:t,userName:e,login:i}=xt(),n=F.useRef(null),s=F.useRef(null),r=F.useRef(null),a=F.useRef(null),l=F.useRef(null),c=F.useRef(null),d=F.useRef(null),j=F.useRef(null),I=F.useRef(null),v=F.useRef(null);F.useEffect(()=>{Do()},[]);const[N,u]=F.useState(0),[T,L]=F.useState(""),[f,p]=F.useState([]),[S,g]=F.useState([]),[C,R]=F.useState(!1),[y,k]=F.useState(!0),[D,E]=F.useState(!0),[x,B]=F.useState(!1),[M,O]=F.useState(!1),[U,H]=F.useState(null),[$,z]=F.useState([]),[te,_]=F.useState([]),[me,xe]=F.useState([]),[q,ke]=F.useState(null),[fe,he]=F.useState(!1),[ae,Re]=F.useState(""),[De,ve]=F.useState(""),[V,Ye]=F.useState(null),[st,vt]=F.useState([]),[Uo,bt]=F.useState([]),[Qe,lt]=F.useState({}),[wt,Ae]=F.useState(!1),[Ct,St]=F.useState(2e3),[ie,Ne]=F.useState(600),[ye,be]=F.useState(null),[Q,kt]=F.useState({windSpeed:15,windDirection:270}),[re,qe]=F.useState({passengerWeight:0,contingencyFuelPercent:10,taxiFuel:50,reserveFuel:0,deckTimePerStop:5,deckFuelFlow:400}),[Oe,je]=F.useState(5),[ct,Ke]=F.useState(100),[We,Te]=F.useState(400),[Be,Le]=F.useState(220),[le,Xe]=F.useState(0),[Ue,Pe]=F.useState(50),[Je,Ee]=F.useState(10),[At,Ft]=F.useState("fixed"),we=(b,W)=>{switch(b){case"passengerWeight":Le(W);break;case"deckTimePerStop":je(W);break;case"deckFuelFlow":Te(W);break;case"deckFuelPerStop":Ke(W);break;case"taxiFuel":Pe(W);break;case"contingencyFuelPercent":Ee(W);break;case"cargoWeight":Xe(W);break;case"reserveMethod":Ft(W);break;default:console.warn(`Unknown flight setting: ${b}`)}const h={...re,[b]:W};if(qe(h),j.current&&j.current.updateConfig(h),v.current&&v.current.updateFlightSettings({[b]:W}),V&&s.current&&s.current.getWaypoints().length>=2){const A=s.current.getWaypoints().map(w=>w.coords);a.current.calculateRouteStats(A,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:h.reserveFuel||ie,weather:Q})}};F.useEffect(()=>{if(console.log("FastPlannerApp: Initializing managers..."),!se){console.error("OSDK Client Error: client is null or undefined");const h=document.createElement("div");h.style.position="fixed",h.style.top="0",h.style.left="0",h.style.right="0",h.style.bottom="0",h.style.backgroundColor="rgba(0, 0, 0, 0.6)",h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center",h.style.zIndex="9999";const A=document.createElement("div");A.style.backgroundColor="white",A.style.padding="20px",A.style.borderRadius="8px",A.style.maxWidth="500px",A.style.textAlign="center",A.innerHTML=`
        <h3 style="color: #dc3545; margin-top: 0;">OSDK Client Error</h3>
        <p>The Palantir OSDK client failed to initialize properly. This will prevent loading aircraft and platform data.</p>
        <p>Error: Client is null or undefined</p>
        <p>Please reload the page and try again. If the problem persists, check the console for more details.</p>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
          <button id="dismiss-btn" style="padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; background-color: #f8f9fa; color: #212529;">Dismiss</button>
          <button id="reload-btn" style="padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; background-color: #007bff; color: white;">Reload Page</button>
        </div>
      `,h.appendChild(A),document.body.appendChild(h),document.getElementById("dismiss-btn").addEventListener("click",()=>{document.body.removeChild(h)}),document.getElementById("reload-btn").addEventListener("click",()=>{window.location.reload()})}if(n.current||(console.log("FastPlannerApp: Creating MapManager instance"),n.current=new Fo,setTimeout(()=>{console.log("FastPlannerApp: Delayed map initialization"),n.current.loadScripts().then(()=>(console.log("FastPlannerApp: Scripts loaded, initializing map..."),n.current.initializeMap("fast-planner-map"))).then(h=>{console.log("FastPlannerApp: Map initialization complete"),et&&et(h),d.current&&se&&(console.log("Loading aircraft after map initialization"),d.current.loadAircraftFromOSDK(se).then(()=>{console.log("Aircraft loaded successfully"),u(A=>A+1)}).catch(A=>{console.error("Error loading aircraft:",A)}))}).catch(h=>{console.error("FastPlannerApp: Error initializing map:",h)})},500)),c.current||(console.log("FastPlannerApp: Creating FavoriteLocationsManager instance"),c.current=new Po,c.current.setCallback("onChange",h=>{if(q){console.log(`Favorites changed, updating UI for region ${q.id}`);const A=c.current.getFavoriteLocationsByRegion(q.id);g(A)}})),!r.current&&n.current&&(console.log("FastPlannerApp: Creating PlatformManager instance"),r.current=new No(n.current)),!l.current&&n.current&&r.current&&(console.log("FastPlannerApp: Creating RegionManager instance"),l.current=new Lo(n.current,r.current),l.current.setCallback("onRegionLoaded",h=>{console.log(`Region loaded: ${h.region.name}`),he(!1)}),l.current.setCallback("onRegionChanged",h=>{if(console.log(`Region changed to: ${h.name}`),ke(h),c.current&&h){console.log(`Loading favorites for region ${h.id}`);const A=c.current.getFavoriteLocationsByRegion(h.id);console.log(`Found ${A.length} favorites for region ${h.id}:`,A),g(A)}}),l.current.setCallback("onError",h=>{console.error(`Region manager error: ${h}`),he(!1)})),s.current||(console.log("FastPlannerApp: Creating WaypointManager instance"),s.current=new Ro(n.current)),s.current&&r.current&&s.current.setPlatformManager(r.current),a.current||(console.log("FastPlannerApp: Creating RouteCalculator instance"),a.current=new jo,window.routeCalculator=a.current,a.current.setCallback("onCalculationComplete",h=>{var w,P,G,K,J;if(console.log("ðŸ”„ Route calculation complete with stats:",{totalDistance:h==null?void 0:h.totalDistance,estimatedTime:h==null?void 0:h.estimatedTime,timeHours:h==null?void 0:h.timeHours,legCount:((w=h==null?void 0:h.legs)==null?void 0:w.length)||0,hasWind:(h==null?void 0:h.windAdjusted)||!1}),!h||!h.timeHours||h.timeHours===0){console.error("ðŸ”„ Received invalid route stats with zero time:",h);return}const A={...ye};if(be(h),window.currentRouteStats=h,s.current){const X=((P=A==null?void 0:A.windData)==null?void 0:P.windSpeed)!==((G=h==null?void 0:h.windData)==null?void 0:G.windSpeed)||((K=A==null?void 0:A.windData)==null?void 0:K.windDirection)!==((J=h==null?void 0:h.windData)==null?void 0:J.windDirection);console.log("ðŸ”„ Forcing route display update with new stats, wind changed:",X),s.current.updateRoute(null),setTimeout(()=>{s.current.updateRoute(h),console.log("ðŸ”„ Route display updated with new stats")},50)}if(h&&$.length>=2&&V){console.log("ðŸ”„ Generating stop cards with stats:",{totalDistance:h.totalDistance,estimatedTime:h.estimatedTime,timeHours:h.timeHours});const X=Ce($,h,V,Q);console.log("ðŸ”„ Generated stop cards:",X.map(Y=>({leg:Y.index+1,legTime:Y.legTime,totalTime:Y.totalTime}))),_(X)}}),console.log("FastPlannerApp: RouteCalculator configured with accurate wind calculations")),d.current||(console.log("FastPlannerApp: Creating AircraftManager instance"),d.current=new Eo,d.current.setCallback("onAircraftLoaded",h=>{console.log(`Loaded ${h.length} total aircraft`),vt(h),q&&d.current.filterAircraft(q.id)}),d.current.setCallback("onAircraftFiltered",(h,A)=>{if(console.log(`Filtered to ${h.length} aircraft of type ${A||"all"}`),A)lt(w=>({...w,[A]:h}));else{const w={},P=[];h.forEach(G=>{const K=G.modelType||"Unknown";w[K]||(w[K]=[],P.push(K)),w[K].push(G)}),console.log(`Available aircraft types: ${P.join(", ")}`),bt(P),lt(w)}Ae(!1)})),j.current||(console.log("FastPlannerApp: Creating FlightCalculations instance"),j.current=new Mo,j.current.updateConfig({passengerWeight:Be,contingencyFuelPercent:Je,taxiFuel:Ue,reserveFuel:ie,deckTimePerStop:Oe,deckFuelFlow:We}),rt(()=>import("./WindCalculations-CIwjEqfX.js"),[],import.meta.url).then(h=>{window.WindCalculations=h,console.log("WindCalculations module imported and made globally available")}).catch(h=>{console.error("Failed to import WindCalculations module:",h)})),!v.current){console.log("FastPlannerApp: Creating AppSettingsManager instance"),v.current=new $o,v.current.setCallback("onRegionChange",P=>{console.log(`AppSettingsManager: Region changed to ${P}`)}),v.current.setCallback("onAircraftChange",P=>{console.log(`AppSettingsManager: Aircraft changed to ${P.type} ${P.registration}`),P.type!==ae&&Re(P.type),P.registration!==De&&ve(P.registration)}),v.current.setCallback("onFlightSettingsChange",P=>{console.log("AppSettingsManager: Flight settings changed"),qe(P),Le(P.passengerWeight),Ee(P.contingencyFuelPercent),Pe(P.taxiFuel),Ne(P.reserveFuel),je(P.deckTimePerStop),Te(P.deckFuelFlow)}),v.current.setCallback("onUISettingsChange",P=>{console.log("AppSettingsManager: UI settings changed"),C!==P.leftPanelVisible&&R(P.leftPanelVisible),y!==P.rightPanelVisible&&k(P.rightPanelVisible),D!==P.platformsVisible&&E(P.platformsVisible)});const h=v.current.getAllSettings(),A=h.flightSettings;Le(A.passengerWeight),Ee(A.contingencyFuelPercent),Pe(A.taxiFuel),Ne(A.reserveFuel||600),je(A.deckTimePerStop),Te(A.deckFuelFlow);const w=h.uiSettings;R(w.leftPanelVisible),k(w.rightPanelVisible),E(w.platformsVisible)}!I.current&&n.current&&s.current&&r.current&&(console.log("FastPlannerApp: Creating MapInteractionHandler instance"),I.current=new Io(n.current,s.current,r.current),I.current.setCallback("onLeftPanelOpen",()=>{C||(console.log("Opening left panel due to map click"),R(!0))}),I.current.setCallback("onMapClick",async h=>{console.log("ðŸ—ºï¸ Map click callback received",h);try{const A={...h};await tt(A)}catch(A){console.error("Error processing map click:",A)}}),I.current.setCallback("onPlatformClick",async h=>{console.log("ðŸ¢ Platform click callback received",h);try{const A={...h};await tt(A)}catch(A){console.error("Error processing platform click:",A)}}),I.current.setCallback("onRouteClick",async h=>{console.log("ðŸ›£ï¸ Route click callback received",h);try{const A={...h};A.nearestRig&&A.nearestRig.distance<1?(console.log("ðŸ›£ï¸ Adding rig at route click:",A.nearestRig.name),s.current.addWaypointAtIndex(A.nearestRig.coordinates,A.nearestRig.name,A.insertIndex)):(console.log("ðŸ›£ï¸ Adding waypoint at route click"),s.current.addWaypointAtIndex([A.lngLat.lng,A.lngLat.lat],null,A.insertIndex));const w=s.current.getWaypoints();if(await new Promise(P=>{z([...w]),setTimeout(P,0)}),w.length>=2&&V){const P=w.map(G=>G.coords);if(console.log("ðŸ›£ï¸ Manually recalculating route for route click"),a.current){console.log("ðŸ›£ï¸ Direct calculation for route click");const G=a.current.calculateRouteStats(P,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q});if(G&&G.timeHours>0){console.log("ðŸ›£ï¸ Directly updating route stats from calculation:",{distance:G.totalDistance,time:G.estimatedTime}),await new Promise(J=>{be(G),setTimeout(J,0)});const K=Ce(w,G,V,Q);await new Promise(J=>{_(K),setTimeout(J,0)}),u(J=>J+1)}}}}catch(A){console.error("Error processing route click:",A)}}),I.current.setCallback("onError",h=>{console.error(`MapInteractionHandler error: ${h}`)}));const b=h=>{const{key:A,settings:w}=h.detail;console.log(`Saving settings for ${A}:`,w);try{if(localStorage.setItem(`fastPlanner_settings_${A}`,JSON.stringify(w)),console.log(`Successfully saved settings for ${A}`),V&&A===`aircraft_${V.registration}`){if(console.log("Updating current flight settings with saved aircraft settings"),w.passengerWeight!==void 0&&Le(w.passengerWeight),w.contingencyFuelPercent!==void 0&&Ee(w.contingencyFuelPercent),w.taxiFuel!==void 0&&Pe(w.taxiFuel),w.reserveFuel!==void 0&&Ne(w.reserveFuel),w.deckTimePerStop!==void 0&&je(w.deckTimePerStop),w.deckFuelFlow!==void 0&&Te(w.deckFuelFlow),w.deckFuelPerStop!==void 0&&Ke(w.deckFuelPerStop),w.cargoWeight!==void 0&&Xe(w.cargoWeight),v.current&&v.current.updateFlightSettings({passengerWeight:w.passengerWeight,contingencyFuelPercent:w.contingencyFuelPercent,taxiFuel:w.taxiFuel,reserveFuel:w.reserveFuel,deckTimePerStop:w.deckTimePerStop,deckFuelFlow:w.deckFuelFlow}),V&&s.current&&s.current.getWaypoints().length>=2){const P=s.current.getWaypoints().map(G=>G.coords);a.current.calculateRouteStats(P,{aircraftType:V.modelType||"s92",payloadWeight:w.cargoWeight||le||0,reserveFuel:w.reserveFuel||ie,weather:Q})}u(P=>P+1)}}catch(P){console.error(`Error saving settings for ${A}:`,P)}},W=()=>{if(console.log("Settings changed event received, forcing UI update"),u(h=>h+1),s.current&&s.current.getWaypoints().length>=2){const h=s.current.getWaypoints().map(A=>A.coords);if(a.current&&a.current.calculateDistanceOnly(h),V){a.current.calculateRouteStats(h,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q});const A=Ce($,ye,V,Q);_(A)}}};return window.addEventListener("save-aircraft-settings",b),window.addEventListener("settings-changed",W),u(h=>h+1),()=>{window.removeEventListener("save-aircraft-settings",b),window.removeEventListener("settings-changed",W)}},[Be,Je,Ue,ie,Oe,We,$.length,V]);const et=b=>{if(console.log("ðŸ—ºï¸ Map is ready",b),l.current){console.log("ðŸ—ºï¸ Initializing regions..."),he(!0),xe(l.current.getRegions());const W=v.current?v.current.getRegion():"gulf-of-mexico";console.log(`ðŸ—ºï¸ Initializing with region: ${W}`),l.current.initialize(W)}I.current&&(console.log("ðŸ—ºï¸ Initializing map interaction handler..."),s.current&&(s.current.setCallback("onChange",h=>{if(console.log(`ðŸ—ºï¸ Waypoints changed, now ${h.length} waypoints`),z([...h]),h.length>=2&&a.current){const A=h.map(P=>P.coords);console.log("ðŸ—ºï¸ Calculating basic distance for updated waypoints");const w=a.current.calculateDistanceOnly(A);(!ye||!ye.timeHours)&&(console.log("ðŸ—ºï¸ No aircraft-based stats available, using distance-only results"),be(w)),V&&(console.log("ðŸ—ºï¸ Calculating full route stats with aircraft"),a.current.calculateRouteStats(A,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q}))}}),s.current.setCallback("onRouteUpdated",h=>{if(console.log(`ðŸ—ºï¸ Route updated with ${h.waypoints.length} waypoints`),a.current&&h.coordinates&&h.coordinates.length>=2&&a.current.calculateDistanceOnly(h.coordinates),V&&h.waypoints.length>=2){const A=h.waypoints.map(w=>w.coords);a.current.calculateRouteStats(A,{aircraftType:V.modelType||"s92",payloadWeight:le||0,reserveFuel:ie,weather:Q})}})),I.current.initialize()?console.log("Map interaction handler initialized successfully"):console.error("Failed to initialize map interaction handler"))},Rt=()=>{const b=!C;R(b),v.current&&v.current.updateUISettings({leftPanelVisible:b});const W=document.querySelector(".route-editor-panel");W&&(b?W.style.animation="slideInFromLeft 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards":W.style.animation="slideOutToLeft 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards")},Nt=()=>{const b=!y;k(b),v.current&&v.current.updateUISettings({rightPanelVisible:b});const W=document.querySelector(".info-panel");W&&(b?W.style.animation="slideInFromRight 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards":W.style.animation="slideOutToRight 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards")},jt=b=>{L(b)},Ce=(b,W,h,A)=>{if(b.length<2||!h)return[];if(!h.cruiseSpeed||!h.fuelBurn)return console.log("generateStopCardsData: Aircraft missing required properties"),[];console.log("Generating stop cards with weather data:",A);const w=[];let P=0,G=0,K=0,J=0,X=0;const Y=h;K+=Ue||50,K+=ie,!window.turf&&a.current&&console.warn("Turf.js not loaded, using routeStats legs for distances");for(let oe=0;oe<b.length-1;oe++){const ce=b[oe],de=b[oe+1],He=de.id||`waypoint-${oe}`;let pe=0;if(W&&W.legs&&W.legs[oe])pe=parseFloat(W.legs[oe].distance);else if(window.turf){const Fe=window.turf.point(ce.coords),ze=window.turf.point(de.coords),ue={units:"nauticalmiles"};pe=window.turf.distance(Fe,ze,ue)}let ee=0,Se=0,Me=Y.cruiseSpeed,Ie=0;const Ht=ce.lat&&ce.lon||ce.coords&&ce.coords.length===2,zt=de.lat&&de.lon||de.coords&&de.coords.length===2;if(Ht&&zt){const Fe={lat:ce.lat||ce.coords[1],lon:ce.lon||ce.coords[0]},ze={lat:de.lat||de.coords[1],lon:de.lon||de.coords[0]};if(window.WindCalculations)try{console.log(`Calculating leg ${oe} with wind: ${Fe.lat},${Fe.lon} to ${ze.lat},${ze.lon}`);const ue=window.WindCalculations.calculateLegWithWind(Fe,ze,pe,Y,A);console.log(`Leg ${oe} calculation results:`,{time:ue.time,fuel:ue.fuel,groundSpeed:ue.groundSpeed,headwind:ue.headwindComponent}),ee=ue.time,Se=Math.round(ue.fuel),Me=Math.round(ue.groundSpeed),Ie=Math.round(ue.headwindComponent)}catch(ue){console.warn("Error calculating leg with wind:",ue),ee=pe/Y.cruiseSpeed,Se=Math.round(ee*Y.fuelBurn),Me=Y.cruiseSpeed,Ie=0}else ee=pe/Y.cruiseSpeed,Se=Math.round(ee*Y.fuelBurn),Me=Y.cruiseSpeed,Ie=0,console.warn("WindCalculations not available, using basic time calculation")}else ee=pe/Y.cruiseSpeed,Se=Math.round(ee*Y.fuelBurn);P+=pe,G+=ee,K+=Se;let ot=0,ut=0;oe>0&&(ot=Oe/60,ut=Math.round(ot*We),J+=ot,X+=ut);let Ze=0;if(h){const Fe=Math.max(0,h.maxTakeoffWeight-h.emptyWeight-K-X);Ze=Math.floor(Fe/Be),Ze=Math.min(Ze,h.maxPassengers||19)}const $e={index:oe,id:He,stopName:de.name,legDistance:pe.toFixed(1),totalDistance:P.toFixed(1),legTime:Number(ee),totalTime:Number(G+J),legFuel:Number(Se),totalFuel:Number(K+X),maxPassengers:Number(Ze),groundSpeed:Number(Me),headwind:Number(Ie),deckTime:Number(J*60),deckFuel:Number(X)};console.log(`Stop card ${oe} data:`,{stopName:$e.stopName,legTime:$e.legTime,cumulativeTime:G,deckTime:J*60,totalTime:$e.totalTime,legFuel:$e.legFuel,cumulativeFuel:K,deckFuel:X,totalFuel:$e.totalFuel}),w.push($e)}return console.log("All stop cards generated, cards count:",w.length),w},Tt=(b,W)=>{console.log("ðŸŒ¬ï¸ updateWeatherSettings called with:",b,W);const h=parseInt(b)||0,A=((parseInt(W)||0)%360+360)%360,w={windSpeed:h,windDirection:A};if(console.log(`ðŸŒ¬ï¸ Updating weather settings: Wind ${w.windSpeed} kts from ${w.windDirection}Â°`),console.log("ðŸŒ¬ï¸ Old weather state:",Q),kt(w),console.log("ðŸŒ¬ï¸ Weather state updated to:",w),u(P=>P+1),V&&s.current&&s.current.getWaypoints().length>=2){const P=s.current.getWaypoints().map(G=>G.coords);if(console.log(`ðŸŒ¬ï¸ Recalculating route with weather: Wind ${w.windSpeed} kts from ${w.windDirection}Â°`),s.current&&(console.log("ðŸŒ¬ï¸ Forcing immediate route display update to clear old wind data"),s.current.updateRoute(null)),a.current.calculateRouteStats(P,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:w,forceTimeCalculation:!0}),setTimeout(()=>{if(s.current){const G=window.currentRouteStats||ye;console.log("ðŸŒ¬ï¸ Forcing delayed route display update after weather change with stats:",G?{time:G.estimatedTime,windAdjusted:G.windAdjusted}:"No stats"),s.current.updateRoute(G),u(K=>K+1)}},300),$.length>=2&&V){console.log(`ðŸŒ¬ï¸ Generating new stop cards with updated weather: ${w.windSpeed} kts from ${w.windDirection}Â°`);const G=Ce($,ye,V,w);_(G)}}},tt=async b=>{var W,h;if(s.current){let A,w,P=!1;if(console.log("ðŸŒ FastPlannerApp: Adding waypoint with data:",b),Array.isArray(b))A=b,w=null;else if(typeof b=="string")if(console.log(`ðŸŒ Looking for location with name: ${b}`),r.current){console.log(`ðŸŒ Searching for platform with name: ${b}`);const K=r.current.findPlatformByName(b);if(K)console.log(`ðŸŒ Found platform: ${K.name} at ${K.coordinates}`),A=K.coordinates,w=K.name;else{if(console.log(`ðŸŒ Platform not found with name: ${b}`),window.LoadingIndicator)window.LoadingIndicator.updateStatusIndicator(`Platform "${b}" not found. Please check spelling or click on map.`,"error");else{const J=document.createElement("div");J.style.position="fixed",J.style.bottom="20px",J.style.left="50%",J.style.transform="translateX(-50%)",J.style.backgroundColor="rgba(220, 53, 69, 0.9)",J.style.color="white",J.style.padding="10px 20px",J.style.borderRadius="5px",J.style.zIndex="1000",J.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",J.textContent=`Platform "${b}" not found. Please check spelling or click on map.`,document.body.appendChild(J),setTimeout(()=>{document.body.removeChild(J)},3e3)}A=null,w=b}}else console.log("ðŸŒ Platform manager not available"),A=null,w=b;else if(b&&typeof b=="object")if(b.mapClickSource==="directClick"&&(console.log("ðŸŒ Detected direct map click operation"),P=!0),b.nearestRig&&b.nearestRig.distance<=2){if(console.log(`ðŸŒ FastPlannerApp: Snapping to nearest rig: ${b.nearestRig.name} (${b.nearestRig.distance.toFixed(2)} nm away)`),b.nearestRig.coordinates)A=b.nearestRig.coordinates;else if(b.nearestRig.coords)A=b.nearestRig.coords;else if(b.nearestRig.lng!==void 0&&b.nearestRig.lat!==void 0)A=[b.nearestRig.lng,b.nearestRig.lat];else if(console.error("Invalid nearestRig coordinates format:",b.nearestRig),b.lngLat)A=[b.lngLat.lng,b.lngLat.lat];else{console.error("No valid coordinates found in nearestRig or lngLat");return}w=b.nearestRig.name}else if(b.coordinates)A=b.coordinates,w=b.name;else if(b.lngLat)A=[b.lngLat.lng,b.lngLat.lat],w=null;else{console.error("Invalid waypoint data format:",b);return}else{console.error("Invalid waypoint data:",b);return}if(!A&&w&&console.log(`ðŸŒ We need to search for location with name: ${w}`),!A||!Array.isArray(A)||A.length!==2){console.error("Invalid coordinates format:",A);return}if(typeof A[0]!="number"||typeof A[1]!="number"||isNaN(A[0])||isNaN(A[1])){console.error("Coordinates must be valid numbers:",A),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator("Invalid coordinates. Please try again.","error");return}console.log(`ðŸŒ FastPlannerApp: Adding waypoint at [${A}] with name "${w||"Unnamed"}", isMapClick=${P}`),s.current.addWaypoint(A,w);const G=s.current.getWaypoints();if(console.log(`ðŸŒ Updated waypoints (${G.length}):`,G),await new Promise(K=>{z([...G]),setTimeout(K,0)}),G.length>=2){const K=G.map(J=>J.coords);if(console.log(`ðŸŒ Recalculating routes for ${K.length} coordinates, isMapClick=${P}`),a.current&&(console.log("ðŸŒ Calculating route distance"),a.current.calculateDistanceOnly(K)),V&&(console.log("ðŸŒ Calculating full route stats with aircraft:",V.registration),a.current)){console.log("ðŸŒ Aircraft verification:",{modelType:V.modelType,cruiseSpeed:V.cruiseSpeed,fuelBurn:V.fuelBurn});const J={selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q};P&&(J.forceTimeCalculation=!0);const X=a.current.calculateRouteStats(K,J);if(console.log("ðŸŒ Raw calculation results:",X?{totalDistance:X.totalDistance,estimatedTime:X.estimatedTime,timeHours:X.timeHours,legs:((W=X.legs)==null?void 0:W.length)||0}:"No results"),X&&X.totalDistance&&(X.timeHours===0||X.estimatedTime==="00:00")){console.log("ðŸŒ FIXING ZERO TIME ISSUE: Manual time calculation");const Y=parseFloat(X.totalDistance);if(Y>0&&V.cruiseSpeed>0){const ne=Y/V.cruiseSpeed,oe=Math.floor(ne),ce=Math.floor((ne-oe)*60);X.timeHours=ne,X.estimatedTime=`${oe.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`,console.log("ðŸŒ Fixed time calculation:",{distance:Y,cruiseSpeed:V.cruiseSpeed,timeHours:ne,estimatedTime:X.estimatedTime})}}if(X&&X.timeHours>0){console.log("ðŸŒ Final calculation results:",{distance:X.totalDistance,time:X.estimatedTime,timeHours:X.timeHours,legs:((h=X.legs)==null?void 0:h.length)||0}),await new Promise(ne=>{be(X),window.currentRouteStats=X,setTimeout(ne,0)});const Y=Ce(G,X,V,Q);await new Promise(ne=>{_(Y),setTimeout(ne,0)}),setTimeout(()=>{u(ne=>ne+1),console.log("ðŸŒ Forced update after map click calculation")},50)}else{console.error("ðŸŒ Invalid calculation results even after fixes:",X),console.log("ðŸŒ Creating emergency backup calculation");let Y=0;for(let ee=0;ee<K.length-1;ee++){const Se=window.turf.point(K[ee]),Me=window.turf.point(K[ee+1]),Ie={units:"nauticalmiles"};Y+=window.turf.distance(Se,Me,Ie)}const ne=Y/V.cruiseSpeed,oe=Math.floor(ne),ce=Math.floor((ne-oe)*60),de=`${oe.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`,He={totalDistance:Y.toFixed(1),estimatedTime:de,timeHours:ne,fuelRequired:Math.round(ne*V.fuelBurn),tripFuel:Math.round(ne*V.fuelBurn),windAdjusted:!1};console.log("ðŸŒ Emergency backup calculation results:",He),await new Promise(ee=>{be(He),setTimeout(ee,0)});const pe=Ce(G,He,V,Q);await new Promise(ee=>{_(pe),setTimeout(ee,0)}),setTimeout(()=>{u(ee=>ee+1),console.log("ðŸŒ Forced emergency update")},50)}}}}},dt=b=>{var W;if(s.current){const h=s.current.getWaypoints();let A,w;if(typeof b=="string")A=b,w=h.findIndex(P=>P.id===A);else if(typeof b=="number")w=b,A=(W=h[w])==null?void 0:W.id;else{console.error("Invalid waypoint identifier:",b);return}if(console.log(`FastPlannerApp: Removing waypoint with ID ${A} at index ${w}`),A&&w!==-1){s.current.removeWaypoint(A,w);const P=s.current.getWaypoints();if(z([...P]),P.length>=2){const G=P.map(K=>K.coords);a.current&&a.current.calculateDistanceOnly(G),V&&(console.log("Recalculating route after removing waypoint"),a.current.calculateRouteStats(G,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q}),setTimeout(()=>{const K=Ce(P,ye,V,Q);_(K)},100))}else be(null)}else console.error(`FastPlannerApp: Cannot find waypoint to remove - ID: ${A}, Index: ${w}`)}},Lt=(b,W)=>{s.current&&(s.current.updateWaypointName(b,W),z([...s.current.getWaypoints()]))},Pt=()=>{s.current&&(s.current.clearRoute(),z([]),be(null))},Et=b=>{if(c.current&&q){console.log(`Adding favorite location to region ${q.id}:`,b),c.current.addFavoriteLocation(q.id,b);const W=c.current.getFavoriteLocationsByRegion(q.id);console.log(`Manually updating UI with ${W.length} favorites after adding:`,W),g(W)}else console.error("Cannot add favorite: No favorite locations manager or current region")},Mt=(b,W)=>{if(s.current&&b&&W){console.log(`FastPlannerApp: Reordering from ${b} to ${W}`),s.current.reorderWaypoints(b,W),z([...s.current.getWaypoints()]);const h=s.current.getWaypoints();if(h.length>=2){const A=h.map(w=>w.coords);a.current&&a.current.calculateDistanceOnly(A),V&&a.current.calculateRouteStats(A,{selectedAircraft:V,payloadWeight:le||0,reserveFuel:ie,weather:Q})}}else console.error("Cannot reorder: Missing waypoint manager or invalid IDs")},It=b=>{c.current&&q?(console.log(`Removing favorite location with ID ${b} from region ${q.id}`),c.current.removeFavoriteLocation(q.id,b),g(c.current.getFavoriteLocationsByRegion(q.id))):console.error("Cannot remove favorite: No favorite locations manager or current region")},$t=()=>{const b=!D;E(b),r.current&&r.current.toggleVisibility(b),v.current&&v.current.updateUISettings({platformsVisible:b})},Dt=()=>{console.log("loadCustomChart - Not implemented")},Ot=()=>{r.current&&q&&(O(!0),r.current.loadPlatformsFromFoundry(se,q.osdkRegion).then(()=>{B(!0),O(!1),E(!0)}).catch(b=>{console.error(`Error loading platforms: ${b}`),H(b.message),O(!1)}))},Wt=b=>{if(l.current){if(console.log(`Changing region to ${b}`),he(!0),Re(""),ve(""),Ye(null),l.current.setRegion(b),c.current){console.log(`Loading favorite locations for region: ${b}`);const W=c.current.getFavoriteLocationsByRegion(b);g(W)}v.current&&v.current.setRegion(b)}},Bt=b=>{Re(b),ve(""),Ye(null),v.current&&v.current.setAircraft(b,""),d.current&&q&&(Ae(!0),d.current.filterAircraft(q.id,b))},Ut=b=>{console.log(`âš¡ Changing aircraft registration to: ${b}`),ve(b);let W=null;if(Qe[ae]){if(W=Qe[ae].find(h=>h.registration===b),Ye(W),console.log("âš¡ Selected aircraft:",{registration:W==null?void 0:W.registration,type:W==null?void 0:W.modelType,cruiseSpeed:W==null?void 0:W.cruiseSpeed,fuelBurn:W==null?void 0:W.fuelBurn}),v.current&&v.current.setAircraft(ae,b),W)try{const h=`aircraft_${W.registration}`,A=localStorage.getItem(`fastPlanner_settings_${h}`);if(A){const w=JSON.parse(A);console.log(`Found saved settings for ${W.registration}:`,w),w.passengerWeight!==void 0&&Le(w.passengerWeight),w.contingencyFuelPercent!==void 0&&Ee(w.contingencyFuelPercent),w.taxiFuel!==void 0&&Pe(w.taxiFuel),w.reserveFuel!==void 0&&Ne(w.reserveFuel),w.deckTimePerStop!==void 0&&je(w.deckTimePerStop),w.deckFuelFlow!==void 0&&Te(w.deckFuelFlow),w.deckFuelPerStop!==void 0&&Ke(w.deckFuelPerStop),w.cargoWeight!==void 0&&Xe(w.cargoWeight);const P={...re,passengerWeight:w.passengerWeight||re.passengerWeight,contingencyFuelPercent:w.contingencyFuelPercent||re.contingencyFuelPercent,taxiFuel:w.taxiFuel||re.taxiFuel,reserveFuel:w.reserveFuel||re.reserveFuel,deckTimePerStop:w.deckTimePerStop||re.deckTimePerStop,deckFuelFlow:w.deckFuelFlow||re.deckFuelFlow};qe(P),j.current&&j.current.updateConfig(P),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator(`Loaded saved settings for ${W.registration}`)}else{const w=localStorage.getItem(`fastPlanner_settings_${ae}`);if(w){const P=JSON.parse(w);console.log(`Found saved settings for aircraft type ${ae}:`,P),P.passengerWeight!==void 0&&Le(P.passengerWeight),P.contingencyFuelPercent!==void 0&&Ee(P.contingencyFuelPercent),P.taxiFuel!==void 0&&Pe(P.taxiFuel),P.reserveFuel!==void 0&&Ne(P.reserveFuel),P.deckTimePerStop!==void 0&&je(P.deckTimePerStop),P.deckFuelFlow!==void 0&&Te(P.deckFuelFlow),P.deckFuelPerStop!==void 0&&Ke(P.deckFuelPerStop),P.cargoWeight!==void 0&&Xe(P.cargoWeight);const G={...re,passengerWeight:P.passengerWeight||re.passengerWeight,contingencyFuelPercent:P.contingencyFuelPercent||re.contingencyFuelPercent,taxiFuel:P.taxiFuel||re.taxiFuel,reserveFuel:P.reserveFuel||re.reserveFuel,deckTimePerStop:P.deckTimePerStop||re.deckTimePerStop,deckFuelFlow:P.deckFuelFlow||re.deckFuelFlow};qe(G),j.current&&j.current.updateConfig(G),window.LoadingIndicator&&window.LoadingIndicator.updateStatusIndicator(`Loaded ${ae} type settings`)}}}catch(h){console.error(`Error loading saved settings for ${b}:`,h)}if(b&&setTimeout(()=>{Re(""),ve(""),u(h=>h+1),console.log("Reset dropdowns after aircraft selection while keeping selectedAircraft")},100),W&&s.current){const h=s.current.getWaypoints();if(h.length>=2){const A=h.map(w=>w.coords);if(console.log(`âš¡ Recalculating route for ${h.length} waypoints after aircraft selection`),a.current){console.log("âš¡ Forcing route calculation after aircraft selection");const w=a.current.calculateRouteStats(A,{selectedAircraft:W,payloadWeight:le||0,reserveFuel:ie,weather:Q});if(console.log("âš¡ Direct calculation results:",{estimatedTime:w==null?void 0:w.estimatedTime,timeHours:w==null?void 0:w.timeHours,totalDistance:w==null?void 0:w.totalDistance}),w&&w.timeHours>0){console.log("âš¡ Directly updating route stats"),be(w);const P=Ce(h,w,W,Q);_(P),u(G=>G+1)}}}}}};return F.useEffect(()=>{if(d.current&&q&&se)if(console.log(`Loading aircraft for region ${q.name}`),Ae(!0),st.length>0)console.log("Aircraft already loaded, just filtering by region"),d.current.filterAircraft(q.id,ae),Ae(!1);else try{d.current.loadAircraftFromOSDK(se).then(()=>{console.log("Aircraft loaded from OSDK, filtering by region"),q&&d.current.filterAircraft(q.id,ae),Ae(!1)}).catch(b=>{console.error(`Error loading aircraft: ${b}`),Ae(!1)})}catch(b){console.error(`Error calling loadAircraftFromOSDK: ${b}`),Ae(!1)}},[q,se,ae,st.length]),F.useEffect(()=>{if(r.current&&q&&se){console.log(`Loading platforms for region ${q.name}`),O(!0);try{typeof r.current.loadPlatformsFromFoundry=="function"?r.current.loadPlatformsFromFoundry(se,q.osdkRegion).then(()=>{B(!0),O(!1),E(!0)}).catch(b=>{console.error(`Error loading platforms: ${b}`),H((b==null?void 0:b.message)||"Unknown error loading platforms"),O(!1)}):(console.error("PlatformManager.loadPlatformsFromFoundry is not a function"),H("Platform loading method not available"),O(!1))}catch(b){console.error(`Error calling platform loading method: ${b}`),H((b==null?void 0:b.message)||"Error loading platforms"),O(!1)}}},[q,se]),o.jsxs("div",{className:"fast-planner-container",children:[o.jsxs("div",{id:"loading-overlay",className:"loading-overlay",style:{display:"none"},children:[o.jsx("div",{className:"loading-spinner"}),o.jsx("div",{className:"loading-message",children:"Loading..."})]}),o.jsx(Ao,{routeStats:ye,selectedAircraft:V,waypoints:$,deckTimePerStop:Oe,deckFuelPerStop:ct,deckFuelFlow:We,passengerWeight:Be,cargoWeight:le,taxiFuel:Ue,contingencyFuelPercent:Je,reserveFuel:ie,weather:Q,stopCards:te}),o.jsx(ko,{mapManagerRef:n,onMapReady:et,className:"fast-planner-map"}),o.jsx(eo,{visible:C,onToggleVisibility:Rt,waypoints:$,onRemoveWaypoint:dt,onWaypointNameChange:Lt,onAddWaypoint:tt,onReorderWaypoints:Mt,routeInput:T,onRouteInputChange:jt,favoriteLocations:S,onAddFavoriteLocation:Et,onRemoveFavoriteLocation:It}),o.jsx(So,{visible:y,onToggleVisibility:Nt,onClearRoute:Pt,onLoadRigData:Ot,onToggleChart:$t,onLoadCustomChart:Dt,chartsVisible:D,aircraftType:ae,onAircraftTypeChange:Bt,aircraftRegistration:De,onAircraftRegistrationChange:Ut,selectedAircraft:V,aircraftsByType:Qe,aircraftLoading:wt,routeStats:ye,waypoints:$,onRemoveWaypoint:dt,isAuthenticated:m,authUserName:e,rigsLoading:M,onLogin:i,regions:me,currentRegion:q,onRegionChange:Wt,regionLoading:fe,deckTimePerStop:Oe,deckFuelPerStop:ct,deckFuelFlow:We,passengerWeight:Be,cargoWeight:le,taxiFuel:Ue,contingencyFuelPercent:Je,reserveMethod:At,onDeckTimeChange:b=>we("deckTimePerStop",b),onDeckFuelChange:b=>we("deckFuelPerStop",b),onDeckFuelFlowChange:b=>we("deckFuelFlow",b),onPassengerWeightChange:b=>we("passengerWeight",b),onCargoWeightChange:b=>we("cargoWeight",b),onTaxiFuelChange:b=>we("taxiFuel",b),onContingencyFuelPercentChange:b=>we("contingencyFuelPercent",b),onReserveMethodChange:b=>we("reserveMethod",b),forceUpdate:N,payloadWeight:Ct,onPayloadWeightChange:St,reserveFuel:ie,onReserveFuelChange:Ne,weather:Q,onWeatherUpdate:Tt})]})},Wo=()=>o.jsx("div",{className:"fast-planner-page",children:o.jsx(Oo,{})});function Bo(){return o.jsx(Zt,{children:o.jsx("div",{className:"app-container",children:o.jsx(Wo,{})})})}it.createRoot(document.getElementById("root")).render(o.jsx(Ve.StrictMode,{children:o.jsx(Bo,{})}));
//# sourceMappingURL=index-C5enLCAU.js.map

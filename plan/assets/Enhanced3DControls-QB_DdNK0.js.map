{"version":3,"file":"Enhanced3DControls-QB_DdNK0.js","sources":["../../src/components/fast-planner/modules/weather/Enhanced3DControls.js"],"sourcesContent":["/**\n * Enhanced3DControls.js\n * \n * Advanced camera controls for 3D flight simulation\n * Provides smooth, aviation-realistic camera movements for cloud penetration effects\n */\n\nclass Enhanced3DControls {\n    constructor(mapInstance) {\n        this.map = mapInstance;\n        this.isActive = false;\n        this.isDragging = false;\n        this.lastMousePos = null;\n        \n        // Camera constraints for aviation realism\n        this.constraints = {\n            minPitch: 0,      // Top-down view\n            maxPitch: 85,     // Nearly vertical (like looking up from cockpit)\n            minZoom: 1,       // Global view\n            maxZoom: 20,      // Close terrain view\n            pitchSensitivity: 0.3,  // Mouse sensitivity for pitch\n            bearingSensitivity: 0.5, // Mouse sensitivity for bearing\n            zoomSensitivity: 0.1     // Scroll sensitivity\n        };\n        \n        // Current camera state\n        this.camera = {\n            pitch: 0,\n            bearing: 0,\n            zoom: 6,\n            center: null\n        };\n        \n        console.log('🎮 Enhanced 3D Controls initialized');\n    }\n    \n    /**\n     * Activate enhanced 3D controls\n     */\n    activate() {\n        if (!this.map || this.isActive) return;\n        \n        this.isActive = true;\n        \n        // Store current camera state\n        this.camera.pitch = this.map.getPitch();\n        this.camera.bearing = this.map.getBearing();\n        this.camera.zoom = this.map.getZoom();\n        this.camera.center = this.map.getCenter();\n        \n        // Add custom mouse controls\n        this.addMouseControls();\n        this.addKeyboardControls();\n        this.addScrollControls();\n        \n        // Create control panel\n        this.createControlPanel();\n        \n        console.log('✅ Enhanced 3D controls activated');\n    }\n    \n    /**\n     * Deactivate enhanced controls and return to normal\n     */\n    deactivate() {\n        if (!this.isActive) return;\n        \n        this.isActive = false;\n        this.removeEventListeners();\n        this.removeControlPanel();\n        \n        // Reset to normal 2D view\n        this.map.easeTo({\n            pitch: 0,\n            bearing: 0,\n            duration: 1000\n        });\n        \n        console.log('📐 Enhanced 3D controls deactivated');\n    }\n    \n    /**\n     * Add advanced mouse controls for flight simulation\n     */\n    addMouseControls() {\n        // Right-click drag for pitch/bearing (like flight simulator)\n        this.onMouseDown = (e) => {\n            if (e.button === 2) { // Right mouse button\n                e.preventDefault();\n                this.isDragging = true;\n                this.lastMousePos = { x: e.clientX, y: e.clientY };\n                this.map.getContainer().style.cursor = 'move';\n            }\n        };\n        \n        this.onMouseMove = (e) => {\n            if (!this.isDragging || !this.lastMousePos) return;\n            \n            const deltaX = e.clientX - this.lastMousePos.x;\n            const deltaY = e.clientY - this.lastMousePos.y;\n            \n            // Calculate new camera angles\n            const newBearing = this.camera.bearing + (deltaX * this.constraints.bearingSensitivity);\n            const newPitch = Math.max(\n                this.constraints.minPitch,\n                Math.min(\n                    this.constraints.maxPitch,\n                    this.camera.pitch - (deltaY * this.constraints.pitchSensitivity)\n                )\n            );\n            \n            // Apply smooth camera movement\n            this.map.easeTo({\n                bearing: newBearing,\n                pitch: newPitch,\n                duration: 0 // Immediate for smooth dragging\n            });\n            \n            // Update camera state\n            this.camera.bearing = newBearing;\n            this.camera.pitch = newPitch;\n            \n            this.lastMousePos = { x: e.clientX, y: e.clientY };\n            this.updateControlPanel();\n        };\n        \n        this.onMouseUp = (e) => {\n            if (e.button === 2) {\n                this.isDragging = false;\n                this.lastMousePos = null;\n                this.map.getContainer().style.cursor = '';\n            }\n        };\n        \n        // Prevent context menu on right-click\n        this.onContextMenu = (e) => e.preventDefault();\n        \n        const container = this.map.getContainer();\n        container.addEventListener('mousedown', this.onMouseDown);\n        container.addEventListener('mousemove', this.onMouseMove);\n        container.addEventListener('mouseup', this.onMouseUp);\n        container.addEventListener('contextmenu', this.onContextMenu);\n    }\n    \n    /**\n     * Add keyboard controls for precise movements\n     */\n    addKeyboardControls() {\n        this.onKeyDown = (e) => {\n            if (!this.isActive) return;\n            \n            let handled = false;\n            const pitchStep = 5;\n            const bearingStep = 10;\n            const zoomStep = 0.5;\n            \n            switch (e.key) {\n                case 'ArrowUp':\n                case 'w':\n                case 'W':\n                    // Increase pitch (look up)\n                    this.adjustPitch(pitchStep);\n                    handled = true;\n                    break;\n                case 'ArrowDown':\n                case 's':\n                case 'S':\n                    // Decrease pitch (look down)\n                    this.adjustPitch(-pitchStep);\n                    handled = true;\n                    break;\n                case 'ArrowLeft':\n                case 'a':\n                case 'A':\n                    // Rotate left\n                    this.adjustBearing(-bearingStep);\n                    handled = true;\n                    break;\n                case 'ArrowRight':\n                case 'd':\n                case 'D':\n                    // Rotate right\n                    this.adjustBearing(bearingStep);\n                    handled = true;\n                    break;\n                case 'q':\n                case 'Q':\n                    // Zoom in (lower altitude)\n                    this.adjustZoom(zoomStep);\n                    handled = true;\n                    break;\n                case 'e':\n                case 'E':\n                    // Zoom out (higher altitude)\n                    this.adjustZoom(-zoomStep);\n                    handled = true;\n                    break;\n                case ' ':\n                    // Spacebar - reset to level flight\n                    this.resetToLevelFlight();\n                    handled = true;\n                    break;\n            }\n            \n            if (handled) {\n                e.preventDefault();\n                this.updateControlPanel();\n            }\n        };\n        \n        document.addEventListener('keydown', this.onKeyDown);\n    }\n    \n    /**\n     * Enhanced scroll controls for altitude simulation\n     */\n    addScrollControls() {\n        this.onWheel = (e) => {\n            if (!this.isActive) return;\n            \n            e.preventDefault();\n            \n            // Holding Shift = adjust pitch instead of zoom\n            if (e.shiftKey) {\n                const pitchDelta = e.deltaY * 0.1;\n                this.adjustPitch(-pitchDelta);\n            } else {\n                // Normal zoom with enhanced sensitivity\n                const zoomDelta = e.deltaY * -0.01 * this.constraints.zoomSensitivity;\n                this.adjustZoom(zoomDelta);\n            }\n            \n            this.updateControlPanel();\n        };\n        \n        this.map.getContainer().addEventListener('wheel', this.onWheel, { passive: false });\n    }\n    \n    /**\n     * Adjust pitch with constraints\n     */\n    adjustPitch(delta) {\n        const newPitch = Math.max(\n            this.constraints.minPitch,\n            Math.min(this.constraints.maxPitch, this.camera.pitch + delta)\n        );\n        \n        this.map.easeTo({\n            pitch: newPitch,\n            duration: 200\n        });\n        \n        this.camera.pitch = newPitch;\n    }\n    \n    /**\n     * Adjust bearing (rotation)\n     */\n    adjustBearing(delta) {\n        const newBearing = (this.camera.bearing + delta) % 360;\n        \n        this.map.easeTo({\n            bearing: newBearing,\n            duration: 200\n        });\n        \n        this.camera.bearing = newBearing;\n    }\n    \n    /**\n     * Adjust zoom (altitude simulation)\n     */\n    adjustZoom(delta) {\n        const newZoom = Math.max(\n            this.constraints.minZoom,\n            Math.min(this.constraints.maxZoom, this.camera.zoom + delta)\n        );\n        \n        this.map.easeTo({\n            zoom: newZoom,\n            duration: 200\n        });\n        \n        this.camera.zoom = newZoom;\n    }\n    \n    /**\n     * Reset to level flight (0 pitch, 0 bearing)\n     */\n    resetToLevelFlight() {\n        this.map.easeTo({\n            pitch: 0,\n            bearing: 0,\n            duration: 1000\n        });\n        \n        this.camera.pitch = 0;\n        this.camera.bearing = 0;\n    }\n    \n    /**\n     * Create on-screen control panel\n     */\n    createControlPanel() {\n        if (document.getElementById('enhanced-3d-controls')) return;\n        \n        const panel = document.createElement('div');\n        panel.id = 'enhanced-3d-controls';\n        panel.style.cssText = `\n            position: fixed;\n            top: 10px;\n            right: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 15px;\n            border-radius: 8px;\n            font-family: monospace;\n            font-size: 12px;\n            z-index: 1000;\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            min-width: 200px;\n        `;\n        \n        panel.innerHTML = `\n            <div style=\"font-weight: bold; margin-bottom: 8px; color: #4CAF50;\">🎮 Flight Controls</div>\n            <div id=\"camera-info\">\n                <div>Pitch: <span id=\"pitch-value\">0°</span></div>\n                <div>Bearing: <span id=\"bearing-value\">0°</span></div>\n                <div>Altitude: <span id=\"altitude-value\">0ft</span></div>\n            </div>\n            <div style=\"margin-top: 8px; font-size: 10px; color: #ccc;\">\n                <div>🖱️ Right-click + drag: Look around</div>\n                <div>⌨️ WASD/Arrows: Pitch/Turn</div>\n                <div>🖱️ Scroll: Altitude</div>\n                <div>⇧ Shift+Scroll: Pitch</div>\n                <div>⎵ Space: Level flight</div>\n                <div>🎚️ Q/E: Fine altitude</div>\n            </div>\n        `;\n        \n        document.body.appendChild(panel);\n        this.updateControlPanel();\n    }\n    \n    /**\n     * Update control panel display\n     */\n    updateControlPanel() {\n        const pitchEl = document.getElementById('pitch-value');\n        const bearingEl = document.getElementById('bearing-value');\n        const altitudeEl = document.getElementById('altitude-value');\n        \n        if (pitchEl) pitchEl.textContent = `${Math.round(this.camera.pitch)}°`;\n        if (bearingEl) bearingEl.textContent = `${Math.round(this.camera.bearing)}°`;\n        if (altitudeEl) {\n            // Calculate approximate altitude from zoom\n            const altitude = Math.round(Math.pow(2, 15 - this.camera.zoom) * 100);\n            altitudeEl.textContent = `${altitude.toLocaleString()}ft`;\n        }\n    }\n    \n    /**\n     * Remove control panel\n     */\n    removeControlPanel() {\n        const panel = document.getElementById('enhanced-3d-controls');\n        if (panel) {\n            panel.remove();\n        }\n    }\n    \n    /**\n     * Remove all event listeners\n     */\n    removeEventListeners() {\n        const container = this.map.getContainer();\n        if (this.onMouseDown) container.removeEventListener('mousedown', this.onMouseDown);\n        if (this.onMouseMove) container.removeEventListener('mousemove', this.onMouseMove);\n        if (this.onMouseUp) container.removeEventListener('mouseup', this.onMouseUp);\n        if (this.onContextMenu) container.removeEventListener('contextmenu', this.onContextMenu);\n        if (this.onWheel) container.removeEventListener('wheel', this.onWheel);\n        if (this.onKeyDown) document.removeEventListener('keydown', this.onKeyDown);\n    }\n    \n    /**\n     * Get current camera state\n     */\n    getCameraState() {\n        return {\n            ...this.camera,\n            estimatedAltitude: Math.round(Math.pow(2, 15 - this.camera.zoom) * 100)\n        };\n    }\n}\n\nexport default Enhanced3DControls;\n\n// Make available globally\nif (typeof window !== 'undefined') {\n    window.Enhanced3DControls = Enhanced3DControls;\n    console.log('🎮 Enhanced 3D Controls available at: window.Enhanced3DControls');\n}"],"names":["Enhanced3DControls","mapInstance","e","deltaX","deltaY","newBearing","newPitch","container","handled","pitchStep","bearingStep","zoomStep","pitchDelta","zoomDelta","delta","newZoom","panel","pitchEl","bearingEl","altitudeEl","altitude"],"mappings":"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"}
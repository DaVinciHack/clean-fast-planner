{"version":3,"file":"wireActionTypeV2ToSdkActionMetadata.js","names":["getModifiedEntityTypes","wireActionTypeV2ToSdkActionMetadata","input","modifiedEntityTypes","type","apiName","parameters","Object","fromEntries","entries","map","key","value","wireActionParameterV2ToSdkParameterDefinition","displayName","description","modifiedEntities","createModifiedEntities","addedObjects","modifiedObjects","rid","status","multiplicity","dataType","actionPropertyToSdkPropertyDefinition","subType","nullable","required","parameterType","objectSet","objectTypeApiName","object","interface","interfaceTypeApiName","struct","fields","reduce","structMap","structField","name","fieldType","Error","JSON","stringify","entities","created","modified"],"sources":["wireActionTypeV2ToSdkActionMetadata.ts"],"sourcesContent":["/*\n * Copyright 2023 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ActionMetadata } from \"@osdk/api\";\nimport type {\n  ActionParameterType,\n  ActionParameterV2,\n  ActionTypeV2,\n} from \"@osdk/foundry.ontologies\";\nimport { getModifiedEntityTypes } from \"./getEditedEntities.js\";\n\nexport function wireActionTypeV2ToSdkActionMetadata(\n  input: ActionTypeV2,\n): ActionMetadata {\n  const modifiedEntityTypes = getModifiedEntityTypes(input);\n  return {\n    type: \"action\",\n    apiName: input.apiName,\n    parameters: Object.fromEntries(\n      Object.entries(input.parameters).map((\n        [key, value],\n      ) => [key, wireActionParameterV2ToSdkParameterDefinition(value)]),\n    ),\n    displayName: input.displayName,\n    description: input.description,\n    modifiedEntities: createModifiedEntities(\n      modifiedEntityTypes.addedObjects,\n      modifiedEntityTypes.modifiedObjects,\n    ),\n    rid: input.rid,\n    status: input.status,\n  };\n}\n\nfunction wireActionParameterV2ToSdkParameterDefinition(\n  value: ActionParameterV2,\n): ActionMetadata.Parameter<any> {\n  return {\n    multiplicity: value.dataType.type === \"array\",\n    type: actionPropertyToSdkPropertyDefinition(\n      value.dataType.type === \"array\" ? value.dataType.subType : value.dataType,\n    ),\n    nullable: !value.required,\n    description: value.description,\n  };\n}\n\nfunction actionPropertyToSdkPropertyDefinition(\n  parameterType: ActionParameterType,\n): ActionMetadata.Parameter[\"type\"] {\n  switch (parameterType.type) {\n    case \"string\":\n    case \"boolean\":\n    case \"attachment\":\n    case \"double\":\n    case \"integer\":\n    case \"long\":\n    case \"timestamp\":\n    case \"mediaReference\":\n    case \"marking\":\n    case \"objectType\":\n      return parameterType.type;\n    case \"date\":\n      return \"datetime\";\n    case \"objectSet\":\n      return { type: \"objectSet\", objectSet: parameterType.objectTypeApiName! };\n    case \"object\":\n      return { type: \"object\", object: parameterType.objectTypeApiName };\n    case \"array\":\n      return actionPropertyToSdkPropertyDefinition(parameterType.subType);\n    case \"interfaceObject\":\n      return {\n        type: \"interface\",\n        interface: parameterType.interfaceTypeApiName,\n      };\n    case \"struct\":\n      return {\n        type: \"struct\",\n        struct: parameterType.fields.reduce(\n          (\n            structMap: Record<\n              string,\n              ActionMetadata.DataType.BaseActionParameterTypes\n            >,\n            structField,\n          ) => {\n            structMap[structField.name] = actionPropertyToSdkPropertyDefinition(\n              structField.fieldType as ActionParameterType,\n            ) as ActionMetadata.DataType.BaseActionParameterTypes;\n            return structMap;\n          },\n          {},\n        ),\n      };\n    default:\n      throw new Error(\n        `Unsupported action parameter type: ${JSON.stringify(parameterType)}`,\n      );\n  }\n}\n\nfunction createModifiedEntities<K extends string>(\n  addedObjects: Set<K>,\n  modifiedObjects: Set<K>,\n): ActionMetadata[\"modifiedEntities\"] {\n  const entities = {} as Record<\n    K,\n    {\n      created: boolean;\n      modified: boolean;\n    }\n  >;\n\n  for (const key of addedObjects) {\n    entities[key] = { created: true, modified: false };\n  }\n\n  for (const key of modifiedObjects) {\n    if (entities[key]) {\n      entities[key].modified = true;\n    } else {\n      entities[key] = { created: false, modified: true };\n    }\n  }\n\n  return entities;\n}\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"wireObjectTypeFullMetadataToSdkObjectMetadata.js","names":["wirePropertyV2ToSdkPrimaryKeyTypeDefinition","wirePropertyV2ToSdkPropertyDefinition","wireObjectTypeFullMetadataToSdkObjectMetadata","objectTypeWithLink","v2","log","objectType","properties","primaryKey","undefined","Error","apiName","implementsInterfaces2","implementsInterfaces","interfaceMap","Object","fromEntries","entries","map","interfaceApiName","impl","type","description","primaryKeyApiName","primaryKeyType","links","linkTypes","linkType","multiplicity","cardinality","targetType","objectTypeApiName","key","value","filter","implements","inverseInterfaceMap","props","invertProps","icon","supportedIconTypes","includes","titleProperty","displayName","pluralDisplayName","status","rid","visibility","a","k","v"],"sources":["wireObjectTypeFullMetadataToSdkObjectMetadata.ts"],"sourcesContent":["/*\n * Copyright 2023 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ObjectMetadata } from \"@osdk/api\";\nimport type {\n  ObjectTypeFullMetadata,\n  PropertyApiName,\n  PropertyV2,\n} from \"@osdk/foundry.ontologies\";\nimport { wirePropertyV2ToSdkPrimaryKeyTypeDefinition } from \"./wirePropertyV2ToSdkPrimaryKeyTypeDefinition.js\";\nimport { wirePropertyV2ToSdkPropertyDefinition } from \"./wirePropertyV2ToSdkPropertyDefinition.js\";\n\nexport function wireObjectTypeFullMetadataToSdkObjectMetadata(\n  objectTypeWithLink: ObjectTypeFullMetadata & {\n    objectType: {\n      properties: Record<PropertyApiName, PropertyV2 & { nullable?: boolean }>;\n    };\n  },\n  v2: boolean,\n  log?: { info: (msg: string) => void },\n): ObjectMetadata {\n  if (\n    objectTypeWithLink.objectType\n      .properties[objectTypeWithLink.objectType.primaryKey] === undefined\n  ) {\n    throw new Error(\n      `Primary key ${objectTypeWithLink.objectType.primaryKey} not found in ${objectTypeWithLink.objectType.apiName}`,\n    );\n  }\n\n  // saved ontology.json files may not have this implementsInterfaces2 so we need to handle\n  if (\n    objectTypeWithLink.implementsInterfaces2 == null\n    && objectTypeWithLink.implementsInterfaces != null\n  ) {\n    throw new Error(\n      \"Your ontology.json file is missing the implementsInterfaces2 field. Please regenerate it.\",\n    );\n  }\n\n  const interfaceMap = objectTypeWithLink.implementsInterfaces2\n    ? Object.fromEntries(\n      Object.entries(objectTypeWithLink.implementsInterfaces2).map(\n        ([interfaceApiName, impl]) => [interfaceApiName, impl.properties],\n      ),\n    )\n    : {};\n\n  return {\n    type: \"object\",\n    apiName: objectTypeWithLink.objectType.apiName,\n    description: objectTypeWithLink.objectType.description,\n    primaryKeyApiName: objectTypeWithLink.objectType.primaryKey,\n    primaryKeyType: wirePropertyV2ToSdkPrimaryKeyTypeDefinition(\n      objectTypeWithLink.objectType\n        .properties[objectTypeWithLink.objectType.primaryKey],\n    ),\n    links: Object.fromEntries(objectTypeWithLink.linkTypes.map(linkType => {\n      return [linkType.apiName, {\n        multiplicity: linkType.cardinality === \"MANY\",\n        targetType: linkType.objectTypeApiName,\n      }];\n    })),\n    properties: Object.fromEntries(\n      Object.entries(objectTypeWithLink.objectType.properties).map((\n        [key, value],\n      ) => [\n        key,\n        wirePropertyV2ToSdkPropertyDefinition(\n          value,\n          !(v2 && objectTypeWithLink.objectType.primaryKey === key),\n          log,\n        ),\n      ]).filter(([key, value]) => value != null),\n    ),\n    implements: objectTypeWithLink.implementsInterfaces as string[],\n    interfaceMap,\n    inverseInterfaceMap: Object.fromEntries(\n      Object.entries(interfaceMap).map((\n        [interfaceApiName, props],\n      ) => [interfaceApiName, invertProps(props)]),\n    ),\n    icon: supportedIconTypes.includes(objectTypeWithLink.objectType.icon.type)\n      ? objectTypeWithLink.objectType.icon\n      : undefined,\n    titleProperty: objectTypeWithLink.objectType.titleProperty,\n    displayName: objectTypeWithLink.objectType.displayName,\n    pluralDisplayName: objectTypeWithLink.objectType.pluralDisplayName,\n    status: objectTypeWithLink.objectType.status,\n    rid: objectTypeWithLink.objectType.rid,\n    visibility: objectTypeWithLink.objectType.visibility,\n  };\n}\n\nfunction invertProps(\n  a?: Record<string, string>,\n): typeof a extends undefined ? typeof a : Record<string, string> {\n  return (a\n    ? Object.fromEntries(Object.entries(a).map(([k, v]) => [v, k]))\n    : undefined) as typeof a extends undefined ? typeof a\n      : Record<string, string>;\n}\n\nconst supportedIconTypes = [\"blueprint\"];\n"],"mappings":"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","ignoreList":[]}
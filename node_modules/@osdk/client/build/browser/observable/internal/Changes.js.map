{"version":3,"file":"Changes.js","names":["MultiMap","DEBUG_ONLY__cacheKeyToString","Changes","modifiedObjects","addedObjects","added","Set","modified","registerObject","cacheKey","data","isNew","set","$apiName","add","registerList","key","isEmpty","size","createChangedObjects","DEBUG_ONLY__changesToString","changes","process","env","NODE_ENV","JSON","stringify","multimapHelper","listHelper","Error","Array","from","map","multimap","Object","fromEntries","associations","type","objects","o","$primaryKey"],"sources":["Changes.ts"],"sourcesContent":["/*\n * Copyright 2025 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MultiMap } from \"mnemonist\";\nimport type { ObjectHolder } from \"../../object/convertWireToOsdkObjects/ObjectHolder.js\";\nimport type { CacheKey } from \"./CacheKey.js\";\nimport { DEBUG_ONLY__cacheKeyToString } from \"./CacheKey.js\";\nimport type { ListCacheKey } from \"./ListQuery.js\";\nimport type { ObjectCacheKey } from \"./ObjectQuery.js\";\n\nexport class Changes {\n  modifiedObjects: MultiMap<string, ObjectHolder> = new MultiMap();\n  addedObjects: MultiMap<string, ObjectHolder> = new MultiMap();\n\n  added: Set<ListCacheKey | ObjectCacheKey> = new Set();\n  modified: Set<ListCacheKey | ObjectCacheKey> = new Set();\n\n  registerObject = (\n    cacheKey: ObjectCacheKey,\n    data: ObjectHolder,\n    isNew: boolean,\n  ): void => {\n    this[isNew ? \"addedObjects\" : \"modifiedObjects\"].set(data.$apiName, data);\n    this[isNew ? \"added\" : \"modified\"].add(cacheKey);\n  };\n\n  registerList = (key: ListCacheKey): void => {\n    this.modified.add(key);\n  };\n\n  isEmpty(): boolean {\n    return (\n      this.modifiedObjects.size === 0\n      && this.addedObjects.size === 0\n      && this.added.size === 0\n      && this.modified.size === 0\n    );\n  }\n}\n\nexport function createChangedObjects(): Changes {\n  return new Changes();\n}\n\nexport function DEBUG_ONLY__changesToString(changes: Changes): string {\n  if (process.env.NODE_ENV !== \"production\") {\n    return JSON.stringify(\n      {\n        modifiedObjects: multimapHelper(changes.modifiedObjects),\n        addedObjects: multimapHelper(changes.addedObjects),\n        added: listHelper(changes.added),\n        modified: listHelper(changes.modified),\n      },\n      null,\n      2,\n    );\n  } else {\n    throw new Error(\"not implemented\");\n  }\n}\n\nfunction listHelper(set: Set<CacheKey>) {\n  return Array.from(set).map(DEBUG_ONLY__cacheKeyToString);\n}\n\nfunction multimapHelper(\n  multimap: MultiMap<string, ObjectHolder>,\n) {\n  return Object.fromEntries(\n    Array.from(multimap.associations()).map(\n      ([type, objects]) => {\n        return [type, objects.map(o => o.$primaryKey)];\n      },\n    ),\n  );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,QAAQ,QAAQ,WAAW;AAGpC,SAASC,4BAA4B,QAAQ,eAAe;AAI5D,OAAO,MAAMC,OAAO,CAAC;EACnBC,eAAe,GAAmC,IAAIH,QAAQ,CAAC,CAAC;EAChEI,YAAY,GAAmC,IAAIJ,QAAQ,CAAC,CAAC;EAE7DK,KAAK,GAAuC,IAAIC,GAAG,CAAC,CAAC;EACrDC,QAAQ,GAAuC,IAAID,GAAG,CAAC,CAAC;EAExDE,cAAc,GAAGA,CACfC,QAAwB,EACxBC,IAAkB,EAClBC,KAAc,KACL;IACT,IAAI,CAACA,KAAK,GAAG,cAAc,GAAG,iBAAiB,CAAC,CAACC,GAAG,CAACF,IAAI,CAACG,QAAQ,EAAEH,IAAI,CAAC;IACzE,IAAI,CAACC,KAAK,GAAG,OAAO,GAAG,UAAU,CAAC,CAACG,GAAG,CAACL,QAAQ,CAAC;EAClD,CAAC;EAEDM,YAAY,GAAIC,GAAiB,IAAW;IAC1C,IAAI,CAACT,QAAQ,CAACO,GAAG,CAACE,GAAG,CAAC;EACxB,CAAC;EAEDC,OAAOA,CAAA,EAAY;IACjB,OACE,IAAI,CAACd,eAAe,CAACe,IAAI,KAAK,CAAC,IAC5B,IAAI,CAACd,YAAY,CAACc,IAAI,KAAK,CAAC,IAC5B,IAAI,CAACb,KAAK,CAACa,IAAI,KAAK,CAAC,IACrB,IAAI,CAACX,QAAQ,CAACW,IAAI,KAAK,CAAC;EAE/B;AACF;AAEA,OAAO,SAASC,oBAAoBA,CAAA,EAAY;EAC9C,OAAO,IAAIjB,OAAO,CAAC,CAAC;AACtB;AAEA,OAAO,SAASkB,2BAA2BA,CAACC,OAAgB,EAAU;EACpE,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;IACzC,OAAOC,IAAI,CAACC,SAAS,CACnB;MACEvB,eAAe,EAAEwB,cAAc,CAACN,OAAO,CAAClB,eAAe,CAAC;MACxDC,YAAY,EAAEuB,cAAc,CAACN,OAAO,CAACjB,YAAY,CAAC;MAClDC,KAAK,EAAEuB,UAAU,CAACP,OAAO,CAAChB,KAAK,CAAC;MAChCE,QAAQ,EAAEqB,UAAU,CAACP,OAAO,CAACd,QAAQ;IACvC,CAAC,EACD,IAAI,EACJ,CACF,CAAC;EACH,CAAC,MAAM;IACL,MAAM,IAAIsB,KAAK,CAAC,iBAAiB,CAAC;EACpC;AACF;AAEA,SAASD,UAAUA,CAAChB,GAAkB,EAAE;EACtC,OAAOkB,KAAK,CAACC,IAAI,CAACnB,GAAG,CAAC,CAACoB,GAAG,CAAC/B,4BAA4B,CAAC;AAC1D;AAEA,SAAS0B,cAAcA,CACrBM,QAAwC,EACxC;EACA,OAAOC,MAAM,CAACC,WAAW,CACvBL,KAAK,CAACC,IAAI,CAACE,QAAQ,CAACG,YAAY,CAAC,CAAC,CAAC,CAACJ,GAAG,CACrC,CAAC,CAACK,IAAI,EAAEC,OAAO,CAAC,KAAK;IACnB,OAAO,CAACD,IAAI,EAAEC,OAAO,CAACN,GAAG,CAACO,CAAC,IAAIA,CAAC,CAACC,WAAW,CAAC,CAAC;EAChD,CACF,CACF,CAAC;AACH","ignoreList":[]}
{"version":3,"file":"media.test.js","names":["$ontologyRid","objectTypeWithAllPropertyTypes","LegacyFauxFoundry","startNodeApiServer","stubData","beforeAll","describe","expect","it","createClient","client","testSetup","fauxFoundry","getDataStore","registerMedia","apiName","TextEncoder","encode","JSON","stringify","content","objectWithAllPropertyTypes1","mediaReference","apiServer","close","result","where","id","fetchPage","object1","data","toBeDefined","mediaMetadata","fetchMetadata","toEqual","path","mediaType","sizeBytes","mediaContent","fetchContents","json"],"sources":["media.test.ts"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  $ontologyRid,\n  objectTypeWithAllPropertyTypes,\n} from \"@osdk/client.test.ontology\";\nimport {\n  LegacyFauxFoundry,\n  startNodeApiServer,\n  stubData,\n} from \"@osdk/shared.test\";\nimport { beforeAll, describe, expect, it } from \"vitest\";\nimport type { Client } from \"../Client.js\";\nimport { createClient } from \"../createClient.js\";\n\ndescribe(\"media\", () => {\n  let client: Client;\n\n  beforeAll(() => {\n    const testSetup = startNodeApiServer(\n      new LegacyFauxFoundry(),\n      createClient,\n    );\n\n    ({ client } = testSetup);\n\n    testSetup.fauxFoundry\n      .getDataStore($ontologyRid)\n      .registerMedia(\n        objectTypeWithAllPropertyTypes.apiName,\n        \"mediaReference\",\n        new TextEncoder().encode(\n          JSON.stringify({ content: \"Hello World\" }),\n        ),\n        \"application/json\",\n        \"file1.txt\",\n        stubData.objectWithAllPropertyTypes1.mediaReference,\n      );\n\n    return () => {\n      testSetup.apiServer.close();\n    };\n  });\n\n  it(\"reads media metadata successfully\", async () => {\n    const result = await client(\n      objectTypeWithAllPropertyTypes,\n    )\n      .where({ id: stubData.objectWithAllPropertyTypes1.id }).fetchPage();\n\n    const object1 = result.data[0];\n    expect(object1.mediaReference).toBeDefined();\n    const mediaMetadata = await object1.mediaReference?.fetchMetadata();\n    expect(mediaMetadata).toEqual({\n      path: \"file1.txt\",\n      mediaType: \"application/json\",\n      sizeBytes: 25,\n    });\n  });\n\n  it(\"reads media content successfully\", async () => {\n    const result = await client(objectTypeWithAllPropertyTypes)\n      .where({ id: stubData.objectWithAllPropertyTypes1.id }).fetchPage();\n\n    const object1 = result.data[0];\n    expect(object1.mediaReference).toBeDefined();\n    const mediaContent = await object1?.mediaReference?.fetchContents();\n    expect(await mediaContent!.json()).toEqual({\n      content: \"Hello World\",\n    });\n  });\n});\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SACEA,YAAY,EACZC,8BAA8B,QACzB,4BAA4B;AACnC,SACEC,iBAAiB,EACjBC,kBAAkB,EAClBC,QAAQ,QACH,mBAAmB;AAC1B,SAASC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,EAAE,QAAQ,QAAQ;AAExD,SAASC,YAAY,QAAQ,oBAAoB;AAEjDH,QAAQ,CAAC,OAAO,EAAE,MAAM;EACtB,IAAII,MAAc;EAElBL,SAAS,CAAC,MAAM;IACd,MAAMM,SAAS,GAAGR,kBAAkB,CAClC,IAAID,iBAAiB,CAAC,CAAC,EACvBO,YACF,CAAC;IAED,CAAC;MAAEC;IAAO,CAAC,GAAGC,SAAS;IAEvBA,SAAS,CAACC,WAAW,CAClBC,YAAY,CAACb,YAAY,CAAC,CAC1Bc,aAAa,CACZb,8BAA8B,CAACc,OAAO,EACtC,gBAAgB,EAChB,IAAIC,WAAW,CAAC,CAAC,CAACC,MAAM,CACtBC,IAAI,CAACC,SAAS,CAAC;MAAEC,OAAO,EAAE;IAAc,CAAC,CAC3C,CAAC,EACD,kBAAkB,EAClB,WAAW,EACXhB,QAAQ,CAACiB,2BAA2B,CAACC,cACvC,CAAC;IAEH,OAAO,MAAM;MACXX,SAAS,CAACY,SAAS,CAACC,KAAK,CAAC,CAAC;IAC7B,CAAC;EACH,CAAC,CAAC;EAEFhB,EAAE,CAAC,mCAAmC,EAAE,YAAY;IAClD,MAAMiB,MAAM,GAAG,MAAMf,MAAM,CACzBT,8BACF,CAAC,CACEyB,KAAK,CAAC;MAAEC,EAAE,EAAEvB,QAAQ,CAACiB,2BAA2B,CAACM;IAAG,CAAC,CAAC,CAACC,SAAS,CAAC,CAAC;IAErE,MAAMC,OAAO,GAAGJ,MAAM,CAACK,IAAI,CAAC,CAAC,CAAC;IAC9BvB,MAAM,CAACsB,OAAO,CAACP,cAAc,CAAC,CAACS,WAAW,CAAC,CAAC;IAC5C,MAAMC,aAAa,GAAG,MAAMH,OAAO,CAACP,cAAc,EAAEW,aAAa,CAAC,CAAC;IACnE1B,MAAM,CAACyB,aAAa,CAAC,CAACE,OAAO,CAAC;MAC5BC,IAAI,EAAE,WAAW;MACjBC,SAAS,EAAE,kBAAkB;MAC7BC,SAAS,EAAE;IACb,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF7B,EAAE,CAAC,kCAAkC,EAAE,YAAY;IACjD,MAAMiB,MAAM,GAAG,MAAMf,MAAM,CAACT,8BAA8B,CAAC,CACxDyB,KAAK,CAAC;MAAEC,EAAE,EAAEvB,QAAQ,CAACiB,2BAA2B,CAACM;IAAG,CAAC,CAAC,CAACC,SAAS,CAAC,CAAC;IAErE,MAAMC,OAAO,GAAGJ,MAAM,CAACK,IAAI,CAAC,CAAC,CAAC;IAC9BvB,MAAM,CAACsB,OAAO,CAACP,cAAc,CAAC,CAACS,WAAW,CAAC,CAAC;IAC5C,MAAMO,YAAY,GAAG,MAAMT,OAAO,EAAEP,cAAc,EAAEiB,aAAa,CAAC,CAAC;IACnEhC,MAAM,CAAC,MAAM+B,YAAY,CAAEE,IAAI,CAAC,CAAC,CAAC,CAACN,OAAO,CAAC;MACzCd,OAAO,EAAE;IACX,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}
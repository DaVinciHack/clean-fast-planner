{"version":3,"file":"modernToLegacyGroupByClause.js","names":["DurationMapping","modernToLegacyGroupByClause","groupByClause","Object","entries","flatMap","field","type","maxGroupCount","$exactWithLimit","$exact","$limit","undefined","defaultValue","$defaultValue","fixedWidth","$fixedWidth","ranges","$ranges","map","range","convertRange","value","$duration","unit","startValue","endValue"],"sources":["modernToLegacyGroupByClause.ts"],"sourcesContent":["/*\n * Copyright 2023 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { AllGroupByValues, GroupByClause, GroupByRange } from \"@osdk/api\";\nimport { DurationMapping } from \"@osdk/api\";\nimport type {\n  AggregationGroupByV2,\n  AggregationRangeV2,\n} from \"@osdk/foundry.ontologies\";\n\n/** @internal */\nexport function modernToLegacyGroupByClause(\n  groupByClause: GroupByClause<any> | undefined,\n) {\n  if (!groupByClause) return [];\n\n  return Object.entries(\n    groupByClause as Record<string, AllGroupByValues>,\n  ).flatMap<AggregationGroupByV2>(([field, type]) => {\n    if (type === \"exact\") {\n      return [{ type, field }];\n    } else if (\"$exactWithLimit\" in type) {\n      {\n        return [\n          {\n            type: \"exact\",\n            field,\n            maxGroupCount: type.$exactWithLimit,\n          },\n        ];\n      }\n    } else if (\"$exact\" in type) {\n      return [\n        {\n          type: \"exact\",\n          field,\n          maxGroupCount: type.$exact?.$limit ?? undefined,\n          defaultValue: type.$exact.$defaultValue ?? undefined,\n        },\n      ];\n    } else if (\"$fixedWidth\" in type) {\n      return [{\n        type: \"fixedWidth\",\n        field,\n        fixedWidth: type.$fixedWidth,\n      }];\n    } else if (\"$ranges\" in type) {\n      return [{\n        type: \"ranges\",\n        field,\n        ranges: type.$ranges.map(range => convertRange(range)),\n      }];\n    } else if (\"$duration\" in type) {\n      return [{\n        type: \"duration\",\n        field,\n        value: type.$duration[0],\n        unit: DurationMapping[type.$duration[1]],\n      }];\n    } else return [];\n  });\n}\n\nfunction convertRange(\n  range: GroupByRange<number | string>,\n): AggregationRangeV2 {\n  return { startValue: range[0], endValue: range[1] };\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA,SAASA,eAAe,QAAQ,WAAW;AAM3C;AACA,OAAO,SAASC,2BAA2BA,CACzCC,aAA6C,EAC7C;EACA,IAAI,CAACA,aAAa,EAAE,OAAO,EAAE;EAE7B,OAAOC,MAAM,CAACC,OAAO,CACnBF,aACF,CAAC,CAACG,OAAO,CAAuB,CAAC,CAACC,KAAK,EAAEC,IAAI,CAAC,KAAK;IACjD,IAAIA,IAAI,KAAK,OAAO,EAAE;MACpB,OAAO,CAAC;QAAEA,IAAI;QAAED;MAAM,CAAC,CAAC;IAC1B,CAAC,MAAM,IAAI,iBAAiB,IAAIC,IAAI,EAAE;MACpC;QACE,OAAO,CACL;UACEA,IAAI,EAAE,OAAO;UACbD,KAAK;UACLE,aAAa,EAAED,IAAI,CAACE;QACtB,CAAC,CACF;MACH;IACF,CAAC,MAAM,IAAI,QAAQ,IAAIF,IAAI,EAAE;MAC3B,OAAO,CACL;QACEA,IAAI,EAAE,OAAO;QACbD,KAAK;QACLE,aAAa,EAAED,IAAI,CAACG,MAAM,EAAEC,MAAM,IAAIC,SAAS;QAC/CC,YAAY,EAAEN,IAAI,CAACG,MAAM,CAACI,aAAa,IAAIF;MAC7C,CAAC,CACF;IACH,CAAC,MAAM,IAAI,aAAa,IAAIL,IAAI,EAAE;MAChC,OAAO,CAAC;QACNA,IAAI,EAAE,YAAY;QAClBD,KAAK;QACLS,UAAU,EAAER,IAAI,CAACS;MACnB,CAAC,CAAC;IACJ,CAAC,MAAM,IAAI,SAAS,IAAIT,IAAI,EAAE;MAC5B,OAAO,CAAC;QACNA,IAAI,EAAE,QAAQ;QACdD,KAAK;QACLW,MAAM,EAAEV,IAAI,CAACW,OAAO,CAACC,GAAG,CAACC,KAAK,IAAIC,YAAY,CAACD,KAAK,CAAC;MACvD,CAAC,CAAC;IACJ,CAAC,MAAM,IAAI,WAAW,IAAIb,IAAI,EAAE;MAC9B,OAAO,CAAC;QACNA,IAAI,EAAE,UAAU;QAChBD,KAAK;QACLgB,KAAK,EAAEf,IAAI,CAACgB,SAAS,CAAC,CAAC,CAAC;QACxBC,IAAI,EAAExB,eAAe,CAACO,IAAI,CAACgB,SAAS,CAAC,CAAC,CAAC;MACzC,CAAC,CAAC;IACJ,CAAC,MAAM,OAAO,EAAE;EAClB,CAAC,CAAC;AACJ;AAEA,SAASF,YAAYA,CACnBD,KAAoC,EAChB;EACpB,OAAO;IAAEK,UAAU,EAAEL,KAAK,CAAC,CAAC,CAAC;IAAEM,QAAQ,EAAEN,KAAK,CAAC,CAAC;EAAE,CAAC;AACrD","ignoreList":[]}
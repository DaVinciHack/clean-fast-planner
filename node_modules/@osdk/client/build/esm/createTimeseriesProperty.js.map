{"version":3,"file":"createTimeseriesProperty.js","names":["OntologiesV2","asyncIterPointsHelper","getTimeRange","TimeSeriesPropertyImpl","triplet","client","constructor","objectApiName","primaryKey","propertyName","getFirstPoint","TimeSeriesPropertiesV2","ontologyRid","getLastPoint","getAllPoints","query","allPoints","point","asyncIterPoints","push","streamPointsIterator","streamPoints","range","timeseriesPoint"],"sources":["createTimeseriesProperty.ts"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  TimeSeriesPoint,\n  TimeSeriesProperty,\n  TimeSeriesQuery,\n} from \"@osdk/api\";\nimport * as OntologiesV2 from \"@osdk/foundry.ontologies\";\nimport type { MinimalClient } from \"./MinimalClientContext.js\";\nimport { asyncIterPointsHelper, getTimeRange } from \"./util/timeseriesUtils.js\";\n\nexport class TimeSeriesPropertyImpl<T extends number | string>\n  implements TimeSeriesProperty<T>\n{\n  #triplet: [string, any, string];\n  #client: MinimalClient;\n\n  constructor(\n    client: MinimalClient,\n    objectApiName: string,\n    primaryKey: any,\n    propertyName: string,\n  ) {\n    this.#client = client;\n    this.#triplet = [objectApiName, primaryKey, propertyName];\n  }\n\n  public async getFirstPoint(): Promise<TimeSeriesPoint<T>> {\n    return OntologiesV2.TimeSeriesPropertiesV2.getFirstPoint(\n      this.#client,\n      await this.#client.ontologyRid,\n      ...this.#triplet,\n    ) as Promise<TimeSeriesPoint<T>>;\n  }\n\n  public async getLastPoint(): Promise<TimeSeriesPoint<T>> {\n    return OntologiesV2.TimeSeriesPropertiesV2.getLastPoint(\n      this.#client,\n      await this.#client.ontologyRid,\n      ...this.#triplet,\n    ) as Promise<TimeSeriesPoint<T>>;\n  }\n\n  public async getAllPoints(\n    query?: TimeSeriesQuery,\n  ): Promise<TimeSeriesPoint<T>[]> {\n    const allPoints: Array<TimeSeriesPoint<T>> = [];\n\n    for await (const point of this.asyncIterPoints(query)) {\n      allPoints.push(point);\n    }\n    return allPoints;\n  }\n\n  public async *asyncIterPoints(\n    query?: TimeSeriesQuery,\n  ): AsyncGenerator<\n    {\n      time: any;\n      value: T;\n    },\n    void,\n    unknown\n  > {\n    const streamPointsIterator = await OntologiesV2.TimeSeriesPropertiesV2\n      .streamPoints(\n        this.#client,\n        await this.#client.ontologyRid,\n        ...this.#triplet,\n        query ? { range: getTimeRange(query) } : {},\n      );\n\n    for await (\n      const timeseriesPoint of asyncIterPointsHelper<T>(streamPointsIterator)\n    ) {\n      yield timeseriesPoint;\n    }\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOA,OAAO,KAAKA,YAAY,MAAM,0BAA0B;AAExD,SAASC,qBAAqB,EAAEC,YAAY,QAAQ,2BAA2B;AAE/E,OAAO,MAAMC,sBAAsB,CAEnC;EACE,CAACC,OAAO;EACR,CAACC,MAAM;EAEPC,WAAWA,CACTD,MAAqB,EACrBE,aAAqB,EACrBC,UAAe,EACfC,YAAoB,EACpB;IACA,IAAI,CAAC,CAACJ,MAAM,GAAGA,MAAM;IACrB,IAAI,CAAC,CAACD,OAAO,GAAG,CAACG,aAAa,EAAEC,UAAU,EAAEC,YAAY,CAAC;EAC3D;EAEA,MAAaC,aAAaA,CAAA,EAAgC;IACxD,OAAOV,YAAY,CAACW,sBAAsB,CAACD,aAAa,CACtD,IAAI,CAAC,CAACL,MAAM,EACZ,MAAM,IAAI,CAAC,CAACA,MAAM,CAACO,WAAW,EAC9B,GAAG,IAAI,CAAC,CAACR,OACX,CAAC;EACH;EAEA,MAAaS,YAAYA,CAAA,EAAgC;IACvD,OAAOb,YAAY,CAACW,sBAAsB,CAACE,YAAY,CACrD,IAAI,CAAC,CAACR,MAAM,EACZ,MAAM,IAAI,CAAC,CAACA,MAAM,CAACO,WAAW,EAC9B,GAAG,IAAI,CAAC,CAACR,OACX,CAAC;EACH;EAEA,MAAaU,YAAYA,CACvBC,KAAuB,EACQ;IAC/B,MAAMC,SAAoC,GAAG,EAAE;IAE/C,WAAW,MAAMC,KAAK,IAAI,IAAI,CAACC,eAAe,CAACH,KAAK,CAAC,EAAE;MACrDC,SAAS,CAACG,IAAI,CAACF,KAAK,CAAC;IACvB;IACA,OAAOD,SAAS;EAClB;EAEA,OAAcE,eAAeA,CAC3BH,KAAuB,EAQvB;IACA,MAAMK,oBAAoB,GAAG,MAAMpB,YAAY,CAACW,sBAAsB,CACnEU,YAAY,CACX,IAAI,CAAC,CAAChB,MAAM,EACZ,MAAM,IAAI,CAAC,CAACA,MAAM,CAACO,WAAW,EAC9B,GAAG,IAAI,CAAC,CAACR,OAAO,EAChBW,KAAK,GAAG;MAAEO,KAAK,EAAEpB,YAAY,CAACa,KAAK;IAAE,CAAC,GAAG,CAAC,CAC5C,CAAC;IAEH,WACE,MAAMQ,eAAe,IAAItB,qBAAqB,CAAImB,oBAAoB,CAAC,EACvE;MACA,MAAMG,eAAe;IACvB;EACF;AACF","ignoreList":[]}
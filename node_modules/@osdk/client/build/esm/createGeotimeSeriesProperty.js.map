{"version":3,"file":"createGeotimeSeriesProperty.js","names":["OntologiesV2","asyncIterPointsHelper","getTimeRange","GeotimeSeriesPropertyImpl","triplet","client","constructor","objectApiName","primaryKey","propertyName","initialValue","lastFetchedValue","getLatestValue","latestPointPromise","TimeSeriesValueBankProperties","ontologyRid","then","latestPoint","err","console","error","getAllValues","query","allPoints","point","asyncIterValues","push","streamPointsIterator","streamValues","range","timeseriesPoint"],"sources":["createGeotimeSeriesProperty.ts"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  GeotimeSeriesProperty,\n  TimeSeriesPoint,\n  TimeSeriesQuery,\n} from \"@osdk/api\";\nimport * as OntologiesV2 from \"@osdk/foundry.ontologies\";\nimport type { MinimalClient } from \"./MinimalClientContext.js\";\nimport { asyncIterPointsHelper, getTimeRange } from \"./util/timeseriesUtils.js\";\n\nexport class GeotimeSeriesPropertyImpl<T extends GeoJSON.Point>\n  implements GeotimeSeriesProperty<T>\n{\n  #triplet: [string, any, string];\n  #client: MinimalClient;\n  lastFetchedValue: TimeSeriesPoint<T> | undefined;\n\n  constructor(\n    client: MinimalClient,\n    objectApiName: string,\n    primaryKey: any,\n    propertyName: string,\n    initialValue?: TimeSeriesPoint<T>,\n  ) {\n    this.#client = client;\n    this.#triplet = [objectApiName, primaryKey, propertyName];\n    if (initialValue != null) {\n      this.lastFetchedValue = initialValue;\n    }\n  }\n\n  public async getLatestValue(): Promise<TimeSeriesPoint<T> | undefined> {\n    const latestPointPromise = OntologiesV2.TimeSeriesValueBankProperties\n      .getLatestValue(\n        this.#client,\n        await this.#client.ontologyRid,\n        ...this.#triplet,\n      );\n    latestPointPromise.then(\n      latestPoint => this.lastFetchedValue = latestPoint,\n      // eslint-disable-next-line no-console\n      err => void console.error(err),\n    );\n    return latestPointPromise;\n  }\n\n  public async getAllValues(\n    query?: TimeSeriesQuery,\n  ): Promise<TimeSeriesPoint<T>[]> {\n    const allPoints: Array<TimeSeriesPoint<T>> = [];\n\n    for await (const point of this.asyncIterValues(query)) {\n      allPoints.push(point);\n    }\n    return allPoints;\n  }\n\n  public async *asyncIterValues(\n    query?: TimeSeriesQuery,\n  ): AsyncGenerator<\n    {\n      time: any;\n      value: T;\n    },\n    void,\n    unknown\n  > {\n    const streamPointsIterator = await OntologiesV2\n      .TimeSeriesValueBankProperties.streamValues(\n        this.#client,\n        await this.#client.ontologyRid,\n        ...this.#triplet,\n        query ? { range: getTimeRange(query) } : {},\n      );\n\n    for await (\n      const timeseriesPoint of asyncIterPointsHelper<T>(streamPointsIterator)\n    ) {\n      yield timeseriesPoint;\n    }\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAOA,OAAO,KAAKA,YAAY,MAAM,0BAA0B;AAExD,SAASC,qBAAqB,EAAEC,YAAY,QAAQ,2BAA2B;AAE/E,OAAO,MAAMC,yBAAyB,CAEtC;EACE,CAACC,OAAO;EACR,CAACC,MAAM;EAGPC,WAAWA,CACTD,MAAqB,EACrBE,aAAqB,EACrBC,UAAe,EACfC,YAAoB,EACpBC,YAAiC,EACjC;IACA,IAAI,CAAC,CAACL,MAAM,GAAGA,MAAM;IACrB,IAAI,CAAC,CAACD,OAAO,GAAG,CAACG,aAAa,EAAEC,UAAU,EAAEC,YAAY,CAAC;IACzD,IAAIC,YAAY,IAAI,IAAI,EAAE;MACxB,IAAI,CAACC,gBAAgB,GAAGD,YAAY;IACtC;EACF;EAEA,MAAaE,cAAcA,CAAA,EAA4C;IACrE,MAAMC,kBAAkB,GAAGb,YAAY,CAACc,6BAA6B,CAClEF,cAAc,CACb,IAAI,CAAC,CAACP,MAAM,EACZ,MAAM,IAAI,CAAC,CAACA,MAAM,CAACU,WAAW,EAC9B,GAAG,IAAI,CAAC,CAACX,OACX,CAAC;IACHS,kBAAkB,CAACG,IAAI,CACrBC,WAAW,IAAI,IAAI,CAACN,gBAAgB,GAAGM,WAAW;IAClD;IACAC,GAAG,IAAI,KAAKC,OAAO,CAACC,KAAK,CAACF,GAAG,CAC/B,CAAC;IACD,OAAOL,kBAAkB;EAC3B;EAEA,MAAaQ,YAAYA,CACvBC,KAAuB,EACQ;IAC/B,MAAMC,SAAoC,GAAG,EAAE;IAE/C,WAAW,MAAMC,KAAK,IAAI,IAAI,CAACC,eAAe,CAACH,KAAK,CAAC,EAAE;MACrDC,SAAS,CAACG,IAAI,CAACF,KAAK,CAAC;IACvB;IACA,OAAOD,SAAS;EAClB;EAEA,OAAcE,eAAeA,CAC3BH,KAAuB,EAQvB;IACA,MAAMK,oBAAoB,GAAG,MAAM3B,YAAY,CAC5Cc,6BAA6B,CAACc,YAAY,CACzC,IAAI,CAAC,CAACvB,MAAM,EACZ,MAAM,IAAI,CAAC,CAACA,MAAM,CAACU,WAAW,EAC9B,GAAG,IAAI,CAAC,CAACX,OAAO,EAChBkB,KAAK,GAAG;MAAEO,KAAK,EAAE3B,YAAY,CAACoB,KAAK;IAAE,CAAC,GAAG,CAAC,CAC5C,CAAC;IAEH,WACE,MAAMQ,eAAe,IAAI7B,qBAAqB,CAAI0B,oBAAoB,CAAC,EACvE;MACA,MAAMG,eAAe;IACvB;EACF;AACF","ignoreList":[]}